---
title: Creación de aplicaciones web progresivas con ASP.NET Core Blazor WebAssembly
author: guardrex
description: Obtenga más información sobre cómo crear aplicaciones web progresivas basadas en Blazor (PWA), aplicaciones web que usan las características modernas del explorador para comportarse como aplicaciones de escritorio.
monikerRange: '>= aspnetcore-3.1'
ms.author: riande
ms.custom: mvc
ms.date: 03/09/2020
no-loc:
- Blazor
- SignalR
uid: blazor/progressive-web-app
ms.openlocfilehash: f1c1ce50f20bf579e67e1d4eb02cc7d9d681e354
ms.sourcegitcommit: 98bcf5fe210931e3eb70f82fd675d8679b33f5d6
ms.translationtype: HT
ms.contentlocale: es-ES
ms.lasthandoff: 03/11/2020
ms.locfileid: "79083564"
---
# <a name="build-progressive-web-applications-with-aspnet-core-opno-locblazor-webassembly"></a><span data-ttu-id="6ec2c-103">Creación de aplicaciones web progresivas con ASP.NET Core Blazor WebAssembly</span><span class="sxs-lookup"><span data-stu-id="6ec2c-103">Build Progressive Web Applications with ASP.NET Core Blazor WebAssembly</span></span>

<span data-ttu-id="6ec2c-104">Por [Steve Sanderson](https://github.com/SteveSandersonMS)</span><span class="sxs-lookup"><span data-stu-id="6ec2c-104">By [Steve Sanderson](https://github.com/SteveSandersonMS)</span></span>

[!INCLUDE[](~/includes/blazorwasm-preview-notice.md)]

[!INCLUDE[](~/includes/blazorwasm-3.2-template-article-notice.md)]

<span data-ttu-id="6ec2c-105">Una aplicación web progresiva (PWA) es una aplicación basada en web que usa las API y las capacidades del explorador moderno para comportarse como una aplicación de escritorio.</span><span class="sxs-lookup"><span data-stu-id="6ec2c-105">A Progressive Web Application (PWA) is a web-based application that uses modern browser APIs and capabilities to behave like a desktop application.</span></span> <span data-ttu-id="6ec2c-106">Estas son algunas de ellas:</span><span class="sxs-lookup"><span data-stu-id="6ec2c-106">These capabilities can include:</span></span>

* <span data-ttu-id="6ec2c-107">Trabajo sin conexión y carga instantánea, independientemente de la velocidad de la red</span><span class="sxs-lookup"><span data-stu-id="6ec2c-107">Working offline and always loading instantly, independently of network speed</span></span>
* <span data-ttu-id="6ec2c-108">Posibilidad de ejecutarse en su propia ventana de la aplicación, no solo en una ventana del explorador</span><span class="sxs-lookup"><span data-stu-id="6ec2c-108">Being able to run in its own application window, not just a browser window</span></span>
* <span data-ttu-id="6ec2c-109">Apertura desde el menú de inicio del sistema operativo host (SO) o la pantalla principal, o bien mediante acoplamiento</span><span class="sxs-lookup"><span data-stu-id="6ec2c-109">Being launched from the host operating system (OS) start menu, dock, or home screen</span></span>
* <span data-ttu-id="6ec2c-110">Recepción de notificaciones de inserción desde un servidor back-end, incluso aunque el usuario no esté usando la aplicación</span><span class="sxs-lookup"><span data-stu-id="6ec2c-110">Receiving push notifications from a backend server, even while the user is not using the application</span></span>
* <span data-ttu-id="6ec2c-111">Actualización automática en segundo plano</span><span class="sxs-lookup"><span data-stu-id="6ec2c-111">Automatically updating in the background</span></span>

<span data-ttu-id="6ec2c-112">Un usuario podría descubrir y usar la aplicación primero en su explorador web, como cualquier otra aplicación de página única (SPA), y, después, proceder a instalarla en su sistema operativo y habilitar las notificaciones de inserción.</span><span class="sxs-lookup"><span data-stu-id="6ec2c-112">A user might first discover and use the application within their web browser like any other single-page application (SPA), then later progress to installing it in their OS and enabling push notifications.</span></span> <span data-ttu-id="6ec2c-113">Este es el motivo por el que se usa el término *progresivo*.</span><span class="sxs-lookup"><span data-stu-id="6ec2c-113">That's why we use the term *progressive*.</span></span>

Blazor<span data-ttu-id="6ec2c-114"> WebAssembly es una verdadera plataforma de aplicaciones web de cliente basada en estándares, por lo que puede usar cualquier API del explorador, incluidas las API de PWA necesarias para las funcionalidades indicadas anteriormente.</span><span class="sxs-lookup"><span data-stu-id="6ec2c-114"> WebAssembly is a true standards-based client-side web application platform, so it can use any browser API, including PWA APIs needed for the capabilities listed above.</span></span> <span data-ttu-id="6ec2c-115">Puede funcionar sin conexión, de la misma manera que cualquier otra tecnología web del lado cliente.</span><span class="sxs-lookup"><span data-stu-id="6ec2c-115">It can work offline just like any other client-side web technology.</span></span>

## <a name="pwa-template"></a><span data-ttu-id="6ec2c-116">Plantilla de PWA</span><span class="sxs-lookup"><span data-stu-id="6ec2c-116">PWA template</span></span>

<span data-ttu-id="6ec2c-117">Al crear una nueva aplicación Blazor WebAssembly, se le ofrece la opción de agregar características de PWA.</span><span class="sxs-lookup"><span data-stu-id="6ec2c-117">When creating a new Blazor WebAssembly application, you are offered the option to add PWA features.</span></span> <span data-ttu-id="6ec2c-118">En Visual Studio, la opción se proporciona como una casilla en el cuadro de diálogo de creación del proyecto:</span><span class="sxs-lookup"><span data-stu-id="6ec2c-118">In Visual Studio, the option is given as a checkbox in the project creation dialog:</span></span>

![imagen](https://user-images.githubusercontent.com/1101362/76207411-a6b54200-61f5-11ea-9dfc-6acd87a91428.png)

<span data-ttu-id="6ec2c-120">Si va a crear el proyecto en la línea de comandos, puede usar la marca `--pwa`.</span><span class="sxs-lookup"><span data-stu-id="6ec2c-120">If you're creating the project on the command line, you can use the `--pwa` flag.</span></span> <span data-ttu-id="6ec2c-121">Por ejemplo,</span><span class="sxs-lookup"><span data-stu-id="6ec2c-121">For example,</span></span>

```dotnetcli
dotnet new blazorwasm --pwa -o MyNewProject
```

<span data-ttu-id="6ec2c-122">En ambos casos, se puede combinar con la opción "ASP.NET Core hospedada", si quiere, pero no es necesario hacerlo.</span><span class="sxs-lookup"><span data-stu-id="6ec2c-122">In both cases, you're free to combine this with the "ASP.NET Core hosted" option if you wish, but don't have to do so.</span></span> <span data-ttu-id="6ec2c-123">Las características de PWA son independientes del modelo de hospedaje.</span><span class="sxs-lookup"><span data-stu-id="6ec2c-123">PWA features are independent of the hosting model.</span></span>

## <a name="installation-and-app-manifest"></a><span data-ttu-id="6ec2c-124">Instalación y manifiesto de la aplicación</span><span class="sxs-lookup"><span data-stu-id="6ec2c-124">Installation and app manifest</span></span>

<span data-ttu-id="6ec2c-125">Al visitar una aplicación creada con la opción de plantilla PWA, los usuarios tienen la opción de instalar la aplicación desde el menú inicio o la pantalla principal de su sistema operativo, o bien mediante el acoplamiento.</span><span class="sxs-lookup"><span data-stu-id="6ec2c-125">When visiting an application created using the PWA template option, users have the option to install the application into their OS's start menu, dock, or home screen.</span></span>

<span data-ttu-id="6ec2c-126">La forma en la que se presenta esta opción depende del explorador del usuario.</span><span class="sxs-lookup"><span data-stu-id="6ec2c-126">The way this option is presented depends on the user's browser.</span></span> <span data-ttu-id="6ec2c-127">Por ejemplo, al usar exploradores basados en Chromium de escritorio, como Edge o Chrome, aparece un botón *Agregar* en la barra de direcciones URL:</span><span class="sxs-lookup"><span data-stu-id="6ec2c-127">For example, when using desktop Chromium-based browsers such as Edge or Chrome, an *Add* button appears within the URL bar:</span></span>

![imagen](https://user-images.githubusercontent.com/1101362/76208127-f7796a80-61f6-11ea-8aea-7fba704be787.png)

<span data-ttu-id="6ec2c-129">En iOS, los visitantes pueden instalar la PWA mediante el botón *Compartir* de Safari y la opción que permite la *adición a la pantalla de inicio*.</span><span class="sxs-lookup"><span data-stu-id="6ec2c-129">On iOS, visitors can install the PWA using Safari's *Share* button and its *Add to Homescreen* option.</span></span> <span data-ttu-id="6ec2c-130">En Chrome para Android, los usuarios deben pulsar el botón *Menú* en la esquina superior derecha y seleccionar *Agregar a la pantalla principal*.</span><span class="sxs-lookup"><span data-stu-id="6ec2c-130">On Chrome for Android, users should tap the *Menu* button in the upper-right corner, then choose *Add to Home screen*.</span></span>

<span data-ttu-id="6ec2c-131">Una vez instalada, la aplicación aparece en su propia ventana, sin ninguna barra de direcciones.</span><span class="sxs-lookup"><span data-stu-id="6ec2c-131">Once installed, the application appears in its own window, without any address bar.</span></span>

![imagen](https://user-images.githubusercontent.com/1101362/76208588-e2e9a200-61f7-11ea-85e1-8c3fc849b252.png)

<span data-ttu-id="6ec2c-133">Para personalizar el título, la combinación de colores, el icono u otros detalles de la ventana, vea el archivo `manifest.json` en el directorio *wwwroot* del proyecto.</span><span class="sxs-lookup"><span data-stu-id="6ec2c-133">To customize the window's title, color scheme, icon, or other details, see the file `manifest.json` in your project's *wwwroot* directory.</span></span> <span data-ttu-id="6ec2c-134">El esquema de este archivo se define mediante los estándares web.</span><span class="sxs-lookup"><span data-stu-id="6ec2c-134">The schema of this file is defined by web standards.</span></span> <span data-ttu-id="6ec2c-135">Para obtener documentación detallada, consulte https://developer.mozilla.org/docs/Web/Manifest.</span><span class="sxs-lookup"><span data-stu-id="6ec2c-135">For detailed documentation, see https://developer.mozilla.org/docs/Web/Manifest.</span></span>

## <a name="offline-support"></a><span data-ttu-id="6ec2c-136">Compatibilidad sin conexión</span><span class="sxs-lookup"><span data-stu-id="6ec2c-136">Offline support</span></span>

<span data-ttu-id="6ec2c-137">De forma predeterminada, las aplicaciones creadas con la opción de plantilla PWA tienen compatibilidad para ejecutarse sin conexión.</span><span class="sxs-lookup"><span data-stu-id="6ec2c-137">By default, applications created using the PWA template option have support for running offline.</span></span> <span data-ttu-id="6ec2c-138">Un usuario debe visitar primero la aplicación mientras está en línea y, después, el explorador descargará y almacenará en caché todos los recursos necesarios para trabajar sin conexión.</span><span class="sxs-lookup"><span data-stu-id="6ec2c-138">A user must first visit the application while they are online, then the browser will automatically download and cache all the resources needed to operate offline.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="6ec2c-139">La compatibilidad sin conexión solo está habilitada para *aplicaciones* publicadas.</span><span class="sxs-lookup"><span data-stu-id="6ec2c-139">Offline support is only enabled for *published* applications.</span></span> <span data-ttu-id="6ec2c-140">No se habilita durante el desarrollo.</span><span class="sxs-lookup"><span data-stu-id="6ec2c-140">It is not enabled during development.</span></span> <span data-ttu-id="6ec2c-141">Esto se debe a que interferiría con el ciclo de desarrollo habitual, que incluye la implementación de cambios y la realización de pruebas.</span><span class="sxs-lookup"><span data-stu-id="6ec2c-141">This is because it would interfere with the usual development cycle of making changes and testing them.</span></span>

> [!WARNING]
> <span data-ttu-id="6ec2c-142">Si quiere enviar una PWA habilitada para su uso sin conexión, hay [varias advertencias importantes](#caveats-for-offline-pwas) que debe comprender.</span><span class="sxs-lookup"><span data-stu-id="6ec2c-142">If you intend to ship an offline-enabled PWA, there are [several important warnings and caveats](#caveats-for-offline-pwas) you need to understand.</span></span> <span data-ttu-id="6ec2c-143">Son inherentes a PWA sin conexión y no son específicas de Blazor.</span><span class="sxs-lookup"><span data-stu-id="6ec2c-143">These are inherent to offline PWAs, and not specific to Blazor.</span></span> <span data-ttu-id="6ec2c-144">Asegúrese de leer y comprender estas advertencias antes de realizar suposiciones sobre cómo funcionará la aplicación habilitada para su uso sin conexión.</span><span class="sxs-lookup"><span data-stu-id="6ec2c-144">Be sure to read and understand these caveats before making assumptions about how your offline-enabled application will work.</span></span>

<span data-ttu-id="6ec2c-145">Para ver cómo funciona la compatibilidad sin conexión, primero [publique la aplicación](https://docs.microsoft.com/aspnet/core/host-and-deploy/blazor/?view=aspnetcore-3.1&tabs=visual-studio#publish-the-app) y hospédela en un servidor que admita HTTPS.</span><span class="sxs-lookup"><span data-stu-id="6ec2c-145">To see how offline support works, first [publish your application](https://docs.microsoft.com/aspnet/core/host-and-deploy/blazor/?view=aspnetcore-3.1&tabs=visual-studio#publish-the-app), and host it on a server supporting HTTPS.</span></span> <span data-ttu-id="6ec2c-146">Al visitar la aplicación, debería poder abrir las herramientas de desarrollo del explorador y comprobar que se ha registrado un *trabajo de servicio* para el host:</span><span class="sxs-lookup"><span data-stu-id="6ec2c-146">When you visit the application, you should be able to open the browser's dev tools and verify that a *Service Worker* is registered for your host:</span></span>

![imagen](https://user-images.githubusercontent.com/1101362/76210294-bd5e9780-61fb-11ea-9869-65c55c62803d.png)

<span data-ttu-id="6ec2c-148">Además, si vuelve a cargar la página, en la pestaña *Red* debería ver que todos los recursos necesarios para cargar la página se recuperan del *trabajo de servicio* o la *caché de memoria*:</span><span class="sxs-lookup"><span data-stu-id="6ec2c-148">Additionally, if you reload the page, then on the *Network* tab you should see that all resources needed to load your page are being retrieved from the *Service Worker* or *Memory Cache*:</span></span>

![imagen](https://user-images.githubusercontent.com/1101362/76210472-1d553e00-61fc-11ea-84c6-291644df709e.png)

<span data-ttu-id="6ec2c-150">Esto muestra que el explorador no depende del acceso a la red para cargar la aplicación.</span><span class="sxs-lookup"><span data-stu-id="6ec2c-150">This shows that the browser is not dependent on network access to load your application.</span></span> <span data-ttu-id="6ec2c-151">Para comprobarlo, puede apagar el servidor web o indicar al explorador que simule el modo sin conexión:</span><span class="sxs-lookup"><span data-stu-id="6ec2c-151">To verify this, you can either shut down your web server, or instruct the browser to simulate offline mode:</span></span>

![imagen](https://user-images.githubusercontent.com/1101362/76210556-47a6fb80-61fc-11ea-9d12-20a8f6528744.png)

<span data-ttu-id="6ec2c-153">Ahora, incluso sin acceso al servidor web, debería poder recargar la página y ver que la aplicación todavía se carga y se ejecuta.</span><span class="sxs-lookup"><span data-stu-id="6ec2c-153">Now, even without access to your web server, you should be able to reload the page and see that your application still loads and runs.</span></span> <span data-ttu-id="6ec2c-154">Del mismo modo, aunque se simule una conexión de red muy lenta, la página se cargará inmediatamente, ya que lo hace con independencia de la red.</span><span class="sxs-lookup"><span data-stu-id="6ec2c-154">Likewise, even if you simulate a very slow network connection, your page will still load immediately since it is loaded independently of the network.</span></span>

### <a name="service-worker"></a><span data-ttu-id="6ec2c-155">Trabajo de servicio</span><span class="sxs-lookup"><span data-stu-id="6ec2c-155">Service worker</span></span>

<span data-ttu-id="6ec2c-156">La compatibilidad sin conexión se logra mediante un trabajo de servicio.</span><span class="sxs-lookup"><span data-stu-id="6ec2c-156">Offline support is achieved using a service worker.</span></span> <span data-ttu-id="6ec2c-157">Se trata de un estándar web, no específico de Blazor.</span><span class="sxs-lookup"><span data-stu-id="6ec2c-157">This is a web standard, not specific to Blazor.</span></span> <span data-ttu-id="6ec2c-158">Para obtener documentación sobre los trabajos de servicio, consulte https://developer.mozilla.org/docs/Web/API/Service_Worker_API.</span><span class="sxs-lookup"><span data-stu-id="6ec2c-158">For documentation about service workers, see https://developer.mozilla.org/docs/Web/API/Service_Worker_API.</span></span> <span data-ttu-id="6ec2c-159">Para obtener más información sobre los patrones de uso comunes de los trabajos de servicio, consulte el excelente artículo [Ciclo de vida de trabajo de servicio](https://developers.google.com/web/fundamentals/primers/service-workers/lifecycle).</span><span class="sxs-lookup"><span data-stu-id="6ec2c-159">To learn more about common usage patterns for service workers, see the excellent article [The Service Worker Lifecycle](https://developers.google.com/web/fundamentals/primers/service-workers/lifecycle).</span></span>

<span data-ttu-id="6ec2c-160">La plantilla de PWA de Blazor genera dos archivos de trabajo de servicio:</span><span class="sxs-lookup"><span data-stu-id="6ec2c-160">Blazor's PWA template produces two service worker files:</span></span>

* <span data-ttu-id="6ec2c-161">*wwwroot/service-worker.js*, que se usa durante el desarrollo.</span><span class="sxs-lookup"><span data-stu-id="6ec2c-161">*wwwroot/service-worker.js*, which is used during development</span></span>
* <span data-ttu-id="6ec2c-162">*wwwroot/service-worker.published.js*, que se usa una vez publicada la aplicación.</span><span class="sxs-lookup"><span data-stu-id="6ec2c-162">*wwwroot/service-worker.published.js*, which is used once your application is published</span></span>

<span data-ttu-id="6ec2c-163">Si quiere compartir la lógica entre estos dos archivos, considere la posibilidad de agregar un tercer archivo JavaScript para que contenga la lógica común y use [`self.importScripts`](https://developer.mozilla.org/docs/Web/API/WorkerGlobalScope/importScripts) para cargar dicha lógica en ambos archivos.</span><span class="sxs-lookup"><span data-stu-id="6ec2c-163">If you want to share logic between these two files, consider adding a third JavaScript file to hold the common logic, and use [`self.importScripts`](https://developer.mozilla.org/docs/Web/API/WorkerGlobalScope/importScripts) to load that logic into both files.</span></span>

#### <a name="cache-first-fetch-strategy"></a><span data-ttu-id="6ec2c-164">Estrategia de captura desde la caché</span><span class="sxs-lookup"><span data-stu-id="6ec2c-164">Cache-first fetch strategy</span></span>

<span data-ttu-id="6ec2c-165">El servicio de trabajo integrado *service-worker.published.js* resuelve las solicitudes mediante una estrategia *desde la caché*.</span><span class="sxs-lookup"><span data-stu-id="6ec2c-165">The built-in *service-worker.published.js* service worker resolves requests using a *cache-first* strategy.</span></span> <span data-ttu-id="6ec2c-166">Esto significa que siempre prefiere devolver el contenido almacenado en la caché, si está disponible, independientemente de si el usuario tiene acceso de red o de si el contenido nuevo está disponible en el servidor.</span><span class="sxs-lookup"><span data-stu-id="6ec2c-166">This means it always prefers to return cached content if available, regardless of whether the user has network access or whether newer content is available on the server.</span></span>

<span data-ttu-id="6ec2c-167">Existen dos razones por las que esto es útil:</span><span class="sxs-lookup"><span data-stu-id="6ec2c-167">There are two reasons why this is valuable:</span></span>

* <span data-ttu-id="6ec2c-168">**Garantiza la confiabilidad.**</span><span class="sxs-lookup"><span data-stu-id="6ec2c-168">**It ensures reliability.**</span></span> <span data-ttu-id="6ec2c-169">El acceso a la red no es un estado booleano.</span><span class="sxs-lookup"><span data-stu-id="6ec2c-169">Network access is not a boolean state.</span></span> <span data-ttu-id="6ec2c-170">Un usuario no está simplemente "en línea" o "sin conexión".</span><span class="sxs-lookup"><span data-stu-id="6ec2c-170">A user is not simply "online" or "offline".</span></span> <span data-ttu-id="6ec2c-171">En realidad, el dispositivo del usuario puede creer que está en línea, pero la red puede ser tan lenta como para que no sea factible esperar.</span><span class="sxs-lookup"><span data-stu-id="6ec2c-171">In reality, the user's device may believe it is online, but the network may be so slow as to be impractical to wait for.</span></span> <span data-ttu-id="6ec2c-172">O bien, es posible que la red devuelva resultados no válidos para ciertas direcciones URL, como cuando hay un portal WIFI cautivo que está bloqueando o redirigiendo determinadas solicitudes.</span><span class="sxs-lookup"><span data-stu-id="6ec2c-172">Or the network might be returning invalid results for certain URLs, such as when there is a captive WIFI portal that is currently blocking or redirecting certain requests.</span></span> <span data-ttu-id="6ec2c-173">Esta es la razón por la que la API de `navigator.onLine` del explorador no es confiable y no se debe depender de ella.</span><span class="sxs-lookup"><span data-stu-id="6ec2c-173">This is why the browser's `navigator.onLine` API is not reliable and should not be depended upon.</span></span>
* <span data-ttu-id="6ec2c-174">**Garantiza la corrección.**</span><span class="sxs-lookup"><span data-stu-id="6ec2c-174">**It ensures correctness.**</span></span> <span data-ttu-id="6ec2c-175">Al compilar una memoria caché de recursos sin conexión, el trabajo de servicio usa el hash de contenido para garantizar que ha capturado una instantánea completa y autocoherente de los recursos en un solo instante en el tiempo.</span><span class="sxs-lookup"><span data-stu-id="6ec2c-175">When building a cache of offline resources, the service worker uses content hashing to guarantee it has fetched a complete and self-consistent snapshot of resources at a single instant in time.</span></span> <span data-ttu-id="6ec2c-176">Después, esta caché se utiliza como unidad atómica.</span><span class="sxs-lookup"><span data-stu-id="6ec2c-176">This cache is then used as an atomic unit.</span></span> <span data-ttu-id="6ec2c-177">Teniendo esto en cuenta, no hay ningún punto que solicite a la red recursos más recientes, ya que las únicas versiones que quiere son las que ya se han almacenado en la memoria caché.</span><span class="sxs-lookup"><span data-stu-id="6ec2c-177">Given this, there is no point asking the network for newer resources, since the only versions you want are the ones you've already cached.</span></span> <span data-ttu-id="6ec2c-178">Cualquier otra cosa implica un riesgo de incoherencias e incompatibilidad (por ejemplo, intentar usar versiones de ensamblados .NET que no se compilaron juntos).</span><span class="sxs-lookup"><span data-stu-id="6ec2c-178">Anything else risks inconsistency and incompatibility (for example, trying to use versions of .NET assemblies that were not compiled together).</span></span>

#### <a name="background-updates"></a><span data-ttu-id="6ec2c-179">Actualizaciones en segundo plano</span><span class="sxs-lookup"><span data-stu-id="6ec2c-179">Background updates</span></span>

<span data-ttu-id="6ec2c-180">Como modelo mental, puede pensar que una PWA sin conexión se comporta como una aplicación móvil que se puede instalar.</span><span class="sxs-lookup"><span data-stu-id="6ec2c-180">As a mental model, you can think of an offline-first PWA as behaving like an mobile app that can be installed.</span></span> <span data-ttu-id="6ec2c-181">Siempre se inicia inmediatamente, independientemente de la conectividad de la red, pero la lógica de la aplicación instalada procede de una instantánea de un momento dado que podría no ser la versión más reciente.</span><span class="sxs-lookup"><span data-stu-id="6ec2c-181">It always starts up immediately regardless of network connectivity, but the installed application logic comes from a point-in-time snapshot that might not be the latest version.</span></span>

<span data-ttu-id="6ec2c-182">La plantilla PWA Blazor genera aplicaciones que intentan actualizarse automáticamente en segundo plano cada vez que el usuario realiza una visita y tiene una conexión de red operativa.</span><span class="sxs-lookup"><span data-stu-id="6ec2c-182">The Blazor PWA template produces applications that automatically try to update themselves in the background whenever the user visits and has a working network connection.</span></span> <span data-ttu-id="6ec2c-183">Así es como funciona:</span><span class="sxs-lookup"><span data-stu-id="6ec2c-183">The way this works is as follows:</span></span>

* <span data-ttu-id="6ec2c-184">Durante la compilación, el proyecto genera un *manifiesto de recursos de trabajo de servicio*.</span><span class="sxs-lookup"><span data-stu-id="6ec2c-184">During compilation, your project generates a *service worker assets manifest*.</span></span> <span data-ttu-id="6ec2c-185">De forma predeterminada, este se denomina *service-worker-assets.js*.</span><span class="sxs-lookup"><span data-stu-id="6ec2c-185">By default this is called *service-worker-assets.js*.</span></span> <span data-ttu-id="6ec2c-186">Aquí se enumeran todos los recursos estáticos que la aplicación necesita para funcionar sin conexión, como los ensamblados .NET, los archivos JavaScript, CSS, etc., incluidos sus hash de contenido.</span><span class="sxs-lookup"><span data-stu-id="6ec2c-186">This lists all the static resources your application needs to function offline, such as .NET assemblies, JavaScript files, CSS, etc., including their content hashes.</span></span> <span data-ttu-id="6ec2c-187">Esta lista la carga el trabajo de servicio para que sepa qué recursos almacenar en la caché.</span><span class="sxs-lookup"><span data-stu-id="6ec2c-187">This list is loaded by your service worker so that it knows which resources to cache.</span></span>
* <span data-ttu-id="6ec2c-188">Cada vez que el usuario visita su aplicación, el explorador vuelve a solicitar *service-worker.js* y *service-worker-assets.js* en segundo plano.</span><span class="sxs-lookup"><span data-stu-id="6ec2c-188">Each time the user visits your application, the browser re-requests *service-worker.js* and *service-worker-assets.js* in the background.</span></span> <span data-ttu-id="6ec2c-189">Si el servidor devuelve contenido modificado para cualquiera de estos archivos (comparado byte por byte con el trabajo de servicio instalado), el trabajo de servicio intenta instalar una nueva versión de sí mismo.</span><span class="sxs-lookup"><span data-stu-id="6ec2c-189">If the server returns changed content for either of these files (compared byte-for-byte with the existing installed service worker), the service worker tries to install a new version of itself.</span></span>
* <span data-ttu-id="6ec2c-190">Al instalar una nueva versión de sí mismo, el trabajo de servicio crea una nueva memoria caché independiente para los recursos sin conexión y comienza a rellenarla con los recursos enumerados en *service-worker-assets.js*.</span><span class="sxs-lookup"><span data-stu-id="6ec2c-190">When installing a new version of itself, the service worker creates a new, separate cache for offline resources, and starts populating it with resources listed in *service-worker-assets.js*.</span></span> <span data-ttu-id="6ec2c-191">Esta lógica se implementa en la `onInstall`función dentro de *service-worker.published.js*.</span><span class="sxs-lookup"><span data-stu-id="6ec2c-191">This logic is implemented in the `onInstall` function inside *service-worker.published.js*.</span></span>
* <span data-ttu-id="6ec2c-192">Si el proceso se completa correctamente (es decir, todos los recursos se cargan sin errores y todos los hash de contenido coinciden), el nuevo trabajo de servicio entra en estado "en espera de activación".</span><span class="sxs-lookup"><span data-stu-id="6ec2c-192">If the process completes successfully (i.e., all the resources are loaded without error, and all content hashes match), then the new service worker enters a "waiting for activation" state.</span></span> <span data-ttu-id="6ec2c-193">En cuanto el usuario cierra la aplicación (es decir, no quedan pestañas o ventanas que muestren la aplicación), el nuevo trabajo de servicio se convierte en "activo" y se usará para las visitas posteriores a la aplicación.</span><span class="sxs-lookup"><span data-stu-id="6ec2c-193">As soon as the user closes your application (i.e., there are no remaining tabs or windows displaying your application), the new service worker becomes "active" and will be used for subsequent visits to your application.</span></span> <span data-ttu-id="6ec2c-194">El trabajo de servicio anterior y su memoria caché se eliminan.</span><span class="sxs-lookup"><span data-stu-id="6ec2c-194">The old service worker and its cache are deleted.</span></span>
* <span data-ttu-id="6ec2c-195">Si el proceso no se completa correctamente, se descarta la nueva instancia de trabajo de servicio.</span><span class="sxs-lookup"><span data-stu-id="6ec2c-195">If the process does not complete successfully, the new service worker instance is discarded.</span></span> <span data-ttu-id="6ec2c-196">El proceso de actualización se volverá a intentar en la próxima visita del usuario; con suerte, tendrá una mejor conexión de red que permita completar las solicitudes.</span><span class="sxs-lookup"><span data-stu-id="6ec2c-196">The update process will be attempted again on the user's next visit, when hopefully they have a better network connection that can complete the requests.</span></span>

<span data-ttu-id="6ec2c-197">Puede personalizar cualquier aspecto de este proceso editando la lógica del trabajo de servicio.</span><span class="sxs-lookup"><span data-stu-id="6ec2c-197">You can customize any aspect of this process by editing the service worker logic.</span></span> <span data-ttu-id="6ec2c-198">Ninguna de las opciones anteriores es específica de Blazor, sino que es simplemente una sugerencia proporcionada por la opción de plantilla de PWA.</span><span class="sxs-lookup"><span data-stu-id="6ec2c-198">None of the above is specific to Blazor, but is merely a suggestion provided by the PWA template option.</span></span> <span data-ttu-id="6ec2c-199">Para obtener más información, consulte la [documentación sobre el trabajo de servicio](https://developer.mozilla.org/docs/Web/API/Service_Worker_API.).</span><span class="sxs-lookup"><span data-stu-id="6ec2c-199">See [service worker documentation](https://developer.mozilla.org/docs/Web/API/Service_Worker_API.) for more information.</span></span>

#### <a name="how-requests-are-resolved"></a><span data-ttu-id="6ec2c-200">Procedimientos para resolver las solicitudes</span><span class="sxs-lookup"><span data-stu-id="6ec2c-200">How requests are resolved</span></span>

<span data-ttu-id="6ec2c-201">Tal y como se ha descrito anteriormente, el trabajo de servicio predeterminado utiliza una estrategia *desde la caché*, lo que significa que intenta servir contenido almacenado en la caché cuando esté disponible.</span><span class="sxs-lookup"><span data-stu-id="6ec2c-201">As described above, the default service worker uses a *cache-first* strategy, meaning that it tries to serve cached content when available.</span></span> <span data-ttu-id="6ec2c-202">Si no hay contenido almacenado en la caché para una dirección URL determinada (por ejemplo, cuando se solicitan datos de una API de back-end), el trabajo de servicio recurre a una solicitud de red normal que solo puede realizarse si el servidor es accesible.</span><span class="sxs-lookup"><span data-stu-id="6ec2c-202">If there is no content cached for a certain URL, for example when requesting data from a backend API, the service worker falls back on a regular network request which can only succeed if the server is reachable.</span></span> <span data-ttu-id="6ec2c-203">Esta lógica se implementa `onFetch`dentro de *service-worker.published.js*.</span><span class="sxs-lookup"><span data-stu-id="6ec2c-203">This logic is implemented inside `onFetch` within *service-worker.published.js*.</span></span>

<span data-ttu-id="6ec2c-204">Si los componentes de Blazor dependen de la solicitud de datos de las API de back-end y quiere proporcionar una experiencia de usuario sencilla en caso de que estas solicitudes generen un error debido a la falta de disponibilidad de la red, debe implementar la lógica dentro de los componentes.</span><span class="sxs-lookup"><span data-stu-id="6ec2c-204">If your Blazor components rely on requesting data from backend APIs, and you want to provide a friendly user experience in the case where such requests fail due to network unavailability, then you need to implement logic within your components.</span></span> <span data-ttu-id="6ec2c-205">Por ejemplo, use solicitudes `try/catch` en torno a `HttpClient`.</span><span class="sxs-lookup"><span data-stu-id="6ec2c-205">For example, use `try/catch` around `HttpClient` requests.</span></span>

#### <a name="support-server-rendered-pages"></a><span data-ttu-id="6ec2c-206">Compatibilidad de las páginas representadas por el servidor</span><span class="sxs-lookup"><span data-stu-id="6ec2c-206">Support server-rendered pages</span></span>

<span data-ttu-id="6ec2c-207">Tenga en cuenta lo que sucede cuando el usuario navega por primera vez a una dirección URL como `/counter` o cualquier otro vínculo profundo de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="6ec2c-207">Consider what happens when the user first navigates to a URL such as `/counter` or any other deep link into your application.</span></span> <span data-ttu-id="6ec2c-208">En estos casos, no quiere devolver el contenido almacenado en la caché como `/counter`, sino que necesita que el explorador cargue el contenido almacenado en la caché como `/index.html` para iniciar la aplicación Blazor WebAssembly.</span><span class="sxs-lookup"><span data-stu-id="6ec2c-208">In these cases, you don't want to return content cached as `/counter`, but instead need the browser to load the content cached as `/index.html` to start up your Blazor WebAssembly application.</span></span> <span data-ttu-id="6ec2c-209">Estas solicitudes iniciales se conocen como solicitudes de *navegación* (en lugar de solicitudes de *subrecursos* de imágenes, CSS, etc., o solicitudes de *captura/XHR* de los datos de la API).</span><span class="sxs-lookup"><span data-stu-id="6ec2c-209">These initial requests are known as *navigation* requests (as opposed to *subresource* requests for images/CSS/etc, or *fetch/XHR* requests for API data).</span></span>

<span data-ttu-id="6ec2c-210">El trabajo de servicio predeterminado contiene lógica de casos especiales para las solicitudes de navegación.</span><span class="sxs-lookup"><span data-stu-id="6ec2c-210">The default service worker contains special-case logic for navigation requests.</span></span> <span data-ttu-id="6ec2c-211">Las resuelve devolviendo el contenido almacenado en la caché para `/index.html`, independientemente de la dirección URL solicitada.</span><span class="sxs-lookup"><span data-stu-id="6ec2c-211">It resolves them by returning the cached content for `/index.html`, regardless of the requested URL.</span></span> <span data-ttu-id="6ec2c-212">Esta lógica se implementa en la`onFetch` función dentro de *service-worker.published.js*.</span><span class="sxs-lookup"><span data-stu-id="6ec2c-212">This logic is implemented in the `onFetch` function inside *service-worker.published.js*.</span></span>

<span data-ttu-id="6ec2c-213">Si la aplicación tiene determinadas direcciones URL que deben devolver el código HTML representado por el servidor (y no servir `/index.html` de la memoria caché), debe editar la lógica en el trabajo del servicio.</span><span class="sxs-lookup"><span data-stu-id="6ec2c-213">If your application has certain URLs that must return server-rendered HTML (and not serve `/index.html` from the cache), then you need to edit the logic in your service worker.</span></span> <span data-ttu-id="6ec2c-214">Por ejemplo, si todas las direcciones URL que contienen `/Identity/` deben controlarse como solicitudes normales solo en línea en el servidor, modifique la lógica de *service-worker.published.js*`onFetch`.</span><span class="sxs-lookup"><span data-stu-id="6ec2c-214">For example, if all URLs containing `/Identity/` need to be handled as regular online-only requests to the server, then modify *service-worker.published.js* `onFetch` logic.</span></span> <span data-ttu-id="6ec2c-215">Busque el código siguiente:</span><span class="sxs-lookup"><span data-stu-id="6ec2c-215">Locate the following code:</span></span>

```javascript
const shouldServeIndexHtml = event.request.mode === 'navigate';
```

<span data-ttu-id="6ec2c-216">Cambie el código por lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="6ec2c-216">Change the code to the following:</span></span>

```javascript
const shouldServeIndexHtml = event.request.mode === 'navigate'
    && !event.request.url.includes('/Identity/');
```

<span data-ttu-id="6ec2c-217">Si no lo hace, independientemente de la conectividad de red, el trabajo de servicio interceptará las solicitudes de dichas direcciones URL y las resolverá mediante `/index.html`.</span><span class="sxs-lookup"><span data-stu-id="6ec2c-217">If you don't do this, then regardless of network connectivity, the service worker will intercept requests for such URLs and will resolve them using `/index.html`.</span></span>

#### <a name="control-asset-caching"></a><span data-ttu-id="6ec2c-218">Control del almacenamiento en caché de recursos</span><span class="sxs-lookup"><span data-stu-id="6ec2c-218">Control asset caching</span></span>

<span data-ttu-id="6ec2c-219">Si el proyecto define una propiedad de MSBuild llamada `ServiceWorkerAssetsManifest`, las herramientas de compilación de Blazor generarán un manifiesto de recursos de trabajo de servicio con el nombre especificado.</span><span class="sxs-lookup"><span data-stu-id="6ec2c-219">If your project defines an MSBuild property called `ServiceWorkerAssetsManifest`, then Blazor's build tooling will generate a service worker assets manifest with the specified name.</span></span> <span data-ttu-id="6ec2c-220">La plantilla de PWA predeterminada produce un archivo de proyecto que contiene lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="6ec2c-220">The default PWA template produces a project file containing the following:</span></span>

```xml
<ServiceWorkerAssetsManifest>service-worker-assets.js</ServiceWorkerAssetsManifest>
```

<span data-ttu-id="6ec2c-221">El archivo se coloca en el directorio de salida *wwwroot*, por lo que el explorador puede recuperar este archivo solicitando `/service-worker-assets.js`.</span><span class="sxs-lookup"><span data-stu-id="6ec2c-221">The file is placed in the *wwwroot* output directory, so the browser can retrieve this file by requesting `/service-worker-assets.js`.</span></span> <span data-ttu-id="6ec2c-222">Para ver el contenido, abra *YourProject\bin\Debug\netstandard2.1\wwwroot\service-worker-assets.js* en un editor de texto.</span><span class="sxs-lookup"><span data-stu-id="6ec2c-222">To see the contents, open *YourProject\bin\Debug\netstandard2.1\wwwroot\service-worker-assets.js* in a text editor.</span></span> <span data-ttu-id="6ec2c-223">Sin embargo, no edite el archivo, ya que se volverá a generar en cada compilación.</span><span class="sxs-lookup"><span data-stu-id="6ec2c-223">However, don't edit the file, as it will be regenerated on each build.</span></span>

<span data-ttu-id="6ec2c-224">De forma predeterminada, este manifiesto muestra:</span><span class="sxs-lookup"><span data-stu-id="6ec2c-224">By default, this manifest lists:</span></span>

* <span data-ttu-id="6ec2c-225">Los recursos administrados por Blazor, como los ensamblados .NET y los archivos en tiempo de ejecución de WebAssembly .NET necesarios para funcionar sin conexión.</span><span class="sxs-lookup"><span data-stu-id="6ec2c-225">Any Blazor-managed resources such as .NET assemblies and the .NET WebAssembly runtime files needed to function offline</span></span>
* <span data-ttu-id="6ec2c-226">Todos los recursos que se publicarán en el directorio *wwwroot*, como imágenes, archivos CSS y archivos JavaScript.</span><span class="sxs-lookup"><span data-stu-id="6ec2c-226">All resources that will be published in your *wwwroot* directory, such as images, CSS files, and JavaScript files.</span></span> <span data-ttu-id="6ec2c-227">Esto incluye los recursos web estáticos que proporcionan los proyectos externos y los paquetes NuGet.</span><span class="sxs-lookup"><span data-stu-id="6ec2c-227">This includes static web assets supplied by external projects and NuGet packages.</span></span>

<span data-ttu-id="6ec2c-228">Puede controlar qué recursos capturará y almacenará en la caché el trabajo de servicio mediante la edición de la lógica`onInstall` en *service-worker.published.js*.</span><span class="sxs-lookup"><span data-stu-id="6ec2c-228">You can control which of these resources will be fetched and cached by the service worker by editing the logic in `onInstall` in *service-worker.published.js*.</span></span> <span data-ttu-id="6ec2c-229">De forma predeterminada, capturará y almacenará en la caché los archivos que coincidan con las extensiones de nombre de archivo web típicas, como *.html*, *.css*, *.js*, *.wasm*, etc., además de tipos de archivo específicos de Blazor WebAssembly ( *.dll*, *.pdb*).</span><span class="sxs-lookup"><span data-stu-id="6ec2c-229">By default, it will fetch and cache files matching typical web filename extensions such as *.html*, *.css*, *.js*, *.wasm*, and others, plus file types specific to Blazor WebAssembly (*.dll*, *.pdb*).</span></span>

<span data-ttu-id="6ec2c-230">Si quiere incluir recursos adicionales que no están presentes en el directorio *wwwroot*, puede hacerlo definiendo entradas de ItemGroup de MSBuild adicionales.</span><span class="sxs-lookup"><span data-stu-id="6ec2c-230">If you want to include additional resources that aren't present in your *wwwroot* directory, you can do so by defining extra MSBuild itemgroup entries.</span></span> <span data-ttu-id="6ec2c-231">Por ejemplo, en el archivo del proyecto, agregue:</span><span class="sxs-lookup"><span data-stu-id="6ec2c-231">For example, in your project file, add:</span></span>

```xml
<ItemGroup>
    <ServiceWorkerAssetsManifestItem
        Include="MyDirectory\AnotherFile.json"
        RelativePath="MyDirectory\AnotherFile.json"
        AssetUrl="files/AnotherFile.json" />
</ItemGroup>
```

<span data-ttu-id="6ec2c-232">Los metadatos de `AssetUrl` especifican la dirección URL de base relativa que debe usar el explorador al capturar el recurso en la memoria caché.</span><span class="sxs-lookup"><span data-stu-id="6ec2c-232">The `AssetUrl` metadata specifies the base-relative URL that the browser should use when fetching the resource to cache.</span></span> <span data-ttu-id="6ec2c-233">Puede ser independiente del nombre del archivo de origen en el disco.</span><span class="sxs-lookup"><span data-stu-id="6ec2c-233">This can be independent of its original source file name on disk.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="6ec2c-234">Agregar un elemento `ServiceWorkerAssetsManifestItem` no hace que el archivo se publique en el directorio *wwwroot*.</span><span class="sxs-lookup"><span data-stu-id="6ec2c-234">Adding a `ServiceWorkerAssetsManifestItem` does not cause the file to be published in your *wwwroot* directory.</span></span> <span data-ttu-id="6ec2c-235">Usted controla la salida de la publicación por separado.</span><span class="sxs-lookup"><span data-stu-id="6ec2c-235">It up to you to control your publish output separately.</span></span> <span data-ttu-id="6ec2c-236">El elemento `ServiceWorkerAssetsManifestItem` solo hace que aparezca una entrada adicional en el manifiesto de recursos de trabajo de servicio.</span><span class="sxs-lookup"><span data-stu-id="6ec2c-236">The `ServiceWorkerAssetsManifestItem` only causes an additional entry to appear in the service worker assets manifest.</span></span>

## <a name="push-notifications"></a><span data-ttu-id="6ec2c-237">Notificaciones de inserción</span><span class="sxs-lookup"><span data-stu-id="6ec2c-237">Push notifications</span></span>

<span data-ttu-id="6ec2c-238">Al igual que cualquier otra PWA, una PWA Blazor WebAssembly puede recibir notificaciones de inserción de un servidor back-end.</span><span class="sxs-lookup"><span data-stu-id="6ec2c-238">Like any other PWA, a Blazor WebAssembly PWA can receive push notifications from a backend server.</span></span> <span data-ttu-id="6ec2c-239">El servidor puede enviarlas en cualquier momento, incluso cuando el usuario no esté utilizando activamente la aplicación (por ejemplo, cuando un usuario diferente realice una acción que pueda ser pertinente).</span><span class="sxs-lookup"><span data-stu-id="6ec2c-239">Your server can send these at any time, even when the user is not actively using your application (for example, when a different user performs an action that may be relevant).</span></span>

<span data-ttu-id="6ec2c-240">El mecanismo para enviar una notificación de inserción es totalmente independiente de Blazor WebAssembly, ya que lo implementa el servidor back-end, que puede usar cualquier tecnología.</span><span class="sxs-lookup"><span data-stu-id="6ec2c-240">The mechanism for sending a push notification is entirely independent of Blazor WebAssembly, since it's implemented by the backend server which can use any technology.</span></span> <span data-ttu-id="6ec2c-241">Si quiere enviar notificaciones de inserción desde un servidor de ASP.NET Core, considere la posibilidad de [usar una técnica similar a la del taller de Blazing Pizza](https://github.com/dotnet-presentations/blazor-workshop/blob/master/docs/09-progressive-web-app.md#sending-push-notifications).</span><span class="sxs-lookup"><span data-stu-id="6ec2c-241">If you want to send push notifications from an ASP.NET Core server, consider [using a technique similar to that in the Blazing Pizza workshop](https://github.com/dotnet-presentations/blazor-workshop/blob/master/docs/09-progressive-web-app.md#sending-push-notifications).</span></span>

<span data-ttu-id="6ec2c-242">El mecanismo para recibir y mostrar una notificación de inserción en el cliente también es independiente de Blazor WebAssembly, ya que se implementa en el trabajo de servicio, que es un archivo de JavaScript.</span><span class="sxs-lookup"><span data-stu-id="6ec2c-242">The mechanism for receiving and displaying a push notification on the client is also independent of Blazor WebAssembly, since it's implemented in the service worker, which is a JavaScript file.</span></span> <span data-ttu-id="6ec2c-243">Por ejemplo, puede ver de nuevo el [enfoque que se usa en el taller de Blazing Pizza](https://github.com/dotnet-presentations/blazor-workshop/blob/master/docs/09-progressive-web-app.md#displaying-notifications).</span><span class="sxs-lookup"><span data-stu-id="6ec2c-243">As an example, you can again see [the approach used in the Blazing Pizza workshop](https://github.com/dotnet-presentations/blazor-workshop/blob/master/docs/09-progressive-web-app.md#displaying-notifications).</span></span>

## <a name="caveats-for-offline-pwas"></a><span data-ttu-id="6ec2c-244">Advertencias de PWA sin conexión</span><span class="sxs-lookup"><span data-stu-id="6ec2c-244">Caveats for offline PWAs</span></span>

<span data-ttu-id="6ec2c-245">No todas las aplicaciones deben intentar admitir el uso sin conexión.</span><span class="sxs-lookup"><span data-stu-id="6ec2c-245">Not all applications should attempt to support offline use.</span></span> <span data-ttu-id="6ec2c-246">Esto agrega una complejidad significativa, aunque no siempre es pertinente.</span><span class="sxs-lookup"><span data-stu-id="6ec2c-246">It adds significant complexity, while not always being relevant.</span></span>

<span data-ttu-id="6ec2c-247">La compatibilidad sin conexión normalmente solo es pertinente:</span><span class="sxs-lookup"><span data-stu-id="6ec2c-247">Offline support is usually relevant only:</span></span>

* <span data-ttu-id="6ec2c-248">Si el almacén de datos principal es local para el explorador.</span><span class="sxs-lookup"><span data-stu-id="6ec2c-248">If your primary data store is local to the browser.</span></span> <span data-ttu-id="6ec2c-249">Por ejemplo, al compilar una interfaz de usuario para un dispositivo [IoT](https://en.wikipedia.org/wiki/Internet_of_things) que almacena datos en `localStorage` o [IndexedDB](https://developer.mozilla.org/docs/Web/API/IndexedDB_API).</span><span class="sxs-lookup"><span data-stu-id="6ec2c-249">For example, when building a UI for an [IoT](https://en.wikipedia.org/wiki/Internet_of_things) device that stores data in `localStorage` or [IndexedDB](https://developer.mozilla.org/docs/Web/API/IndexedDB_API).</span></span>

* <span data-ttu-id="6ec2c-250">Si realiza un trabajo significativo para capturar y almacenar en la caché los datos de la API de back-end pertinentes para cada usuario, para que puedan desplazarse por ellos sin conexión.</span><span class="sxs-lookup"><span data-stu-id="6ec2c-250">If you do significant work to fetch and cache the backend API data relevant to each user, so they can navigate through it offline.</span></span> <span data-ttu-id="6ec2c-251">Si admite la edición, también tendrá que crear un sistema para realizar el seguimiento de los cambios y sincronizarlos con el back-end.</span><span class="sxs-lookup"><span data-stu-id="6ec2c-251">If you support editing, you will also need to build a system for tracking changes and synchronizing them with the backend.</span></span>

* <span data-ttu-id="6ec2c-252">Si el objetivo es garantizar que la aplicación se cargue inmediatamente, independientemente de las condiciones de la red.</span><span class="sxs-lookup"><span data-stu-id="6ec2c-252">If your goal is to guarantee the application loads immediately regardless of network conditions.</span></span> <span data-ttu-id="6ec2c-253">En ese caso, tendrá que implementar una experiencia de usuario adecuada en torno a las solicitudes de API de back-end para mostrar el progreso de las solicitudes y comportarse correctamente cuando se produzca un error debido a la falta de disponibilidad de la red.</span><span class="sxs-lookup"><span data-stu-id="6ec2c-253">You will then need to implement a suitable user experience around backend API requests to show the progress of requests and behave gracefully when they fail due to network unavailability.</span></span>

<span data-ttu-id="6ec2c-254">Además, las PWA con capacidad sin conexión deben tratar con una gran variedad de complicaciones adicionales.</span><span class="sxs-lookup"><span data-stu-id="6ec2c-254">Additionally, offline-capable PWAs need to deal with a range of extra complications.</span></span> <span data-ttu-id="6ec2c-255">Los desarrolladores deben familiarizarse cuidadosamente con las siguientes advertencias.</span><span class="sxs-lookup"><span data-stu-id="6ec2c-255">Developers should carefully familiarize themselves with the following caveats.</span></span>

### <a name="offline-support-only-when-published"></a><span data-ttu-id="6ec2c-256">Compatibilidad sin conexión solo al realizar la publicación</span><span class="sxs-lookup"><span data-stu-id="6ec2c-256">Offline support only when published</span></span>

<span data-ttu-id="6ec2c-257">La plantilla de PWA de Blazor solo habilita la compatibilidad sin conexión cuando se publica.</span><span class="sxs-lookup"><span data-stu-id="6ec2c-257">Blazor's PWA template enables offline support only when published.</span></span> <span data-ttu-id="6ec2c-258">Esto se debe a que, durante el desarrollo, normalmente quiere ver cada cambio reflejado inmediatamente en el explorador, sin pasar por un proceso de actualización en segundo plano.</span><span class="sxs-lookup"><span data-stu-id="6ec2c-258">This is because, during development, you typically want to see each change reflected immediately in the browser, without going through a background update process.</span></span>

<span data-ttu-id="6ec2c-259">Por lo tanto, al compilar una aplicación que admita el uso sin conexión, no basta con probar la aplicación en modo de desarrollo.</span><span class="sxs-lookup"><span data-stu-id="6ec2c-259">Therefore when building an offline-capable application, it's not enough to test your application in development mode.</span></span> <span data-ttu-id="6ec2c-260">Debe probar la aplicación en su estado publicado para entender cómo responderá a condiciones de red diferentes.</span><span class="sxs-lookup"><span data-stu-id="6ec2c-260">You must test your application in its published state to understand how it will respond to differing network conditions.</span></span>

### <a name="update-completion-after-user-navigation-away-from-app"></a><span data-ttu-id="6ec2c-261">Finalización de la actualización tras la navegación del usuario fuera de la aplicación</span><span class="sxs-lookup"><span data-stu-id="6ec2c-261">Update completion after user navigation away from app</span></span>

<span data-ttu-id="6ec2c-262">Las actualizaciones no se completarán hasta que el usuario haya navegado fuera de la aplicación en todas las pestañas.</span><span class="sxs-lookup"><span data-stu-id="6ec2c-262">Updates don't complete until the user has navigated away from your application in all tabs.</span></span> <span data-ttu-id="6ec2c-263">Como se explica en [Actualizaciones en segundo plano](#background-updates), después de implementar una actualización en la aplicación, el explorador capturará los archivos de trabajo de servicio actualizados y comenzará un proceso de actualización.</span><span class="sxs-lookup"><span data-stu-id="6ec2c-263">As explained in [Background updates](#background-updates), after you deploy an update to your application, the browser will fetch the updated service worker files and begin an update process.</span></span>

<span data-ttu-id="6ec2c-264">Lo que sorprende a muchos desarrolladores es que, incluso cuando se completa esta actualización, **no** surtirá efecto hasta que el usuario haya navegado fuera de todas las pestañas.</span><span class="sxs-lookup"><span data-stu-id="6ec2c-264">What surprises many developers is that, even when this update completes, it does **not** take effect until the user has navigated away in all tabs.</span></span> <span data-ttu-id="6ec2c-265">**No** basta con actualizar la pestaña que muestra la aplicación, incluso si se trata de la única pestaña que muestra la aplicación.</span><span class="sxs-lookup"><span data-stu-id="6ec2c-265">It is **not** sufficient to refresh the tab displaying your application, even if it's the only tab displaying your application.</span></span> <span data-ttu-id="6ec2c-266">Hasta que la aplicación se cierre por completo, el nuevo trabajo de servicio permanecerá en el estado "en espera de activación".</span><span class="sxs-lookup"><span data-stu-id="6ec2c-266">Until your application is completely closed, the new service worker will remain in a "waiting to activate" status.</span></span> <span data-ttu-id="6ec2c-267">**Esto no es específico de Blazor, sino que es un comportamiento estándar de la plataforma web.**</span><span class="sxs-lookup"><span data-stu-id="6ec2c-267">**This is not specific to Blazor, but rather is a standard web platform behavior.**</span></span>

<span data-ttu-id="6ec2c-268">Habitualmente, esto trae problemas a los desarrolladores que intentan probar las actualizaciones de su trabajo de servicio o de los recursos almacenados en la caché sin conexión.</span><span class="sxs-lookup"><span data-stu-id="6ec2c-268">This commonly troubles developers who are trying to test updates to their service worker or offline cached resources.</span></span> <span data-ttu-id="6ec2c-269">Si inserta en el repositorio las herramientas de desarrollo del explorador, puede ver algo parecido a lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="6ec2c-269">If you check in the browser's dev tools, you may see something like the following:</span></span>

![imagen](https://user-images.githubusercontent.com/1101362/76226394-b93f7380-6215-11ea-8572-7d52afee2dd8.png)

<span data-ttu-id="6ec2c-271">Mientras la lista de "clientes" (es decir, pestañas o ventanas que muestran la aplicación) no esté vacía, el trabajo seguirá en espera.</span><span class="sxs-lookup"><span data-stu-id="6ec2c-271">For as long as the list of "clients" (i.e., tabs or windows displaying your application) is nonempty, the worker will continue waiting.</span></span> <span data-ttu-id="6ec2c-272">La razón por la que los trabajos de servicio hacen esto es garantizar la coherencia, es decir, que todos los recursos se capturen de la misma caché atómica.</span><span class="sxs-lookup"><span data-stu-id="6ec2c-272">The reason service workers do this is to guarantee consistency, i.e., that all resources are fetched from the same atomic cache.</span></span>

<span data-ttu-id="6ec2c-273">Al probar los cambios, puede que le resulte conveniente hacer clic en el vínculo "skipWaiting", como se muestra en la captura de pantalla anterior, y volver a cargar la página.</span><span class="sxs-lookup"><span data-stu-id="6ec2c-273">When testing changes, you may find it convenient to click the "skipWaiting" link as shown in the screenshot above, then reload the page.</span></span> <span data-ttu-id="6ec2c-274">Si quiere, puede automatizar este proceso para todos los usuarios mediante la codificación del trabajo de servicio para [omitir la fase de "espera" y activarlo inmediatamente al actualizar](https://developers.google.com/web/fundamentals/primers/service-workers/lifecycle#skip_the_waiting_phase).</span><span class="sxs-lookup"><span data-stu-id="6ec2c-274">If you want, you can automate this for all users by coding your service worker to [skip the "waiting" phase and immediately activate on update](https://developers.google.com/web/fundamentals/primers/service-workers/lifecycle#skip_the_waiting_phase).</span></span> <span data-ttu-id="6ec2c-275">Sin embargo, si lo hace, ya no tendrá la garantía de que los recursos siempre se capturen de forma coherente desde la misma instancia de la caché.</span><span class="sxs-lookup"><span data-stu-id="6ec2c-275">However if you do this, you are giving up the guarantee that resources are always fetched consistently from the same cache instance.</span></span>

### <a name="users-may-run-any-historical-version-of-the-app"></a><span data-ttu-id="6ec2c-276">Posibilidad para los usuarios de ejecutar cualquier versión histórica de la aplicación</span><span class="sxs-lookup"><span data-stu-id="6ec2c-276">Users may run any historical version of the app</span></span>

<span data-ttu-id="6ec2c-277">Normalmente, los desarrolladores web esperan que los usuarios ejecuten solo la última versión implementada de su aplicación web, ya que es lo habitual en el modelo de distribución web tradicional.</span><span class="sxs-lookup"><span data-stu-id="6ec2c-277">Web developers habitually expect that users will only run the latest deployed version of their web application, since that's normal within the traditional web distribution model.</span></span> <span data-ttu-id="6ec2c-278">Pero una PWA sin conexión es más similar a una aplicación móvil nativa, cuya versión ejecutada por los usuarios no siempre es la más reciente.</span><span class="sxs-lookup"><span data-stu-id="6ec2c-278">However, an offline-first PWA is more akin to a native mobile app, where users are not necessarily running the latest version.</span></span>

<span data-ttu-id="6ec2c-279">Tal como se explica en [Actualizaciones en segundo plano](#background-updates), después de implementar una actualización en la aplicación, **cada usuario existente seguirá usando una versión anterior durante, al menos, una visita adicional** (porque la actualización se produce en segundo plano y no se activa hasta que el usuario se desplace fuera de la aplicación).</span><span class="sxs-lookup"><span data-stu-id="6ec2c-279">As explained in [Background updates](#background-updates), after you deploy an update to your application, **each existing user will continue to use a previous version for at least one further visit** (because the update occurs in the background and isn't activated until the user then navigates away).</span></span> <span data-ttu-id="6ec2c-280">Además, la versión anterior que se está usando no es necesariamente la anterior que implementó; puede ser *cualquier* versión histórica, en función de cuándo el usuario haya completado una actualización por última vez.</span><span class="sxs-lookup"><span data-stu-id="6ec2c-280">Plus, the previous version being used isn't necessarily the previous one you deployed - it can be *any* historical version, depending on when the user last completed an update.</span></span>

<span data-ttu-id="6ec2c-281">Esto puede ser un problema si las partes de front-end y back-end de la aplicación requieren un acuerdo sobre el esquema para las solicitudes de API.</span><span class="sxs-lookup"><span data-stu-id="6ec2c-281">This can be an issue if the frontend and backend parts of your application require agreement about the schema for API requests.</span></span> <span data-ttu-id="6ec2c-282">No debe implementar los cambios de esquema de API incompatibles con versiones anteriores hasta que se asegure de que todos los usuarios hayan realizado la actualización, o al menos haya impedido que los usuarios utilicen versiones anteriores incompatibles de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="6ec2c-282">You must not deploy backward-incompatible API schema changes until you can be sure that all users have upgraded, or at least block users from using incompatible older versions of the app.</span></span> <span data-ttu-id="6ec2c-283">Esto es igual que una aplicación móvil nativa.</span><span class="sxs-lookup"><span data-stu-id="6ec2c-283">This is just like a native mobile app.</span></span> <span data-ttu-id="6ec2c-284">Si implementa un cambio importante en las API de servidor, la aplicación cliente se interrumpirá para las personas que aún no hayan realizado la actualización.</span><span class="sxs-lookup"><span data-stu-id="6ec2c-284">If you deploy a breaking change in server APIs, the client app will be broken for people who haven't yet updated.</span></span>

<span data-ttu-id="6ec2c-285">Si es posible, no implemente cambios importantes en las API de back-end.</span><span class="sxs-lookup"><span data-stu-id="6ec2c-285">If possible, don't deploy breaking changes to your backend APIs.</span></span> <span data-ttu-id="6ec2c-286">Pero si tiene que hacerlo, considere la posibilidad de usar [API de trabajo de servicio estándar como `ServiceWorkerRegistration`](https://developer.mozilla.org/docs/Web/API/ServiceWorkerRegistration) para determinar si la aplicación está actualizada y, en caso contrario, evitar el uso.</span><span class="sxs-lookup"><span data-stu-id="6ec2c-286">But if you must do so, consider using [standard Service Worker APIs such as `ServiceWorkerRegistration`](https://developer.mozilla.org/docs/Web/API/ServiceWorkerRegistration) to determine whether the application is up-to-date, and if not, to prevent usage.</span></span>

### <a name="interference-with-server-rendered-pages"></a><span data-ttu-id="6ec2c-287">Interferencias con páginas representadas por el servidor</span><span class="sxs-lookup"><span data-stu-id="6ec2c-287">Interference with server-rendered pages</span></span>

<span data-ttu-id="6ec2c-288">[Como se describió anteriormente](#support-server-rendered-pages), si quiere omitir el comportamiento del trabajo de servicio de devolver contenido de `/index.html` para todas las solicitudes de navegación, debe editar la lógica en el trabajo de servicio.</span><span class="sxs-lookup"><span data-stu-id="6ec2c-288">[As described above](#support-server-rendered-pages), if you want to bypass the service worker's behavior of returning `/index.html` contents for all navigation requests, you need to edit the logic in your service worker.</span></span>

### <a name="all-service-worker-asset-manifest-contents-are-cached-by-default"></a><span data-ttu-id="6ec2c-289">Almacenamiento en caché de todos los contenidos del manifiesto de recursos del trabajo de servicio de forma predeterminada</span><span class="sxs-lookup"><span data-stu-id="6ec2c-289">All service worker asset manifest contents are cached by default</span></span>

<span data-ttu-id="6ec2c-290">[Como se describió anteriormente](#control-asset-caching), el archivo *service-worker-assets.js* se genera durante la compilación y enumera todos los recursos que el trabajo de servicio debe capturar y almacenar en la caché.</span><span class="sxs-lookup"><span data-stu-id="6ec2c-290">[As described above](#control-asset-caching), the file *service-worker-assets.js* is generated during build and lists all assets the service worker should fetch and cache.</span></span>

<span data-ttu-id="6ec2c-291">Puesto que esta lista incluye de forma predeterminada todo lo que se emite para *wwwroot* (incluido el contenido proporcionado por los paquetes y proyectos externos), debe tener cuidado de no incluir demasiado contenido en él.</span><span class="sxs-lookup"><span data-stu-id="6ec2c-291">Since this list by default includes everything emitted to *wwwroot* (including content supplied by external packages and projects), you must be careful not to put too much content there.</span></span> <span data-ttu-id="6ec2c-292">Si, por ejemplo, el directorio *wwwroot* contiene millones de imágenes, el trabajo de servicio intentará recuperarlas y almacenarlas en la caché, lo que consumiría un ancho de banda excesivo y probablemente no se completará correctamente.</span><span class="sxs-lookup"><span data-stu-id="6ec2c-292">If for example your *wwwroot* directory contains millions of images, the service worker would try to fetch and cache them all, consuming excessive bandwidth and most likely not completing successfully.</span></span>

<span data-ttu-id="6ec2c-293">Puede implementar una lógica arbitraria para controlar qué subconjunto del contenido del manifiesto se debe capturar y almacenar en la memoria caché mediante la edición de la función `onInstall` en *service-worker.published.js*.</span><span class="sxs-lookup"><span data-stu-id="6ec2c-293">You can implement arbitrary logic to control which subset of the manifest's contents should be fetched and cached by editing the `onInstall` function in *service-worker.published.js*.</span></span>

### <a name="interaction-with-authentication"></a><span data-ttu-id="6ec2c-294">Interacción con la autenticación</span><span class="sxs-lookup"><span data-stu-id="6ec2c-294">Interaction with authentication</span></span>

<span data-ttu-id="6ec2c-295">Se puede usar la opción de plantilla PWA junto con las opciones de autenticación.</span><span class="sxs-lookup"><span data-stu-id="6ec2c-295">It's possible to use the PWA template option in conjunction with the authentication options.</span></span> <span data-ttu-id="6ec2c-296">Un PWA con capacidad sin conexión también puede admitir la autenticación cuando el usuario tiene conectividad de red.</span><span class="sxs-lookup"><span data-stu-id="6ec2c-296">An offline-capable PWA can also support authentication when the user has network connectivity.</span></span>

<span data-ttu-id="6ec2c-297">Sin embargo, cuando un usuario no tiene conectividad de red, no podrá autenticarse ni obtener tokens de acceso.</span><span class="sxs-lookup"><span data-stu-id="6ec2c-297">However, when a user does not have network connectivity, they will not be able to authenticate or obtain access tokens.</span></span> <span data-ttu-id="6ec2c-298">Si intenta visitar la página "Inicio de sesión", se mostrará de forma predeterminada un mensaje que indica "Error de red".</span><span class="sxs-lookup"><span data-stu-id="6ec2c-298">Attempting to visit the "login" page will by default display a message saying "network error".</span></span>

<span data-ttu-id="6ec2c-299">Como tal, su trabajo es diseñar un flujo de interfaz de usuario que permita al usuario hacer cosas útiles mientras está sin conexión sin intentar autenticarse ni obtener tokens de acceso, o al menos que los errores que se produzcan en esos casos sean estables.</span><span class="sxs-lookup"><span data-stu-id="6ec2c-299">As such it's your job to design a UI flow that lets the user do useful things while offline without attempting to authenticate or obtain access tokens, or at least failing in a graceful way in those cases.</span></span> <span data-ttu-id="6ec2c-300">Si esto no es posible en la aplicación, es posible que no quiera habilitar la compatibilidad sin conexión.</span><span class="sxs-lookup"><span data-stu-id="6ec2c-300">If this isn't possible in your application, you might not want to enable offline support.</span></span>
