---
title: Razor Pages pruebas unitarias en ASP.NET Core
author: guardrex
description: Obtenga información sobre cómo crear pruebas unitarias para aplicaciones Razor Pages.
monikerRange: '>= aspnetcore-2.1'
ms.author: riande
ms.custom: mvc
ms.date: 08/14/2019
uid: test/razor-pages-tests
ms.openlocfilehash: 35feb5dd95fa79ceca7ff03523cef30d29ccbdd3
ms.sourcegitcommit: 476ea5ad86a680b7b017c6f32098acd3414c0f6c
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/14/2019
ms.locfileid: "69022573"
---
# <a name="razor-pages-unit-tests-in-aspnet-core"></a><span data-ttu-id="c0499-103">Razor Pages pruebas unitarias en ASP.NET Core</span><span class="sxs-lookup"><span data-stu-id="c0499-103">Razor Pages unit tests in ASP.NET Core</span></span>

<span data-ttu-id="c0499-104">Por [Luke Latham](https://github.com/guardrex)</span><span class="sxs-lookup"><span data-stu-id="c0499-104">By [Luke Latham](https://github.com/guardrex)</span></span>

::: moniker range=">= aspnetcore-3.0"

<span data-ttu-id="c0499-105">ASP.NET Core admite pruebas unitarias de aplicaciones de Razor Pages.</span><span class="sxs-lookup"><span data-stu-id="c0499-105">ASP.NET Core supports unit tests of Razor Pages apps.</span></span> <span data-ttu-id="c0499-106">Las pruebas de la capa de acceso a datos (DAL) y los modelos de página ayudan a garantizar:</span><span class="sxs-lookup"><span data-stu-id="c0499-106">Tests of the data access layer (DAL) and page models help ensure:</span></span>

* <span data-ttu-id="c0499-107">Las partes de una aplicación Razor Pages funcionan de forma independiente y conjunta como una unidad durante la construcción de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="c0499-107">Parts of a Razor Pages app work independently and together as a unit during app construction.</span></span>
* <span data-ttu-id="c0499-108">Las clases y los métodos tienen ámbitos limitados de responsabilidad.</span><span class="sxs-lookup"><span data-stu-id="c0499-108">Classes and methods have limited scopes of responsibility.</span></span>
* <span data-ttu-id="c0499-109">Existe documentación adicional sobre el comportamiento de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="c0499-109">Additional documentation exists on how the app should behave.</span></span>
* <span data-ttu-id="c0499-110">Las regresiones, que son errores que se producen al actualizar el código, se encuentran durante la creación e implementación automatizadas.</span><span class="sxs-lookup"><span data-stu-id="c0499-110">Regressions, which are errors brought about by updates to the code, are found during automated building and deployment.</span></span>

<span data-ttu-id="c0499-111">En este tema se supone que tiene conocimientos básicos de Razor Pages aplicaciones y pruebas unitarias.</span><span class="sxs-lookup"><span data-stu-id="c0499-111">This topic assumes that you have a basic understanding of Razor Pages apps and unit tests.</span></span> <span data-ttu-id="c0499-112">Si no está familiarizado con las aplicaciones de Razor Pages o los conceptos de prueba, vea los temas siguientes:</span><span class="sxs-lookup"><span data-stu-id="c0499-112">If you're unfamiliar with Razor Pages apps or test concepts, see the following topics:</span></span>

* <xref:razor-pages/index>
* <xref:tutorials/razor-pages/razor-pages-start>
* [<span data-ttu-id="c0499-113">Pruebas C# unitarias en .net Core con pruebas de dotnet y xUnit</span><span class="sxs-lookup"><span data-stu-id="c0499-113">Unit testing C# in .NET Core using dotnet test and xUnit</span></span>](/dotnet/articles/core/testing/unit-testing-with-dotnet-test)

<span data-ttu-id="c0499-114">[Vea o descargue el código de ejemplo](https://github.com/aspnet/AspNetCore.Docs/tree/master/aspnetcore/test/razor-pages-tests/samples) ([cómo descargarlo](xref:index#how-to-download-a-sample))</span><span class="sxs-lookup"><span data-stu-id="c0499-114">[View or download sample code](https://github.com/aspnet/AspNetCore.Docs/tree/master/aspnetcore/test/razor-pages-tests/samples) ([how to download](xref:index#how-to-download-a-sample))</span></span>

<span data-ttu-id="c0499-115">El proyecto de ejemplo se compone de dos aplicaciones:</span><span class="sxs-lookup"><span data-stu-id="c0499-115">The sample project is composed of two apps:</span></span>

| <span data-ttu-id="c0499-116">Aplicación</span><span class="sxs-lookup"><span data-stu-id="c0499-116">App</span></span>         | <span data-ttu-id="c0499-117">Carpeta de proyecto</span><span class="sxs-lookup"><span data-stu-id="c0499-117">Project folder</span></span>                     | <span data-ttu-id="c0499-118">DESCRIPCIÓN</span><span class="sxs-lookup"><span data-stu-id="c0499-118">Description</span></span> |
| ----------- | ---------------------------------- | ----------- |
| <span data-ttu-id="c0499-119">Aplicación de mensaje</span><span class="sxs-lookup"><span data-stu-id="c0499-119">Message app</span></span> | <span data-ttu-id="c0499-120">*src/RazorPagesTestSample*</span><span class="sxs-lookup"><span data-stu-id="c0499-120">*src/RazorPagesTestSample*</span></span>         | <span data-ttu-id="c0499-121">Permite que un usuario agregue un mensaje, elimine un mensaje, elimine todos los mensajes y analice los mensajes (busque el número promedio de palabras por mensaje).</span><span class="sxs-lookup"><span data-stu-id="c0499-121">Allows a user to add a message, delete one message, delete all messages, and analyze messages (find the average number of words per message).</span></span> |
| <span data-ttu-id="c0499-122">Aplicación de prueba</span><span class="sxs-lookup"><span data-stu-id="c0499-122">Test app</span></span>    | <span data-ttu-id="c0499-123">*tests/RazorPagesTestSample.Tests*</span><span class="sxs-lookup"><span data-stu-id="c0499-123">*tests/RazorPagesTestSample.Tests*</span></span> | <span data-ttu-id="c0499-124">Se usa para probar unitarias el modelo de página de índice y la capa DAL de la aplicación de mensaje.</span><span class="sxs-lookup"><span data-stu-id="c0499-124">Used to unit test the DAL and Index page model of the message app.</span></span> |

<span data-ttu-id="c0499-125">Las pruebas se pueden ejecutar con las características de prueba integradas de un IDE, como [Visual Studio](/visualstudio/test/unit-test-your-code) o [Visual Studio para Mac](/dotnet/core/tutorials/using-on-mac-vs-full-solution).</span><span class="sxs-lookup"><span data-stu-id="c0499-125">The tests can be run using the built-in test features of an IDE, such as [Visual Studio](/visualstudio/test/unit-test-your-code) or [Visual Studio for Mac](/dotnet/core/tutorials/using-on-mac-vs-full-solution).</span></span> <span data-ttu-id="c0499-126">Si usa [Visual Studio Code](https://code.visualstudio.com/) o la línea de comandos, ejecute el siguiente comando en un símbolo del sistema en la carpeta *tests/RazorPagesTestSample. tests* :</span><span class="sxs-lookup"><span data-stu-id="c0499-126">If using [Visual Studio Code](https://code.visualstudio.com/) or the command line, execute the following command at a command prompt in the *tests/RazorPagesTestSample.Tests* folder:</span></span>

```console
dotnet test
```

## <a name="message-app-organization"></a><span data-ttu-id="c0499-127">Organización de aplicaciones de mensajes</span><span class="sxs-lookup"><span data-stu-id="c0499-127">Message app organization</span></span>

<span data-ttu-id="c0499-128">La aplicación de mensaje es un sistema de mensajes Razor Pages con las siguientes características:</span><span class="sxs-lookup"><span data-stu-id="c0499-128">The message app is a Razor Pages message system with the following characteristics:</span></span>

* <span data-ttu-id="c0499-129">La página de índice de la aplicación (*pages/index. cshtml* y *pages/index. cshtml. CS*) proporciona un método de interfaz de usuario y un modelo de página para controlar la adición, eliminación y análisis de mensajes (buscar el número promedio de palabras por mensaje).</span><span class="sxs-lookup"><span data-stu-id="c0499-129">The Index page of the app (*Pages/Index.cshtml* and *Pages/Index.cshtml.cs*) provides a UI and page model methods to control the addition, deletion, and analysis of messages (find the average number of words per message).</span></span>
* <span data-ttu-id="c0499-130">La `Message` clase (*Data/Message. CS*) describe un mensaje con dos propiedades: `Id` (Key) y `Text` (Message).</span><span class="sxs-lookup"><span data-stu-id="c0499-130">A message is described by the `Message` class (*Data/Message.cs*) with two properties: `Id` (key) and `Text` (message).</span></span> <span data-ttu-id="c0499-131">La `Text` propiedad es necesaria y está limitada a 200 caracteres.</span><span class="sxs-lookup"><span data-stu-id="c0499-131">The `Text` property is required and limited to 200 characters.</span></span>
* <span data-ttu-id="c0499-132">Los mensajes se almacenan mediante&#8224; [Entity Framework base de datos en memoria](/ef/core/providers/in-memory/).</span><span class="sxs-lookup"><span data-stu-id="c0499-132">Messages are stored using [Entity Framework's in-memory database](/ef/core/providers/in-memory/)&#8224;.</span></span>
* <span data-ttu-id="c0499-133">La aplicación contiene una capa Dal en su clase de contexto `AppDbContext` de base de datos, (*Data/AppDbContext. CS*).</span><span class="sxs-lookup"><span data-stu-id="c0499-133">The app contains a DAL in its database context class, `AppDbContext` (*Data/AppDbContext.cs*).</span></span> <span data-ttu-id="c0499-134">Los métodos Dal están marcados `virtual`, lo que permite simular los métodos para su uso en las pruebas.</span><span class="sxs-lookup"><span data-stu-id="c0499-134">The DAL methods are marked `virtual`, which allows mocking the methods for use in the tests.</span></span>
* <span data-ttu-id="c0499-135">Si la base de datos está vacía al iniciarse la aplicación, el almacén de mensajes se inicializa con tres mensajes.</span><span class="sxs-lookup"><span data-stu-id="c0499-135">If the database is empty on app startup, the message store is initialized with three messages.</span></span> <span data-ttu-id="c0499-136">Estos *mensajes inicializados* también se usan en las pruebas.</span><span class="sxs-lookup"><span data-stu-id="c0499-136">These *seeded messages* are also used in tests.</span></span>

<span data-ttu-id="c0499-137">&#8224;En el tema EF, [Test with inmemory](/ef/core/miscellaneous/testing/in-memory), se explica cómo usar una base de datos en memoria para las pruebas con MSTest.</span><span class="sxs-lookup"><span data-stu-id="c0499-137">&#8224;The EF topic, [Test with InMemory](/ef/core/miscellaneous/testing/in-memory), explains how to use an in-memory database for tests with MSTest.</span></span> <span data-ttu-id="c0499-138">En este tema se usa el marco de pruebas de [xUnit](https://xunit.github.io/) .</span><span class="sxs-lookup"><span data-stu-id="c0499-138">This topic uses the [xUnit](https://xunit.github.io/) test framework.</span></span> <span data-ttu-id="c0499-139">Los conceptos de prueba y las implementaciones de prueba en diferentes marcos de pruebas son similares, pero no idénticos.</span><span class="sxs-lookup"><span data-stu-id="c0499-139">Test concepts and test implementations across different test frameworks are similar but not identical.</span></span>

<span data-ttu-id="c0499-140">Aunque la aplicación de ejemplo no usa el patrón de repositorio y no es un ejemplo eficaz del [patrón de unidad de trabajo (UoW)](https://martinfowler.com/eaaCatalog/unitOfWork.html), Razor pages admite estos patrones de desarrollo.</span><span class="sxs-lookup"><span data-stu-id="c0499-140">Although the sample app doesn't use the repository pattern and isn't an effective example of the [Unit of Work (UoW) pattern](https://martinfowler.com/eaaCatalog/unitOfWork.html), Razor Pages supports these patterns of development.</span></span> <span data-ttu-id="c0499-141">Para obtener más información, vea [diseñar el nivel de persistencia de la infraestructura](/dotnet/standard/microservices-architecture/microservice-ddd-cqrs-patterns/infrastructure-persistence-layer-design) y <xref:mvc/controllers/testing> (el ejemplo implementa el patrón del repositorio).</span><span class="sxs-lookup"><span data-stu-id="c0499-141">For more information, see [Designing the infrastructure persistence layer](/dotnet/standard/microservices-architecture/microservice-ddd-cqrs-patterns/infrastructure-persistence-layer-design) and <xref:mvc/controllers/testing> (the sample implements the repository pattern).</span></span>

## <a name="test-app-organization"></a><span data-ttu-id="c0499-142">Probar la organización de la aplicación</span><span class="sxs-lookup"><span data-stu-id="c0499-142">Test app organization</span></span>

<span data-ttu-id="c0499-143">La aplicación de prueba es una aplicación de consola dentro de la carpeta *tests/RazorPagesTestSample. tests* .</span><span class="sxs-lookup"><span data-stu-id="c0499-143">The test app is a console app inside the *tests/RazorPagesTestSample.Tests* folder.</span></span>

| <span data-ttu-id="c0499-144">Carpeta de aplicación de prueba</span><span class="sxs-lookup"><span data-stu-id="c0499-144">Test app folder</span></span> | <span data-ttu-id="c0499-145">DESCRIPCIÓN</span><span class="sxs-lookup"><span data-stu-id="c0499-145">Description</span></span> |
| --------------- | ----------- |
| <span data-ttu-id="c0499-146">*UnitTests*</span><span class="sxs-lookup"><span data-stu-id="c0499-146">*UnitTests*</span></span>     | <ul><li><span data-ttu-id="c0499-147">*DataAccessLayerTest.CS* contiene las pruebas unitarias para la capa dal.</span><span class="sxs-lookup"><span data-stu-id="c0499-147">*DataAccessLayerTest.cs* contains the unit tests for the DAL.</span></span></li><li><span data-ttu-id="c0499-148">*IndexPageTests.CS* contiene las pruebas unitarias para el modelo de página de índice.</span><span class="sxs-lookup"><span data-stu-id="c0499-148">*IndexPageTests.cs* contains the unit tests for the Index page model.</span></span></li></ul> |
| <span data-ttu-id="c0499-149">*Utilidad*</span><span class="sxs-lookup"><span data-stu-id="c0499-149">*Utilities*</span></span>     | <span data-ttu-id="c0499-150">Contiene el `TestDbContextOptions` método utilizado para crear nuevas opciones de contexto de base de datos para cada prueba unitaria de la capa Dal, de modo que la base de datos se restablezca a su condición de línea base para cada prueba.</span><span class="sxs-lookup"><span data-stu-id="c0499-150">Contains the `TestDbContextOptions` method used to create new database context options for each DAL unit test so that the database is reset to its baseline condition for each test.</span></span> |

<span data-ttu-id="c0499-151">El marco de pruebas es [xUnit](https://xunit.github.io/).</span><span class="sxs-lookup"><span data-stu-id="c0499-151">The test framework is [xUnit](https://xunit.github.io/).</span></span> <span data-ttu-id="c0499-152">El marco de trabajo ficticio de objetos es [MOQ](https://github.com/moq/moq4).</span><span class="sxs-lookup"><span data-stu-id="c0499-152">The object mocking framework is [Moq](https://github.com/moq/moq4).</span></span>

## <a name="unit-tests-of-the-data-access-layer-dal"></a><span data-ttu-id="c0499-153">Pruebas unitarias de la capa de acceso a datos (DAL)</span><span class="sxs-lookup"><span data-stu-id="c0499-153">Unit tests of the data access layer (DAL)</span></span>

<span data-ttu-id="c0499-154">La aplicación de mensaje tiene un Dal con cuatro métodos contenidos en `AppDbContext` la clase (*src/RazorPagesTestSample/Data/AppDbContext. CS*).</span><span class="sxs-lookup"><span data-stu-id="c0499-154">The message app has a DAL with four methods contained in the `AppDbContext` class (*src/RazorPagesTestSample/Data/AppDbContext.cs*).</span></span> <span data-ttu-id="c0499-155">Cada método tiene una o dos pruebas unitarias en la aplicación de prueba.</span><span class="sxs-lookup"><span data-stu-id="c0499-155">Each method has one or two unit tests in the test app.</span></span>

| <span data-ttu-id="c0499-156">DAL (método)</span><span class="sxs-lookup"><span data-stu-id="c0499-156">DAL method</span></span>               | <span data-ttu-id="c0499-157">Función</span><span class="sxs-lookup"><span data-stu-id="c0499-157">Function</span></span>                                                                   |
| ------------------------ | -------------------------------------------------------------------------- |
| `GetMessagesAsync`       | <span data-ttu-id="c0499-158">Obtiene de la base de datos ordenada por la `Text` propiedad. `List<Message>`</span><span class="sxs-lookup"><span data-stu-id="c0499-158">Obtains a `List<Message>` from the database sorted by the `Text` property.</span></span> |
| `AddMessageAsync`        | <span data-ttu-id="c0499-159">Agrega un `Message` a la base de datos.</span><span class="sxs-lookup"><span data-stu-id="c0499-159">Adds a `Message` to the database.</span></span>                                          |
| `DeleteAllMessagesAsync` | <span data-ttu-id="c0499-160">Elimina todas `Message` las entradas de la base de datos.</span><span class="sxs-lookup"><span data-stu-id="c0499-160">Deletes all `Message` entries from the database.</span></span>                           |
| `DeleteMessageAsync`     | <span data-ttu-id="c0499-161">Elimina un único `Message` de la base de datos `Id`por.</span><span class="sxs-lookup"><span data-stu-id="c0499-161">Deletes a single `Message` from the database by `Id`.</span></span>                      |

<span data-ttu-id="c0499-162">Las pruebas unitarias de la <xref:Microsoft.EntityFrameworkCore.DbContextOptions> capa Dal requieren al `AppDbContext` crear un nuevo para cada prueba.</span><span class="sxs-lookup"><span data-stu-id="c0499-162">Unit tests of the DAL require <xref:Microsoft.EntityFrameworkCore.DbContextOptions> when creating a new `AppDbContext` for each test.</span></span> <span data-ttu-id="c0499-163">Un enfoque para crear el `DbContextOptions` para cada prueba es usar un: <xref:Microsoft.EntityFrameworkCore.DbContextOptionsBuilder></span><span class="sxs-lookup"><span data-stu-id="c0499-163">One approach to creating the `DbContextOptions` for each test is to use a <xref:Microsoft.EntityFrameworkCore.DbContextOptionsBuilder>:</span></span>

```csharp
var optionsBuilder = new DbContextOptionsBuilder<AppDbContext>()
    .UseInMemoryDatabase("InMemoryDb");

using (var db = new AppDbContext(optionsBuilder.Options))
{
    // Use the db here in the unit test.
}
```

<span data-ttu-id="c0499-164">El problema de este enfoque es que cada prueba recibe la base de datos en el estado que la prueba anterior la dejó.</span><span class="sxs-lookup"><span data-stu-id="c0499-164">The problem with this approach is that each test receives the database in whatever state the previous test left it.</span></span> <span data-ttu-id="c0499-165">Esto puede ser problemático al intentar escribir pruebas unitarias atómicas que no interfieren entre sí.</span><span class="sxs-lookup"><span data-stu-id="c0499-165">This can be problematic when trying to write atomic unit tests that don't interfere with each other.</span></span> <span data-ttu-id="c0499-166">Para forzar `AppDbContext` a que use un nuevo contexto de base de datos para cada `DbContextOptions` prueba, proporcione una instancia de basada en un nuevo proveedor de servicios.</span><span class="sxs-lookup"><span data-stu-id="c0499-166">To force the `AppDbContext` to use a new database context for each test, supply a `DbContextOptions` instance that's based on a new service provider.</span></span> <span data-ttu-id="c0499-167">La aplicación de prueba muestra cómo hacerlo mediante su `Utilities` método `TestDbContextOptions` de clase (*tests/RazorPagesTestSample. tests/Utilities/Utilities. CS*):</span><span class="sxs-lookup"><span data-stu-id="c0499-167">The test app shows how to do this using its `Utilities` class method `TestDbContextOptions` (*tests/RazorPagesTestSample.Tests/Utilities/Utilities.cs*):</span></span>

[!code-csharp[](razor-pages-tests/samples/3.x/tests/RazorPagesTestSample.Tests/Utilities/Utilities.cs?name=snippet1)]

<span data-ttu-id="c0499-168">El `DbContextOptions` uso de en las pruebas unitarias de dal permite que cada prueba se ejecute de forma atómica con una nueva instancia de base de datos:</span><span class="sxs-lookup"><span data-stu-id="c0499-168">Using the `DbContextOptions` in the DAL unit tests allows each test to run atomically with a fresh database instance:</span></span>

```csharp
using (var db = new AppDbContext(Utilities.TestDbContextOptions()))
{
    // Use the db here in the unit test.
}
```

<span data-ttu-id="c0499-169">Cada método de prueba de `DataAccessLayerTest` la clase (*UnitTests/DataAccessLayerTest. CS*) sigue un patrón de Arrange-Act-Assert similar:</span><span class="sxs-lookup"><span data-stu-id="c0499-169">Each test method in the `DataAccessLayerTest` class (*UnitTests/DataAccessLayerTest.cs*) follows a similar Arrange-Act-Assert pattern:</span></span>

1. <span data-ttu-id="c0499-170">Orden La base de datos está configurada para la prueba y/o se ha definido el resultado esperado.</span><span class="sxs-lookup"><span data-stu-id="c0499-170">Arrange: The database is configured for the test and/or the expected outcome is defined.</span></span>
1. <span data-ttu-id="c0499-171">LEDs La prueba se ejecuta.</span><span class="sxs-lookup"><span data-stu-id="c0499-171">Act: The test is executed.</span></span>
1. <span data-ttu-id="c0499-172">Declarar Se realizan aserciones para determinar si el resultado de la prueba es un éxito.</span><span class="sxs-lookup"><span data-stu-id="c0499-172">Assert: Assertions are made to determine if the test result is a success.</span></span>

<span data-ttu-id="c0499-173">Por ejemplo, el `DeleteMessageAsync` método es responsable de quitar un solo mensaje identificado por su `Id` (*src/RazorPagesTestSample/Data/AppDbContext. CS*):</span><span class="sxs-lookup"><span data-stu-id="c0499-173">For example, the `DeleteMessageAsync` method is responsible for removing a single message identified by its `Id` (*src/RazorPagesTestSample/Data/AppDbContext.cs*):</span></span>

[!code-csharp[](razor-pages-tests/samples/3.x/src/RazorPagesTestSample/Data/AppDbContext.cs?name=snippet4)]

<span data-ttu-id="c0499-174">Hay dos pruebas para este método.</span><span class="sxs-lookup"><span data-stu-id="c0499-174">There are two tests for this method.</span></span> <span data-ttu-id="c0499-175">Una prueba comprueba que el método elimina un mensaje cuando el mensaje está presente en la base de datos.</span><span class="sxs-lookup"><span data-stu-id="c0499-175">One test checks that the method deletes a message when the message is present in the database.</span></span> <span data-ttu-id="c0499-176">El otro método comprueba que la base de datos no cambia si `Id` no existe el mensaje para su eliminación.</span><span class="sxs-lookup"><span data-stu-id="c0499-176">The other method tests that the database doesn't change if the message `Id` for deletion doesn't exist.</span></span> <span data-ttu-id="c0499-177">El `DeleteMessageAsync_MessageIsDeleted_WhenMessageIsFound` método se muestra a continuación:</span><span class="sxs-lookup"><span data-stu-id="c0499-177">The `DeleteMessageAsync_MessageIsDeleted_WhenMessageIsFound` method is shown below:</span></span>

[!code-csharp[](razor-pages-tests/samples_snapshot/3.x/tests/RazorPagesTestSample.Tests/UnitTests/DataAccessLayerTest.cs?name=snippet1)]

<span data-ttu-id="c0499-178">En primer lugar, el método realiza el paso de organización, donde tiene lugar la preparación para el paso de Act.</span><span class="sxs-lookup"><span data-stu-id="c0499-178">First, the method performs the Arrange step, where preparation for the Act step takes place.</span></span> <span data-ttu-id="c0499-179">Los mensajes de propagación se obtienen y se mantienen `seedMessages`en.</span><span class="sxs-lookup"><span data-stu-id="c0499-179">The seeding messages are obtained and held in `seedMessages`.</span></span> <span data-ttu-id="c0499-180">Los mensajes de propagación se guardan en la base de datos.</span><span class="sxs-lookup"><span data-stu-id="c0499-180">The seeding messages are saved into the database.</span></span> <span data-ttu-id="c0499-181">El mensaje con un `Id` de `1` se establece para su eliminación.</span><span class="sxs-lookup"><span data-stu-id="c0499-181">The message with an `Id` of `1` is set for deletion.</span></span> <span data-ttu-id="c0499-182">Cuando se `DeleteMessageAsync` ejecuta el método, los mensajes esperados deben tener todos los mensajes excepto el que tiene un `Id` de `1`.</span><span class="sxs-lookup"><span data-stu-id="c0499-182">When the `DeleteMessageAsync` method is executed, the expected messages should have all of the messages except for the one with an `Id` of `1`.</span></span> <span data-ttu-id="c0499-183">La `expectedMessages` variable representa este resultado esperado.</span><span class="sxs-lookup"><span data-stu-id="c0499-183">The `expectedMessages` variable represents this expected outcome.</span></span>

[!code-csharp[](razor-pages-tests/samples/3.x/tests/RazorPagesTestSample.Tests/UnitTests/DataAccessLayerTest.cs?name=snippet1)]

<span data-ttu-id="c0499-184">El método actúa: El `DeleteMessageAsync` método se ejecuta pasando el `recId` de `1`:</span><span class="sxs-lookup"><span data-stu-id="c0499-184">The method acts: The `DeleteMessageAsync` method is executed passing in the `recId` of `1`:</span></span>

[!code-csharp[](razor-pages-tests/samples/3.x/tests/RazorPagesTestSample.Tests/UnitTests/DataAccessLayerTest.cs?name=snippet2)]

<span data-ttu-id="c0499-185">Por último, el método obtiene el `Messages` del contexto y lo compara con la `expectedMessages` aserción de que los dos son iguales:</span><span class="sxs-lookup"><span data-stu-id="c0499-185">Finally, the method obtains the `Messages` from the context and compares it to the `expectedMessages` asserting that the two are equal:</span></span>

[!code-csharp[](razor-pages-tests/samples/3.x/tests/RazorPagesTestSample.Tests/UnitTests/DataAccessLayerTest.cs?name=snippet3)]

<span data-ttu-id="c0499-186">Para comparar que los dos `List<Message>` son los mismos:</span><span class="sxs-lookup"><span data-stu-id="c0499-186">In order to compare that the two `List<Message>` are the same:</span></span>

* <span data-ttu-id="c0499-187">Los mensajes se ordenan `Id`por.</span><span class="sxs-lookup"><span data-stu-id="c0499-187">The messages are ordered by `Id`.</span></span>
* <span data-ttu-id="c0499-188">Los pares de mensajes se comparan en la `Text` propiedad.</span><span class="sxs-lookup"><span data-stu-id="c0499-188">Message pairs are compared on the `Text` property.</span></span>

<span data-ttu-id="c0499-189">Un método `DeleteMessageAsync_NoMessageIsDeleted_WhenMessageIsNotFound` de prueba similar comprueba el resultado de intentar eliminar un mensaje que no existe.</span><span class="sxs-lookup"><span data-stu-id="c0499-189">A similar test method, `DeleteMessageAsync_NoMessageIsDeleted_WhenMessageIsNotFound` checks the result of attempting to delete a message that doesn't exist.</span></span> <span data-ttu-id="c0499-190">En este caso, los mensajes esperados en la base de datos deben ser iguales a los mensajes `DeleteMessageAsync` reales después de ejecutar el método.</span><span class="sxs-lookup"><span data-stu-id="c0499-190">In this case, the expected messages in the database should be equal to the actual messages after the `DeleteMessageAsync` method is executed.</span></span> <span data-ttu-id="c0499-191">No debe haber ningún cambio en el contenido de la base de datos:</span><span class="sxs-lookup"><span data-stu-id="c0499-191">There should be no change to the database's content:</span></span>

[!code-csharp[](razor-pages-tests/samples/3.x/tests/RazorPagesTestSample.Tests/UnitTests/DataAccessLayerTest.cs?name=snippet4)]

## <a name="unit-tests-of-the-page-model-methods"></a><span data-ttu-id="c0499-192">Pruebas unitarias de los métodos del modelo de página</span><span class="sxs-lookup"><span data-stu-id="c0499-192">Unit tests of the page model methods</span></span>

<span data-ttu-id="c0499-193">Otro conjunto de pruebas unitarias es responsable de las pruebas de los métodos del modelo de página.</span><span class="sxs-lookup"><span data-stu-id="c0499-193">Another set of unit tests is responsible for tests of page model methods.</span></span> <span data-ttu-id="c0499-194">En la aplicación de mensaje, los modelos de página de índice se `IndexModel` encuentran en la clase en *src/RazorPagesTestSample/pages/index. cshtml. CS*.</span><span class="sxs-lookup"><span data-stu-id="c0499-194">In the message app, the Index page models are found in the `IndexModel` class in *src/RazorPagesTestSample/Pages/Index.cshtml.cs*.</span></span>

| <span data-ttu-id="c0499-195">Método del modelo de página</span><span class="sxs-lookup"><span data-stu-id="c0499-195">Page model method</span></span> | <span data-ttu-id="c0499-196">Función</span><span class="sxs-lookup"><span data-stu-id="c0499-196">Function</span></span> |
| ----------------- | -------- |
| `OnGetAsync` | <span data-ttu-id="c0499-197">Obtiene los mensajes de la capa Dal para la interfaz de usuario `GetMessagesAsync` mediante el método.</span><span class="sxs-lookup"><span data-stu-id="c0499-197">Obtains the messages from the DAL for the UI using the `GetMessagesAsync` method.</span></span> |
| `OnPostAddMessageAsync` | <span data-ttu-id="c0499-198">Si el [ModelState](xref:Microsoft.AspNetCore.Mvc.ModelBinding.ModelStateDictionary) es válido, llama `AddMessageAsync` a para agregar un mensaje a la base de datos.</span><span class="sxs-lookup"><span data-stu-id="c0499-198">If the [ModelState](xref:Microsoft.AspNetCore.Mvc.ModelBinding.ModelStateDictionary) is valid, calls `AddMessageAsync` to add a message to the database.</span></span> |
| `OnPostDeleteAllMessagesAsync` | <span data-ttu-id="c0499-199">Llama `DeleteAllMessagesAsync` a para eliminar todos los mensajes de la base de datos.</span><span class="sxs-lookup"><span data-stu-id="c0499-199">Calls `DeleteAllMessagesAsync` to delete all of the messages in the database.</span></span> |
| `OnPostDeleteMessageAsync` | <span data-ttu-id="c0499-200">Ejecuta para eliminar un mensaje con el `Id` especificado. `DeleteMessageAsync`</span><span class="sxs-lookup"><span data-stu-id="c0499-200">Executes `DeleteMessageAsync` to delete a message with the `Id` specified.</span></span> |
| `OnPostAnalyzeMessagesAsync` | <span data-ttu-id="c0499-201">Si uno o más mensajes están en la base de datos, calcula el número promedio de palabras por mensaje.</span><span class="sxs-lookup"><span data-stu-id="c0499-201">If one or more messages are in the database, calculates the average number of words per message.</span></span> |

<span data-ttu-id="c0499-202">Los métodos del modelo de página se prueban con siete `IndexPageTests` pruebas en la clase (*tests/RazorPagesTestSample. tests/UnitTests/IndexPageTests. CS*).</span><span class="sxs-lookup"><span data-stu-id="c0499-202">The page model methods are tested using seven tests in the `IndexPageTests` class (*tests/RazorPagesTestSample.Tests/UnitTests/IndexPageTests.cs*).</span></span> <span data-ttu-id="c0499-203">Las pruebas usan el conocido patrón Arrange-Assert-Act.</span><span class="sxs-lookup"><span data-stu-id="c0499-203">The tests use the familiar Arrange-Assert-Act pattern.</span></span> <span data-ttu-id="c0499-204">Estas pruebas se centran en:</span><span class="sxs-lookup"><span data-stu-id="c0499-204">These tests focus on:</span></span>

* <span data-ttu-id="c0499-205">Determinar si los métodos siguen el comportamiento correcto cuando [ModelState](xref:Microsoft.AspNetCore.Mvc.ModelBinding.ModelStateDictionary) no es válido.</span><span class="sxs-lookup"><span data-stu-id="c0499-205">Determining if the methods follow the correct behavior when the [ModelState](xref:Microsoft.AspNetCore.Mvc.ModelBinding.ModelStateDictionary) is invalid.</span></span>
* <span data-ttu-id="c0499-206">La confirmación de los métodos produce el correcto <xref:Microsoft.AspNetCore.Mvc.IActionResult>.</span><span class="sxs-lookup"><span data-stu-id="c0499-206">Confirming the methods produce the correct <xref:Microsoft.AspNetCore.Mvc.IActionResult>.</span></span>
* <span data-ttu-id="c0499-207">Comprobando que las asignaciones de valores de propiedad se realizan correctamente.</span><span class="sxs-lookup"><span data-stu-id="c0499-207">Checking that property value assignments are made correctly.</span></span>

<span data-ttu-id="c0499-208">Este grupo de pruebas suele simular los métodos de la capa DAL para generar los datos esperados para el paso de la acción en el que se ejecuta un método de modelo de página.</span><span class="sxs-lookup"><span data-stu-id="c0499-208">This group of tests often mock the methods of the DAL to produce expected data for the Act step where a page model method is executed.</span></span> <span data-ttu-id="c0499-209">Por ejemplo, el `GetMessagesAsync` método `AppDbContext` de se simula para generar la salida.</span><span class="sxs-lookup"><span data-stu-id="c0499-209">For example, the `GetMessagesAsync` method of the `AppDbContext` is mocked to produce output.</span></span> <span data-ttu-id="c0499-210">Cuando un método de modelo de página ejecuta este método, el simulacro devuelve el resultado.</span><span class="sxs-lookup"><span data-stu-id="c0499-210">When a page model method executes this method, the mock returns the result.</span></span> <span data-ttu-id="c0499-211">Los datos no provienen de la base de datos.</span><span class="sxs-lookup"><span data-stu-id="c0499-211">The data doesn't come from the database.</span></span> <span data-ttu-id="c0499-212">Esto crea condiciones de prueba de confianza y predecible para usar la capa DAL en las pruebas del modelo de página.</span><span class="sxs-lookup"><span data-stu-id="c0499-212">This creates predictable, reliable test conditions for using the DAL in the page model tests.</span></span>

<span data-ttu-id="c0499-213">La `OnGetAsync_PopulatesThePageModel_WithAListOfMessages` prueba muestra cómo se `GetMessagesAsync` simula el método para el modelo de página:</span><span class="sxs-lookup"><span data-stu-id="c0499-213">The `OnGetAsync_PopulatesThePageModel_WithAListOfMessages` test shows how the `GetMessagesAsync` method is mocked for the page model:</span></span>

[!code-csharp[](razor-pages-tests/samples/3.x/tests/RazorPagesTestSample.Tests/UnitTests/IndexPageTests.cs?name=snippet1&highlight=3-4)]

<span data-ttu-id="c0499-214">Cuando el `OnGetAsync` método se ejecuta en el paso de Act, llama al método del modelo `GetMessagesAsync` de página.</span><span class="sxs-lookup"><span data-stu-id="c0499-214">When the `OnGetAsync` method is executed in the Act step, it calls the page model's `GetMessagesAsync` method.</span></span>

<span data-ttu-id="c0499-215">Paso de acción de prueba unitaria (tests */RazorPagesTestSample. tests/UnitTests/IndexPageTests. CS*):</span><span class="sxs-lookup"><span data-stu-id="c0499-215">Unit test Act step (*tests/RazorPagesTestSample.Tests/UnitTests/IndexPageTests.cs*):</span></span>

[!code-csharp[](razor-pages-tests/samples/3.x/tests/RazorPagesTestSample.Tests/UnitTests/IndexPageTests.cs?name=snippet2)]

<span data-ttu-id="c0499-216">`IndexPage`método del modelo `OnGetAsync` de página (*src/RazorPagesTestSample/pages/index. cshtml. CS*):</span><span class="sxs-lookup"><span data-stu-id="c0499-216">`IndexPage` page model's `OnGetAsync` method (*src/RazorPagesTestSample/Pages/Index.cshtml.cs*):</span></span>

[!code-csharp[](razor-pages-tests/samples/3.x/src/RazorPagesTestSample/Pages/Index.cshtml.cs?name=snippet1&highlight=3)]

<span data-ttu-id="c0499-217">El `GetMessagesAsync` método de la capa Dal no devuelve el resultado de esta llamada al método.</span><span class="sxs-lookup"><span data-stu-id="c0499-217">The `GetMessagesAsync` method in the DAL doesn't return the result for this method call.</span></span> <span data-ttu-id="c0499-218">La versión ficticia del método devuelve el resultado.</span><span class="sxs-lookup"><span data-stu-id="c0499-218">The mocked version of the method returns the result.</span></span>

<span data-ttu-id="c0499-219">En el `Assert` paso, se asignan los`actualMessages`mensajes reales () de `Messages` la propiedad del modelo de página.</span><span class="sxs-lookup"><span data-stu-id="c0499-219">In the `Assert` step, the actual messages (`actualMessages`) are assigned from the `Messages` property of the page model.</span></span> <span data-ttu-id="c0499-220">También se realiza una comprobación de tipo cuando se asignan los mensajes.</span><span class="sxs-lookup"><span data-stu-id="c0499-220">A type check is also performed when the messages are assigned.</span></span> <span data-ttu-id="c0499-221">Los mensajes esperados y reales se comparan por sus `Text` propiedades.</span><span class="sxs-lookup"><span data-stu-id="c0499-221">The expected and actual messages are compared by their `Text` properties.</span></span> <span data-ttu-id="c0499-222">La prueba valida que las dos `List<Message>` instancias contienen los mismos mensajes.</span><span class="sxs-lookup"><span data-stu-id="c0499-222">The test asserts that the two `List<Message>` instances contain the same messages.</span></span>

[!code-csharp[](razor-pages-tests/samples/3.x/tests/RazorPagesTestSample.Tests/UnitTests/IndexPageTests.cs?name=snippet3)]

<span data-ttu-id="c0499-223">Otras pruebas de este grupo crean objetos de modelo de página que <xref:Microsoft.AspNetCore.Http.DefaultHttpContext>incluyen <xref:Microsoft.AspNetCore.Mvc.ModelBinding.ModelStateDictionary>, <xref:Microsoft.AspNetCore.Mvc.ActionContext> , y `PageContext`para establecer `PageContext`, `ViewDataDictionary`y.</span><span class="sxs-lookup"><span data-stu-id="c0499-223">Other tests in this group create page model objects that include the <xref:Microsoft.AspNetCore.Http.DefaultHttpContext>, the <xref:Microsoft.AspNetCore.Mvc.ModelBinding.ModelStateDictionary>, an <xref:Microsoft.AspNetCore.Mvc.ActionContext> to establish the `PageContext`, a `ViewDataDictionary`, and a `PageContext`.</span></span> <span data-ttu-id="c0499-224">Son útiles para realizar pruebas.</span><span class="sxs-lookup"><span data-stu-id="c0499-224">These are useful in conducting tests.</span></span> <span data-ttu-id="c0499-225">Por ejemplo, la aplicación de mensaje establece `ModelState` un error <xref:Microsoft.AspNetCore.Mvc.ModelBinding.ModelStateDictionary.AddModelError*> con para comprobar que se <xref:Microsoft.AspNetCore.Mvc.RazorPages.PageResult> devuelve un válido `OnPostAddMessageAsync` cuando se ejecuta:</span><span class="sxs-lookup"><span data-stu-id="c0499-225">For example, the message app establishes a `ModelState` error with <xref:Microsoft.AspNetCore.Mvc.ModelBinding.ModelStateDictionary.AddModelError*> to check that a valid <xref:Microsoft.AspNetCore.Mvc.RazorPages.PageResult> is returned when `OnPostAddMessageAsync` is executed:</span></span>

[!code-csharp[](razor-pages-tests/samples/3.x/tests/RazorPagesTestSample.Tests/UnitTests/IndexPageTests.cs?name=snippet4&highlight=11,26,29,32)]

## <a name="additional-resources"></a><span data-ttu-id="c0499-226">Recursos adicionales</span><span class="sxs-lookup"><span data-stu-id="c0499-226">Additional resources</span></span>

* [<span data-ttu-id="c0499-227">Pruebas C# unitarias en .net Core con pruebas de dotnet y xUnit</span><span class="sxs-lookup"><span data-stu-id="c0499-227">Unit testing C# in .NET Core using dotnet test and xUnit</span></span>](/dotnet/articles/core/testing/unit-testing-with-dotnet-test)
* <xref:mvc/controllers/testing>
* <span data-ttu-id="c0499-228">[Prueba unitaria del código](/visualstudio/test/unit-test-your-code) (Visual Studio)</span><span class="sxs-lookup"><span data-stu-id="c0499-228">[Unit Test Your Code](/visualstudio/test/unit-test-your-code) (Visual Studio)</span></span>
* <xref:test/integration-tests>
* [<span data-ttu-id="c0499-229">xUnit.net</span><span class="sxs-lookup"><span data-stu-id="c0499-229">xUnit.net</span></span>](https://xunit.github.io/)
* [<span data-ttu-id="c0499-230">Creación de una solución completa de .NET Core en macOS con Visual Studio para Mac</span><span class="sxs-lookup"><span data-stu-id="c0499-230">Building a complete .NET Core solution on macOS using Visual Studio for Mac</span></span>](/dotnet/core/tutorials/using-on-mac-vs-full-solution)
* [<span data-ttu-id="c0499-231">Introducción a xUnit.net: Uso de .NET Core con la línea de comandos del SDK de .NET</span><span class="sxs-lookup"><span data-stu-id="c0499-231">Getting started with xUnit.net: Using .NET Core with the .NET SDK command line</span></span>](https://xunit.github.io/docs/getting-started-dotnet-core)
* [<span data-ttu-id="c0499-232">MOQ</span><span class="sxs-lookup"><span data-stu-id="c0499-232">Moq</span></span>](https://github.com/moq/moq4)
* [<span data-ttu-id="c0499-233">Inicio rápido de MOQ</span><span class="sxs-lookup"><span data-stu-id="c0499-233">Moq Quickstart</span></span>](https://github.com/Moq/moq4/wiki/Quickstart)

::: moniker-end

::: moniker range="< aspnetcore-3.0"

<span data-ttu-id="c0499-234">ASP.NET Core admite pruebas unitarias de aplicaciones de Razor Pages.</span><span class="sxs-lookup"><span data-stu-id="c0499-234">ASP.NET Core supports unit tests of Razor Pages apps.</span></span> <span data-ttu-id="c0499-235">Las pruebas de la capa de acceso a datos (DAL) y los modelos de página ayudan a garantizar:</span><span class="sxs-lookup"><span data-stu-id="c0499-235">Tests of the data access layer (DAL) and page models help ensure:</span></span>

* <span data-ttu-id="c0499-236">Las partes de una aplicación Razor Pages funcionan de forma independiente y conjunta como una unidad durante la construcción de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="c0499-236">Parts of a Razor Pages app work independently and together as a unit during app construction.</span></span>
* <span data-ttu-id="c0499-237">Las clases y los métodos tienen ámbitos limitados de responsabilidad.</span><span class="sxs-lookup"><span data-stu-id="c0499-237">Classes and methods have limited scopes of responsibility.</span></span>
* <span data-ttu-id="c0499-238">Existe documentación adicional sobre el comportamiento de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="c0499-238">Additional documentation exists on how the app should behave.</span></span>
* <span data-ttu-id="c0499-239">Las regresiones, que son errores que se producen al actualizar el código, se encuentran durante la creación e implementación automatizadas.</span><span class="sxs-lookup"><span data-stu-id="c0499-239">Regressions, which are errors brought about by updates to the code, are found during automated building and deployment.</span></span>

<span data-ttu-id="c0499-240">En este tema se supone que tiene conocimientos básicos de Razor Pages aplicaciones y pruebas unitarias.</span><span class="sxs-lookup"><span data-stu-id="c0499-240">This topic assumes that you have a basic understanding of Razor Pages apps and unit tests.</span></span> <span data-ttu-id="c0499-241">Si no está familiarizado con las aplicaciones de Razor Pages o los conceptos de prueba, vea los temas siguientes:</span><span class="sxs-lookup"><span data-stu-id="c0499-241">If you're unfamiliar with Razor Pages apps or test concepts, see the following topics:</span></span>

* <xref:razor-pages/index>
* <xref:tutorials/razor-pages/razor-pages-start>
* [<span data-ttu-id="c0499-242">Pruebas C# unitarias en .net Core con pruebas de dotnet y xUnit</span><span class="sxs-lookup"><span data-stu-id="c0499-242">Unit testing C# in .NET Core using dotnet test and xUnit</span></span>](/dotnet/articles/core/testing/unit-testing-with-dotnet-test)

<span data-ttu-id="c0499-243">[Vea o descargue el código de ejemplo](https://github.com/aspnet/AspNetCore.Docs/tree/master/aspnetcore/test/razor-pages-tests/samples) ([cómo descargarlo](xref:index#how-to-download-a-sample))</span><span class="sxs-lookup"><span data-stu-id="c0499-243">[View or download sample code](https://github.com/aspnet/AspNetCore.Docs/tree/master/aspnetcore/test/razor-pages-tests/samples) ([how to download](xref:index#how-to-download-a-sample))</span></span>

<span data-ttu-id="c0499-244">El proyecto de ejemplo se compone de dos aplicaciones:</span><span class="sxs-lookup"><span data-stu-id="c0499-244">The sample project is composed of two apps:</span></span>

| <span data-ttu-id="c0499-245">Aplicación</span><span class="sxs-lookup"><span data-stu-id="c0499-245">App</span></span>         | <span data-ttu-id="c0499-246">Carpeta de proyecto</span><span class="sxs-lookup"><span data-stu-id="c0499-246">Project folder</span></span>                     | <span data-ttu-id="c0499-247">DESCRIPCIÓN</span><span class="sxs-lookup"><span data-stu-id="c0499-247">Description</span></span> |
| ----------- | ---------------------------------- | ----------- |
| <span data-ttu-id="c0499-248">Aplicación de mensaje</span><span class="sxs-lookup"><span data-stu-id="c0499-248">Message app</span></span> | <span data-ttu-id="c0499-249">*src/RazorPagesTestSample*</span><span class="sxs-lookup"><span data-stu-id="c0499-249">*src/RazorPagesTestSample*</span></span>         | <span data-ttu-id="c0499-250">Permite que un usuario agregue un mensaje, elimine un mensaje, elimine todos los mensajes y analice los mensajes (busque el número promedio de palabras por mensaje).</span><span class="sxs-lookup"><span data-stu-id="c0499-250">Allows a user to add a message, delete one message, delete all messages, and analyze messages (find the average number of words per message).</span></span> |
| <span data-ttu-id="c0499-251">Aplicación de prueba</span><span class="sxs-lookup"><span data-stu-id="c0499-251">Test app</span></span>    | <span data-ttu-id="c0499-252">*tests/RazorPagesTestSample.Tests*</span><span class="sxs-lookup"><span data-stu-id="c0499-252">*tests/RazorPagesTestSample.Tests*</span></span> | <span data-ttu-id="c0499-253">Se usa para probar unitarias el modelo de página de índice y la capa DAL de la aplicación de mensaje.</span><span class="sxs-lookup"><span data-stu-id="c0499-253">Used to unit test the DAL and Index page model of the message app.</span></span> |

<span data-ttu-id="c0499-254">Las pruebas se pueden ejecutar con las características de prueba integradas de un IDE, como [Visual Studio](/visualstudio/test/unit-test-your-code) o [Visual Studio para Mac](/dotnet/core/tutorials/using-on-mac-vs-full-solution).</span><span class="sxs-lookup"><span data-stu-id="c0499-254">The tests can be run using the built-in test features of an IDE, such as [Visual Studio](/visualstudio/test/unit-test-your-code) or [Visual Studio for Mac](/dotnet/core/tutorials/using-on-mac-vs-full-solution).</span></span> <span data-ttu-id="c0499-255">Si usa [Visual Studio Code](https://code.visualstudio.com/) o la línea de comandos, ejecute el siguiente comando en un símbolo del sistema en la carpeta *tests/RazorPagesTestSample. tests* :</span><span class="sxs-lookup"><span data-stu-id="c0499-255">If using [Visual Studio Code](https://code.visualstudio.com/) or the command line, execute the following command at a command prompt in the *tests/RazorPagesTestSample.Tests* folder:</span></span>

```console
dotnet test
```

## <a name="message-app-organization"></a><span data-ttu-id="c0499-256">Organización de aplicaciones de mensajes</span><span class="sxs-lookup"><span data-stu-id="c0499-256">Message app organization</span></span>

<span data-ttu-id="c0499-257">La aplicación de mensaje es un sistema de mensajes Razor Pages con las siguientes características:</span><span class="sxs-lookup"><span data-stu-id="c0499-257">The message app is a Razor Pages message system with the following characteristics:</span></span>

* <span data-ttu-id="c0499-258">La página de índice de la aplicación (*pages/index. cshtml* y *pages/index. cshtml. CS*) proporciona un método de interfaz de usuario y un modelo de página para controlar la adición, eliminación y análisis de mensajes (buscar el número promedio de palabras por mensaje).</span><span class="sxs-lookup"><span data-stu-id="c0499-258">The Index page of the app (*Pages/Index.cshtml* and *Pages/Index.cshtml.cs*) provides a UI and page model methods to control the addition, deletion, and analysis of messages (find the average number of words per message).</span></span>
* <span data-ttu-id="c0499-259">La `Message` clase (*Data/Message. CS*) describe un mensaje con dos propiedades: `Id` (Key) y `Text` (Message).</span><span class="sxs-lookup"><span data-stu-id="c0499-259">A message is described by the `Message` class (*Data/Message.cs*) with two properties: `Id` (key) and `Text` (message).</span></span> <span data-ttu-id="c0499-260">La `Text` propiedad es necesaria y está limitada a 200 caracteres.</span><span class="sxs-lookup"><span data-stu-id="c0499-260">The `Text` property is required and limited to 200 characters.</span></span>
* <span data-ttu-id="c0499-261">Los mensajes se almacenan mediante&#8224; [Entity Framework base de datos en memoria](/ef/core/providers/in-memory/).</span><span class="sxs-lookup"><span data-stu-id="c0499-261">Messages are stored using [Entity Framework's in-memory database](/ef/core/providers/in-memory/)&#8224;.</span></span>
* <span data-ttu-id="c0499-262">La aplicación contiene una capa Dal en su clase de contexto `AppDbContext` de base de datos, (*Data/AppDbContext. CS*).</span><span class="sxs-lookup"><span data-stu-id="c0499-262">The app contains a DAL in its database context class, `AppDbContext` (*Data/AppDbContext.cs*).</span></span> <span data-ttu-id="c0499-263">Los métodos Dal están marcados `virtual`, lo que permite simular los métodos para su uso en las pruebas.</span><span class="sxs-lookup"><span data-stu-id="c0499-263">The DAL methods are marked `virtual`, which allows mocking the methods for use in the tests.</span></span>
* <span data-ttu-id="c0499-264">Si la base de datos está vacía al iniciarse la aplicación, el almacén de mensajes se inicializa con tres mensajes.</span><span class="sxs-lookup"><span data-stu-id="c0499-264">If the database is empty on app startup, the message store is initialized with three messages.</span></span> <span data-ttu-id="c0499-265">Estos *mensajes inicializados* también se usan en las pruebas.</span><span class="sxs-lookup"><span data-stu-id="c0499-265">These *seeded messages* are also used in tests.</span></span>

<span data-ttu-id="c0499-266">&#8224;En el tema EF, [Test with inmemory](/ef/core/miscellaneous/testing/in-memory), se explica cómo usar una base de datos en memoria para las pruebas con MSTest.</span><span class="sxs-lookup"><span data-stu-id="c0499-266">&#8224;The EF topic, [Test with InMemory](/ef/core/miscellaneous/testing/in-memory), explains how to use an in-memory database for tests with MSTest.</span></span> <span data-ttu-id="c0499-267">En este tema se usa el marco de pruebas de [xUnit](https://xunit.github.io/) .</span><span class="sxs-lookup"><span data-stu-id="c0499-267">This topic uses the [xUnit](https://xunit.github.io/) test framework.</span></span> <span data-ttu-id="c0499-268">Los conceptos de prueba y las implementaciones de prueba en diferentes marcos de pruebas son similares, pero no idénticos.</span><span class="sxs-lookup"><span data-stu-id="c0499-268">Test concepts and test implementations across different test frameworks are similar but not identical.</span></span>

<span data-ttu-id="c0499-269">Aunque la aplicación de ejemplo no usa el patrón de repositorio y no es un ejemplo eficaz del [patrón de unidad de trabajo (UoW)](https://martinfowler.com/eaaCatalog/unitOfWork.html), Razor pages admite estos patrones de desarrollo.</span><span class="sxs-lookup"><span data-stu-id="c0499-269">Although the sample app doesn't use the repository pattern and isn't an effective example of the [Unit of Work (UoW) pattern](https://martinfowler.com/eaaCatalog/unitOfWork.html), Razor Pages supports these patterns of development.</span></span> <span data-ttu-id="c0499-270">Para obtener más información, vea [diseñar el nivel de persistencia de la infraestructura](/dotnet/standard/microservices-architecture/microservice-ddd-cqrs-patterns/infrastructure-persistence-layer-design) y <xref:mvc/controllers/testing> (el ejemplo implementa el patrón del repositorio).</span><span class="sxs-lookup"><span data-stu-id="c0499-270">For more information, see [Designing the infrastructure persistence layer](/dotnet/standard/microservices-architecture/microservice-ddd-cqrs-patterns/infrastructure-persistence-layer-design) and <xref:mvc/controllers/testing> (the sample implements the repository pattern).</span></span>

## <a name="test-app-organization"></a><span data-ttu-id="c0499-271">Probar la organización de la aplicación</span><span class="sxs-lookup"><span data-stu-id="c0499-271">Test app organization</span></span>

<span data-ttu-id="c0499-272">La aplicación de prueba es una aplicación de consola dentro de la carpeta *tests/RazorPagesTestSample. tests* .</span><span class="sxs-lookup"><span data-stu-id="c0499-272">The test app is a console app inside the *tests/RazorPagesTestSample.Tests* folder.</span></span>

| <span data-ttu-id="c0499-273">Carpeta de aplicación de prueba</span><span class="sxs-lookup"><span data-stu-id="c0499-273">Test app folder</span></span> | <span data-ttu-id="c0499-274">DESCRIPCIÓN</span><span class="sxs-lookup"><span data-stu-id="c0499-274">Description</span></span> |
| --------------- | ----------- |
| <span data-ttu-id="c0499-275">*UnitTests*</span><span class="sxs-lookup"><span data-stu-id="c0499-275">*UnitTests*</span></span>     | <ul><li><span data-ttu-id="c0499-276">*DataAccessLayerTest.CS* contiene las pruebas unitarias para la capa dal.</span><span class="sxs-lookup"><span data-stu-id="c0499-276">*DataAccessLayerTest.cs* contains the unit tests for the DAL.</span></span></li><li><span data-ttu-id="c0499-277">*IndexPageTests.CS* contiene las pruebas unitarias para el modelo de página de índice.</span><span class="sxs-lookup"><span data-stu-id="c0499-277">*IndexPageTests.cs* contains the unit tests for the Index page model.</span></span></li></ul> |
| <span data-ttu-id="c0499-278">*Utilidad*</span><span class="sxs-lookup"><span data-stu-id="c0499-278">*Utilities*</span></span>     | <span data-ttu-id="c0499-279">Contiene el `TestDbContextOptions` método utilizado para crear nuevas opciones de contexto de base de datos para cada prueba unitaria de la capa Dal, de modo que la base de datos se restablezca a su condición de línea base para cada prueba.</span><span class="sxs-lookup"><span data-stu-id="c0499-279">Contains the `TestDbContextOptions` method used to create new database context options for each DAL unit test so that the database is reset to its baseline condition for each test.</span></span> |

<span data-ttu-id="c0499-280">El marco de pruebas es [xUnit](https://xunit.github.io/).</span><span class="sxs-lookup"><span data-stu-id="c0499-280">The test framework is [xUnit](https://xunit.github.io/).</span></span> <span data-ttu-id="c0499-281">El marco de trabajo ficticio de objetos es [MOQ](https://github.com/moq/moq4).</span><span class="sxs-lookup"><span data-stu-id="c0499-281">The object mocking framework is [Moq](https://github.com/moq/moq4).</span></span>

## <a name="unit-tests-of-the-data-access-layer-dal"></a><span data-ttu-id="c0499-282">Pruebas unitarias de la capa de acceso a datos (DAL)</span><span class="sxs-lookup"><span data-stu-id="c0499-282">Unit tests of the data access layer (DAL)</span></span>

<span data-ttu-id="c0499-283">La aplicación de mensaje tiene un Dal con cuatro métodos contenidos en `AppDbContext` la clase (*src/RazorPagesTestSample/Data/AppDbContext. CS*).</span><span class="sxs-lookup"><span data-stu-id="c0499-283">The message app has a DAL with four methods contained in the `AppDbContext` class (*src/RazorPagesTestSample/Data/AppDbContext.cs*).</span></span> <span data-ttu-id="c0499-284">Cada método tiene una o dos pruebas unitarias en la aplicación de prueba.</span><span class="sxs-lookup"><span data-stu-id="c0499-284">Each method has one or two unit tests in the test app.</span></span>

| <span data-ttu-id="c0499-285">DAL (método)</span><span class="sxs-lookup"><span data-stu-id="c0499-285">DAL method</span></span>               | <span data-ttu-id="c0499-286">Función</span><span class="sxs-lookup"><span data-stu-id="c0499-286">Function</span></span>                                                                   |
| ------------------------ | -------------------------------------------------------------------------- |
| `GetMessagesAsync`       | <span data-ttu-id="c0499-287">Obtiene de la base de datos ordenada por la `Text` propiedad. `List<Message>`</span><span class="sxs-lookup"><span data-stu-id="c0499-287">Obtains a `List<Message>` from the database sorted by the `Text` property.</span></span> |
| `AddMessageAsync`        | <span data-ttu-id="c0499-288">Agrega un `Message` a la base de datos.</span><span class="sxs-lookup"><span data-stu-id="c0499-288">Adds a `Message` to the database.</span></span>                                          |
| `DeleteAllMessagesAsync` | <span data-ttu-id="c0499-289">Elimina todas `Message` las entradas de la base de datos.</span><span class="sxs-lookup"><span data-stu-id="c0499-289">Deletes all `Message` entries from the database.</span></span>                           |
| `DeleteMessageAsync`     | <span data-ttu-id="c0499-290">Elimina un único `Message` de la base de datos `Id`por.</span><span class="sxs-lookup"><span data-stu-id="c0499-290">Deletes a single `Message` from the database by `Id`.</span></span>                      |

<span data-ttu-id="c0499-291">Las pruebas unitarias de la <xref:Microsoft.EntityFrameworkCore.DbContextOptions> capa Dal requieren al `AppDbContext` crear un nuevo para cada prueba.</span><span class="sxs-lookup"><span data-stu-id="c0499-291">Unit tests of the DAL require <xref:Microsoft.EntityFrameworkCore.DbContextOptions> when creating a new `AppDbContext` for each test.</span></span> <span data-ttu-id="c0499-292">Un enfoque para crear el `DbContextOptions` para cada prueba es usar un: <xref:Microsoft.EntityFrameworkCore.DbContextOptionsBuilder></span><span class="sxs-lookup"><span data-stu-id="c0499-292">One approach to creating the `DbContextOptions` for each test is to use a <xref:Microsoft.EntityFrameworkCore.DbContextOptionsBuilder>:</span></span>

```csharp
var optionsBuilder = new DbContextOptionsBuilder<AppDbContext>()
    .UseInMemoryDatabase("InMemoryDb");

using (var db = new AppDbContext(optionsBuilder.Options))
{
    // Use the db here in the unit test.
}
```

<span data-ttu-id="c0499-293">El problema de este enfoque es que cada prueba recibe la base de datos en el estado que la prueba anterior la dejó.</span><span class="sxs-lookup"><span data-stu-id="c0499-293">The problem with this approach is that each test receives the database in whatever state the previous test left it.</span></span> <span data-ttu-id="c0499-294">Esto puede ser problemático al intentar escribir pruebas unitarias atómicas que no interfieren entre sí.</span><span class="sxs-lookup"><span data-stu-id="c0499-294">This can be problematic when trying to write atomic unit tests that don't interfere with each other.</span></span> <span data-ttu-id="c0499-295">Para forzar `AppDbContext` a que use un nuevo contexto de base de datos para cada `DbContextOptions` prueba, proporcione una instancia de basada en un nuevo proveedor de servicios.</span><span class="sxs-lookup"><span data-stu-id="c0499-295">To force the `AppDbContext` to use a new database context for each test, supply a `DbContextOptions` instance that's based on a new service provider.</span></span> <span data-ttu-id="c0499-296">La aplicación de prueba muestra cómo hacerlo mediante su `Utilities` método `TestDbContextOptions` de clase (*tests/RazorPagesTestSample. tests/Utilities/Utilities. CS*):</span><span class="sxs-lookup"><span data-stu-id="c0499-296">The test app shows how to do this using its `Utilities` class method `TestDbContextOptions` (*tests/RazorPagesTestSample.Tests/Utilities/Utilities.cs*):</span></span>

[!code-csharp[](razor-pages-tests/samples/2.x/tests/RazorPagesTestSample.Tests/Utilities/Utilities.cs?name=snippet1)]

<span data-ttu-id="c0499-297">El `DbContextOptions` uso de en las pruebas unitarias de dal permite que cada prueba se ejecute de forma atómica con una nueva instancia de base de datos:</span><span class="sxs-lookup"><span data-stu-id="c0499-297">Using the `DbContextOptions` in the DAL unit tests allows each test to run atomically with a fresh database instance:</span></span>

```csharp
using (var db = new AppDbContext(Utilities.TestDbContextOptions()))
{
    // Use the db here in the unit test.
}
```

<span data-ttu-id="c0499-298">Cada método de prueba de `DataAccessLayerTest` la clase (*UnitTests/DataAccessLayerTest. CS*) sigue un patrón de Arrange-Act-Assert similar:</span><span class="sxs-lookup"><span data-stu-id="c0499-298">Each test method in the `DataAccessLayerTest` class (*UnitTests/DataAccessLayerTest.cs*) follows a similar Arrange-Act-Assert pattern:</span></span>

1. <span data-ttu-id="c0499-299">Orden La base de datos está configurada para la prueba y/o se ha definido el resultado esperado.</span><span class="sxs-lookup"><span data-stu-id="c0499-299">Arrange: The database is configured for the test and/or the expected outcome is defined.</span></span>
1. <span data-ttu-id="c0499-300">LEDs La prueba se ejecuta.</span><span class="sxs-lookup"><span data-stu-id="c0499-300">Act: The test is executed.</span></span>
1. <span data-ttu-id="c0499-301">Declarar Se realizan aserciones para determinar si el resultado de la prueba es un éxito.</span><span class="sxs-lookup"><span data-stu-id="c0499-301">Assert: Assertions are made to determine if the test result is a success.</span></span>

<span data-ttu-id="c0499-302">Por ejemplo, el `DeleteMessageAsync` método es responsable de quitar un solo mensaje identificado por su `Id` (*src/RazorPagesTestSample/Data/AppDbContext. CS*):</span><span class="sxs-lookup"><span data-stu-id="c0499-302">For example, the `DeleteMessageAsync` method is responsible for removing a single message identified by its `Id` (*src/RazorPagesTestSample/Data/AppDbContext.cs*):</span></span>

[!code-csharp[](razor-pages-tests/samples/2.x/src/RazorPagesTestSample/Data/AppDbContext.cs?name=snippet4)]

<span data-ttu-id="c0499-303">Hay dos pruebas para este método.</span><span class="sxs-lookup"><span data-stu-id="c0499-303">There are two tests for this method.</span></span> <span data-ttu-id="c0499-304">Una prueba comprueba que el método elimina un mensaje cuando el mensaje está presente en la base de datos.</span><span class="sxs-lookup"><span data-stu-id="c0499-304">One test checks that the method deletes a message when the message is present in the database.</span></span> <span data-ttu-id="c0499-305">El otro método comprueba que la base de datos no cambia si `Id` no existe el mensaje para su eliminación.</span><span class="sxs-lookup"><span data-stu-id="c0499-305">The other method tests that the database doesn't change if the message `Id` for deletion doesn't exist.</span></span> <span data-ttu-id="c0499-306">El `DeleteMessageAsync_MessageIsDeleted_WhenMessageIsFound` método se muestra a continuación:</span><span class="sxs-lookup"><span data-stu-id="c0499-306">The `DeleteMessageAsync_MessageIsDeleted_WhenMessageIsFound` method is shown below:</span></span>

[!code-csharp[](razor-pages-tests/samples_snapshot/2.x/tests/RazorPagesTestSample.Tests/UnitTests/DataAccessLayerTest.cs?name=snippet1)]

<span data-ttu-id="c0499-307">En primer lugar, el método realiza el paso de organización, donde tiene lugar la preparación para el paso de Act.</span><span class="sxs-lookup"><span data-stu-id="c0499-307">First, the method performs the Arrange step, where preparation for the Act step takes place.</span></span> <span data-ttu-id="c0499-308">Los mensajes de propagación se obtienen y se mantienen `seedMessages`en.</span><span class="sxs-lookup"><span data-stu-id="c0499-308">The seeding messages are obtained and held in `seedMessages`.</span></span> <span data-ttu-id="c0499-309">Los mensajes de propagación se guardan en la base de datos.</span><span class="sxs-lookup"><span data-stu-id="c0499-309">The seeding messages are saved into the database.</span></span> <span data-ttu-id="c0499-310">El mensaje con un `Id` de `1` se establece para su eliminación.</span><span class="sxs-lookup"><span data-stu-id="c0499-310">The message with an `Id` of `1` is set for deletion.</span></span> <span data-ttu-id="c0499-311">Cuando se `DeleteMessageAsync` ejecuta el método, los mensajes esperados deben tener todos los mensajes excepto el que tiene un `Id` de `1`.</span><span class="sxs-lookup"><span data-stu-id="c0499-311">When the `DeleteMessageAsync` method is executed, the expected messages should have all of the messages except for the one with an `Id` of `1`.</span></span> <span data-ttu-id="c0499-312">La `expectedMessages` variable representa este resultado esperado.</span><span class="sxs-lookup"><span data-stu-id="c0499-312">The `expectedMessages` variable represents this expected outcome.</span></span>

[!code-csharp[](razor-pages-tests/samples/2.x/tests/RazorPagesTestSample.Tests/UnitTests/DataAccessLayerTest.cs?name=snippet1)]

<span data-ttu-id="c0499-313">El método actúa: El `DeleteMessageAsync` método se ejecuta pasando el `recId` de `1`:</span><span class="sxs-lookup"><span data-stu-id="c0499-313">The method acts: The `DeleteMessageAsync` method is executed passing in the `recId` of `1`:</span></span>

[!code-csharp[](razor-pages-tests/samples/2.x/tests/RazorPagesTestSample.Tests/UnitTests/DataAccessLayerTest.cs?name=snippet2)]

<span data-ttu-id="c0499-314">Por último, el método obtiene el `Messages` del contexto y lo compara con la `expectedMessages` aserción de que los dos son iguales:</span><span class="sxs-lookup"><span data-stu-id="c0499-314">Finally, the method obtains the `Messages` from the context and compares it to the `expectedMessages` asserting that the two are equal:</span></span>

[!code-csharp[](razor-pages-tests/samples/2.x/tests/RazorPagesTestSample.Tests/UnitTests/DataAccessLayerTest.cs?name=snippet3)]

<span data-ttu-id="c0499-315">Para comparar que los dos `List<Message>` son los mismos:</span><span class="sxs-lookup"><span data-stu-id="c0499-315">In order to compare that the two `List<Message>` are the same:</span></span>

* <span data-ttu-id="c0499-316">Los mensajes se ordenan `Id`por.</span><span class="sxs-lookup"><span data-stu-id="c0499-316">The messages are ordered by `Id`.</span></span>
* <span data-ttu-id="c0499-317">Los pares de mensajes se comparan en la `Text` propiedad.</span><span class="sxs-lookup"><span data-stu-id="c0499-317">Message pairs are compared on the `Text` property.</span></span>

<span data-ttu-id="c0499-318">Un método `DeleteMessageAsync_NoMessageIsDeleted_WhenMessageIsNotFound` de prueba similar comprueba el resultado de intentar eliminar un mensaje que no existe.</span><span class="sxs-lookup"><span data-stu-id="c0499-318">A similar test method, `DeleteMessageAsync_NoMessageIsDeleted_WhenMessageIsNotFound` checks the result of attempting to delete a message that doesn't exist.</span></span> <span data-ttu-id="c0499-319">En este caso, los mensajes esperados en la base de datos deben ser iguales a los mensajes `DeleteMessageAsync` reales después de ejecutar el método.</span><span class="sxs-lookup"><span data-stu-id="c0499-319">In this case, the expected messages in the database should be equal to the actual messages after the `DeleteMessageAsync` method is executed.</span></span> <span data-ttu-id="c0499-320">No debe haber ningún cambio en el contenido de la base de datos:</span><span class="sxs-lookup"><span data-stu-id="c0499-320">There should be no change to the database's content:</span></span>

[!code-csharp[](razor-pages-tests/samples/2.x/tests/RazorPagesTestSample.Tests/UnitTests/DataAccessLayerTest.cs?name=snippet4)]

## <a name="unit-tests-of-the-page-model-methods"></a><span data-ttu-id="c0499-321">Pruebas unitarias de los métodos del modelo de página</span><span class="sxs-lookup"><span data-stu-id="c0499-321">Unit tests of the page model methods</span></span>

<span data-ttu-id="c0499-322">Otro conjunto de pruebas unitarias es responsable de las pruebas de los métodos del modelo de página.</span><span class="sxs-lookup"><span data-stu-id="c0499-322">Another set of unit tests is responsible for tests of page model methods.</span></span> <span data-ttu-id="c0499-323">En la aplicación de mensaje, los modelos de página de índice se `IndexModel` encuentran en la clase en *src/RazorPagesTestSample/pages/index. cshtml. CS*.</span><span class="sxs-lookup"><span data-stu-id="c0499-323">In the message app, the Index page models are found in the `IndexModel` class in *src/RazorPagesTestSample/Pages/Index.cshtml.cs*.</span></span>

| <span data-ttu-id="c0499-324">Método del modelo de página</span><span class="sxs-lookup"><span data-stu-id="c0499-324">Page model method</span></span> | <span data-ttu-id="c0499-325">Función</span><span class="sxs-lookup"><span data-stu-id="c0499-325">Function</span></span> |
| ----------------- | -------- |
| `OnGetAsync` | <span data-ttu-id="c0499-326">Obtiene los mensajes de la capa Dal para la interfaz de usuario `GetMessagesAsync` mediante el método.</span><span class="sxs-lookup"><span data-stu-id="c0499-326">Obtains the messages from the DAL for the UI using the `GetMessagesAsync` method.</span></span> |
| `OnPostAddMessageAsync` | <span data-ttu-id="c0499-327">Si el [ModelState](xref:Microsoft.AspNetCore.Mvc.ModelBinding.ModelStateDictionary) es válido, llama `AddMessageAsync` a para agregar un mensaje a la base de datos.</span><span class="sxs-lookup"><span data-stu-id="c0499-327">If the [ModelState](xref:Microsoft.AspNetCore.Mvc.ModelBinding.ModelStateDictionary) is valid, calls `AddMessageAsync` to add a message to the database.</span></span> |
| `OnPostDeleteAllMessagesAsync` | <span data-ttu-id="c0499-328">Llama `DeleteAllMessagesAsync` a para eliminar todos los mensajes de la base de datos.</span><span class="sxs-lookup"><span data-stu-id="c0499-328">Calls `DeleteAllMessagesAsync` to delete all of the messages in the database.</span></span> |
| `OnPostDeleteMessageAsync` | <span data-ttu-id="c0499-329">Ejecuta para eliminar un mensaje con el `Id` especificado. `DeleteMessageAsync`</span><span class="sxs-lookup"><span data-stu-id="c0499-329">Executes `DeleteMessageAsync` to delete a message with the `Id` specified.</span></span> |
| `OnPostAnalyzeMessagesAsync` | <span data-ttu-id="c0499-330">Si uno o más mensajes están en la base de datos, calcula el número promedio de palabras por mensaje.</span><span class="sxs-lookup"><span data-stu-id="c0499-330">If one or more messages are in the database, calculates the average number of words per message.</span></span> |

<span data-ttu-id="c0499-331">Los métodos del modelo de página se prueban con siete `IndexPageTests` pruebas en la clase (*tests/RazorPagesTestSample. tests/UnitTests/IndexPageTests. CS*).</span><span class="sxs-lookup"><span data-stu-id="c0499-331">The page model methods are tested using seven tests in the `IndexPageTests` class (*tests/RazorPagesTestSample.Tests/UnitTests/IndexPageTests.cs*).</span></span> <span data-ttu-id="c0499-332">Las pruebas usan el conocido patrón Arrange-Assert-Act.</span><span class="sxs-lookup"><span data-stu-id="c0499-332">The tests use the familiar Arrange-Assert-Act pattern.</span></span> <span data-ttu-id="c0499-333">Estas pruebas se centran en:</span><span class="sxs-lookup"><span data-stu-id="c0499-333">These tests focus on:</span></span>

* <span data-ttu-id="c0499-334">Determinar si los métodos siguen el comportamiento correcto cuando [ModelState](xref:Microsoft.AspNetCore.Mvc.ModelBinding.ModelStateDictionary) no es válido.</span><span class="sxs-lookup"><span data-stu-id="c0499-334">Determining if the methods follow the correct behavior when the [ModelState](xref:Microsoft.AspNetCore.Mvc.ModelBinding.ModelStateDictionary) is invalid.</span></span>
* <span data-ttu-id="c0499-335">La confirmación de los métodos produce el correcto <xref:Microsoft.AspNetCore.Mvc.IActionResult>.</span><span class="sxs-lookup"><span data-stu-id="c0499-335">Confirming the methods produce the correct <xref:Microsoft.AspNetCore.Mvc.IActionResult>.</span></span>
* <span data-ttu-id="c0499-336">Comprobando que las asignaciones de valores de propiedad se realizan correctamente.</span><span class="sxs-lookup"><span data-stu-id="c0499-336">Checking that property value assignments are made correctly.</span></span>

<span data-ttu-id="c0499-337">Este grupo de pruebas suele simular los métodos de la capa DAL para generar los datos esperados para el paso de la acción en el que se ejecuta un método de modelo de página.</span><span class="sxs-lookup"><span data-stu-id="c0499-337">This group of tests often mock the methods of the DAL to produce expected data for the Act step where a page model method is executed.</span></span> <span data-ttu-id="c0499-338">Por ejemplo, el `GetMessagesAsync` método `AppDbContext` de se simula para generar la salida.</span><span class="sxs-lookup"><span data-stu-id="c0499-338">For example, the `GetMessagesAsync` method of the `AppDbContext` is mocked to produce output.</span></span> <span data-ttu-id="c0499-339">Cuando un método de modelo de página ejecuta este método, el simulacro devuelve el resultado.</span><span class="sxs-lookup"><span data-stu-id="c0499-339">When a page model method executes this method, the mock returns the result.</span></span> <span data-ttu-id="c0499-340">Los datos no provienen de la base de datos.</span><span class="sxs-lookup"><span data-stu-id="c0499-340">The data doesn't come from the database.</span></span> <span data-ttu-id="c0499-341">Esto crea condiciones de prueba de confianza y predecible para usar la capa DAL en las pruebas del modelo de página.</span><span class="sxs-lookup"><span data-stu-id="c0499-341">This creates predictable, reliable test conditions for using the DAL in the page model tests.</span></span>

<span data-ttu-id="c0499-342">La `OnGetAsync_PopulatesThePageModel_WithAListOfMessages` prueba muestra cómo se `GetMessagesAsync` simula el método para el modelo de página:</span><span class="sxs-lookup"><span data-stu-id="c0499-342">The `OnGetAsync_PopulatesThePageModel_WithAListOfMessages` test shows how the `GetMessagesAsync` method is mocked for the page model:</span></span>

[!code-csharp[](razor-pages-tests/samples/2.x/tests/RazorPagesTestSample.Tests/UnitTests/IndexPageTests.cs?name=snippet1&highlight=3-4)]

<span data-ttu-id="c0499-343">Cuando el `OnGetAsync` método se ejecuta en el paso de Act, llama al método del modelo `GetMessagesAsync` de página.</span><span class="sxs-lookup"><span data-stu-id="c0499-343">When the `OnGetAsync` method is executed in the Act step, it calls the page model's `GetMessagesAsync` method.</span></span>

<span data-ttu-id="c0499-344">Paso de acción de prueba unitaria (tests */RazorPagesTestSample. tests/UnitTests/IndexPageTests. CS*):</span><span class="sxs-lookup"><span data-stu-id="c0499-344">Unit test Act step (*tests/RazorPagesTestSample.Tests/UnitTests/IndexPageTests.cs*):</span></span>

[!code-csharp[](razor-pages-tests/samples/2.x/tests/RazorPagesTestSample.Tests/UnitTests/IndexPageTests.cs?name=snippet2)]

<span data-ttu-id="c0499-345">`IndexPage`método del modelo `OnGetAsync` de página (*src/RazorPagesTestSample/pages/index. cshtml. CS*):</span><span class="sxs-lookup"><span data-stu-id="c0499-345">`IndexPage` page model's `OnGetAsync` method (*src/RazorPagesTestSample/Pages/Index.cshtml.cs*):</span></span>

[!code-csharp[](razor-pages-tests/samples/2.x/src/RazorPagesTestSample/Pages/Index.cshtml.cs?name=snippet1&highlight=3)]

<span data-ttu-id="c0499-346">El `GetMessagesAsync` método de la capa Dal no devuelve el resultado de esta llamada al método.</span><span class="sxs-lookup"><span data-stu-id="c0499-346">The `GetMessagesAsync` method in the DAL doesn't return the result for this method call.</span></span> <span data-ttu-id="c0499-347">La versión ficticia del método devuelve el resultado.</span><span class="sxs-lookup"><span data-stu-id="c0499-347">The mocked version of the method returns the result.</span></span>

<span data-ttu-id="c0499-348">En el `Assert` paso, se asignan los`actualMessages`mensajes reales () de `Messages` la propiedad del modelo de página.</span><span class="sxs-lookup"><span data-stu-id="c0499-348">In the `Assert` step, the actual messages (`actualMessages`) are assigned from the `Messages` property of the page model.</span></span> <span data-ttu-id="c0499-349">También se realiza una comprobación de tipo cuando se asignan los mensajes.</span><span class="sxs-lookup"><span data-stu-id="c0499-349">A type check is also performed when the messages are assigned.</span></span> <span data-ttu-id="c0499-350">Los mensajes esperados y reales se comparan por sus `Text` propiedades.</span><span class="sxs-lookup"><span data-stu-id="c0499-350">The expected and actual messages are compared by their `Text` properties.</span></span> <span data-ttu-id="c0499-351">La prueba valida que las dos `List<Message>` instancias contienen los mismos mensajes.</span><span class="sxs-lookup"><span data-stu-id="c0499-351">The test asserts that the two `List<Message>` instances contain the same messages.</span></span>

[!code-csharp[](razor-pages-tests/samples/2.x/tests/RazorPagesTestSample.Tests/UnitTests/IndexPageTests.cs?name=snippet3)]

<span data-ttu-id="c0499-352">Otras pruebas de este grupo crean objetos de modelo de página que <xref:Microsoft.AspNetCore.Http.DefaultHttpContext>incluyen <xref:Microsoft.AspNetCore.Mvc.ModelBinding.ModelStateDictionary>, <xref:Microsoft.AspNetCore.Mvc.ActionContext> , y `PageContext`para establecer `PageContext`, `ViewDataDictionary`y.</span><span class="sxs-lookup"><span data-stu-id="c0499-352">Other tests in this group create page model objects that include the <xref:Microsoft.AspNetCore.Http.DefaultHttpContext>, the <xref:Microsoft.AspNetCore.Mvc.ModelBinding.ModelStateDictionary>, an <xref:Microsoft.AspNetCore.Mvc.ActionContext> to establish the `PageContext`, a `ViewDataDictionary`, and a `PageContext`.</span></span> <span data-ttu-id="c0499-353">Son útiles para realizar pruebas.</span><span class="sxs-lookup"><span data-stu-id="c0499-353">These are useful in conducting tests.</span></span> <span data-ttu-id="c0499-354">Por ejemplo, la aplicación de mensaje establece `ModelState` un error <xref:Microsoft.AspNetCore.Mvc.ModelBinding.ModelStateDictionary.AddModelError*> con para comprobar que se <xref:Microsoft.AspNetCore.Mvc.RazorPages.PageResult> devuelve un válido `OnPostAddMessageAsync` cuando se ejecuta:</span><span class="sxs-lookup"><span data-stu-id="c0499-354">For example, the message app establishes a `ModelState` error with <xref:Microsoft.AspNetCore.Mvc.ModelBinding.ModelStateDictionary.AddModelError*> to check that a valid <xref:Microsoft.AspNetCore.Mvc.RazorPages.PageResult> is returned when `OnPostAddMessageAsync` is executed:</span></span>

[!code-csharp[](razor-pages-tests/samples/2.x/tests/RazorPagesTestSample.Tests/UnitTests/IndexPageTests.cs?name=snippet4&highlight=11,26,29,32)]

## <a name="additional-resources"></a><span data-ttu-id="c0499-355">Recursos adicionales</span><span class="sxs-lookup"><span data-stu-id="c0499-355">Additional resources</span></span>

* [<span data-ttu-id="c0499-356">Pruebas C# unitarias en .net Core con pruebas de dotnet y xUnit</span><span class="sxs-lookup"><span data-stu-id="c0499-356">Unit testing C# in .NET Core using dotnet test and xUnit</span></span>](/dotnet/articles/core/testing/unit-testing-with-dotnet-test)
* <xref:mvc/controllers/testing>
* <span data-ttu-id="c0499-357">[Prueba unitaria del código](/visualstudio/test/unit-test-your-code) (Visual Studio)</span><span class="sxs-lookup"><span data-stu-id="c0499-357">[Unit Test Your Code](/visualstudio/test/unit-test-your-code) (Visual Studio)</span></span>
* <xref:test/integration-tests>
* [<span data-ttu-id="c0499-358">xUnit.net</span><span class="sxs-lookup"><span data-stu-id="c0499-358">xUnit.net</span></span>](https://xunit.github.io/)
* [<span data-ttu-id="c0499-359">Creación de una solución completa de .NET Core en macOS con Visual Studio para Mac</span><span class="sxs-lookup"><span data-stu-id="c0499-359">Building a complete .NET Core solution on macOS using Visual Studio for Mac</span></span>](/dotnet/core/tutorials/using-on-mac-vs-full-solution)
* [<span data-ttu-id="c0499-360">Introducción a xUnit.net: Uso de .NET Core con la línea de comandos del SDK de .NET</span><span class="sxs-lookup"><span data-stu-id="c0499-360">Getting started with xUnit.net: Using .NET Core with the .NET SDK command line</span></span>](https://xunit.github.io/docs/getting-started-dotnet-core)
* [<span data-ttu-id="c0499-361">MOQ</span><span class="sxs-lookup"><span data-stu-id="c0499-361">Moq</span></span>](https://github.com/moq/moq4)
* [<span data-ttu-id="c0499-362">Inicio rápido de MOQ</span><span class="sxs-lookup"><span data-stu-id="c0499-362">Moq Quickstart</span></span>](https://github.com/Moq/moq4/wiki/Quickstart)

::: moniker-end
