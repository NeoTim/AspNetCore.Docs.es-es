---
title: Migración de ASP.NET Core 2.2 a 3.0 Preview
author: tdykstra
description: Obtenga información sobre cómo migrar un proyecto de ASP.NET Core 2.2 a ASP.NET Core 3.0.
ms.author: tdykstra
ms.custom: mvc
ms.date: 05/09/2019
uid: migration/22-to-30
ms.openlocfilehash: 7c47d042749ac3960c301ad918858e0375f4b2d0
ms.sourcegitcommit: 20ca93d72cb0b3998637724b44523e57b089c8fd
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 05/09/2019
ms.locfileid: "65473586"
---
# <a name="migrate-from-aspnet-core-22-to-30"></a><span data-ttu-id="e3397-103">Migración de ASP.NET Core 2.2 a 3.0</span><span class="sxs-lookup"><span data-stu-id="e3397-103">Migrate from ASP.NET Core 2.2 to 3.0</span></span>

<span data-ttu-id="e3397-104">Por [Scott Addie](https://github.com/scottaddie) y [Rick Anderson](https://twitter.com/RickAndMSFT)</span><span class="sxs-lookup"><span data-stu-id="e3397-104">By [Scott Addie](https://github.com/scottaddie) and [Rick Anderson](https://twitter.com/RickAndMSFT)</span></span>

<span data-ttu-id="e3397-105">En este artículo se explica cómo actualizar un proyecto de ASP.NET Core 2.2 existente a ASP.NET Core 3.0.</span><span class="sxs-lookup"><span data-stu-id="e3397-105">This article explains how to update an existing ASP.NET Core 2.2 project to ASP.NET Core 3.0.</span></span>

[!INCLUDE[](~/includes/net-core-prereqs-all-3.0.md)]

## <a name="update-the-project-file"></a><span data-ttu-id="e3397-106">Actualizar el archivo de proyecto</span><span class="sxs-lookup"><span data-stu-id="e3397-106">Update the project file</span></span>

* <span data-ttu-id="e3397-107">Establecer el [Moniker (TFM) de la plataforma de destino](/dotnet/standard/frameworks#referring-to-frameworks) a `netcoreapp3.0`:</span><span class="sxs-lookup"><span data-stu-id="e3397-107">Set the [Target Framework Moniker (TFM)](/dotnet/standard/frameworks#referring-to-frameworks) to `netcoreapp3.0`:</span></span>

  ```xml
  <TargetFramework>netcoreapp3.0</TargetFramework>
  ```

* <span data-ttu-id="e3397-108">Quite cualquier `<PackageReference>` a la [Microsoft.AspNetCore.All](xref:fundamentals/metapackage) o [Microsoft.AspNetCore.App](xref:fundamentals/metapackage-app) metapaquete.</span><span class="sxs-lookup"><span data-stu-id="e3397-108">Remove any `<PackageReference>` to the [Microsoft.AspNetCore.All](xref:fundamentals/metapackage) or [Microsoft.AspNetCore.App](xref:fundamentals/metapackage-app) metapackage.</span></span>

* <span data-ttu-id="e3397-109">Actualización de la `Version` en restantes `<PackageReference>` elementos para `Microsoft.AspNetCore.*` paquetes en la vista previa actual (por ejemplo, `3.0.0-preview-18579-0053`).</span><span class="sxs-lookup"><span data-stu-id="e3397-109">Update the `Version` on remaining `<PackageReference>` elements for `Microsoft.AspNetCore.*` packages to the current preview (for example, `3.0.0-preview-18579-0053`).</span></span>

  <span data-ttu-id="e3397-110">Si no hay ninguna versión 3.0 de un paquete, el paquete podría han quedado obsoletas en 3.0.</span><span class="sxs-lookup"><span data-stu-id="e3397-110">If there's no 3.0 version of a package, the package might have been deprecated in 3.0.</span></span> <span data-ttu-id="e3397-111">Muchas de ellas son parte de `Microsoft.AspNetCore.App` y no debe hacer referencia a individualmente.</span><span class="sxs-lookup"><span data-stu-id="e3397-111">Many of these are part of `Microsoft.AspNetCore.App` and shouldn't be referenced individually.</span></span> <span data-ttu-id="e3397-112">Para obtener una lista preliminar de los paquetes ya no se producen en 3.0, consulte [deje de generar paquetes para los ensamblados del marco compartido 3.0 (aspnet/AspNetCore #3756)](https://github.com/aspnet/AspNetCore/issues/3756).</span><span class="sxs-lookup"><span data-stu-id="e3397-112">For a preliminary list of packages no longer produced in 3.0, see [Stop producing packages for shared framework assemblies in 3.0 (aspnet/AspNetCore #3756)](https://github.com/aspnet/AspNetCore/issues/3756).</span></span> <span data-ttu-id="e3397-113">El *marco compartido* es el conjunto de ensamblados (*.dll* archivos) que están instalados en el equipo y al que hace referencia `Microsoft.AspNetCore.App`.</span><span class="sxs-lookup"><span data-stu-id="e3397-113">The *shared framework* is the set of assemblies (*.dll* files) that are installed on the machine and referenced by `Microsoft.AspNetCore.App`.</span></span> <span data-ttu-id="e3397-114">Para obtener más información, consulte [marco compartido](https://natemcmaster.com/blog/2018/08/29/netcore-primitives-2/).</span><span class="sxs-lookup"><span data-stu-id="e3397-114">For more information, see [The shared framework](https://natemcmaster.com/blog/2018/08/29/netcore-primitives-2/).</span></span>

* <span data-ttu-id="e3397-115">Se quitaron algunos ensamblados `Microsoft.AspNetCore.App` entre 2.x y 3.0.</span><span class="sxs-lookup"><span data-stu-id="e3397-115">Some assemblies were removed from `Microsoft.AspNetCore.App` between 2.x and 3.0.</span></span> <span data-ttu-id="e3397-116">Es posible que deba agregar `<PackageReference>` elementos si usa las API de los paquetes enumerados en [ensamblados que se va a quitarse Microsoft.AspNetCore.App 3.0 (aspnet/AspNetCore #3755)](https://github.com/aspnet/AspNetCore/issues/3755).</span><span class="sxs-lookup"><span data-stu-id="e3397-116">You may need to add `<PackageReference>` items if you're using APIs from packages listed in [Assemblies being removed from Microsoft.AspNetCore.App 3.0 (aspnet/AspNetCore #3755)](https://github.com/aspnet/AspNetCore/issues/3755).</span></span>

  <span data-ttu-id="e3397-117">Por ejemplo, `Microsoft.EntityFrameworkCore` y `System.Data.SqlClient` ya no forman parte de `Microsoft.AspNetCore.App`.</span><span class="sxs-lookup"><span data-stu-id="e3397-117">For example, `Microsoft.EntityFrameworkCore` and `System.Data.SqlClient` are no longer part of `Microsoft.AspNetCore.App`.</span></span> <span data-ttu-id="e3397-118">La lista de ensamblados de envío en `Microsoft.AspNetCore.App` aún no ha finalizado o no y cambiará antes de 3.0 RTM.</span><span class="sxs-lookup"><span data-stu-id="e3397-118">The list of assemblies shipping in `Microsoft.AspNetCore.App` hasn't been finalized yet and will change before 3.0 RTM.</span></span>

* <span data-ttu-id="e3397-119">Agregar [Json.NET soporte](#jsonnet-support).</span><span class="sxs-lookup"><span data-stu-id="e3397-119">Add [Json.NET support](#jsonnet-support).</span></span>

* <span data-ttu-id="e3397-120">Los proyectos de forma predeterminada el [modelo de hospedaje en proceso](xref:host-and-deploy/aspnet-core-module#in-process-hosting-model) en ASP.NET Core 3.0 o posterior.</span><span class="sxs-lookup"><span data-stu-id="e3397-120">Projects default to the [in-process hosting model](xref:host-and-deploy/aspnet-core-module#in-process-hosting-model) in ASP.NET Core 3.0 or later.</span></span> <span data-ttu-id="e3397-121">Opcionalmente, puede quitar el `<AspNetCoreHostingModel>` propiedad en el archivo de proyecto si su valor es `InProcess`.</span><span class="sxs-lookup"><span data-stu-id="e3397-121">You may optionally remove the `<AspNetCoreHostingModel>` property in the project file if its value is `InProcess`.</span></span>

## <a name="jsonnet-support"></a><span data-ttu-id="e3397-122">Compatibilidad con Json.NET</span><span class="sxs-lookup"><span data-stu-id="e3397-122">Json.NET support</span></span>

<span data-ttu-id="e3397-123">Como parte del trabajo para [mejorar el marco de ASP.NET Core compartido](https://blogs.msdn.microsoft.com/webdev/2018/10/29/a-first-look-at-changes-coming-in-asp-net-core-3-0/), [Json.NET](https://www.newtonsoft.com/json/help/html/Introduction.htm) se ha quitado de la plataforma compartida de ASP.NET Core.</span><span class="sxs-lookup"><span data-stu-id="e3397-123">As part of the work to [improve the ASP.NET Core shared framework](https://blogs.msdn.microsoft.com/webdev/2018/10/29/a-first-look-at-changes-coming-in-asp-net-core-3-0/), [Json.NET](https://www.newtonsoft.com/json/help/html/Introduction.htm) has been removed from the ASP.NET Core shared framework.</span></span>

<span data-ttu-id="e3397-124">Para utilizar Json.NET en un proyecto de ASP.NET Core 3.0:</span><span class="sxs-lookup"><span data-stu-id="e3397-124">To use Json.NET in an ASP.NET Core 3.0 project:</span></span>

* <span data-ttu-id="e3397-125">Agregue una referencia de paquete a [Microsoft.AspNetCore.Mvc.NewtonsoftJson](https://nuget.org/packages/Microsoft.AspNetCore.Mvc.NewtonsoftJson).</span><span class="sxs-lookup"><span data-stu-id="e3397-125">Add a package reference to [Microsoft.AspNetCore.Mvc.NewtonsoftJson](https://nuget.org/packages/Microsoft.AspNetCore.Mvc.NewtonsoftJson).</span></span>
* <span data-ttu-id="e3397-126">Actualización `Startup.ConfigureServices` para llamar a `AddNewtonsoftJson()`.</span><span class="sxs-lookup"><span data-stu-id="e3397-126">Update `Startup.ConfigureServices` to call `AddNewtonsoftJson()`.</span></span>

  ```csharp
  services.AddMvc()
      .AddNewtonsoftJson();
  ```

  <span data-ttu-id="e3397-127">Se puede establecer la configuración de Newtonsoft con `AddNewtonsoftJson`:</span><span class="sxs-lookup"><span data-stu-id="e3397-127">Newtonsoft settings can be set with `AddNewtonsoftJson`:</span></span>

  ```csharp
  services.AddMvc()
      .AddNewtonsoftJson(options =>
             options.SerializerSettings.ContractResolver =
                new CamelCasePropertyNamesContractResolver());
  ```

## <a name="mvc-service-registration"></a><span data-ttu-id="e3397-128">Registro del servicio MVC</span><span class="sxs-lookup"><span data-stu-id="e3397-128">MVC service registration</span></span>

<span data-ttu-id="e3397-129">ASP.NET Core 3.0 agrega nuevas opciones para registrar los escenarios MVC dentro de `Startup.ConfigureServices`.</span><span class="sxs-lookup"><span data-stu-id="e3397-129">ASP.NET Core 3.0 adds new options for registering MVC scenarios inside `Startup.ConfigureServices`.</span></span>

<span data-ttu-id="e3397-130">Tres nuevos métodos de extensión de nivel superior relacionada con escenarios MVC en `IServiceCollection` están disponibles.</span><span class="sxs-lookup"><span data-stu-id="e3397-130">Three new top-level extension methods related to MVC scenarios on `IServiceCollection` are available.</span></span> <span data-ttu-id="e3397-131">Las plantillas usan estos nuevos métodos en lugar de `UseMvc`.</span><span class="sxs-lookup"><span data-stu-id="e3397-131">Templates use these new methods instead of `UseMvc`.</span></span> <span data-ttu-id="e3397-132">Sin embargo, `AddMvc` se seguirán comportando, ya que tiene en las versiones anteriores.</span><span class="sxs-lookup"><span data-stu-id="e3397-132">However, `AddMvc` continues to behave as it has in previous releases.</span></span>

<span data-ttu-id="e3397-133">El ejemplo siguiente agrega compatibilidad para los controladores y características relacionadas con la API, pero no a vistas o páginas.</span><span class="sxs-lookup"><span data-stu-id="e3397-133">The following example adds support for controllers and API-related features, but not views or pages.</span></span> <span data-ttu-id="e3397-134">La plantilla de API usa este código:</span><span class="sxs-lookup"><span data-stu-id="e3397-134">The API template uses this code:</span></span>

```csharp
public void ConfigureServices(IServiceCollection services)
{
    services.AddControllers();
}
```

<span data-ttu-id="e3397-135">El ejemplo siguiente agrega compatibilidad con controladores, características relacionadas con la API y las vistas, pero no para las páginas.</span><span class="sxs-lookup"><span data-stu-id="e3397-135">The following example adds support for controllers, API-related features, and views, but not pages.</span></span> <span data-ttu-id="e3397-136">La plantilla de aplicación Web (MVC) usa este código:</span><span class="sxs-lookup"><span data-stu-id="e3397-136">The Web Application (MVC) template uses this code:</span></span>

```csharp
public void ConfigureServices(IServiceCollection services)
{
    services.AddControllersWithViews();
}
```

<span data-ttu-id="e3397-137">En el ejemplo siguiente se agrega compatibilidad para las páginas de Razor y compatibilidad de controlador mínimo.</span><span class="sxs-lookup"><span data-stu-id="e3397-137">The following example adds support for Razor Pages and minimal controller support.</span></span> <span data-ttu-id="e3397-138">La plantilla de aplicación Web usa este código:</span><span class="sxs-lookup"><span data-stu-id="e3397-138">The Web Application template uses this code:</span></span>

```csharp
public void ConfigureServices(IServiceCollection services)
{
    services.AddRazorPages();
}
```

<span data-ttu-id="e3397-139">También se pueden combinar los nuevos métodos.</span><span class="sxs-lookup"><span data-stu-id="e3397-139">The new methods can also be combined.</span></span> <span data-ttu-id="e3397-140">El ejemplo siguiente es equivalente a llamar a `AddMvc` en ASP.NET Core 2.2:</span><span class="sxs-lookup"><span data-stu-id="e3397-140">The following example is equivalent to calling `AddMvc` in ASP.NET Core 2.2:</span></span> 

```csharp
public void ConfigureServices(IServiceCollection services)
{
    services.AddControllers();
    services.AddRazorPages();
}
```

## <a name="update-routing-startup-code"></a><span data-ttu-id="e3397-141">Actualizar código de inicio de enrutamiento</span><span class="sxs-lookup"><span data-stu-id="e3397-141">Update routing startup code</span></span>

<span data-ttu-id="e3397-142">Si una aplicación llama a `UseMvc` o `UseSignalR`, migrar la aplicación a [punto de conexión de enrutamiento](xref:fundamentals/routing) si es posible.</span><span class="sxs-lookup"><span data-stu-id="e3397-142">If an app calls `UseMvc` or `UseSignalR`, migrate the app to [Endpoint Routing](xref:fundamentals/routing) if possible.</span></span> <span data-ttu-id="e3397-143">Para mejorar el enrutamiento de punto de conexión de la compatibilidad con versiones anteriores de MVC, nos hemos revertido algunos de los cambios en la generación de direcciones URL que se introdujo en ASP.NET Core 2.2.</span><span class="sxs-lookup"><span data-stu-id="e3397-143">To improve Endpoint Routing compatibility with previous versions of MVC, we've reverted some of the changes in URL generation introduced in ASP.NET Core 2.2.</span></span> <span data-ttu-id="e3397-144">Si experimenta problemas al usar enrutamiento de punto de conexión en 2.2, esperar mejoras en ASP.NET Core 3.0 con las siguientes excepciones:</span><span class="sxs-lookup"><span data-stu-id="e3397-144">If you experienced problems using Endpoint Routing in 2.2, expect improvements in ASP.NET Core 3.0 with the following exceptions:</span></span>

* <span data-ttu-id="e3397-145">Si la aplicación implementa `IRouter` o hereda de `Route`, desea evitar que se migren en este momento.</span><span class="sxs-lookup"><span data-stu-id="e3397-145">If the app implements `IRouter` or inherits from `Route`, you may want to avoid migrating at this time.</span></span> <span data-ttu-id="e3397-146">Proporcionar comentarios en [Plan para migrar las implementaciones de IRouter basada en enrutamiento de punto de conexión](https://github.com/aspnet/AspNetCore/issues/4221).</span><span class="sxs-lookup"><span data-stu-id="e3397-146">Provide feedback at [Plan to migrate IRouter based implementations onto Endpoint Routing](https://github.com/aspnet/AspNetCore/issues/4221).</span></span>

* <span data-ttu-id="e3397-147">Si la aplicación accede directamente a `RouteData.Routers` dentro de MVC, puede desear evitar que se migren en este momento.</span><span class="sxs-lookup"><span data-stu-id="e3397-147">If the app directly accesses `RouteData.Routers` inside MVC, you may want to avoid migrating at this time.</span></span> <span data-ttu-id="e3397-148">Proporcionar comentarios en [Guía de migración para el uso de RouteData.Routers](https://github.com/aspnet/AspNetCore/issues/9148).</span><span class="sxs-lookup"><span data-stu-id="e3397-148">Provide feedback at [Migration guidance for using RouteData.Routers](https://github.com/aspnet/AspNetCore/issues/9148).</span></span>

<span data-ttu-id="e3397-149">Enrutamiento de punto de conexión es compatible con la misma sintaxis del patrón de ruta y la creación de características como el patrón de ruta `IRouter`.</span><span class="sxs-lookup"><span data-stu-id="e3397-149">Endpoint Routing supports the same route pattern syntax and route pattern authoring features as `IRouter`.</span></span> <span data-ttu-id="e3397-150">Es compatible con el enrutamiento de punto de conexión `IRouteContraint`.</span><span class="sxs-lookup"><span data-stu-id="e3397-150">Endpoint Routing supports `IRouteContraint`.</span></span> <span data-ttu-id="e3397-151">Admite enrutamiento de punto de conexión `[Route]`, `[HttpGet]`y los demás atributos de enrutamiento de MVC.</span><span class="sxs-lookup"><span data-stu-id="e3397-151">Endpoint routing supports `[Route]`, `[HttpGet]`, and the other MVC routing attributes.</span></span>

<span data-ttu-id="e3397-152">Para la mayoría de las aplicaciones, sólo `Startup` requiere cambios.</span><span class="sxs-lookup"><span data-stu-id="e3397-152">For most applications, only `Startup` requires changes.</span></span>

### <a name="migrate-startupconfigure"></a><span data-ttu-id="e3397-153">Migrar Startup.Configure</span><span class="sxs-lookup"><span data-stu-id="e3397-153">Migrate Startup.Configure</span></span>

<span data-ttu-id="e3397-154">Consejos generales:</span><span class="sxs-lookup"><span data-stu-id="e3397-154">General advice:</span></span>

* <span data-ttu-id="e3397-155">Agregar `UseRouting`.</span><span class="sxs-lookup"><span data-stu-id="e3397-155">Add `UseRouting`.</span></span> 
* <span data-ttu-id="e3397-156">Si la aplicación llama a `UseStaticFiles`, coloque `UseStaticFiles` **antes** `UseRouting`.</span><span class="sxs-lookup"><span data-stu-id="e3397-156">If the app calls `UseStaticFiles`, place `UseStaticFiles` **before** `UseRouting`.</span></span>
* <span data-ttu-id="e3397-157">Si la aplicación usa características de autenticación y autorización, como `AuthorizePage` o `[Authorize]`, realizar una llamada a `UseAuthentication` y `UseAuthorization` **después** `UseRouting`.</span><span class="sxs-lookup"><span data-stu-id="e3397-157">If the app uses authentication/authorization features such as `AuthorizePage` or `[Authorize]`, place the call to `UseAuthentication` and `UseAuthorization` **after** `UseRouting`.</span></span>
* <span data-ttu-id="e3397-158">Si la aplicación usa [CORS](xref:security/cors) características, como `[EnableCors]`, coloque `UseCors` siguiente.</span><span class="sxs-lookup"><span data-stu-id="e3397-158">If the app uses [CORS](xref:security/cors) features, such as `[EnableCors]`, place `UseCors` next.</span></span>
* <span data-ttu-id="e3397-159">Reemplace `UseMvc` o `UseSignalR` con `UseEndpoints`.</span><span class="sxs-lookup"><span data-stu-id="e3397-159">Replace `UseMvc` or `UseSignalR` with `UseEndpoints`.</span></span>

<span data-ttu-id="e3397-160">El siguiente es un ejemplo de `Startup.Configure` en una aplicación típica de ASP.NET Core 2.2:</span><span class="sxs-lookup"><span data-stu-id="e3397-160">The following is an example of `Startup.Configure` in a typical ASP.NET Core 2.2 app:</span></span>

```csharp
public void Configure(IApplicationBuilder app)
{
    ...

    app.UseStaticFiles();
    
    app.UseAuthentication();

    app.UseSignalR(hubs =>
    {
        hubs.MapHub<ChatHub>("/chat");
    });

    app.UseMvc(routes =>
    {
        routes.MapRoute("default", "{controller=Home}/{action=Index}/{id?}");
    });
}
```

<span data-ttu-id="e3397-161">Después de actualizar el anterior `Startup.Configure` código:</span><span class="sxs-lookup"><span data-stu-id="e3397-161">After updating the previous `Startup.Configure` code:</span></span>

```csharp
public void Configure(IApplicationBuilder app)
{
    ...

    app.UseStaticFiles();
    
    app.UseRouting();

    app.UseAuthentication();
    app.UseAuthorization();
    app.UseCors();

    app.UseEndpoints(endpoints =>
    {
        endpoints.MapHub<ChatHub>("/chat");
        endpoints.MapControllerRoute("default", "{controller=Home}/{action=Index}/{id?}");
    });
}
```

### <a name="security-middleware-guidance"></a><span data-ttu-id="e3397-162">Guía de seguridad de middleware</span><span class="sxs-lookup"><span data-stu-id="e3397-162">Security middleware guidance</span></span>

<span data-ttu-id="e3397-163">Soporte técnico para la autorización y la CORS está unificado en torno a la [middleware](xref:fundamentals/middleware/index) enfoque.</span><span class="sxs-lookup"><span data-stu-id="e3397-163">Support for authorization and CORS is unified around the [middleware](xref:fundamentals/middleware/index) approach.</span></span> <span data-ttu-id="e3397-164">Esto permite el uso de la misma middleware y funcionalidad a través de estos escenarios.</span><span class="sxs-lookup"><span data-stu-id="e3397-164">This allows use of the same middleware and functionality across these scenarios.</span></span> <span data-ttu-id="e3397-165">Se proporciona un middleware de autorización actualizada en esta versión y middleware de CORS se ha mejorado para que pueda comprender los atributos utilizados por los controladores MVC.</span><span class="sxs-lookup"><span data-stu-id="e3397-165">An updated authorization middleware is provided in this release, and CORS middleware is enhanced so that it can understand the attributes used by MVC controllers.</span></span>

#### <a name="cors"></a><span data-ttu-id="e3397-166">CORS</span><span class="sxs-lookup"><span data-stu-id="e3397-166">CORS</span></span>

<span data-ttu-id="e3397-167">Anteriormente, la CORS podría ser difícil de configurar.</span><span class="sxs-lookup"><span data-stu-id="e3397-167">Previously, CORS could be difficult to configure.</span></span> <span data-ttu-id="e3397-168">Se proporcionó el middleware para uso en algunos casos de uso, pero los filtros MVC se han diseñado para utilizarse **sin** el middleware en otros casos de uso.</span><span class="sxs-lookup"><span data-stu-id="e3397-168">Middleware was provided for use in some use cases, but MVC filters were intended to be used **without** the middleware in other use cases.</span></span> <span data-ttu-id="e3397-169">Con ASP.NET Core 3.0, se recomienda que todas las aplicaciones que requieren la CORS usan el middleware de CORS en tándem con el punto de conexión de enrutamiento.</span><span class="sxs-lookup"><span data-stu-id="e3397-169">With ASP.NET Core 3.0, we recommend that all apps that require CORS use the CORS middleware in tandem with Endpoint Routing.</span></span> <span data-ttu-id="e3397-170">`UseCors` se puede proporcionar de forma predeterminada, y `[EnableCors]` y `[DisableCors]` atributos se pueden usar para invalidar la directiva predeterminada cuando sea necesario.</span><span class="sxs-lookup"><span data-stu-id="e3397-170">`UseCors` can be provided with a default policy, and `[EnableCors]` and `[DisableCors]` attributes can be used to override the default policy where required.</span></span> 

<span data-ttu-id="e3397-171">En el ejemplo siguiente:</span><span class="sxs-lookup"><span data-stu-id="e3397-171">In the following example:</span></span>

* <span data-ttu-id="e3397-172">Se ha habilitado CORS para todos los puntos de conexión con el `default` directiva con nombre.</span><span class="sxs-lookup"><span data-stu-id="e3397-172">CORS is enabled for all endpoints with the `default` named policy.</span></span>
* <span data-ttu-id="e3397-173">El `MyController` clase deshabilita la CORS con el `[DisableCors]` atributo.</span><span class="sxs-lookup"><span data-stu-id="e3397-173">The `MyController` class disables CORS with the `[DisableCors]` attribute.</span></span>

```csharp
public void Configure(IApplicationBuilder app)
{
    ...

    app.UseRouting();

    app.UseCors("default"); 

    app.UseEndpoints(endpoints =>
    {
        endpoints.MapDefaultControllerRoute();
    });
}

[DisableCors]
public class MyController : ControllerBase
{
    ...
}
```

#### <a name="authorization"></a><span data-ttu-id="e3397-174">Autorización</span><span class="sxs-lookup"><span data-stu-id="e3397-174">Authorization</span></span>

<span data-ttu-id="e3397-175">En versiones anteriores de ASP.NET Core, se ha proporcionado soporte técnico de autorización mediante el `[Authorize]` atributo.</span><span class="sxs-lookup"><span data-stu-id="e3397-175">In earlier versions of ASP.NET Core, authorization support was provided via the `[Authorize]` attribute.</span></span> <span data-ttu-id="e3397-176">Middleware de autorización no estaba disponible.</span><span class="sxs-lookup"><span data-stu-id="e3397-176">Authorization middleware wasn't available.</span></span> <span data-ttu-id="e3397-177">En ASP.NET Core 3.0, el middleware de autorización es necesario.</span><span class="sxs-lookup"><span data-stu-id="e3397-177">In ASP.NET Core 3.0, authorization middleware is required.</span></span> <span data-ttu-id="e3397-178">Se recomienda colocar el middleware de autorización (`UseAuthentication`) inmediatamente antes de `UseAuthorization`.</span><span class="sxs-lookup"><span data-stu-id="e3397-178">We recommend placing the authorization middleware (`UseAuthentication`) immediately before `UseAuthorization`.</span></span> <span data-ttu-id="e3397-179">Middleware de autorización también puede configurarse con una directiva predeterminada, que se puede invalidar.</span><span class="sxs-lookup"><span data-stu-id="e3397-179">Authorization middleware can also be configured with a default policy, which can be overridden.</span></span>

<span data-ttu-id="e3397-180">En ASP.NET Core 3.0 o posterior, `UseAuthorization` se denomina en `Startup.Configure`y los siguientes `HomeController` requiere que un usuario:</span><span class="sxs-lookup"><span data-stu-id="e3397-180">In ASP.NET Core 3.0 or later, `UseAuthorization` is called in `Startup.Configure`, and the following `HomeController` requires a signed in user:</span></span>

```csharp
public void Configure(IApplicationBuilder app)
{
    ...

    app.UseRouting();

    app.UseAuthentication();
    app.UseAuthorization();

    app.UseEndpoints(endpoints =>
    {
        endpoints.MapDefaultControllerRoute();
    });
}

public class HomeController : ControllerBase
{
    [Authorize]
    public IActionResult BuyWidgets()
    {
        ...
    }
}
```

<span data-ttu-id="e3397-181">Si la aplicación usa un `AuthorizeFilter` como un filtro global en MVC, se recomienda refactorizar el código para proporcionar una directiva para el `UseAuthorization` middleware.</span><span class="sxs-lookup"><span data-stu-id="e3397-181">If the app uses an `AuthorizeFilter` as a global filter in MVC, we recommend refactoring the code to provide a policy to the `UseAuthorization` middleware.</span></span>

<span data-ttu-id="e3397-182">En el ejemplo siguiente, una directiva personalizada que se aplicará a todas las solicitudes cuando `UseAuthorization` se llama a y el `HomeController` permite el acceso sin que el usuario inicie sesión en la aplicación:</span><span class="sxs-lookup"><span data-stu-id="e3397-182">In the following example, a custom policy to be applied to all requests when `UseAuthorization` is called, and the `HomeController` allows access without the user signing into the app:</span></span>

```csharp
public void Configure(IApplicationBuilder app)
{
    ...

    app.UseRouting();

    app.UseAuthentication();
    app.UseAuthorization(new AuthorizationPolicyBuilder().Build()));

    app.UseEndpoints(endpoints =>
    {
        endpoints.MapDefaultControllerRoute();
    });
}

[AllowAnonymous]
public class HomeController : ControllerBase
{
    ...
}
```

<span data-ttu-id="e3397-183">Autorización middleware funciona sin el marco de trabajo tengan conocimiento específico de autorización.</span><span class="sxs-lookup"><span data-stu-id="e3397-183">Authorization by middleware works without the framework having any specific knowledge of authorization.</span></span> <span data-ttu-id="e3397-184">Por ejemplo, [comprobaciones de estado](xref:host-and-deploy/health-checks) tiene ningún conocimiento específico de autorización, pero las comprobaciones de estado pueden tener una directiva de autorización configurables aplicada por el middleware.</span><span class="sxs-lookup"><span data-stu-id="e3397-184">For instance, [health checks](xref:host-and-deploy/health-checks) has no specific knowledge of authorization, but health checks can have a configurable authorization policy applied by the middleware.</span></span>

<span data-ttu-id="e3397-185">En el ejemplo siguiente, `UseAuthorization` procesa autorización sin una directiva predeterminada, pero la `/healthz` punto de conexión de comprobación de mantenimiento requiere que el usuario esté en el `admin` rol:</span><span class="sxs-lookup"><span data-stu-id="e3397-185">In the following example, `UseAuthorization` processes authorization without a default policy, but the `/healthz` health check endpoint requires the user to be in the `admin` role:</span></span> 

```csharp
public void Configure(IApplicationBuilder app)
{
    ...

    app.UseRouting();

    app.UseAuthentication();
    app.UseAuthorization();

    app.UseEndpoints(endpoints =>
    {
        endpoints
            .MapHealthChecks("/healthz")
            .RequireAuthorization(new AuthorizeAttribute(){ Roles = "admin", });
    });
}
```

<span data-ttu-id="e3397-186">Protección está implementada para algunos escenarios.</span><span class="sxs-lookup"><span data-stu-id="e3397-186">Protection is implemented for some scenarios.</span></span> <span data-ttu-id="e3397-187">`UseEndpoint` middleware produce una excepción si se omite una autorización o la directiva CORS debido a falta de middleware.</span><span class="sxs-lookup"><span data-stu-id="e3397-187">`UseEndpoint` middleware throws an exception if an authorization or CORS policy is skipped due to missing middleware.</span></span> <span data-ttu-id="e3397-188">Soporte de analizador para proporcionar comentarios adicionales sobre el error de configuración está en curso.</span><span class="sxs-lookup"><span data-stu-id="e3397-188">Analyzer support to provide additional feedback about misconfiguration is in progress.</span></span>

### <a name="migrate-signalr"></a><span data-ttu-id="e3397-189">Migrar de SignalR</span><span class="sxs-lookup"><span data-stu-id="e3397-189">Migrate SignalR</span></span>

<span data-ttu-id="e3397-190">Tiene lugar dentro de la asignación de concentradores de SignalR ahora `UseEndpoints`.</span><span class="sxs-lookup"><span data-stu-id="e3397-190">Mapping of SignalR hubs now takes place inside `UseEndpoints`.</span></span> 

<span data-ttu-id="e3397-191">Asignar cada concentrador con `MapHub`.</span><span class="sxs-lookup"><span data-stu-id="e3397-191">Map each hub with `MapHub`.</span></span> <span data-ttu-id="e3397-192">Como en versiones anteriores, se muestra explícitamente cada concentrador.</span><span class="sxs-lookup"><span data-stu-id="e3397-192">As in previous versions, each hub is explicitly listed.</span></span>

<span data-ttu-id="e3397-193">En el ejemplo siguiente, se admiten para la `ChatHub` se agrega el concentrador de SignalR:</span><span class="sxs-lookup"><span data-stu-id="e3397-193">In the following example, support for the `ChatHub` SignalR hub is added:</span></span>

```csharp
public void Configure(IApplicationBuilder app)
{
    ...

    app.UseRouting();

    app.UseEndpoints(endpoints =>
    {
        endpoints.MapHub<ChatHub>();
    });
}
```

### <a name="migrate-mvc-controllers"></a><span data-ttu-id="e3397-194">Migrar los controladores MVC</span><span class="sxs-lookup"><span data-stu-id="e3397-194">Migrate MVC controllers</span></span>

<span data-ttu-id="e3397-195">Tiene lugar dentro de la asignación de controladores ahora `UseEndpoints`.</span><span class="sxs-lookup"><span data-stu-id="e3397-195">Mapping of controllers now takes place inside `UseEndpoints`.</span></span> 

<span data-ttu-id="e3397-196">Agregar `MapControllers` si la aplicación usa el enrutamiento mediante atributos.</span><span class="sxs-lookup"><span data-stu-id="e3397-196">Add `MapControllers` if the app uses attribute routing.</span></span> <span data-ttu-id="e3397-197">Ya que enrutamiento incluye compatibilidad para muchos marcos de trabajo en ASP.NET Core 3.0 o posterior, agregar controladores enruta de atributo es participar en.</span><span class="sxs-lookup"><span data-stu-id="e3397-197">Since routing includes support for many frameworks in ASP.NET Core 3.0 or later, adding attribute-routed controllers is opt-in.</span></span> 

<span data-ttu-id="e3397-198">Reemplazar los siguientes elementos:</span><span class="sxs-lookup"><span data-stu-id="e3397-198">Replace the following:</span></span>

* <span data-ttu-id="e3397-199">`MapRoute` Con `MapControllerRoute`</span><span class="sxs-lookup"><span data-stu-id="e3397-199">`MapRoute` with `MapControllerRoute`</span></span>
* <span data-ttu-id="e3397-200">`MapAreaRoute` Con `MapAreaControllerRoute`</span><span class="sxs-lookup"><span data-stu-id="e3397-200">`MapAreaRoute` with `MapAreaControllerRoute`</span></span>

<span data-ttu-id="e3397-201">Ya que enrutamiento ahora incluye compatibilidad para algo más que MVC, la terminología ha cambiado para hacer que estos métodos claramente qué hacen.</span><span class="sxs-lookup"><span data-stu-id="e3397-201">Since routing now includes support for more than just MVC, the terminology has changed to make these methods clearly state what they do.</span></span> <span data-ttu-id="e3397-202">Las rutas convencionales como `MapControllerRoute` / `MapAreaControllerRoute` / `MapDefaultControllerRoute` se aplican en el orden en que se agreguen.</span><span class="sxs-lookup"><span data-stu-id="e3397-202">Conventional routes such as `MapControllerRoute`/`MapAreaControllerRoute`/`MapDefaultControllerRoute` are applied in the order that they're added.</span></span> <span data-ttu-id="e3397-203">Colocar en primer lugar las rutas más específicas (por ejemplo, las rutas para un área).</span><span class="sxs-lookup"><span data-stu-id="e3397-203">Place more specific routes (such as routes for an area) first.</span></span>

<span data-ttu-id="e3397-204">En el ejemplo siguiente:</span><span class="sxs-lookup"><span data-stu-id="e3397-204">In the following example:</span></span>

* <span data-ttu-id="e3397-205">`MapControllers` Agrega compatibilidad con controladores enruta de atributo.</span><span class="sxs-lookup"><span data-stu-id="e3397-205">`MapControllers` adds support for attribute-routed controllers.</span></span>
* <span data-ttu-id="e3397-206">`MapAreaControllerRoute` Agrega una ruta convencional para los controladores en un área.</span><span class="sxs-lookup"><span data-stu-id="e3397-206">`MapAreaControllerRoute` adds a conventional route for controllers in an area.</span></span>
* <span data-ttu-id="e3397-207">`MapControllerRoute` Agrega una ruta convencional para los controladores.</span><span class="sxs-lookup"><span data-stu-id="e3397-207">`MapControllerRoute` adds a conventional route for controllers.</span></span>

```csharp
public void Configure(IApplicationBuilder app)
{
    ...

    app.UseRouting();

    app.UseEndpoints(endpoints =>
    {
        endpoints.MapControllers();
        endpoints.MapAreaControllerRoute(
            "admin", 
            "admin", 
            "Admin/{controller=Home}/{action=Index}/{id?}");
        endpoints.MapControllerRoute(
            "default", "{controller=Home}/{action=Index}/{id?}");
    });
}
```

### <a name="migrate-razor-pages"></a><span data-ttu-id="e3397-208">Migrar las páginas de Razor</span><span class="sxs-lookup"><span data-stu-id="e3397-208">Migrate Razor Pages</span></span>

<span data-ttu-id="e3397-209">Asignación de páginas de Razor ahora tiene lugar dentro de `UseEndpoints`.</span><span class="sxs-lookup"><span data-stu-id="e3397-209">Mapping Razor Pages now takes place inside `UseEndpoints`.</span></span>

<span data-ttu-id="e3397-210">Agregar `MapRazorPages` si la aplicación usa las páginas de Razor.</span><span class="sxs-lookup"><span data-stu-id="e3397-210">Add `MapRazorPages` if the app uses Razor Pages.</span></span> <span data-ttu-id="e3397-211">Puesto que el enrutamiento de punto de conexión incluye compatibilidad para muchos marcos, agregando que las páginas de Razor ahora es opcional.</span><span class="sxs-lookup"><span data-stu-id="e3397-211">Since Endpoint Routing includes support for many frameworks, adding Razor Pages is now opt-in.</span></span>

<span data-ttu-id="e3397-212">En el ejemplo siguiente, `MapRazorPages` agrega compatibilidad para las páginas de Razor:</span><span class="sxs-lookup"><span data-stu-id="e3397-212">In the following example, `MapRazorPages` adds support for Razor Pages:</span></span>

```csharp
public void Configure(IApplicationBuilder app)
{
    ...

    app.UseRouting();

    app.UseEndpoints(endpoints =>
    {
        endpoints.MapRazorPages();
    });
}
```

### <a name="use-mvc-without-endpoint-routing"></a><span data-ttu-id="e3397-213">Usar MVC sin el enrutamiento de punto de conexión</span><span class="sxs-lookup"><span data-stu-id="e3397-213">Use MVC without Endpoint Routing</span></span>

<span data-ttu-id="e3397-214">Uso de MVC a través de `UseMvc` o `UseMvcWithDefaultRoute` en ASP.NET Core 3.0 requiere explícita participar en dentro de `Startup.ConfigureServices`.</span><span class="sxs-lookup"><span data-stu-id="e3397-214">Using MVC via `UseMvc` or `UseMvcWithDefaultRoute` in ASP.NET Core 3.0 requires an explicit opt-in inside `Startup.ConfigureServices`.</span></span> <span data-ttu-id="e3397-215">Esto es necesario porque MVC debe saber si puede confiar en la autorización y el middleware de CORS durante la inicialización.</span><span class="sxs-lookup"><span data-stu-id="e3397-215">This is required because MVC must know whether it can rely on the authorization and CORS middleware during initialization.</span></span> <span data-ttu-id="e3397-216">Un analizador es siempre que le advierte si la aplicación intenta usar una configuración no admitida.</span><span class="sxs-lookup"><span data-stu-id="e3397-216">An analyzer is provided that warns if the app attempts to use an unsupported configuration.</span></span>

<span data-ttu-id="e3397-217">Si la aplicación requiere heredado `IRouter` admitir, deshabilite `EnableEndpointRouting` mediante cualquiera de los siguientes enfoques en `Startup.ConfigureServices`:</span><span class="sxs-lookup"><span data-stu-id="e3397-217">If the app requires legacy `IRouter` support, disable `EnableEndpointRouting` using any of the following approaches in `Startup.ConfigureServices`:</span></span>

```csharp
services.AddMvc(options => options.EnableEndpointRouting = false);
```

```csharp
services.AddControllers(options => options.EnableEndpointRouting = false);
```

```csharp
services.AddControllersWithViews(options => options.EnableEndpointRouting = false);

```

```csharp
services.AddRazorPages().AddMvcOptions(options => options.EnableEndpointRouting = false);
```

### <a name="migrate-health-checks"></a><span data-ttu-id="e3397-218">Migrar las comprobaciones de estado</span><span class="sxs-lookup"><span data-stu-id="e3397-218">Migrate health checks</span></span>

<span data-ttu-id="e3397-219">Comprobaciones de mantenimiento se pueden usar como un *enrutador ware* con el punto de conexión de enrutamiento.</span><span class="sxs-lookup"><span data-stu-id="e3397-219">Health checks can be used as a *router-ware* with Endpoint Routing.</span></span>

<span data-ttu-id="e3397-220">Agregar `MapHealthChecks` usar mantenimiento comprueba con el punto de conexión de enrutamiento.</span><span class="sxs-lookup"><span data-stu-id="e3397-220">Add `MapHealthChecks` to use health checks with Endpoint Routing.</span></span> <span data-ttu-id="e3397-221">El `MapHealthChecks` método acepta argumentos similares a `UseHealthChecks`.</span><span class="sxs-lookup"><span data-stu-id="e3397-221">The `MapHealthChecks` method accepts arguments similar to `UseHealthChecks`.</span></span> <span data-ttu-id="e3397-222">La ventaja de usar `MapHealthChecks` sobre `UseHealthChecks` es la capacidad para aplicar la autorización y tener mayor control específico sobre la directiva de coincidencia.</span><span class="sxs-lookup"><span data-stu-id="e3397-222">The advantage of using `MapHealthChecks` over `UseHealthChecks` is the ability to apply authorization and to have greater fine-grained control over the matching policy.</span></span> 

<span data-ttu-id="e3397-223">En el ejemplo siguiente, `MapHealthChecks` se llama para un extremo de la comprobación de mantenimiento en `/healthz`:</span><span class="sxs-lookup"><span data-stu-id="e3397-223">In the following example, `MapHealthChecks` is called for a health check endpoint at `/healthz`:</span></span>

```csharp
public void Configure(IApplicationBuilder app)
{
    ...

    app.UseRouting();

    app.UseEndpoints(endpoints =>
    {
        endpoints.MapHealthChecks("/healthz", new HealthCheckOptions() { });
    });
}
```

## <a name="hostbuilder-replaces-webhostbuilder"></a><span data-ttu-id="e3397-224">HostBuilder reemplaza WebHostBuilder</span><span class="sxs-lookup"><span data-stu-id="e3397-224">HostBuilder replaces WebHostBuilder</span></span>

<span data-ttu-id="e3397-225">Usan las plantillas de ASP.NET Core 3.0 [Host genérico](xref:fundamentals/host/generic-host).</span><span class="sxs-lookup"><span data-stu-id="e3397-225">The ASP.NET Core 3.0 templates use [Generic Host](xref:fundamentals/host/generic-host).</span></span> <span data-ttu-id="e3397-226">Las versiones anteriores usan [Host Web](xref:fundamentals/host/web-host).</span><span class="sxs-lookup"><span data-stu-id="e3397-226">Previous versions used [Web Host](xref:fundamentals/host/web-host).</span></span> <span data-ttu-id="e3397-227">El código siguiente muestra la plantilla de ASP.NET Core 3.0 genera `Program` clase:</span><span class="sxs-lookup"><span data-stu-id="e3397-227">The following code shows the ASP.NET Core 3.0 template generated `Program` class:</span></span>

[!code-csharp[](22-to-30/samples/Program.cs?name=snippet)]

<span data-ttu-id="e3397-228">El código siguiente muestra la 2.2 de núcleo de ASP.NET generadas por las plantillas `Program` clase:</span><span class="sxs-lookup"><span data-stu-id="e3397-228">The following code shows the ASP.NET Core 2.2 template-generated `Program` class:</span></span>

[!code-csharp[](22-to-30/samples/Program2.2.cs?name=snippet)]

<span data-ttu-id="e3397-229"><xref:Microsoft.AspNetCore.Hosting.IWebHostBuilder> permanece en 3.0 y es el tipo de la `webBuilder` visto en el ejemplo de código anterior.</span><span class="sxs-lookup"><span data-stu-id="e3397-229"><xref:Microsoft.AspNetCore.Hosting.IWebHostBuilder> remains in 3.0 and is the type of the `webBuilder` seen in the preceding code sample.</span></span> <span data-ttu-id="e3397-230"><xref:Microsoft.AspNetCore.Hosting.WebHostBuilder> se en desuso en una futura versión y se reemplazan por `HostBuilder`.</span><span class="sxs-lookup"><span data-stu-id="e3397-230"><xref:Microsoft.AspNetCore.Hosting.WebHostBuilder> will be deprecated in a future release and replaced by `HostBuilder`.</span></span>

<span data-ttu-id="e3397-231">El cambio más significativo de `WebHostBuilder` a `HostBuilder` en [inserción de dependencias (DI)](xref:fundamentals/dependency-injection).</span><span class="sxs-lookup"><span data-stu-id="e3397-231">The most significant change from `WebHostBuilder` to `HostBuilder` is in [dependency injection (DI)](xref:fundamentals/dependency-injection).</span></span> <span data-ttu-id="e3397-232">Cuando se usa `HostBuilder`, sólo puede insertar <xref:Microsoft.Extensions.Configuration.IConfiguration> y <xref:Microsoft.AspNetCore.Hosting.IHostingEnvironment> en `Startup`del constructor.</span><span class="sxs-lookup"><span data-stu-id="e3397-232">When using `HostBuilder`, you can only inject <xref:Microsoft.Extensions.Configuration.IConfiguration> and <xref:Microsoft.AspNetCore.Hosting.IHostingEnvironment> into `Startup`'s constructor.</span></span> <span data-ttu-id="e3397-233">El `HostBuilder` DI restricciones:</span><span class="sxs-lookup"><span data-stu-id="e3397-233">The `HostBuilder` DI constraints:</span></span>

* <span data-ttu-id="e3397-234">Habilitar el contenedor de DI que se crea solo una vez.</span><span class="sxs-lookup"><span data-stu-id="e3397-234">Enable the DI container to be built only one time.</span></span>
* <span data-ttu-id="e3397-235">Evita los problemas de duración de objeto resultante como resolución de varias instancias de singleton.</span><span class="sxs-lookup"><span data-stu-id="e3397-235">Avoids the resulting object lifetime issues like resolving multiple instances of singletons.</span></span>

## <a name="update-signalr-code"></a><span data-ttu-id="e3397-236">Actualizar código de SignalR</span><span class="sxs-lookup"><span data-stu-id="e3397-236">Update SignalR code</span></span>

<span data-ttu-id="e3397-237">`System.Text.Json` es ahora el valor predeterminado concentrador protocolo usado por el cliente y el servidor.</span><span class="sxs-lookup"><span data-stu-id="e3397-237">`System.Text.Json` is now the default Hub Protocol used by both the client and server.</span></span>

<span data-ttu-id="e3397-238">En `Startup.ConfigureServices`, llame a `AddJsonProtocol` para establecer las opciones del serializador.</span><span class="sxs-lookup"><span data-stu-id="e3397-238">In `Startup.ConfigureServices`, call `AddJsonProtocol` to set serializer options.</span></span>

<span data-ttu-id="e3397-239">**Servidor:**</span><span class="sxs-lookup"><span data-stu-id="e3397-239">**Server:**</span></span>

```csharp
services.AddSignalR(...)
        .AddJsonProtocol(options =>
        {
            options.WriteIndented = false;
        })
```

<span data-ttu-id="e3397-240">**Cliente:**</span><span class="sxs-lookup"><span data-stu-id="e3397-240">**Client:**</span></span>

```csharp
new HubConnectionBuilder()
    .WithUrl("/chatHub")
    .AddJsonProtocol(options =>
    {
        options.WriteIndented = false;
    })
    .Build();
```

### <a name="switch-to-newtonsoftjson"></a><span data-ttu-id="e3397-241">Cambie a Newtonsoft.Json</span><span class="sxs-lookup"><span data-stu-id="e3397-241">Switch to Newtonsoft.Json</span></span>

<span data-ttu-id="e3397-242">Si usa las características de `Newtonsoft.Json` que no son compatibles con `System.Text.Json`, puede cambiar al `Newtonsoft.Json`:</span><span class="sxs-lookup"><span data-stu-id="e3397-242">If you're using features of `Newtonsoft.Json` that aren't supported in `System.Text.Json`, you can switch back to `Newtonsoft.Json`:</span></span>

1. <span data-ttu-id="e3397-243">Instalar el [Microsoft.AspNetCore.SignalR.Protocols.NewtonsoftJson](https://www.nuget.org/packages/Microsoft.AspNetCore.SignalR.Protocols.NewtonsoftJson) paquete NuGet.</span><span class="sxs-lookup"><span data-stu-id="e3397-243">Install the [Microsoft.AspNetCore.SignalR.Protocols.NewtonsoftJson](https://www.nuget.org/packages/Microsoft.AspNetCore.SignalR.Protocols.NewtonsoftJson) NuGet package.</span></span>
1. <span data-ttu-id="e3397-244">En el cliente, encadenar una `AddNewtonsoftJsonProtocol` llamada al método el `HubConnectionBuilder` instancia:</span><span class="sxs-lookup"><span data-stu-id="e3397-244">On the client, chain an `AddNewtonsoftJsonProtocol` method call to the `HubConnectionBuilder` instance:</span></span>

    ```csharp
    new HubConnectionBuilder()
        .WithUrl("/chatHub")
        .AddNewtonsoftJsonProtocol(...)
        .Build();
    ```

1. <span data-ttu-id="e3397-245">En el servidor, encadenar una `AddNewtonsoftJsonProtocol` llamada al método el `AddSignalR` llamada al método `Startup.ConfigureServices`:</span><span class="sxs-lookup"><span data-stu-id="e3397-245">On the server, chain an `AddNewtonsoftJsonProtocol` method call to the `AddSignalR` method call in `Startup.ConfigureServices`:</span></span>

    ```csharp
    services.AddSignalR()
        .AddNewtonsoftJsonProtocol(...);
    ```

## <a name="opt-in-to-runtime-compilation"></a><span data-ttu-id="e3397-246">Participar en la compilación en tiempo de ejecución</span><span class="sxs-lookup"><span data-stu-id="e3397-246">Opt in to runtime compilation</span></span>

<span data-ttu-id="e3397-247">En 3.0, compilación en tiempo de ejecución es un escenario de participación.</span><span class="sxs-lookup"><span data-stu-id="e3397-247">In 3.0, runtime compilation is an opt-in scenario.</span></span> <span data-ttu-id="e3397-248">Para habilitar la compilación en tiempo de ejecución, consulte <xref:mvc/views/view-compilation#runtime-compilation>.</span><span class="sxs-lookup"><span data-stu-id="e3397-248">To enable runtime compilation, see <xref:mvc/views/view-compilation#runtime-compilation>.</span></span>
