---
title: Migración desde ASP.NET Core 2,2 a la versión preliminar de 3,0
author: rick-anderson
description: Obtenga información sobre cómo migrar un proyecto ASP.NET Core 2,2 a ASP.NET Core 3,0.
ms.author: riande
ms.custom: mvc
ms.date: 09/16/2019
uid: migration/22-to-30
ms.openlocfilehash: ce16961c8a30ed4b905d5a20b2230fbde269a3ed
ms.sourcegitcommit: b1e480e1736b0fe0e4d8dce4a4cf5c8e47fc2101
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 09/19/2019
ms.locfileid: "71108040"
---
# <a name="migrate-from-aspnet-core-22-to-30"></a><span data-ttu-id="23022-103">Migrar de ASP.NET Core 2,2 a 3,0</span><span class="sxs-lookup"><span data-stu-id="23022-103">Migrate from ASP.NET Core 2.2 to 3.0</span></span>

<span data-ttu-id="23022-104">Por [Scott Addie](https://github.com/scottaddie) y [Rick Anderson](https://twitter.com/RickAndMSFT)</span><span class="sxs-lookup"><span data-stu-id="23022-104">By [Scott Addie](https://github.com/scottaddie) and [Rick Anderson](https://twitter.com/RickAndMSFT)</span></span>

<span data-ttu-id="23022-105">En este artículo se explica cómo actualizar un proyecto ASP.NET Core 2,2 existente a ASP.NET Core 3,0.</span><span class="sxs-lookup"><span data-stu-id="23022-105">This article explains how to update an existing ASP.NET Core 2.2 project to ASP.NET Core 3.0.</span></span>

## <a name="prerequisites"></a><span data-ttu-id="23022-106">Requisitos previos</span><span class="sxs-lookup"><span data-stu-id="23022-106">Prerequisites</span></span>

# <a name="visual-studiotabvisual-studio"></a>[<span data-ttu-id="23022-107">Visual Studio</span><span class="sxs-lookup"><span data-stu-id="23022-107">Visual Studio</span></span>](#tab/visual-studio)

[!INCLUDE[](~/includes/net-core-prereqs-vs-3.0.md)]

# <a name="visual-studio-codetabvisual-studio-code"></a>[<span data-ttu-id="23022-108">Visual Studio Code</span><span class="sxs-lookup"><span data-stu-id="23022-108">Visual Studio Code</span></span>](#tab/visual-studio-code)

[!INCLUDE[](~/includes/net-core-prereqs-vsc-3.0.md)]

# <a name="visual-studio-for-mactabvisual-studio-mac"></a>[<span data-ttu-id="23022-109">Visual Studio para Mac</span><span class="sxs-lookup"><span data-stu-id="23022-109">Visual Studio for Mac</span></span>](#tab/visual-studio-mac)

[!INCLUDE[](~/includes/net-core-prereqs-mac-3.0.md)]

---

## <a name="update-the-project-file"></a><span data-ttu-id="23022-110">Actualizar el archivo de proyecto</span><span class="sxs-lookup"><span data-stu-id="23022-110">Update the project file</span></span>

* <span data-ttu-id="23022-111">Establezca el [moniker de la plataforma de destino (TFM)](/dotnet/standard/frameworks) en `netcoreapp3.0`:</span><span class="sxs-lookup"><span data-stu-id="23022-111">Set the [Target Framework Moniker (TFM)](/dotnet/standard/frameworks) to `netcoreapp3.0`:</span></span>

  ```xml
  <TargetFramework>netcoreapp3.0</TargetFramework>
  ```

* <span data-ttu-id="23022-112">Quite cualquier `<PackageReference>` del metapaquete [Microsoft. AspNetCore. All](xref:fundamentals/metapackage) o [Microsoft. AspNetCore. app](xref:fundamentals/metapackage-app) .</span><span class="sxs-lookup"><span data-stu-id="23022-112">Remove any `<PackageReference>` to the [Microsoft.AspNetCore.All](xref:fundamentals/metapackage) or [Microsoft.AspNetCore.App](xref:fundamentals/metapackage-app) metapackage.</span></span>

* <span data-ttu-id="23022-113">Quite cualquier `<PackageReference>` del paquete [Microsoft. AspNetCore. Razor. Design](https://www.nuget.org/packages/Microsoft.AspNetCore.Razor.Design/) .</span><span class="sxs-lookup"><span data-stu-id="23022-113">Remove any `<PackageReference>` to the [Microsoft.AspNetCore.Razor.Design](https://www.nuget.org/packages/Microsoft.AspNetCore.Razor.Design/) package.</span></span>

* <span data-ttu-id="23022-114">Si la aplicación usa [analizadores de API](xref:web-api/advanced/analyzers), quite `<PackageReference>` cualquier elemento del paquete [Microsoft. AspNetCore. Mvc. API. analizadores](https://www.nuget.org/packages/Microsoft.AspNetCore.Mvc.Api.Analyzers/) .</span><span class="sxs-lookup"><span data-stu-id="23022-114">If your application uses [API analyzers](xref:web-api/advanced/analyzers), remove any `<PackageReference>` element for the [Microsoft.AspNetCore.Mvc.Api.Analyzers](https://www.nuget.org/packages/Microsoft.AspNetCore.Mvc.Api.Analyzers/) package.</span></span> <span data-ttu-id="23022-115">Edite el archivo de proyecto para usar el analizador incluido como parte de la SDK de .NET Core:</span><span class="sxs-lookup"><span data-stu-id="23022-115">Edit your project file to use the analyzer shipped as part of the .NET Core SDK:</span></span>

```xml
<PropertyGroup>
 <IncludeOpenAPIAnalyzers>true</IncludeOpenAPIAnalyzers>
</PropertyGroup>
```

* <span data-ttu-id="23022-116">Actualice el `Version` atributo en los `<PackageReference>` elementos restantes `Microsoft.AspNetCore.*` de los paquetes a la vista previa actual ( `3.0.0-preview5-19227-01`por ejemplo,).</span><span class="sxs-lookup"><span data-stu-id="23022-116">Update the `Version` attribute on remaining `<PackageReference>` elements for `Microsoft.AspNetCore.*` packages to the current preview (for example, `3.0.0-preview5-19227-01`).</span></span>

  <span data-ttu-id="23022-117">Si no hay una versión 3,0 de un paquete, es posible que el paquete esté en desuso en 3,0.</span><span class="sxs-lookup"><span data-stu-id="23022-117">If there isn't a 3.0 version of a package, the package might have been deprecated in 3.0.</span></span> <span data-ttu-id="23022-118">Muchos de estos paquetes forman parte de `Microsoft.AspNetCore.App` y no se debe hacer referencia a ellos de forma individual.</span><span class="sxs-lookup"><span data-stu-id="23022-118">Many of these packages are part of `Microsoft.AspNetCore.App` and shouldn't be referenced individually.</span></span> <span data-ttu-id="23022-119">Para obtener una lista preliminar de los paquetes que ya no se producen en 3,0, consulte [detener la generación de paquetes para ensamblados de marco compartidos en 3,0 (ASPNET/AspNetCore #3756)](https://github.com/aspnet/AspNetCore/issues/3756).</span><span class="sxs-lookup"><span data-stu-id="23022-119">For a preliminary list of packages no longer produced in 3.0, see [Stop producing packages for shared framework assemblies in 3.0 (aspnet/AspNetCore #3756)](https://github.com/aspnet/AspNetCore/issues/3756).</span></span> <span data-ttu-id="23022-120">El *marco de trabajo compartido* es el conjunto de ensamblados (archivos *. dll* ) que están instalados en el equipo y `Microsoft.AspNetCore.App`a los que hace referencia.</span><span class="sxs-lookup"><span data-stu-id="23022-120">The *shared framework* is the set of assemblies (*.dll* files) that are installed on the machine and referenced by `Microsoft.AspNetCore.App`.</span></span> <span data-ttu-id="23022-121">Para más información, consulte este artículo sobre el [marco de trabajo compartido](https://natemcmaster.com/blog/2018/08/29/netcore-primitives-2/).</span><span class="sxs-lookup"><span data-stu-id="23022-121">For more information, see [The shared framework](https://natemcmaster.com/blog/2018/08/29/netcore-primitives-2/).</span></span>

* <span data-ttu-id="23022-122">Los ensamblados de varios componentes importantes se quitaron de `Microsoft.AspNetCore.App` en 3,0.</span><span class="sxs-lookup"><span data-stu-id="23022-122">The assemblies for several notable components were removed from `Microsoft.AspNetCore.App` in 3.0.</span></span> <span data-ttu-id="23022-123">Agregue `<PackageReference>` elementos si usa las API de los paquetes enumerados en [ensamblados que se van a quitar de Microsoft. AspNetCore. app 3,0 (ASPNET/AspNetCore #3755)](https://github.com/aspnet/AspNetCore/issues/3755).</span><span class="sxs-lookup"><span data-stu-id="23022-123">Add `<PackageReference>` elements if you're using APIs from packages listed in [Assemblies being removed from Microsoft.AspNetCore.App 3.0 (aspnet/AspNetCore #3755)](https://github.com/aspnet/AspNetCore/issues/3755).</span></span>

  <span data-ttu-id="23022-124">Entre los ejemplos de componentes quitados se incluyen:</span><span class="sxs-lookup"><span data-stu-id="23022-124">Examples of removed components include:</span></span>

  * `Microsoft.AspNet.WebApi.Client`
  * `Microsoft.EntityFrameworkCore`
  * `System.Data.SqlClient`

  <span data-ttu-id="23022-125">La lista de ensamblados que `Microsoft.AspNetCore.App` se distribuyen en no se ha finalizado y cambiará antes 3,0 RTM.</span><span class="sxs-lookup"><span data-stu-id="23022-125">The list of assemblies shipping in `Microsoft.AspNetCore.App` hasn't been finalized and will change before 3.0 RTM.</span></span>

  <span data-ttu-id="23022-126">Observe el código siguiente:</span><span class="sxs-lookup"><span data-stu-id="23022-126">Consider the following code:</span></span>

  ```csharp
  var branches = await response.Content.ReadAsAsync<IEnumerable<GitHubBranch>>();
  ```

  <span data-ttu-id="23022-127">El `ReadAsAsync` método al que se llama en el código anterior `Microsoft.AspNet.WebApi.Client`se incluye en.</span><span class="sxs-lookup"><span data-stu-id="23022-127">The `ReadAsAsync` method called in the preceding code is included in `Microsoft.AspNet.WebApi.Client`.</span></span> <span data-ttu-id="23022-128">Instale el paquete NuGet [Microsoft. Aspnet. WebApi. Client](https://www.nuget.org/packages/Microsoft.AspNet.WebApi.Client/) para resolver el problema de compilación en 3,0.</span><span class="sxs-lookup"><span data-stu-id="23022-128">Install the [Microsoft.AspNet.WebApi.Client](https://www.nuget.org/packages/Microsoft.AspNet.WebApi.Client/) NuGet package to resolve the compilation issue in 3.0.</span></span>

* <span data-ttu-id="23022-129">Agregue [compatibilidad con JSON.net](#jsonnet-support).</span><span class="sxs-lookup"><span data-stu-id="23022-129">Add [Json.NET support](#jsonnet-support).</span></span>

* <span data-ttu-id="23022-130">Los proyectos tienen como valor predeterminado el [modelo de hospedaje en proceso](xref:host-and-deploy/aspnet-core-module#in-process-hosting-model) en ASP.net Core 3,0 o posterior.</span><span class="sxs-lookup"><span data-stu-id="23022-130">Projects default to the [in-process hosting model](xref:host-and-deploy/aspnet-core-module#in-process-hosting-model) in ASP.NET Core 3.0 or later.</span></span> <span data-ttu-id="23022-131">Opcionalmente, puede quitar la `<AspNetCoreHostingModel>` propiedad en el archivo de proyecto si su valor `InProcess`es.</span><span class="sxs-lookup"><span data-stu-id="23022-131">You may optionally remove the `<AspNetCoreHostingModel>` property in the project file if its value is `InProcess`.</span></span>

## <a name="kestrel"></a><span data-ttu-id="23022-132">Kestrel</span><span class="sxs-lookup"><span data-stu-id="23022-132">Kestrel</span></span>

### <a name="configuration"></a><span data-ttu-id="23022-133">Configuración</span><span class="sxs-lookup"><span data-stu-id="23022-133">Configuration</span></span>

<span data-ttu-id="23022-134">Migrar la configuración de Kestrel al generador de hosts `ConfigureWebHostDefaults` web proporcionado por (*Program.CS*):</span><span class="sxs-lookup"><span data-stu-id="23022-134">Migrate Kestrel configuration to the web host builder provided by `ConfigureWebHostDefaults` (*Program.cs*):</span></span>

```csharp
public static IHostBuilder CreateHostBuilder(string[] args) =>
    Host.CreateDefaultBuilder(args)
        .ConfigureWebHostDefaults(webBuilder =>
        {
            webBuilder.ConfigureKestrel(serverOptions =>
            {
                // Set properties and call methods on options
            })
            .UseStartup<Startup>();
        });
```

<span data-ttu-id="23022-135">Si la aplicación crea el host manualmente con `HostBuilder`, llame `UseKestrel` a en el generador de host `ConfigureWebHostDefaults`Web en:</span><span class="sxs-lookup"><span data-stu-id="23022-135">If the app creates the host manually with `HostBuilder`, call `UseKestrel` on the web host builder in `ConfigureWebHostDefaults`:</span></span>

```csharp
public static void Main(string[] args)
{
    var host = new HostBuilder()
        .UseContentRoot(Directory.GetCurrentDirectory())
        .ConfigureWebHostDefaults(webBuilder =>
        {
            webBuilder.UseKestrel(serverOptions =>
            {
                // Set properties and call methods on options
            })
            .UseIISIntegration()
            .UseStartup<Startup>();
        })
        .Build();

    host.Run();
}
```

### <a name="connection-middleware-replaces-connection-adapters"></a><span data-ttu-id="23022-136">El middleware de conexión reemplaza los adaptadores de conexión</span><span class="sxs-lookup"><span data-stu-id="23022-136">Connection Middleware replaces Connection Adapters</span></span>

<span data-ttu-id="23022-137">Los adaptadores de conexión<xref:Microsoft.AspNetCore.Server.Kestrel.Core.Adapter.Internal.IConnectionAdapter>() se han quitado de Kestrel.</span><span class="sxs-lookup"><span data-stu-id="23022-137">Connection Adapters (<xref:Microsoft.AspNetCore.Server.Kestrel.Core.Adapter.Internal.IConnectionAdapter>) have been removed from Kestrel.</span></span> <span data-ttu-id="23022-138">Reemplace los adaptadores de conexión por el middleware de conexión.</span><span class="sxs-lookup"><span data-stu-id="23022-138">Replace Connection Adapters with Connection Middleware.</span></span> <span data-ttu-id="23022-139">El middleware de conexión es similar al middleware HTTP en la canalización de ASP.NET Core, pero para las conexiones de nivel inferior.</span><span class="sxs-lookup"><span data-stu-id="23022-139">Connection Middleware is similar to HTTP Middleware in the ASP.NET Core pipeline but for lower-level connections.</span></span> <span data-ttu-id="23022-140">HTTPS y registro de conexiones:</span><span class="sxs-lookup"><span data-stu-id="23022-140">HTTPS and connection logging:</span></span>

* <span data-ttu-id="23022-141">Se han pasado de los adaptadores de conexión al middleware de conexión.</span><span class="sxs-lookup"><span data-stu-id="23022-141">Have been moved from Connection Adapters to Connection Middleware.</span></span>
* <span data-ttu-id="23022-142">Estos métodos de extensión funcionan como en versiones anteriores de ASP.NET Core.</span><span class="sxs-lookup"><span data-stu-id="23022-142">These extension methods work as in previous versions of ASP.NET Core.</span></span> 

<span data-ttu-id="23022-143">Para obtener más información, consulte [el ejemplo de TlsFilterConnectionHandler en la sección ListenOptions. Protocols del artículo Kestrel](/aspnet/core/fundamentals/servers/kestrel?view=aspnetcore-3.0#listenoptionsprotocols).</span><span class="sxs-lookup"><span data-stu-id="23022-143">For more information, see [the TlsFilterConnectionHandler example in the ListenOptions.Protocols section of the Kestrel article](/aspnet/core/fundamentals/servers/kestrel?view=aspnetcore-3.0#listenoptionsprotocols).</span></span>

### <a name="transport-abstractions-moved-and-made-public"></a><span data-ttu-id="23022-144">Abstracciones de transporte que se movieron y hicieron públicas</span><span class="sxs-lookup"><span data-stu-id="23022-144">Transport abstractions moved and made public</span></span>

<span data-ttu-id="23022-145">La capa de transporte Kestrel se ha expuesto como una interfaz pública `Connections.Abstractions`en.</span><span class="sxs-lookup"><span data-stu-id="23022-145">The Kestrel transport layer has been exposed as a public interface in `Connections.Abstractions`.</span></span> <span data-ttu-id="23022-146">Como parte de estas actualizaciones:</span><span class="sxs-lookup"><span data-stu-id="23022-146">As part of these updates:</span></span>

* <span data-ttu-id="23022-147">`Microsoft.AspNetCore.Server.Kestrel.Transport.Abstractions`y se han quitado los tipos asociados.</span><span class="sxs-lookup"><span data-stu-id="23022-147">`Microsoft.AspNetCore.Server.Kestrel.Transport.Abstractions` and associated types have been removed.</span></span>
* <span data-ttu-id="23022-148"><xref:Microsoft.AspNetCore.Server.Kestrel.KestrelServerOptions.NoDelay>se ha pasado <xref:Microsoft.AspNetCore.Server.Kestrel.Core.ListenOptions> de a las opciones de transporte.</span><span class="sxs-lookup"><span data-stu-id="23022-148"><xref:Microsoft.AspNetCore.Server.Kestrel.KestrelServerOptions.NoDelay> was moved from <xref:Microsoft.AspNetCore.Server.Kestrel.Core.ListenOptions> to the transport options.</span></span>
* <span data-ttu-id="23022-149"><xref:Microsoft.AspNetCore.Server.Kestrel.Transport.Abstractions.Internal.SchedulingMode>se ha quitado de <xref:Microsoft.AspNetCore.Server.Kestrel.KestrelServerOptions>.</span><span class="sxs-lookup"><span data-stu-id="23022-149"><xref:Microsoft.AspNetCore.Server.Kestrel.Transport.Abstractions.Internal.SchedulingMode> was removed from <xref:Microsoft.AspNetCore.Server.Kestrel.KestrelServerOptions>.</span></span>

<span data-ttu-id="23022-150">Para obtener más información, consulte los siguientes recursos de GitHub:</span><span class="sxs-lookup"><span data-stu-id="23022-150">For more information, see the following GitHub resources:</span></span>

* [<span data-ttu-id="23022-151">Abstracciones de redes cliente/servidor (#10308 ASPNET/AspNetCore)</span><span class="sxs-lookup"><span data-stu-id="23022-151">Client/server networking abstractions (aspnet/AspNetCore #10308)</span></span>](https://github.com/aspnet/AspNetCore/issues/10308)
* [<span data-ttu-id="23022-152">Implementar una nueva abstracción de escucha de cimientos y volver a Kestrel en la parte superior (ASPNET/AspNetCore #10321)</span><span class="sxs-lookup"><span data-stu-id="23022-152">Implement new bedrock listener abstraction and re-plat Kestrel on top (aspnet/AspNetCore #10321)</span></span>](https://github.com/aspnet/AspNetCore/pull/10321)

### <a name="kestrel-request-trailer-headers"></a><span data-ttu-id="23022-153">Kestrel encabezados de finalizador de solicitud</span><span class="sxs-lookup"><span data-stu-id="23022-153">Kestrel Request trailer headers</span></span>

<span data-ttu-id="23022-154">En el caso de las aplicaciones destinadas a versiones anteriores de ASP.NET Core:</span><span class="sxs-lookup"><span data-stu-id="23022-154">For apps that target earlier versions of ASP.NET Core:</span></span>

* <span data-ttu-id="23022-155">Kestrel agrega encabezados de finalizador fragmentados de HTTP/1.1 a la colección de encabezados de solicitud.</span><span class="sxs-lookup"><span data-stu-id="23022-155">Kestrel adds HTTP/1.1 chunked trailer headers into the request headers collection.</span></span>
* <span data-ttu-id="23022-156">Los finalizadores están disponibles después de leer el cuerpo de la solicitud hasta el final.</span><span class="sxs-lookup"><span data-stu-id="23022-156">Trailers are available after the request body is read to the end.</span></span>

<span data-ttu-id="23022-157">Esto provoca algunos problemas sobre la ambigüedad entre encabezados y finalizadores, por lo que los finalizadores se han desplazado`RequestTrailerExtensions`a una nueva colección () en 3,0.</span><span class="sxs-lookup"><span data-stu-id="23022-157">This causes some concerns about ambiguity between headers and trailers, so the trailers have been moved to a new collection (`RequestTrailerExtensions`) in 3.0.</span></span>

<span data-ttu-id="23022-158">Los finalizadores de solicitudes HTTP/2 son:</span><span class="sxs-lookup"><span data-stu-id="23022-158">HTTP/2 request trailers are:</span></span>

* <span data-ttu-id="23022-159">No disponible en ASP.NET Core 2,2.</span><span class="sxs-lookup"><span data-stu-id="23022-159">Not available in ASP.NET Core 2.2.</span></span>
* <span data-ttu-id="23022-160">Disponible en 3,0 como `RequestTrailerExtensions`.</span><span class="sxs-lookup"><span data-stu-id="23022-160">Available in 3.0 as `RequestTrailerExtensions`.</span></span>

<span data-ttu-id="23022-161">Hay nuevos métodos de extensión de solicitud para tener acceso a estos finalizadores.</span><span class="sxs-lookup"><span data-stu-id="23022-161">New request extension methods are present to access these trailers.</span></span> <span data-ttu-id="23022-162">Al igual que con HTTP/1.1, los finalizadores están disponibles después de leer el cuerpo de la solicitud hasta el final.</span><span class="sxs-lookup"><span data-stu-id="23022-162">As with HTTP/1.1, trailers are available after the request body is read to the end.</span></span>

<span data-ttu-id="23022-163">Para la versión 3,0, están disponibles `RequestTrailerExtensions` los siguientes métodos:</span><span class="sxs-lookup"><span data-stu-id="23022-163">For the 3.0 release, the following `RequestTrailerExtensions` methods are available:</span></span>

* <span data-ttu-id="23022-164">`GetDeclaredTrailers`Obtiene el encabezado `Trailer` de solicitud que muestra los finalizadores que se esperan después del cuerpo. &ndash;</span><span class="sxs-lookup"><span data-stu-id="23022-164">`GetDeclaredTrailers` &ndash; Gets the request `Trailer` header that lists which trailers to expect after the body.</span></span>
* <span data-ttu-id="23022-165">`SupportsTrailers`&ndash; Indica si la solicitud admite encabezados de finalizador de recepción.</span><span class="sxs-lookup"><span data-stu-id="23022-165">`SupportsTrailers` &ndash; Indicates if the request supports receiving trailer headers.</span></span>
* <span data-ttu-id="23022-166">`CheckTrailersAvailable`&ndash; Comprueba si la solicitud admite finalizadores y si está disponible para su lectura.</span><span class="sxs-lookup"><span data-stu-id="23022-166">`CheckTrailersAvailable` &ndash; Checks if the request supports trailers and if they're available to be read.</span></span> <span data-ttu-id="23022-167">En esta comprobación no se da por hecho que hay finalizadores para leer.</span><span class="sxs-lookup"><span data-stu-id="23022-167">This check doesn't assume that there are trailers to read.</span></span> <span data-ttu-id="23022-168">Es posible que no haya finalizaciones de lectura `true` aunque este método devuelva un resultado.</span><span class="sxs-lookup"><span data-stu-id="23022-168">There might be no trailers to read even if `true` is returned by this method.</span></span>
* <span data-ttu-id="23022-169">`GetTrailer`&ndash; Obtiene el encabezado final solicitado de la respuesta.</span><span class="sxs-lookup"><span data-stu-id="23022-169">`GetTrailer` &ndash; Gets the requested trailing header from the response.</span></span> <span data-ttu-id="23022-170">Compruebe `SupportsTrailers` antes de `GetTrailer`llamar a, <xref:System.NotSupportedException> o puede producirse si la solicitud no admite encabezados finales.</span><span class="sxs-lookup"><span data-stu-id="23022-170">Check `SupportsTrailers` before calling `GetTrailer`, or a <xref:System.NotSupportedException> may occur if the request doesn't support trailing headers.</span></span>

<span data-ttu-id="23022-171">Para obtener más información, consulte [colocar finalizadores de solicitudes en una colección independiente (ASPNET/AspNetCore #10410)](https://github.com/aspnet/AspNetCore/pull/10410).</span><span class="sxs-lookup"><span data-stu-id="23022-171">For more information, see [Put request trailers in a separate collection (aspnet/AspNetCore #10410)](https://github.com/aspnet/AspNetCore/pull/10410).</span></span>

### <a name="allowsynchronousio-disabled"></a><span data-ttu-id="23022-172">AllowSynchronousIO deshabilitado</span><span class="sxs-lookup"><span data-stu-id="23022-172">AllowSynchronousIO disabled</span></span>

<span data-ttu-id="23022-173">`AllowSynchronousIO`habilita o deshabilita las API de e/s sincrónicas `HttpReqeuest.Body.Read`, `Stream.Flush`como, `HttpResponse.Body.Write`y.</span><span class="sxs-lookup"><span data-stu-id="23022-173">`AllowSynchronousIO` enables or disables synchronous IO APIs, such as `HttpReqeuest.Body.Read`, `HttpResponse.Body.Write`, and `Stream.Flush`.</span></span> <span data-ttu-id="23022-174">Estas API son un origen de colapso de subprocesos que conduce a bloqueos de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="23022-174">These APIs are a source of thread starvation leading to app crashes.</span></span> <span data-ttu-id="23022-175">En 3,0, `AllowSynchronousIO` está deshabilitado de forma predeterminada.</span><span class="sxs-lookup"><span data-stu-id="23022-175">In 3.0, `AllowSynchronousIO` is disabled by default.</span></span> <span data-ttu-id="23022-176">Para obtener más información, consulte [la sección de e/s sincrónica en el artículo de Kestrel](/aspnet/core/fundamentals/servers/kestrel?view=aspnetcore-3.0#synchronous-io).</span><span class="sxs-lookup"><span data-stu-id="23022-176">For more information, see [the Synchronous IO section in the Kestrel article](/aspnet/core/fundamentals/servers/kestrel?view=aspnetcore-3.0#synchronous-io).</span></span>

<span data-ttu-id="23022-177">Además de habilitar `AllowSynchronousIO` con `ConfigureKestrel`las opciones de, la e/s sincrónica también puede invalidarse por solicitud como una mitigación temporal:</span><span class="sxs-lookup"><span data-stu-id="23022-177">In addition to enabling `AllowSynchronousIO` with `ConfigureKestrel`'s options, synchronous IO can also be overridden on a per-request basis as a temporary mitigation:</span></span>

```csharp
var syncIOFeature = HttpContext.Features.Get<IHttpBodyControlFeature>();

if (syncIOFeature != null)
{
    syncIOFeature.AllowSynchronousIO = true;
}
```

<span data-ttu-id="23022-178">Si tiene problemas con <xref:System.IO.TextWriter> las implementaciones u otras secuencias que llaman a las API sincrónicas en [Dispose](/dotnet/standard/garbage-collection/implementing-dispose), llame a la nueva <xref:System.IO.Stream.DisposeAsync*> API en su lugar.</span><span class="sxs-lookup"><span data-stu-id="23022-178">If you have trouble with <xref:System.IO.TextWriter> implementations or other streams that call synchronous APIs in [Dispose](/dotnet/standard/garbage-collection/implementing-dispose), call the new <xref:System.IO.Stream.DisposeAsync*> API instead.</span></span>

<span data-ttu-id="23022-179">Para obtener más información, vea [[anuncio] AllowSynchronousIO deshabilitado en todos los servidores (ASPNET/AspNetCore #7644)](https://github.com/aspnet/AspNetCore/issues/7644).</span><span class="sxs-lookup"><span data-stu-id="23022-179">For more information, see [[Announcement] AllowSynchronousIO disabled in all servers (aspnet/AspNetCore #7644)](https://github.com/aspnet/AspNetCore/issues/7644).</span></span>

### <a name="microsoftaspnetcoreserverkestrelhttps-assembly-removed"></a><span data-ttu-id="23022-180">Se quitó el ensamblado Microsoft. AspNetCore. Server. Kestrel. https</span><span class="sxs-lookup"><span data-stu-id="23022-180">Microsoft.AspNetCore.Server.Kestrel.Https assembly removed</span></span>

<span data-ttu-id="23022-181">En ASP.NET Core 2,1, el contenido de *Microsoft. AspNetCore. Server. Kestrel. https. dll* se ha migrado a *Microsoft. AspNetCore. Server. Kestrel. Core. dll*.</span><span class="sxs-lookup"><span data-stu-id="23022-181">In ASP.NET Core 2.1, the contents of *Microsoft.AspNetCore.Server.Kestrel.Https.dll* were moved to *Microsoft.AspNetCore.Server.Kestrel.Core.dll*.</span></span> <span data-ttu-id="23022-182">Se trata de una actualización no interrumpida `TypeForwardedTo` mediante atributos.</span><span class="sxs-lookup"><span data-stu-id="23022-182">This was a non-breaking update using `TypeForwardedTo` attributes.</span></span> <span data-ttu-id="23022-183">En 3,0, se han quitado el ensamblado *Microsoft. AspNetCore. Server. Kestrel. https. dll* vacío (y el paquete NuGet).</span><span class="sxs-lookup"><span data-stu-id="23022-183">For 3.0, the empty *Microsoft.AspNetCore.Server.Kestrel.Https.dll* assembly (and the NuGet package) have been removed.</span></span>

<span data-ttu-id="23022-184">Las bibliotecas que hacen referencia a [Microsoft. AspNetCore. Server. Kestrel. https](https://www.nuget.org/packages/Microsoft.AspNetCore.Server.Kestrel.Https) deben actualizar las dependencias ASP.NET Core a 2,1 o posterior.</span><span class="sxs-lookup"><span data-stu-id="23022-184">Libraries referencing [Microsoft.AspNetCore.Server.Kestrel.Https](https://www.nuget.org/packages/Microsoft.AspNetCore.Server.Kestrel.Https) should update ASP.NET Core dependencies to 2.1 or later.</span></span>

<span data-ttu-id="23022-185">Las aplicaciones y bibliotecas que tienen como destino ASP.NET Core 2,1 o posterior deben quitar las referencias directas al paquete [Microsoft. AspNetCore. Server. Kestrel. https](https://www.nuget.org/packages/Microsoft.AspNetCore.Server.Kestrel.Https) .</span><span class="sxs-lookup"><span data-stu-id="23022-185">Apps and libraries targeting ASP.NET Core 2.1 or later should remove any direct references to the [Microsoft.AspNetCore.Server.Kestrel.Https](https://www.nuget.org/packages/Microsoft.AspNetCore.Server.Kestrel.Https) package.</span></span>

## <a name="jsonnet-support"></a><span data-ttu-id="23022-186">Compatibilidad con Json.NET</span><span class="sxs-lookup"><span data-stu-id="23022-186">Json.NET support</span></span>

<span data-ttu-id="23022-187">Como parte del trabajo para [mejorar la ASP.net Core marco compartido](https://blogs.msdn.microsoft.com/webdev/2018/10/29/a-first-look-at-changes-coming-in-asp-net-core-3-0/), se ha quitado [Json.NET](https://www.newtonsoft.com/json/help/html/Introduction.htm) de la ASP.net Core marco compartido.</span><span class="sxs-lookup"><span data-stu-id="23022-187">As part of the work to [improve the ASP.NET Core shared framework](https://blogs.msdn.microsoft.com/webdev/2018/10/29/a-first-look-at-changes-coming-in-asp-net-core-3-0/), [Json.NET](https://www.newtonsoft.com/json/help/html/Introduction.htm) has been removed from the ASP.NET Core shared framework.</span></span> <span data-ttu-id="23022-188">Es posible que la aplicación requiera esta referencia `Newtonsoft.Json`si usa una característica específica de, como JsonPatch o convertidores, o si [da formato](xref:web-api/advanced/formatting) `Newtonsoft.Json`a tipos específicos de.</span><span class="sxs-lookup"><span data-stu-id="23022-188">Your app may require this reference if it uses `Newtonsoft.Json`-specific feature such as JsonPatch or converters or if it [formats](xref:web-api/advanced/formatting) `Newtonsoft.Json`-specific types.</span></span>

<span data-ttu-id="23022-189">Para usar Json.NET en un proyecto ASP.NET Core 3,0:</span><span class="sxs-lookup"><span data-stu-id="23022-189">To use Json.NET in an ASP.NET Core 3.0 project:</span></span>

* <span data-ttu-id="23022-190">Agregue una referencia de paquete a [Microsoft.AspNetCore.Mvc.NewtonsoftJson](https://nuget.org/packages/Microsoft.AspNetCore.Mvc.NewtonsoftJson).</span><span class="sxs-lookup"><span data-stu-id="23022-190">Add a package reference to [Microsoft.AspNetCore.Mvc.NewtonsoftJson](https://nuget.org/packages/Microsoft.AspNetCore.Mvc.NewtonsoftJson).</span></span>
* <span data-ttu-id="23022-191">Actualización `Startup.ConfigureServices` que se `AddNewtonsoftJson`va a llamar.</span><span class="sxs-lookup"><span data-stu-id="23022-191">Update `Startup.ConfigureServices` to call `AddNewtonsoftJson`.</span></span>

  ```csharp
  services.AddMvc()
      .AddNewtonsoftJson();
  ```

  <span data-ttu-id="23022-192">`AddNewtonsoftJson`es compatible con los nuevos métodos de registro del servicio MVC:</span><span class="sxs-lookup"><span data-stu-id="23022-192">`AddNewtonsoftJson` is compatible with the new MVC service registration methods:</span></span>

  * `AddRazorPages`
  * `AddControllersWithViews`
  * `AddControllers`

  ```csharp
  services.AddControllers()
      .AddNewtonsoftJson();
  ```

  <span data-ttu-id="23022-193">La configuración de Json.NET se puede establecer en la `AddNewtonsoftJson`llamada a:</span><span class="sxs-lookup"><span data-stu-id="23022-193">Json.NET settings can be set in the call to `AddNewtonsoftJson`:</span></span>

  ```csharp
  services.AddMvc()
      .AddNewtonsoftJson(options =>
             options.SerializerSettings.ContractResolver =
                new CamelCasePropertyNamesContractResolver());
  ```

## <a name="mvc-service-registration"></a><span data-ttu-id="23022-194">Registro del servicio MVC</span><span class="sxs-lookup"><span data-stu-id="23022-194">MVC service registration</span></span>

<span data-ttu-id="23022-195">ASP.NET Core 3,0 agrega nuevas opciones para registrar escenarios MVC en `Startup.ConfigureServices`.</span><span class="sxs-lookup"><span data-stu-id="23022-195">ASP.NET Core 3.0 adds new options for registering MVC scenarios inside `Startup.ConfigureServices`.</span></span>

<span data-ttu-id="23022-196">Hay disponibles tres nuevos métodos de extensión de nivel superior relacionados con `IServiceCollection` los escenarios MVC en.</span><span class="sxs-lookup"><span data-stu-id="23022-196">Three new top-level extension methods related to MVC scenarios on `IServiceCollection` are available.</span></span> <span data-ttu-id="23022-197">Las plantillas usan estos nuevos métodos en lugar `UseMvc`de.</span><span class="sxs-lookup"><span data-stu-id="23022-197">Templates use these new methods instead of `UseMvc`.</span></span> <span data-ttu-id="23022-198">Sin embargo `AddMvc` , continúa comportándose como tiene en versiones anteriores.</span><span class="sxs-lookup"><span data-stu-id="23022-198">However, `AddMvc` continues to behave as it has in previous releases.</span></span>

<span data-ttu-id="23022-199">En el ejemplo siguiente se agrega compatibilidad con controladores y características relacionadas con la API, pero no vistas o páginas.</span><span class="sxs-lookup"><span data-stu-id="23022-199">The following example adds support for controllers and API-related features, but not views or pages.</span></span> <span data-ttu-id="23022-200">La plantilla de API usa este código:</span><span class="sxs-lookup"><span data-stu-id="23022-200">The API template uses this code:</span></span>

```csharp
public void ConfigureServices(IServiceCollection services)
{
    services.AddControllers();
}
```

<span data-ttu-id="23022-201">En el ejemplo siguiente se agrega compatibilidad con controladores, características relacionadas con la API y vistas, pero no páginas.</span><span class="sxs-lookup"><span data-stu-id="23022-201">The following example adds support for controllers, API-related features, and views, but not pages.</span></span> <span data-ttu-id="23022-202">La plantilla aplicación web (MVC) utiliza este código:</span><span class="sxs-lookup"><span data-stu-id="23022-202">The Web Application (MVC) template uses this code:</span></span>

```csharp
public void ConfigureServices(IServiceCollection services)
{
    services.AddControllersWithViews();
}
```

<span data-ttu-id="23022-203">En el ejemplo siguiente se agrega compatibilidad con Razor Pages y compatibilidad mínima con el controlador.</span><span class="sxs-lookup"><span data-stu-id="23022-203">The following example adds support for Razor Pages and minimal controller support.</span></span> <span data-ttu-id="23022-204">La plantilla de aplicación Web usa este código:</span><span class="sxs-lookup"><span data-stu-id="23022-204">The Web Application template uses this code:</span></span>

```csharp
public void ConfigureServices(IServiceCollection services)
{
    services.AddRazorPages();
}
```

<span data-ttu-id="23022-205">También se pueden combinar los nuevos métodos.</span><span class="sxs-lookup"><span data-stu-id="23022-205">The new methods can also be combined.</span></span> <span data-ttu-id="23022-206">El ejemplo siguiente es equivalente a llamar `AddMvc` a en ASP.net Core 2,2:</span><span class="sxs-lookup"><span data-stu-id="23022-206">The following example is equivalent to calling `AddMvc` in ASP.NET Core 2.2:</span></span>

```csharp
public void ConfigureServices(IServiceCollection services)
{
    services.AddControllersWithViews();
    services.AddRazorPages();
}
```

## <a name="routing-startup-code"></a><span data-ttu-id="23022-207">Código de inicio de enrutamiento</span><span class="sxs-lookup"><span data-stu-id="23022-207">Routing startup code</span></span>

<span data-ttu-id="23022-208">Si una aplicación llama `UseMvc` a `UseSignalR`o, migre la aplicación al [enrutamiento del punto de conexión](xref:fundamentals/routing) , si es posible.</span><span class="sxs-lookup"><span data-stu-id="23022-208">If an app calls `UseMvc` or `UseSignalR`, migrate the app to [Endpoint Routing](xref:fundamentals/routing) if possible.</span></span> <span data-ttu-id="23022-209">Para mejorar la compatibilidad del enrutamiento de puntos de conexión con versiones anteriores de MVC, hemos revertido algunos de los cambios en la generación de direcciones URL introducidos en ASP.NET Core 2,2.</span><span class="sxs-lookup"><span data-stu-id="23022-209">To improve Endpoint Routing compatibility with previous versions of MVC, we've reverted some of the changes in URL generation introduced in ASP.NET Core 2.2.</span></span> <span data-ttu-id="23022-210">Si experimenta problemas al usar el enrutamiento de puntos de conexión en 2,2, espere mejoras en ASP.NET Core 3,0 con las siguientes excepciones:</span><span class="sxs-lookup"><span data-stu-id="23022-210">If you experienced problems using Endpoint Routing in 2.2, expect improvements in ASP.NET Core 3.0 with the following exceptions:</span></span>

* <span data-ttu-id="23022-211">Si la aplicación implementa `IRouter` o hereda de `Route`, puede que desee evitar la migración en este momento.</span><span class="sxs-lookup"><span data-stu-id="23022-211">If the app implements `IRouter` or inherits from `Route`, you may want to avoid migrating at this time.</span></span> <span data-ttu-id="23022-212">Proporcione comentarios en el [plan para migrar las implementaciones basadas en IRouter al enrutamiento del punto de conexión](https://github.com/aspnet/AspNetCore/issues/4221).</span><span class="sxs-lookup"><span data-stu-id="23022-212">Provide feedback at [Plan to migrate IRouter based implementations onto Endpoint Routing](https://github.com/aspnet/AspNetCore/issues/4221).</span></span>

* <span data-ttu-id="23022-213">Si la aplicación accede directamente a `RouteData.Routers` MVC, puede que desee evitar la migración en este momento.</span><span class="sxs-lookup"><span data-stu-id="23022-213">If the app directly accesses `RouteData.Routers` inside MVC, you may want to avoid migrating at this time.</span></span> <span data-ttu-id="23022-214">Proporcione comentarios en la [Guía de migración para el uso de RouteData. enrutadores](https://github.com/aspnet/AspNetCore/issues/9148).</span><span class="sxs-lookup"><span data-stu-id="23022-214">Provide feedback at [Migration guidance for using RouteData.Routers](https://github.com/aspnet/AspNetCore/issues/9148).</span></span>

<span data-ttu-id="23022-215">El enrutamiento de puntos de conexión admite la misma sintaxis de patrón de ruta y `IRouter`características de creación de patrones de ruta que.</span><span class="sxs-lookup"><span data-stu-id="23022-215">Endpoint Routing supports the same route pattern syntax and route pattern authoring features as `IRouter`.</span></span> <span data-ttu-id="23022-216">El enrutamiento del `IRouteConstraint`extremo admite.</span><span class="sxs-lookup"><span data-stu-id="23022-216">Endpoint Routing supports `IRouteConstraint`.</span></span> <span data-ttu-id="23022-217">El enrutamiento del `[Route]`punto `[HttpGet]`de conexión admite, y los demás atributos de enrutamiento de MVC.</span><span class="sxs-lookup"><span data-stu-id="23022-217">Endpoint routing supports `[Route]`, `[HttpGet]`, and the other MVC routing attributes.</span></span>

<span data-ttu-id="23022-218">Para la mayoría de las `Startup` aplicaciones, solo requiere cambios.</span><span class="sxs-lookup"><span data-stu-id="23022-218">For most applications, only `Startup` requires changes.</span></span>

### <a name="migrate-startupconfigure"></a><span data-ttu-id="23022-219">Migrar startup. Configure</span><span class="sxs-lookup"><span data-stu-id="23022-219">Migrate Startup.Configure</span></span>

<span data-ttu-id="23022-220">Consejos generales:</span><span class="sxs-lookup"><span data-stu-id="23022-220">General advice:</span></span>

* <span data-ttu-id="23022-221">Agregar `UseRouting`.</span><span class="sxs-lookup"><span data-stu-id="23022-221">Add `UseRouting`.</span></span>
* <span data-ttu-id="23022-222">Si la aplicación llama `UseStaticFiles`a, `UseStaticFiles` Coloque **antes** `UseRouting`de.</span><span class="sxs-lookup"><span data-stu-id="23022-222">If the app calls `UseStaticFiles`, place `UseStaticFiles` **before** `UseRouting`.</span></span>
* <span data-ttu-id="23022-223">Si la aplicación usa características de autenticación y autorización como `AuthorizePage` o `[Authorize]`, coloque la llamada a `UseAuthentication` y `UseAuthorization` **después** `UseRouting` de (y **después** `UseCors` de usar el middleware de CORS).</span><span class="sxs-lookup"><span data-stu-id="23022-223">If the app uses authentication/authorization features such as `AuthorizePage` or `[Authorize]`, place the call to `UseAuthentication` and `UseAuthorization` **after** `UseRouting` (and **after** `UseCors` if CORS Middleware is used).</span></span>
* <span data-ttu-id="23022-224">Reemplace `UseMvc` o `UseSignalR` por .`UseEndpoints`</span><span class="sxs-lookup"><span data-stu-id="23022-224">Replace `UseMvc` or `UseSignalR` with `UseEndpoints`.</span></span>
* <span data-ttu-id="23022-225">Si la aplicación usa escenarios de [CORS](xref:security/cors) , como `[EnableCors]`, coloque la llamada a `UseCors` antes de cualquier otro middleware que use CORS (por ejemplo, `UseCors` Coloque `UseAuthentication`antes `UseAuthorization`, y `UseEndpoints`).</span><span class="sxs-lookup"><span data-stu-id="23022-225">If the app uses [CORS](xref:security/cors) scenarios, such as `[EnableCors]`, place the call to `UseCors` before any other middleware that use CORS (for example, place `UseCors` before `UseAuthentication`, `UseAuthorization`, and `UseEndpoints`).</span></span>
* <span data-ttu-id="23022-226">Reemplace `IHostingEnvironment` `using` <xref:Microsoft.Extensions.Hosting?displayProperty=fullName> por `IWebHostEnvironment` y agregue una instrucción para el espacio de nombres.</span><span class="sxs-lookup"><span data-stu-id="23022-226">Replace `IHostingEnvironment` with `IWebHostEnvironment` and add a `using` statement for the <xref:Microsoft.Extensions.Hosting?displayProperty=fullName> namespace.</span></span>
* <span data-ttu-id="23022-227">Reemplazar `IApplicationLifetime` por <xref:Microsoft.Extensions.Hosting.IHostApplicationLifetime> (<xref:Microsoft.Extensions.Hosting?displayProperty=fullName> espacio de nombres).</span><span class="sxs-lookup"><span data-stu-id="23022-227">Replace `IApplicationLifetime` with <xref:Microsoft.Extensions.Hosting.IHostApplicationLifetime> (<xref:Microsoft.Extensions.Hosting?displayProperty=fullName> namespace).</span></span>
* <span data-ttu-id="23022-228">Reemplazar `EnvironmentName` por <xref:Microsoft.Extensions.Hosting.Environments> (<xref:Microsoft.Extensions.Hosting?displayProperty=fullName> espacio de nombres).</span><span class="sxs-lookup"><span data-stu-id="23022-228">Replace `EnvironmentName` with <xref:Microsoft.Extensions.Hosting.Environments> (<xref:Microsoft.Extensions.Hosting?displayProperty=fullName> namespace).</span></span>

<span data-ttu-id="23022-229">El siguiente es un ejemplo de `Startup.Configure` en una aplicación típica de ASP.net Core 2,2:</span><span class="sxs-lookup"><span data-stu-id="23022-229">The following is an example of `Startup.Configure` in a typical ASP.NET Core 2.2 app:</span></span>

```csharp
public void Configure(IApplicationBuilder app)
{
    ...

    app.UseStaticFiles();

    app.UseAuthentication();

    app.UseSignalR(hubs =>
    {
        hubs.MapHub<ChatHub>("/chat");
    });

    app.UseMvc(routes =>
    {
        routes.MapRoute("default", "{controller=Home}/{action=Index}/{id?}");
    });
}
```

<span data-ttu-id="23022-230">Después de actualizar el `Startup.Configure` código anterior:</span><span class="sxs-lookup"><span data-stu-id="23022-230">After updating the previous `Startup.Configure` code:</span></span>

```csharp
public void Configure(IApplicationBuilder app)
{
    ...

    app.UseStaticFiles();

    app.UseRouting();

    app.UseCors();

    app.UseAuthentication();
    app.UseAuthorization();

    app.UseEndpoints(endpoints =>
    {
        endpoints.MapHub<ChatHub>("/chat");
        endpoints.MapControllerRoute("default", "{controller=Home}/{action=Index}/{id?}");
    });
}
```

### <a name="health-checks"></a><span data-ttu-id="23022-231">Comprobaciones de estado</span><span class="sxs-lookup"><span data-stu-id="23022-231">Health Checks</span></span>

<span data-ttu-id="23022-232">Las comprobaciones de estado usan el enrutamiento del punto de conexión con el host genérico.</span><span class="sxs-lookup"><span data-stu-id="23022-232">Health Checks use endpoint routing with the Generic Host.</span></span> <span data-ttu-id="23022-233">En `Startup.Configure`, llame a `MapHealthChecks` en el generador de puntos de conexiones con la dirección URL del punto de conexión o la ruta de acceso relativa:</span><span class="sxs-lookup"><span data-stu-id="23022-233">In `Startup.Configure`, call `MapHealthChecks` on the endpoint builder with the endpoint URL or relative path:</span></span>

```csharp
app.UseEndpoints(endpoints =>
{
    endpoints.MapHealthChecks("/health");
});
```

<span data-ttu-id="23022-234">Los extremos de las comprobaciones de estado pueden:</span><span class="sxs-lookup"><span data-stu-id="23022-234">Health Checks endpoints can:</span></span>

* <span data-ttu-id="23022-235">Especifique uno o más hosts o puertos permitidos.</span><span class="sxs-lookup"><span data-stu-id="23022-235">Specify one or more permitted hosts/ports.</span></span>
* <span data-ttu-id="23022-236">Requerir autorización.</span><span class="sxs-lookup"><span data-stu-id="23022-236">Require authorization.</span></span>
* <span data-ttu-id="23022-237">Requerir CORS.</span><span class="sxs-lookup"><span data-stu-id="23022-237">Require CORS.</span></span>

<span data-ttu-id="23022-238">Para obtener más información, consulta <xref:host-and-deploy/health-checks>.</span><span class="sxs-lookup"><span data-stu-id="23022-238">For more information, see <xref:host-and-deploy/health-checks>.</span></span>

### <a name="security-middleware-guidance"></a><span data-ttu-id="23022-239">Guía de middleware de seguridad</span><span class="sxs-lookup"><span data-stu-id="23022-239">Security middleware guidance</span></span>

<span data-ttu-id="23022-240">La compatibilidad con la autorización y CORS está unificada en torno al enfoque de [middleware](xref:fundamentals/middleware/index) .</span><span class="sxs-lookup"><span data-stu-id="23022-240">Support for authorization and CORS is unified around the [middleware](xref:fundamentals/middleware/index) approach.</span></span> <span data-ttu-id="23022-241">Esto permite el uso del mismo middleware y la misma funcionalidad en estos escenarios.</span><span class="sxs-lookup"><span data-stu-id="23022-241">This allows use of the same middleware and functionality across these scenarios.</span></span> <span data-ttu-id="23022-242">En esta versión se proporciona un middleware de autorización actualizado, y el middleware CORS se ha mejorado para que pueda comprender los atributos usados por los controladores MVC.</span><span class="sxs-lookup"><span data-stu-id="23022-242">An updated authorization middleware is provided in this release, and CORS Middleware is enhanced so that it can understand the attributes used by MVC controllers.</span></span>

#### <a name="cors"></a><span data-ttu-id="23022-243">CORS</span><span class="sxs-lookup"><span data-stu-id="23022-243">CORS</span></span>

<span data-ttu-id="23022-244">Anteriormente, CORS podía ser difícil de configurar.</span><span class="sxs-lookup"><span data-stu-id="23022-244">Previously, CORS could be difficult to configure.</span></span> <span data-ttu-id="23022-245">El middleware se proporcionó para su uso en algunos casos de uso, pero los filtros de MVC debían usarse **sin** el middleware en otros casos de uso.</span><span class="sxs-lookup"><span data-stu-id="23022-245">Middleware was provided for use in some use cases, but MVC filters were intended to be used **without** the middleware in other use cases.</span></span> <span data-ttu-id="23022-246">Con ASP.NET Core 3,0, se recomienda que todas las aplicaciones que requieren CORS usen el middleware de CORS en tándem con el enrutamiento de puntos de conexión.</span><span class="sxs-lookup"><span data-stu-id="23022-246">With ASP.NET Core 3.0, we recommend that all apps that require CORS use the CORS Middleware in tandem with Endpoint Routing.</span></span> <span data-ttu-id="23022-247">`UseCors`se puede proporcionar con una directiva predeterminada, `[EnableCors]` y los atributos y `[DisableCors]` se pueden usar para invalidar la directiva predeterminada cuando sea necesario.</span><span class="sxs-lookup"><span data-stu-id="23022-247">`UseCors` can be provided with a default policy, and `[EnableCors]` and `[DisableCors]` attributes can be used to override the default policy where required.</span></span>

<span data-ttu-id="23022-248">En el ejemplo siguiente:</span><span class="sxs-lookup"><span data-stu-id="23022-248">In the following example:</span></span>

* <span data-ttu-id="23022-249">CORS está habilitado para todos los puntos de `default` conexión con la Directiva con nombre.</span><span class="sxs-lookup"><span data-stu-id="23022-249">CORS is enabled for all endpoints with the `default` named policy.</span></span>
* <span data-ttu-id="23022-250">La `MyController` clase deshabilita CORS con el `[DisableCors]` atributo.</span><span class="sxs-lookup"><span data-stu-id="23022-250">The `MyController` class disables CORS with the `[DisableCors]` attribute.</span></span>

```csharp
public void Configure(IApplicationBuilder app)
{
    ...

    app.UseRouting();

    app.UseCors("default");

    app.UseEndpoints(endpoints =>
    {
        endpoints.MapDefaultControllerRoute();
    });
}

[DisableCors]
public class MyController : ControllerBase
{
    ...
}
```

#### <a name="authorization"></a><span data-ttu-id="23022-251">Autorización</span><span class="sxs-lookup"><span data-stu-id="23022-251">Authorization</span></span>

<span data-ttu-id="23022-252">En versiones anteriores de ASP.net Core, se proporcionaba compatibilidad con la `[Authorize]` autorización mediante el atributo.</span><span class="sxs-lookup"><span data-stu-id="23022-252">In earlier versions of ASP.NET Core, authorization support was provided via the `[Authorize]` attribute.</span></span> <span data-ttu-id="23022-253">El middleware de autorización no estaba disponible.</span><span class="sxs-lookup"><span data-stu-id="23022-253">Authorization middleware wasn't available.</span></span> <span data-ttu-id="23022-254">En ASP.NET Core 3,0, se requiere middleware de autorización.</span><span class="sxs-lookup"><span data-stu-id="23022-254">In ASP.NET Core 3.0, authorization middleware is required.</span></span> <span data-ttu-id="23022-255">Se recomienda colocar el middleware de autorización de`UseAuthorization`ASP.net Core () `UseAuthentication`inmediatamente después de.</span><span class="sxs-lookup"><span data-stu-id="23022-255">We recommend placing the ASP.NET Core Authorization Middleware (`UseAuthorization`) immediately after `UseAuthentication`.</span></span> <span data-ttu-id="23022-256">El middleware de autorización también puede configurarse con una directiva predeterminada, que se puede invalidar.</span><span class="sxs-lookup"><span data-stu-id="23022-256">The Authorization Middleware can also be configured with a default policy, which can be overridden.</span></span>

<span data-ttu-id="23022-257">En ASP.net Core 3,0 o posterior, `UseAuthorization` se llama a `Startup.Configure`en, y lo `HomeController` siguiente requiere un usuario con sesión iniciada:</span><span class="sxs-lookup"><span data-stu-id="23022-257">In ASP.NET Core 3.0 or later, `UseAuthorization` is called in `Startup.Configure`, and the following `HomeController` requires a signed in user:</span></span>

```csharp
public void Configure(IApplicationBuilder app)
{
    ...

    app.UseRouting();

    app.UseAuthentication();
    app.UseAuthorization();

    app.UseEndpoints(endpoints =>
    {
        endpoints.MapDefaultControllerRoute();
    });
}

public class HomeController : ControllerBase
{
    [Authorize]
    public IActionResult BuyWidgets()
    {
        ...
    }
}
```

<span data-ttu-id="23022-258">Si la aplicación usa `AuthorizeFilter` como filtro global en MVC, se recomienda refactorizar el código para proporcionar una directiva en la llamada a. `AddAuthorization`</span><span class="sxs-lookup"><span data-stu-id="23022-258">If the app uses an `AuthorizeFilter` as a global filter in MVC, we recommend refactoring the code to provide a policy in the call to `AddAuthorization`.</span></span>

<span data-ttu-id="23022-259">`DefaultPolicy` Se configura inicialmente para requerir autenticación, por lo que no se requiere ninguna configuración adicional.</span><span class="sxs-lookup"><span data-stu-id="23022-259">The `DefaultPolicy` is initially configured to require authentication, so no additional configuration is required.</span></span> <span data-ttu-id="23022-260">En el ejemplo siguiente, los puntos de conexión de MVC `RequireAuthorization` se marcan como para que todas las solicitudes se `DefaultPolicy`deben autorizar en función de.</span><span class="sxs-lookup"><span data-stu-id="23022-260">In the following example, MVC endpoints are marked as `RequireAuthorization` so that all requests must be authorized based on the `DefaultPolicy`.</span></span> <span data-ttu-id="23022-261">Sin embargo, `HomeController` permite el acceso sin que el usuario inicie sesión en la `[AllowAnonymous]`aplicación debido a:</span><span class="sxs-lookup"><span data-stu-id="23022-261">However, the `HomeController` allows access without the user signing into the app due to `[AllowAnonymous]`:</span></span>

```csharp
public void Configure(IApplicationBuilder app)
{
    ...

    app.UseRouting();

    app.UseAuthentication();
    app.UseAuthorization();

    app.UseEndpoints(endpoints =>
    {
        endpoints.MapDefaultControllerRoute().RequireAuthorization();
    });
}

[AllowAnonymous]
public class HomeController : ControllerBase
{
    ...
}
```

<span data-ttu-id="23022-262">También se pueden personalizar las directivas.</span><span class="sxs-lookup"><span data-stu-id="23022-262">Policies can also be customized.</span></span> <span data-ttu-id="23022-263">Basándose en el ejemplo anterior, `DefaultPolicy` se configura para requerir autenticación y un ámbito específico:</span><span class="sxs-lookup"><span data-stu-id="23022-263">Building upon the previous example, the `DefaultPolicy` is configured to require authentication and a specific scope:</span></span>

```csharp
public void ConfigureServices(IServiceCollection services)
{
    ...

    services.AddAuthorization(options =>
    {
        options.DefaultPolicy = new AuthorizationPolicyBuilder()
          .RequireAuthenticatedUser()
          .RequireScope("MyScope")
          .Build();
    });
}

public void Configure(IApplicationBuilder app)
{
    ...

    app.UseRouting();

    app.UseAuthentication();
    app.UseAuthorization();

    app.UseEndpoints(endpoints =>
    {
        endpoints.MapDefaultControllerRoute().RequireAuthorization();
    });
}

[AllowAnonymous]
public class HomeController : ControllerBase
{
    ...
}
```

<span data-ttu-id="23022-264">Como alternativa, se pueden configurar todos los puntos de conexión para requerir `[Authorize]` la `RequireAuthorization` autorización sin o `FallbackPolicy`mediante la configuración de.</span><span class="sxs-lookup"><span data-stu-id="23022-264">Alternatively, all endpoints can be configured to require authorization without `[Authorize]` or `RequireAuthorization` by configuring a `FallbackPolicy`.</span></span> <span data-ttu-id="23022-265">`FallbackPolicy` Es diferente `DefaultPolicy`de.</span><span class="sxs-lookup"><span data-stu-id="23022-265">The `FallbackPolicy` is different from the `DefaultPolicy`.</span></span> <span data-ttu-id="23022-266">Se desencadena con `[Authorize]` `FallbackPolicy` o `RequireAuthorization`, mientras que se desencadena cuando no se establece ninguna otra directiva. `DefaultPolicy`</span><span class="sxs-lookup"><span data-stu-id="23022-266">The `DefaultPolicy` is triggered by `[Authorize]` or `RequireAuthorization`, while the `FallbackPolicy` is triggered when no other policy is set.</span></span> <span data-ttu-id="23022-267">`FallbackPolicy`está configurado inicialmente para permitir solicitudes sin autorización.</span><span class="sxs-lookup"><span data-stu-id="23022-267">`FallbackPolicy` is initially configured to allow requests without authorization.</span></span>

<span data-ttu-id="23022-268">El ejemplo siguiente es el mismo que el anterior `DefaultPolicy` , pero `FallbackPolicy` usa para requerir siempre la autenticación en todos los extremos excepto cuando `[AllowAnonymous]` se especifica:</span><span class="sxs-lookup"><span data-stu-id="23022-268">The following example is the same as the preceding `DefaultPolicy` example but uses the `FallbackPolicy` to always require authentication on all endpoints except when `[AllowAnonymous]` is specified:</span></span>

```csharp
public void ConfigureServices(IServiceCollection services)
{
    ...

    services.AddAuthorization(options =>
    {
        options.FallbackPolicy = new AuthorizationPolicyBuilder()
          .RequireAuthenticatedUser()
          .RequireScope("MyScope")
          .Build();
    });
}

public void Configure(IApplicationBuilder app)
{
    ...

    app.UseRouting();

    app.UseAuthentication();
    app.UseAuthorization();

    app.UseEndpoints(endpoints =>
    {
        endpoints.MapDefaultControllerRoute();
    });
}

[AllowAnonymous]
public class HomeController : ControllerBase
{
    ...
}
```

<span data-ttu-id="23022-269">La autorización por middleware funciona sin el marco de trabajo que tiene un conocimiento específico de la autorización.</span><span class="sxs-lookup"><span data-stu-id="23022-269">Authorization by middleware works without the framework having any specific knowledge of authorization.</span></span> <span data-ttu-id="23022-270">Por ejemplo, las [comprobaciones de estado](xref:host-and-deploy/health-checks) no tienen ningún conocimiento específico de la autorización, pero las comprobaciones de estado pueden tener una directiva de autorización configurable aplicada por el middleware.</span><span class="sxs-lookup"><span data-stu-id="23022-270">For instance, [health checks](xref:host-and-deploy/health-checks) has no specific knowledge of authorization, but health checks can have a configurable authorization policy applied by the middleware.</span></span>

<span data-ttu-id="23022-271">Además, cada punto de conexión puede personalizar sus requisitos de autorización.</span><span class="sxs-lookup"><span data-stu-id="23022-271">Additionally, each endpoint can customize its authorization requirements.</span></span> <span data-ttu-id="23022-272">En el ejemplo siguiente, `UseAuthorization` procesa la `DefaultPolicy`autorización con, pero el `/healthz` extremo de comprobación de estado `admin` requiere un usuario:</span><span class="sxs-lookup"><span data-stu-id="23022-272">In the following example, `UseAuthorization` processes authorization with the `DefaultPolicy`, but the `/healthz` health check endpoint requires an `admin` user:</span></span>

```csharp
public void Configure(IApplicationBuilder app)
{
    ...

    app.UseRouting();

    app.UseAuthentication();
    app.UseAuthorization();

    app.UseEndpoints(endpoints =>
    {
        endpoints
            .MapHealthChecks("/healthz")
            .RequireAuthorization(new AuthorizeAttribute(){ Roles = "admin", });
    });
}
```

<span data-ttu-id="23022-273">La protección se implementa en algunos escenarios.</span><span class="sxs-lookup"><span data-stu-id="23022-273">Protection is implemented for some scenarios.</span></span> <span data-ttu-id="23022-274">`UseEndpoint`el middleware produce una excepción si se omite una directiva de autorización o CORS debido a que falta un middleware.</span><span class="sxs-lookup"><span data-stu-id="23022-274">`UseEndpoint` middleware throws an exception if an authorization or CORS policy is skipped due to missing middleware.</span></span> <span data-ttu-id="23022-275">La compatibilidad con el analizador para proporcionar información adicional sobre la configuración inestable está en curso.</span><span class="sxs-lookup"><span data-stu-id="23022-275">Analyzer support to provide additional feedback about misconfiguration is in progress.</span></span>

### <a name="signalr"></a><span data-ttu-id="23022-276">SignalR</span><span class="sxs-lookup"><span data-stu-id="23022-276">SignalR</span></span>

<span data-ttu-id="23022-277">La asignación de los concentradores de Signalr `UseEndpoints`ahora tiene lugar dentro de.</span><span class="sxs-lookup"><span data-stu-id="23022-277">Mapping of SignalR hubs now takes place inside `UseEndpoints`.</span></span>

<span data-ttu-id="23022-278">Asigne cada concentrador `MapHub`con.</span><span class="sxs-lookup"><span data-stu-id="23022-278">Map each hub with `MapHub`.</span></span> <span data-ttu-id="23022-279">Como en versiones anteriores, cada concentrador aparece explícitamente en la lista.</span><span class="sxs-lookup"><span data-stu-id="23022-279">As in previous versions, each hub is explicitly listed.</span></span>

<span data-ttu-id="23022-280">En el ejemplo siguiente, se agrega compatibilidad `ChatHub` con la central signalr:</span><span class="sxs-lookup"><span data-stu-id="23022-280">In the following example, support for the `ChatHub` SignalR hub is added:</span></span>

```csharp
public void Configure(IApplicationBuilder app)
{
    ...

    app.UseRouting();

    app.UseEndpoints(endpoints =>
    {
        endpoints.MapHub<ChatHub>();
    });
}
```

<span data-ttu-id="23022-281">Existe una nueva opción para controlar los límites de tamaño de los mensajes de los clientes.</span><span class="sxs-lookup"><span data-stu-id="23022-281">There is a new option for controlling message size limits from clients.</span></span> <span data-ttu-id="23022-282">Por ejemplo, en `Startup.ConfigureServices`:</span><span class="sxs-lookup"><span data-stu-id="23022-282">For example, in `Startup.ConfigureServices`:</span></span>

```csharp
services.AddSignalR(hubOptions =>
{
    hubOptions.MaximumReceiveMessageSize = 32768;
});
```

<span data-ttu-id="23022-283">En ASP.net Core 2,2, puede establecer el y `TransportMaxBufferSize` el que controlarían de forma eficaz el tamaño máximo de los mensajes.</span><span class="sxs-lookup"><span data-stu-id="23022-283">In ASP.NET Core 2.2, you could set the `TransportMaxBufferSize` and that would effectively control the maximum message size.</span></span> <span data-ttu-id="23022-284">En ASP.NET Core 3,0, esa opción ahora solo controla el tamaño máximo antes de que se observe la presión.</span><span class="sxs-lookup"><span data-stu-id="23022-284">In ASP.NET Core 3.0, that option now only controls the maximum size before backpressure is observed.</span></span>

### <a name="mvc-controllers"></a><span data-ttu-id="23022-285">Controladores MVC</span><span class="sxs-lookup"><span data-stu-id="23022-285">MVC controllers</span></span>

<span data-ttu-id="23022-286">La asignación de controladores ahora tiene lugar `UseEndpoints`dentro de.</span><span class="sxs-lookup"><span data-stu-id="23022-286">Mapping of controllers now takes place inside `UseEndpoints`.</span></span>

<span data-ttu-id="23022-287">Agregue `MapControllers` si la aplicación usa el enrutamiento de atributos.</span><span class="sxs-lookup"><span data-stu-id="23022-287">Add `MapControllers` if the app uses attribute routing.</span></span> <span data-ttu-id="23022-288">Dado que el enrutamiento incluye compatibilidad con muchos marcos en ASP.NET Core 3,0 o posterior, la adición de controladores de enrutamiento de atributos es participación.</span><span class="sxs-lookup"><span data-stu-id="23022-288">Since routing includes support for many frameworks in ASP.NET Core 3.0 or later, adding attribute-routed controllers is opt-in.</span></span>

<span data-ttu-id="23022-289">Reemplace lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="23022-289">Replace the following:</span></span>

* <span data-ttu-id="23022-290">`MapRoute`Gracias`MapControllerRoute`</span><span class="sxs-lookup"><span data-stu-id="23022-290">`MapRoute` with `MapControllerRoute`</span></span>
* <span data-ttu-id="23022-291">`MapAreaRoute`Gracias`MapAreaControllerRoute`</span><span class="sxs-lookup"><span data-stu-id="23022-291">`MapAreaRoute` with `MapAreaControllerRoute`</span></span>

<span data-ttu-id="23022-292">Puesto que el enrutamiento ahora incluye compatibilidad con algo más que MVC, la terminología ha cambiado para que estos métodos indiquen claramente lo que hacen.</span><span class="sxs-lookup"><span data-stu-id="23022-292">Since routing now includes support for more than just MVC, the terminology has changed to make these methods clearly state what they do.</span></span> <span data-ttu-id="23022-293">Las rutas convencionales como `MapControllerRoute` / `MapAreaControllerRoute` se aplicanenelordenenqueseagregan./ `MapDefaultControllerRoute`</span><span class="sxs-lookup"><span data-stu-id="23022-293">Conventional routes such as `MapControllerRoute`/`MapAreaControllerRoute`/`MapDefaultControllerRoute` are applied in the order that they're added.</span></span> <span data-ttu-id="23022-294">Coloque primero rutas más específicas (por ejemplo, las rutas de un área).</span><span class="sxs-lookup"><span data-stu-id="23022-294">Place more specific routes (such as routes for an area) first.</span></span>

<span data-ttu-id="23022-295">En el ejemplo siguiente:</span><span class="sxs-lookup"><span data-stu-id="23022-295">In the following example:</span></span>

* <span data-ttu-id="23022-296">`MapControllers`agrega compatibilidad con los controladores de enrutamiento de atributos.</span><span class="sxs-lookup"><span data-stu-id="23022-296">`MapControllers` adds support for attribute-routed controllers.</span></span>
* <span data-ttu-id="23022-297">`MapAreaControllerRoute`agrega una ruta convencional para los controladores de un área.</span><span class="sxs-lookup"><span data-stu-id="23022-297">`MapAreaControllerRoute` adds a conventional route for controllers in an area.</span></span>
* <span data-ttu-id="23022-298">`MapControllerRoute`agrega una ruta convencional para los controladores.</span><span class="sxs-lookup"><span data-stu-id="23022-298">`MapControllerRoute` adds a conventional route for controllers.</span></span>

```csharp
public void Configure(IApplicationBuilder app)
{
    ...

    app.UseRouting();

    app.UseEndpoints(endpoints =>
    {
        endpoints.MapControllers();
        endpoints.MapAreaControllerRoute(
            "admin",
            "admin",
            "Admin/{controller=Home}/{action=Index}/{id?}");
        endpoints.MapControllerRoute(
            "default", "{controller=Home}/{action=Index}/{id?}");
    });
}
```

### <a name="razor-pages"></a><span data-ttu-id="23022-299">Páginas de Razor</span><span class="sxs-lookup"><span data-stu-id="23022-299">Razor Pages</span></span>

<span data-ttu-id="23022-300">La asignación Razor Pages ahora tiene lugar `UseEndpoints`dentro de.</span><span class="sxs-lookup"><span data-stu-id="23022-300">Mapping Razor Pages now takes place inside `UseEndpoints`.</span></span>

<span data-ttu-id="23022-301">Agregue `MapRazorPages` si la aplicación usa Razor pages.</span><span class="sxs-lookup"><span data-stu-id="23022-301">Add `MapRazorPages` if the app uses Razor Pages.</span></span> <span data-ttu-id="23022-302">Dado que el enrutamiento del punto de conexión incluye compatibilidad con muchos marcos, agregar Razor Pages es ahora opcional.</span><span class="sxs-lookup"><span data-stu-id="23022-302">Since Endpoint Routing includes support for many frameworks, adding Razor Pages is now opt-in.</span></span>

<span data-ttu-id="23022-303">En el ejemplo siguiente, `MapRazorPages` agrega compatibilidad con Razor pages:</span><span class="sxs-lookup"><span data-stu-id="23022-303">In the following example, `MapRazorPages` adds support for Razor Pages:</span></span>

```csharp
public void Configure(IApplicationBuilder app)
{
    ...

    app.UseRouting();

    app.UseEndpoints(endpoints =>
    {
        endpoints.MapRazorPages();
    });
}
```

### <a name="use-mvc-without-endpoint-routing"></a><span data-ttu-id="23022-304">Uso de MVC sin enrutamiento de punto de conexión</span><span class="sxs-lookup"><span data-stu-id="23022-304">Use MVC without Endpoint Routing</span></span>

<span data-ttu-id="23022-305">El uso de `UseMvc` MVC `UseMvcWithDefaultRoute` a través de o en ASP.net Core 3,0 requiere una participación `Startup.ConfigureServices`explícita dentro de.</span><span class="sxs-lookup"><span data-stu-id="23022-305">Using MVC via `UseMvc` or `UseMvcWithDefaultRoute` in ASP.NET Core 3.0 requires an explicit opt-in inside `Startup.ConfigureServices`.</span></span> <span data-ttu-id="23022-306">Esto es necesario porque MVC debe saber si puede confiar en la autorización y el middleware CORS durante la inicialización.</span><span class="sxs-lookup"><span data-stu-id="23022-306">This is required because MVC must know whether it can rely on the authorization and CORS Middleware during initialization.</span></span> <span data-ttu-id="23022-307">Se proporciona un analizador que advierte si la aplicación intenta usar una configuración no admitida.</span><span class="sxs-lookup"><span data-stu-id="23022-307">An analyzer is provided that warns if the app attempts to use an unsupported configuration.</span></span>

<span data-ttu-id="23022-308">Si la aplicación requiere compatibilidad `IRouter` heredada, `EnableEndpointRouting` deshabilite el uso de cualquiera de `Startup.ConfigureServices`los métodos siguientes en:</span><span class="sxs-lookup"><span data-stu-id="23022-308">If the app requires legacy `IRouter` support, disable `EnableEndpointRouting` using any of the following approaches in `Startup.ConfigureServices`:</span></span>

```csharp
services.AddMvc(options => options.EnableEndpointRouting = false);
```

```csharp
services.AddControllers(options => options.EnableEndpointRouting = false);
```

```csharp
services.AddControllersWithViews(options => options.EnableEndpointRouting = false);

```

```csharp
services.AddRazorPages().AddMvcOptions(options => options.EnableEndpointRouting = false);
```

### <a name="health-checks"></a><span data-ttu-id="23022-309">Comprobaciones de estado</span><span class="sxs-lookup"><span data-stu-id="23022-309">Health checks</span></span>

<span data-ttu-id="23022-310">Las comprobaciones de estado se pueden usar como un *enrutador* con enrutamiento de punto de conexión.</span><span class="sxs-lookup"><span data-stu-id="23022-310">Health checks can be used as a *router-ware* with Endpoint Routing.</span></span>

<span data-ttu-id="23022-311">Agregue `MapHealthChecks` para usar comprobaciones de estado con enrutamiento de punto de conexión.</span><span class="sxs-lookup"><span data-stu-id="23022-311">Add `MapHealthChecks` to use health checks with Endpoint Routing.</span></span> <span data-ttu-id="23022-312">El `MapHealthChecks` método acepta argumentos similares a `UseHealthChecks`.</span><span class="sxs-lookup"><span data-stu-id="23022-312">The `MapHealthChecks` method accepts arguments similar to `UseHealthChecks`.</span></span> <span data-ttu-id="23022-313">La ventaja de usar `MapHealthChecks` over `UseHealthChecks` es la capacidad de aplicar la autorización y tener un control más preciso sobre la Directiva de coincidencia.</span><span class="sxs-lookup"><span data-stu-id="23022-313">The advantage of using `MapHealthChecks` over `UseHealthChecks` is the ability to apply authorization and to have greater fine-grained control over the matching policy.</span></span>

<span data-ttu-id="23022-314">En el ejemplo siguiente, `MapHealthChecks` se llama a para un extremo de comprobación `/healthz`de estado en:</span><span class="sxs-lookup"><span data-stu-id="23022-314">In the following example, `MapHealthChecks` is called for a health check endpoint at `/healthz`:</span></span>

```csharp
public void Configure(IApplicationBuilder app)
{
    ...

    app.UseRouting();

    app.UseEndpoints(endpoints =>
    {
        endpoints.MapHealthChecks("/healthz", new HealthCheckOptions() { });
    });
}
```

## <a name="hostbuilder-replaces-webhostbuilder"></a><span data-ttu-id="23022-315">HostBuilder reemplaza a WebHostBuilder</span><span class="sxs-lookup"><span data-stu-id="23022-315">HostBuilder replaces WebHostBuilder</span></span>

<span data-ttu-id="23022-316">Las plantillas ASP.NET Core 3,0 usan el [host genérico](xref:fundamentals/host/generic-host).</span><span class="sxs-lookup"><span data-stu-id="23022-316">The ASP.NET Core 3.0 templates use [Generic Host](xref:fundamentals/host/generic-host).</span></span> <span data-ttu-id="23022-317">Las versiones anteriores usaban el [host web](xref:fundamentals/host/web-host).</span><span class="sxs-lookup"><span data-stu-id="23022-317">Previous versions used [Web Host](xref:fundamentals/host/web-host).</span></span> <span data-ttu-id="23022-318">En el código siguiente se muestra la clase generada `Program` de la plantilla ASP.net Core 3,0:</span><span class="sxs-lookup"><span data-stu-id="23022-318">The following code shows the ASP.NET Core 3.0 template generated `Program` class:</span></span>

[!code-csharp[](22-to-30/samples/Program.cs?name=snippet)]

<span data-ttu-id="23022-319">En el código siguiente se muestra la clase generada `Program` por la plantilla ASP.net Core 2,2:</span><span class="sxs-lookup"><span data-stu-id="23022-319">The following code shows the ASP.NET Core 2.2 template-generated `Program` class:</span></span>

[!code-csharp[](22-to-30/samples/Program2.2.cs?name=snippet)]

<span data-ttu-id="23022-320"><xref:Microsoft.AspNetCore.Hosting.IWebHostBuilder>permanece en 3,0 y es el tipo del que `webBuilder` se ha detectado en el ejemplo de código anterior.</span><span class="sxs-lookup"><span data-stu-id="23022-320"><xref:Microsoft.AspNetCore.Hosting.IWebHostBuilder> remains in 3.0 and is the type of the `webBuilder` seen in the preceding code sample.</span></span> <span data-ttu-id="23022-321"><xref:Microsoft.AspNetCore.Hosting.WebHostBuilder>quedará en desuso en una versión futura y se reemplazará por `HostBuilder`.</span><span class="sxs-lookup"><span data-stu-id="23022-321"><xref:Microsoft.AspNetCore.Hosting.WebHostBuilder> will be deprecated in a future release and replaced by `HostBuilder`.</span></span>

<span data-ttu-id="23022-322">El cambio más significativo de `WebHostBuilder` a `HostBuilder` es en la [inserción de dependencias (di)](xref:fundamentals/dependency-injection).</span><span class="sxs-lookup"><span data-stu-id="23022-322">The most significant change from `WebHostBuilder` to `HostBuilder` is in [dependency injection (DI)](xref:fundamentals/dependency-injection).</span></span> <span data-ttu-id="23022-323">Cuando se `HostBuilder`usa, solo se puede <xref:Microsoft.Extensions.Configuration.IConfiguration> insertar <xref:Microsoft.AspNetCore.Hosting.IHostingEnvironment> y `Startup`en el constructor de.</span><span class="sxs-lookup"><span data-stu-id="23022-323">When using `HostBuilder`, you can only inject <xref:Microsoft.Extensions.Configuration.IConfiguration> and <xref:Microsoft.AspNetCore.Hosting.IHostingEnvironment> into `Startup`'s constructor.</span></span> <span data-ttu-id="23022-324">Las `HostBuilder` restricciones de di:</span><span class="sxs-lookup"><span data-stu-id="23022-324">The `HostBuilder` DI constraints:</span></span>

* <span data-ttu-id="23022-325">Habilite el contenedor de DI para que se compile solo una vez.</span><span class="sxs-lookup"><span data-stu-id="23022-325">Enable the DI container to be built only one time.</span></span>
* <span data-ttu-id="23022-326">Evita los problemas de duración de los objetos resultantes como resolver varias instancias de singleton.</span><span class="sxs-lookup"><span data-stu-id="23022-326">Avoids the resulting object lifetime issues like resolving multiple instances of singletons.</span></span>

## <a name="addauthorization-moved-to-a-different-assembly"></a><span data-ttu-id="23022-327">AddAuthorization se ha cambiado a otro ensamblado</span><span class="sxs-lookup"><span data-stu-id="23022-327">AddAuthorization moved to a different assembly</span></span>

<span data-ttu-id="23022-328">Los métodos ASP.net Core 2,2 y `AddAuthorization` Lower de *Microsoft. AspNetCore. Authorization. dll*:</span><span class="sxs-lookup"><span data-stu-id="23022-328">The ASP.NET Core 2.2 and lower `AddAuthorization` methods in *Microsoft.AspNetCore.Authorization.dll*:</span></span>

* <span data-ttu-id="23022-329">Se ha cambiado `AddAuthorizationCore`el nombre.</span><span class="sxs-lookup"><span data-stu-id="23022-329">Have been renamed `AddAuthorizationCore`.</span></span>
* <span data-ttu-id="23022-330">Se han migrado a *Microsoft. AspNetCore. Authorization. Policy. dll*.</span><span class="sxs-lookup"><span data-stu-id="23022-330">Have been moved to *Microsoft.AspNetCore.Authorization.Policy.dll*.</span></span>

<span data-ttu-id="23022-331">Las aplicaciones que usan *Microsoft. AspNetCore. Authorization. dll* y *Microsoft. AspNetCore. Authorization. Policy. dll* no se ven afectadas.</span><span class="sxs-lookup"><span data-stu-id="23022-331">Apps that are using both *Microsoft.AspNetCore.Authorization.dll* and *Microsoft.AspNetCore.Authorization.Policy.dll* are not impacted.</span></span>

<span data-ttu-id="23022-332">Las aplicaciones que no usan *Microsoft. AspNetCore. Authorization. Policy. dll* deben realizar una de las siguientes acciones:</span><span class="sxs-lookup"><span data-stu-id="23022-332">Apps that are not using *Microsoft.AspNetCore.Authorization.Policy.dll* should do one of the following:</span></span>

* <span data-ttu-id="23022-333">Cambiar a con`AddAuthorizationCore`</span><span class="sxs-lookup"><span data-stu-id="23022-333">Switch to using `AddAuthorizationCore`</span></span>
* <span data-ttu-id="23022-334">Agregue una referencia a *Microsoft. AspNetCore. Authorization. Policy. dll*.</span><span class="sxs-lookup"><span data-stu-id="23022-334">Add a reference to *Microsoft.AspNetCore.Authorization.Policy.dll*.</span></span>

<span data-ttu-id="23022-335">Para obtener más información, vea [sobrecarga de `AddAuthorization(o =>`cambios en) en un ensamblado diferente #386](https://github.com/aspnet/Announcements/issues/386).</span><span class="sxs-lookup"><span data-stu-id="23022-335">For more information, see [Breaking change in `AddAuthorization(o =>`) overload lives in a different assembly #386](https://github.com/aspnet/Announcements/issues/386).</span></span>

## <a name="signalr-code"></a><span data-ttu-id="23022-336">Código de signalr</span><span class="sxs-lookup"><span data-stu-id="23022-336">SignalR code</span></span>

<span data-ttu-id="23022-337">El cliente de signalr JavaScript ha cambiado `@aspnet/signalr` de `@microsoft/signalr`a.</span><span class="sxs-lookup"><span data-stu-id="23022-337">The SignalR JavaScript client has changed from `@aspnet/signalr` to `@microsoft/signalr`.</span></span> <span data-ttu-id="23022-338">Para reaccionar a este cambio, cambie las referencias en los archivos *Package. JSON* , las instrucciones require y las instrucciones de importación de ECMAScript.</span><span class="sxs-lookup"><span data-stu-id="23022-338">To react to this change, change the references in *package.json* files, require statements, and ECMAScript import statements.</span></span>

### <a name="systemtextjson-is-the-default-protocol"></a><span data-ttu-id="23022-339">System. Text. JSON es el protocolo predeterminado</span><span class="sxs-lookup"><span data-stu-id="23022-339">System.Text.Json is the default protocol</span></span>

<span data-ttu-id="23022-340">`System.Text.Json`es ahora el protocolo de concentrador predeterminado utilizado por el cliente y el servidor.</span><span class="sxs-lookup"><span data-stu-id="23022-340">`System.Text.Json` is now the default Hub protocol used by both the client and server.</span></span>

<span data-ttu-id="23022-341">En `Startup.ConfigureServices`, llame `AddJsonProtocol` a para establecer las opciones del serializador.</span><span class="sxs-lookup"><span data-stu-id="23022-341">In `Startup.ConfigureServices`, call `AddJsonProtocol` to set serializer options.</span></span>

<span data-ttu-id="23022-342">**Servidor**</span><span class="sxs-lookup"><span data-stu-id="23022-342">**Server:**</span></span>

```csharp
services.AddSignalR(...)
        .AddJsonProtocol(options =>
        {
            options.WriteIndented = false;
        })
```

<span data-ttu-id="23022-343">**Nº**</span><span class="sxs-lookup"><span data-stu-id="23022-343">**Client:**</span></span>

```csharp
new HubConnectionBuilder()
    .WithUrl("/chatHub")
    .AddJsonProtocol(options =>
    {
        options.WriteIndented = false;
    })
    .Build();
```

### <a name="switch-to-newtonsoftjson"></a><span data-ttu-id="23022-344">Cambiar a Newtonsoft. JSON</span><span class="sxs-lookup"><span data-stu-id="23022-344">Switch to Newtonsoft.Json</span></span>

<span data-ttu-id="23022-345">Si utiliza características de `Newtonsoft.Json` que no se admiten en `System.Text.Json`, puede volver a: `Newtonsoft.Json`</span><span class="sxs-lookup"><span data-stu-id="23022-345">If you're using features of `Newtonsoft.Json` that aren't supported in `System.Text.Json`, you can switch back to `Newtonsoft.Json`:</span></span>

1. <span data-ttu-id="23022-346">Instale el paquete NuGet [Microsoft. AspNetCore. signalr. Protocols. NewtonsoftJson](https://www.nuget.org/packages/Microsoft.AspNetCore.SignalR.Protocols.NewtonsoftJson) .</span><span class="sxs-lookup"><span data-stu-id="23022-346">Install the [Microsoft.AspNetCore.SignalR.Protocols.NewtonsoftJson](https://www.nuget.org/packages/Microsoft.AspNetCore.SignalR.Protocols.NewtonsoftJson) NuGet package.</span></span>
1. <span data-ttu-id="23022-347">En el cliente, encadenar una `AddNewtonsoftJsonProtocol` llamada de método a la `HubConnectionBuilder` instancia:</span><span class="sxs-lookup"><span data-stu-id="23022-347">On the client, chain an `AddNewtonsoftJsonProtocol` method call to the `HubConnectionBuilder` instance:</span></span>

    ```csharp
    new HubConnectionBuilder()
        .WithUrl("/chatHub")
        .AddNewtonsoftJsonProtocol(...)
        .Build();
    ```

1. <span data-ttu-id="23022-348">En el servidor, encadenar una `AddNewtonsoftJsonProtocol` llamada de método a la `Startup.ConfigureServices` `AddSignalR` llamada al método en:</span><span class="sxs-lookup"><span data-stu-id="23022-348">On the server, chain an `AddNewtonsoftJsonProtocol` method call to the `AddSignalR` method call in `Startup.ConfigureServices`:</span></span>

    ```csharp
    services.AddSignalR()
        .AddNewtonsoftJsonProtocol(...);
    ```

## <a name="opt-in-to-runtime-compilation"></a><span data-ttu-id="23022-349">Participar en la compilación en tiempo de ejecución</span><span class="sxs-lookup"><span data-stu-id="23022-349">Opt in to runtime compilation</span></span>

<span data-ttu-id="23022-350">En 3,0, la compilación en tiempo de ejecución es un escenario de participación.</span><span class="sxs-lookup"><span data-stu-id="23022-350">In 3.0, runtime compilation is an opt-in scenario.</span></span> <span data-ttu-id="23022-351">Para habilitar la compilación en tiempo <xref:mvc/views/view-compilation#runtime-compilation>de ejecución, vea.</span><span class="sxs-lookup"><span data-stu-id="23022-351">To enable runtime compilation, see <xref:mvc/views/view-compilation#runtime-compilation>.</span></span>
