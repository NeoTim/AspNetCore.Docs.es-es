---
title: Almacenamiento en caché distribuido en ASP.NET Core
author: rick-anderson
description: Aprenda a usar una ASP.NET Core caché distribuida para mejorar el rendimiento y la escalabilidad de las aplicaciones, especialmente en un entorno de granja de servidores o en la nube.
monikerRange: '>= aspnetcore-2.1'
ms.author: riande
ms.custom: mvc
ms.date: 02/07/2020
uid: performance/caching/distributed
ms.openlocfilehash: a4d2a59c8f81ad3e3f020e73a6657864885aa39a
ms.sourcegitcommit: 9a129f5f3e31cc449742b164d5004894bfca90aa
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 03/06/2020
ms.locfileid: "78651803"
---
# <a name="distributed-caching-in-aspnet-core"></a><span data-ttu-id="2baea-103">Almacenamiento en caché distribuido en ASP.NET Core</span><span class="sxs-lookup"><span data-stu-id="2baea-103">Distributed caching in ASP.NET Core</span></span>

<span data-ttu-id="2baea-104">Por [Mohsin Nasir](https://github.com/mohsinnasir) y [Steve Smith](https://ardalis.com/)</span><span class="sxs-lookup"><span data-stu-id="2baea-104">By [Mohsin Nasir](https://github.com/mohsinnasir) and [Steve Smith](https://ardalis.com/)</span></span>

::: moniker range=">= aspnetcore-3.0"

<span data-ttu-id="2baea-105">Una caché distribuida es una memoria caché compartida por varios servidores de aplicaciones, que normalmente se mantiene como un servicio externo a los servidores de aplicaciones que tienen acceso a ella.</span><span class="sxs-lookup"><span data-stu-id="2baea-105">A distributed cache is a cache shared by multiple app servers, typically maintained as an external service to the app servers that access it.</span></span> <span data-ttu-id="2baea-106">Una caché distribuida puede mejorar el rendimiento y la escalabilidad de una aplicación ASP.NET Core, especialmente cuando la aplicación está hospedada en un servicio en la nube o en una granja de servidores.</span><span class="sxs-lookup"><span data-stu-id="2baea-106">A distributed cache can improve the performance and scalability of an ASP.NET Core app, especially when the app is hosted by a cloud service or a server farm.</span></span>

<span data-ttu-id="2baea-107">Una caché distribuida tiene varias ventajas con respecto a otros escenarios de almacenamiento en caché en los que los datos almacenados en caché se almacenan en servidores de aplicaciones individuales.</span><span class="sxs-lookup"><span data-stu-id="2baea-107">A distributed cache has several advantages over other caching scenarios where cached data is stored on individual app servers.</span></span>

<span data-ttu-id="2baea-108">Cuando se distribuyen los datos almacenados en caché, los datos:</span><span class="sxs-lookup"><span data-stu-id="2baea-108">When cached data is distributed, the data:</span></span>

* <span data-ttu-id="2baea-109">Es *coherente (coherente)* entre las solicitudes a varios servidores.</span><span class="sxs-lookup"><span data-stu-id="2baea-109">Is *coherent* (consistent) across requests to multiple servers.</span></span>
* <span data-ttu-id="2baea-110">Sobrevive los reinicios del servidor y las implementaciones de aplicaciones.</span><span class="sxs-lookup"><span data-stu-id="2baea-110">Survives server restarts and app deployments.</span></span>
* <span data-ttu-id="2baea-111">No usa la memoria local.</span><span class="sxs-lookup"><span data-stu-id="2baea-111">Doesn't use local memory.</span></span>

<span data-ttu-id="2baea-112">La configuración de caché distribuida es específica de la implementación.</span><span class="sxs-lookup"><span data-stu-id="2baea-112">Distributed cache configuration is implementation specific.</span></span> <span data-ttu-id="2baea-113">En este artículo se describe cómo configurar SQL Server y las cachés distribuidas de Redis.</span><span class="sxs-lookup"><span data-stu-id="2baea-113">This article describes how to configure SQL Server and Redis distributed caches.</span></span> <span data-ttu-id="2baea-114">También hay implementaciones de terceros disponibles, como [NCache](http://www.alachisoft.com/ncache/aspnet-core-idistributedcache-ncache.html) ([NCache en github](https://github.com/Alachisoft/NCache)).</span><span class="sxs-lookup"><span data-stu-id="2baea-114">Third party implementations are also available, such as [NCache](http://www.alachisoft.com/ncache/aspnet-core-idistributedcache-ncache.html) ([NCache on GitHub](https://github.com/Alachisoft/NCache)).</span></span> <span data-ttu-id="2baea-115">Independientemente de la implementación que se seleccione, la aplicación interactúa con la memoria caché mediante la interfaz <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache>.</span><span class="sxs-lookup"><span data-stu-id="2baea-115">Regardless of which implementation is selected, the app interacts with the cache using the <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache> interface.</span></span>

<span data-ttu-id="2baea-116">[Vea o descargue el código de ejemplo](https://github.com/dotnet/AspNetCore.Docs/tree/master/aspnetcore/performance/caching/distributed/samples/) ([cómo descargarlo](xref:index#how-to-download-a-sample))</span><span class="sxs-lookup"><span data-stu-id="2baea-116">[View or download sample code](https://github.com/dotnet/AspNetCore.Docs/tree/master/aspnetcore/performance/caching/distributed/samples/) ([how to download](xref:index#how-to-download-a-sample))</span></span>

## <a name="prerequisites"></a><span data-ttu-id="2baea-117">Prerequisites</span><span class="sxs-lookup"><span data-stu-id="2baea-117">Prerequisites</span></span>

<span data-ttu-id="2baea-118">Para usar una SQL Server caché distribuida, agregue una referencia de paquete al paquete [Microsoft. Extensions. Caching. SqlServer](https://www.nuget.org/packages/Microsoft.Extensions.Caching.SqlServer) .</span><span class="sxs-lookup"><span data-stu-id="2baea-118">To use a SQL Server distributed cache, add a package reference to the [Microsoft.Extensions.Caching.SqlServer](https://www.nuget.org/packages/Microsoft.Extensions.Caching.SqlServer) package.</span></span>

<span data-ttu-id="2baea-119">Para usar una caché distribuida de Redis, agregue una referencia de paquete al paquete [Microsoft. Extensions. Caching. StackExchangeRedis](https://www.nuget.org/packages/Microsoft.Extensions.Caching.StackExchangeRedis) .</span><span class="sxs-lookup"><span data-stu-id="2baea-119">To use a Redis distributed cache, add a package reference to the [Microsoft.Extensions.Caching.StackExchangeRedis](https://www.nuget.org/packages/Microsoft.Extensions.Caching.StackExchangeRedis) package.</span></span>

<span data-ttu-id="2baea-120">Para usar caché distribuida de NCache, agregue una referencia de paquete al paquete [NCache. Microsoft. Extensions. Caching. código abierto](https://www.nuget.org/packages/NCache.Microsoft.Extensions.Caching.OpenSource) .</span><span class="sxs-lookup"><span data-stu-id="2baea-120">To use NCache distributed cache, add a package reference to the [NCache.Microsoft.Extensions.Caching.OpenSource](https://www.nuget.org/packages/NCache.Microsoft.Extensions.Caching.OpenSource) package.</span></span>

## <a name="idistributedcache-interface"></a><span data-ttu-id="2baea-121">Interfaz IDistributedCache</span><span class="sxs-lookup"><span data-stu-id="2baea-121">IDistributedCache interface</span></span>

<span data-ttu-id="2baea-122">La interfaz de <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache> proporciona los métodos siguientes para manipular los elementos de la implementación de caché distribuida:</span><span class="sxs-lookup"><span data-stu-id="2baea-122">The <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache> interface provides the following methods to manipulate items in the distributed cache implementation:</span></span>

* <span data-ttu-id="2baea-123"><xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache.Get*>, <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache.GetAsync*> &ndash; acepta una clave de cadena y recupera un elemento almacenado en caché como una matriz de `byte[]` si se encuentra en la memoria caché.</span><span class="sxs-lookup"><span data-stu-id="2baea-123"><xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache.Get*>, <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache.GetAsync*> &ndash; Accepts a string key and retrieves a cached item as a `byte[]` array if found in the cache.</span></span>
* <span data-ttu-id="2baea-124"><xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache.Set*>, <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache.SetAsync*> &ndash; agrega un elemento (como `byte[]` matriz) a la memoria caché utilizando una clave de cadena.</span><span class="sxs-lookup"><span data-stu-id="2baea-124"><xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache.Set*>, <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache.SetAsync*> &ndash; Adds an item (as `byte[]` array) to the cache using a string key.</span></span>
* <span data-ttu-id="2baea-125"><xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache.Refresh*>, <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache.RefreshAsync*> &ndash; actualiza un elemento en la memoria caché en función de su clave, restableciendo el tiempo de espera de expiración variable (si existe).</span><span class="sxs-lookup"><span data-stu-id="2baea-125"><xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache.Refresh*>, <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache.RefreshAsync*> &ndash; Refreshes an item in the cache based on its key, resetting its sliding expiration timeout (if any).</span></span>
* <span data-ttu-id="2baea-126"><xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache.Remove*>, <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache.RemoveAsync*> &ndash; quita un elemento de la memoria caché en función de su clave de cadena.</span><span class="sxs-lookup"><span data-stu-id="2baea-126"><xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache.Remove*>, <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache.RemoveAsync*> &ndash; Removes a cache item based on its string key.</span></span>

## <a name="establish-distributed-caching-services"></a><span data-ttu-id="2baea-127">Establecer servicios de almacenamiento en caché distribuidos</span><span class="sxs-lookup"><span data-stu-id="2baea-127">Establish distributed caching services</span></span>

<span data-ttu-id="2baea-128">Registre una implementación de <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache> en `Startup.ConfigureServices`.</span><span class="sxs-lookup"><span data-stu-id="2baea-128">Register an implementation of <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache> in `Startup.ConfigureServices`.</span></span> <span data-ttu-id="2baea-129">Las implementaciones proporcionadas por el marco de trabajo que se describen en este tema incluyen:</span><span class="sxs-lookup"><span data-stu-id="2baea-129">Framework-provided implementations described in this topic include:</span></span>

* [<span data-ttu-id="2baea-130">Caché de memoria distribuida</span><span class="sxs-lookup"><span data-stu-id="2baea-130">Distributed Memory Cache</span></span>](#distributed-memory-cache)
* [<span data-ttu-id="2baea-131">Caché de SQL Server distribuida</span><span class="sxs-lookup"><span data-stu-id="2baea-131">Distributed SQL Server cache</span></span>](#distributed-sql-server-cache)
* [<span data-ttu-id="2baea-132">Caché en Redis distribuida</span><span class="sxs-lookup"><span data-stu-id="2baea-132">Distributed Redis cache</span></span>](#distributed-redis-cache)
* [<span data-ttu-id="2baea-133">Caché de NCache distribuida</span><span class="sxs-lookup"><span data-stu-id="2baea-133">Distributed NCache cache</span></span>](#distributed-ncache-cache)

### <a name="distributed-memory-cache"></a><span data-ttu-id="2baea-134">Caché de memoria distribuida</span><span class="sxs-lookup"><span data-stu-id="2baea-134">Distributed Memory Cache</span></span>

<span data-ttu-id="2baea-135">La memoria caché de memoria distribuida (<xref:Microsoft.Extensions.DependencyInjection.MemoryCacheServiceCollectionExtensions.AddDistributedMemoryCache*>) es una implementación proporcionada por el marco de <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache> que almacena elementos en la memoria.</span><span class="sxs-lookup"><span data-stu-id="2baea-135">The Distributed Memory Cache (<xref:Microsoft.Extensions.DependencyInjection.MemoryCacheServiceCollectionExtensions.AddDistributedMemoryCache*>) is a framework-provided implementation of <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache> that stores items in memory.</span></span> <span data-ttu-id="2baea-136">La caché de memoria distribuida no es una caché distribuida real.</span><span class="sxs-lookup"><span data-stu-id="2baea-136">The Distributed Memory Cache isn't an actual distributed cache.</span></span> <span data-ttu-id="2baea-137">Los elementos almacenados en caché se almacenan en la instancia de la aplicación en el servidor donde se ejecuta la aplicación.</span><span class="sxs-lookup"><span data-stu-id="2baea-137">Cached items are stored by the app instance on the server where the app is running.</span></span>

<span data-ttu-id="2baea-138">La caché de memoria distribuida es una implementación útil:</span><span class="sxs-lookup"><span data-stu-id="2baea-138">The Distributed Memory Cache is a useful implementation:</span></span>

* <span data-ttu-id="2baea-139">En escenarios de desarrollo y pruebas.</span><span class="sxs-lookup"><span data-stu-id="2baea-139">In development and testing scenarios.</span></span>
* <span data-ttu-id="2baea-140">Cuando se usa un solo servidor en producción y el consumo de memoria no es un problema.</span><span class="sxs-lookup"><span data-stu-id="2baea-140">When a single server is used in production and memory consumption isn't an issue.</span></span> <span data-ttu-id="2baea-141">La implementación de la caché de memoria distribuida abstrae el almacenamiento de datos en caché.</span><span class="sxs-lookup"><span data-stu-id="2baea-141">Implementing the Distributed Memory Cache abstracts cached data storage.</span></span> <span data-ttu-id="2baea-142">Permite implementar una solución de almacenamiento en caché distribuida verdadera en el futuro si se necesitan varios nodos o tolerancia a errores.</span><span class="sxs-lookup"><span data-stu-id="2baea-142">It allows for implementing a true distributed caching solution in the future if multiple nodes or fault tolerance become necessary.</span></span>

<span data-ttu-id="2baea-143">La aplicación de ejemplo hace uso de la caché de memoria distribuida cuando la aplicación se ejecuta en el entorno de desarrollo en `Startup.ConfigureServices`:</span><span class="sxs-lookup"><span data-stu-id="2baea-143">The sample app makes use of the Distributed Memory Cache when the app is run in the Development environment in `Startup.ConfigureServices`:</span></span>

[!code-csharp[](distributed/samples/3.x/DistCacheSample/Startup.cs?name=snippet_AddDistributedMemoryCache)]

### <a name="distributed-sql-server-cache"></a><span data-ttu-id="2baea-144">Caché de SQL Server distribuida</span><span class="sxs-lookup"><span data-stu-id="2baea-144">Distributed SQL Server Cache</span></span>

<span data-ttu-id="2baea-145">La implementación de la memoria caché de SQL Server distribuida (<xref:Microsoft.Extensions.DependencyInjection.SqlServerCachingServicesExtensions.AddDistributedSqlServerCache*>) permite que la memoria caché distribuida use una base de datos de SQL Server como su memoria auxiliar.</span><span class="sxs-lookup"><span data-stu-id="2baea-145">The Distributed SQL Server Cache implementation (<xref:Microsoft.Extensions.DependencyInjection.SqlServerCachingServicesExtensions.AddDistributedSqlServerCache*>) allows the distributed cache to use a SQL Server database as its backing store.</span></span> <span data-ttu-id="2baea-146">Para crear una SQL Server tabla de elementos almacenados en caché en una instancia de SQL Server, puede usar la herramienta `sql-cache`.</span><span class="sxs-lookup"><span data-stu-id="2baea-146">To create a SQL Server cached item table in a SQL Server instance, you can use the `sql-cache` tool.</span></span> <span data-ttu-id="2baea-147">La herramienta crea una tabla con el nombre y el esquema que especifique.</span><span class="sxs-lookup"><span data-stu-id="2baea-147">The tool creates a table with the name and schema that you specify.</span></span>

<span data-ttu-id="2baea-148">Cree una tabla en SQL Server ejecutando el comando `sql-cache create`.</span><span class="sxs-lookup"><span data-stu-id="2baea-148">Create a table in SQL Server by running the `sql-cache create` command.</span></span> <span data-ttu-id="2baea-149">Proporcione la instancia de SQL Server (`Data Source`), la base de datos (`Initial Catalog`), el esquema (por ejemplo, `dbo`) y el nombre de la tabla (por ejemplo, `TestCache`):</span><span class="sxs-lookup"><span data-stu-id="2baea-149">Provide the SQL Server instance (`Data Source`), database (`Initial Catalog`), schema (for example, `dbo`), and table name (for example, `TestCache`):</span></span>

```dotnetcli
dotnet sql-cache create "Data Source=(localdb)\MSSQLLocalDB;Initial Catalog=DistCache;Integrated Security=True;" dbo TestCache
```

<span data-ttu-id="2baea-150">Se registra un mensaje para indicar que la herramienta se ha realizado correctamente:</span><span class="sxs-lookup"><span data-stu-id="2baea-150">A message is logged to indicate that the tool was successful:</span></span>

```console
Table and index were created successfully.
```

<span data-ttu-id="2baea-151">La tabla creada por la herramienta `sql-cache` tiene el siguiente esquema:</span><span class="sxs-lookup"><span data-stu-id="2baea-151">The table created by the `sql-cache` tool has the following schema:</span></span>

![Tabla de caché SqlServer](distributed/_static/SqlServerCacheTable.png)

> [!NOTE]
> <span data-ttu-id="2baea-153">Una aplicación debe manipular los valores de la memoria caché mediante una instancia de <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache>, no una <xref:Microsoft.Extensions.Caching.SqlServer.SqlServerCache>.</span><span class="sxs-lookup"><span data-stu-id="2baea-153">An app should manipulate cache values using an instance of <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache>, not a <xref:Microsoft.Extensions.Caching.SqlServer.SqlServerCache>.</span></span>

<span data-ttu-id="2baea-154">La aplicación de ejemplo implementa <xref:Microsoft.Extensions.Caching.SqlServer.SqlServerCache> en un entorno que no es de desarrollo en `Startup.ConfigureServices`:</span><span class="sxs-lookup"><span data-stu-id="2baea-154">The sample app implements <xref:Microsoft.Extensions.Caching.SqlServer.SqlServerCache> in a non-Development environment in `Startup.ConfigureServices`:</span></span>

[!code-csharp[](distributed/samples/3.x/DistCacheSample/Startup.cs?name=snippet_AddDistributedSqlServerCache)]

> [!NOTE]
> <span data-ttu-id="2baea-155">Un <xref:Microsoft.Extensions.Caching.SqlServer.SqlServerCacheOptions.ConnectionString*> (y, opcionalmente, <xref:Microsoft.Extensions.Caching.SqlServer.SqlServerCacheOptions.SchemaName*> y <xref:Microsoft.Extensions.Caching.SqlServer.SqlServerCacheOptions.TableName*>) se almacena normalmente fuera del control de código fuente (por ejemplo, lo almacena el [Administrador secreto](xref:security/app-secrets) o en *appsettings. JSON*/*appSettings. { ENVIRONMENT}. JSON* files).</span><span class="sxs-lookup"><span data-stu-id="2baea-155">A <xref:Microsoft.Extensions.Caching.SqlServer.SqlServerCacheOptions.ConnectionString*> (and optionally, <xref:Microsoft.Extensions.Caching.SqlServer.SqlServerCacheOptions.SchemaName*> and <xref:Microsoft.Extensions.Caching.SqlServer.SqlServerCacheOptions.TableName*>) are typically stored outside of source control (for example, stored by the [Secret Manager](xref:security/app-secrets) or in *appsettings.json*/*appsettings.{ENVIRONMENT}.json* files).</span></span> <span data-ttu-id="2baea-156">La cadena de conexión puede contener credenciales que deben mantenerse fuera de los sistemas de control de código fuente.</span><span class="sxs-lookup"><span data-stu-id="2baea-156">The connection string may contain credentials that should be kept out of source control systems.</span></span>

### <a name="distributed-redis-cache"></a><span data-ttu-id="2baea-157">Redis Cache distribuido</span><span class="sxs-lookup"><span data-stu-id="2baea-157">Distributed Redis Cache</span></span>

<span data-ttu-id="2baea-158">[Redis](https://redis.io/) es un almacén de datos en memoria de código abierto, que a menudo se usa como caché distribuida.</span><span class="sxs-lookup"><span data-stu-id="2baea-158">[Redis](https://redis.io/) is an open source in-memory data store, which is often used as a distributed cache.</span></span> <span data-ttu-id="2baea-159">Puede usar Redis localmente, y puede configurar un [Azure Redis cache](https://azure.microsoft.com/services/cache/) para una aplicación de ASP.net Core hospedada en Azure.</span><span class="sxs-lookup"><span data-stu-id="2baea-159">You can use Redis locally, and you can configure an [Azure Redis Cache](https://azure.microsoft.com/services/cache/) for an Azure-hosted ASP.NET Core app.</span></span>

<span data-ttu-id="2baea-160">Una aplicación configura la implementación de la memoria caché con una instancia de <xref:Microsoft.Extensions.Caching.StackExchangeRedis.RedisCache> (<xref:Microsoft.Extensions.DependencyInjection.StackExchangeRedisCacheServiceCollectionExtensions.AddStackExchangeRedisCache*>) en un entorno que no es de desarrollo en `Startup.ConfigureServices`:</span><span class="sxs-lookup"><span data-stu-id="2baea-160">An app configures the cache implementation using a <xref:Microsoft.Extensions.Caching.StackExchangeRedis.RedisCache> instance (<xref:Microsoft.Extensions.DependencyInjection.StackExchangeRedisCacheServiceCollectionExtensions.AddStackExchangeRedisCache*>) in a non-Development environment in `Startup.ConfigureServices`:</span></span>

[!code-csharp[](distributed/samples/3.x/DistCacheSample/Startup.cs?name=snippet_AddStackExchangeRedisCache)]

<span data-ttu-id="2baea-161">Para instalar Redis en el equipo local:</span><span class="sxs-lookup"><span data-stu-id="2baea-161">To install Redis on your local machine:</span></span>

1. <span data-ttu-id="2baea-162">Instale el [paquete chocolatey Redis](https://chocolatey.org/packages/redis-64/).</span><span class="sxs-lookup"><span data-stu-id="2baea-162">Install the [Chocolatey Redis package](https://chocolatey.org/packages/redis-64/).</span></span>
1. <span data-ttu-id="2baea-163">Ejecute `redis-server` desde un símbolo del sistema.</span><span class="sxs-lookup"><span data-stu-id="2baea-163">Run `redis-server` from a command prompt.</span></span>

### <a name="distributed-ncache-cache"></a><span data-ttu-id="2baea-164">Caché de NCache distribuida</span><span class="sxs-lookup"><span data-stu-id="2baea-164">Distributed NCache Cache</span></span>

<span data-ttu-id="2baea-165">[NCache](https://github.com/Alachisoft/NCache) es una caché distribuida en memoria de código abierto desarrollada de forma nativa en .NET y .net Core.</span><span class="sxs-lookup"><span data-stu-id="2baea-165">[NCache](https://github.com/Alachisoft/NCache) is an open source in-memory distributed cache developed natively in .NET and .NET Core.</span></span> <span data-ttu-id="2baea-166">NCache funciona localmente y se configura como un clúster de caché distribuida para una aplicación ASP.NET Core que se ejecuta en Azure o en otras plataformas de hospedaje.</span><span class="sxs-lookup"><span data-stu-id="2baea-166">NCache works both locally and configured as a distributed cache cluster for an ASP.NET Core app running in Azure or on other hosting platforms.</span></span>

<span data-ttu-id="2baea-167">Para instalar y configurar NCache en el equipo local, consulte [Guía de introducción de NCache para Windows](https://www.alachisoft.com/resources/docs/ncache-oss/getting-started-guide-windows/).</span><span class="sxs-lookup"><span data-stu-id="2baea-167">To install and configure NCache on your local machine, see [NCache Getting Started Guide for Windows](https://www.alachisoft.com/resources/docs/ncache-oss/getting-started-guide-windows/).</span></span>

<span data-ttu-id="2baea-168">Para configurar NCache:</span><span class="sxs-lookup"><span data-stu-id="2baea-168">To configure NCache:</span></span>

1. <span data-ttu-id="2baea-169">Instalación de [NuGet de código abierto de NCache](https://www.nuget.org/packages/Alachisoft.NCache.OpenSource.SDK/).</span><span class="sxs-lookup"><span data-stu-id="2baea-169">Install [NCache open source NuGet](https://www.nuget.org/packages/Alachisoft.NCache.OpenSource.SDK/).</span></span>
1. <span data-ttu-id="2baea-170">Configure el clúster de caché en [Client. ncconf](https://www.alachisoft.com/resources/docs/ncache-oss/admin-guide/client-config.html).</span><span class="sxs-lookup"><span data-stu-id="2baea-170">Configure the cache cluster in [client.ncconf](https://www.alachisoft.com/resources/docs/ncache-oss/admin-guide/client-config.html).</span></span>
1. <span data-ttu-id="2baea-171">Agregue el siguiente código a `Startup.ConfigureServices`:</span><span class="sxs-lookup"><span data-stu-id="2baea-171">Add the following code to `Startup.ConfigureServices`:</span></span>

   ```csharp
   services.AddNCacheDistributedCache(configuration =>    
   {        
       configuration.CacheName = "demoClusteredCache";
       configuration.EnableLogs = true;
       configuration.ExceptionsEnabled = true;
   });
   ```

## <a name="use-the-distributed-cache"></a><span data-ttu-id="2baea-172">Usar la memoria caché distribuida</span><span class="sxs-lookup"><span data-stu-id="2baea-172">Use the distributed cache</span></span>

<span data-ttu-id="2baea-173">Para usar la interfaz <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache>, solicite una instancia de <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache> de cualquier constructor de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="2baea-173">To use the <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache> interface, request an instance of <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache> from any constructor in the app.</span></span> <span data-ttu-id="2baea-174">La instancia se proporciona mediante la [inserción de dependencias (di)](xref:fundamentals/dependency-injection).</span><span class="sxs-lookup"><span data-stu-id="2baea-174">The instance is provided by [dependency injection (DI)](xref:fundamentals/dependency-injection).</span></span>

<span data-ttu-id="2baea-175">Cuando se inicia la aplicación de ejemplo, <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache> se inserta en `Startup.Configure`.</span><span class="sxs-lookup"><span data-stu-id="2baea-175">When the sample app starts, <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache> is injected into `Startup.Configure`.</span></span> <span data-ttu-id="2baea-176">La hora actual se almacena en la memoria caché mediante <xref:Microsoft.Extensions.Hosting.IHostApplicationLifetime> (para obtener más información, consulte [host genérico: IHostApplicationLifetime](xref:fundamentals/host/generic-host#ihostapplicationlifetime)):</span><span class="sxs-lookup"><span data-stu-id="2baea-176">The current time is cached using <xref:Microsoft.Extensions.Hosting.IHostApplicationLifetime> (for more information, see [Generic Host: IHostApplicationLifetime](xref:fundamentals/host/generic-host#ihostapplicationlifetime)):</span></span>

[!code-csharp[](distributed/samples/3.x/DistCacheSample/Startup.cs?name=snippet_Configure&highlight=10)]

<span data-ttu-id="2baea-177">La aplicación de ejemplo inserta <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache> en el `IndexModel` para que lo use la página de índice.</span><span class="sxs-lookup"><span data-stu-id="2baea-177">The sample app injects <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache> into the `IndexModel` for use by the Index page.</span></span>

<span data-ttu-id="2baea-178">Cada vez que se carga la página de índice, se comprueba la hora almacenada en la memoria caché en `OnGetAsync`.</span><span class="sxs-lookup"><span data-stu-id="2baea-178">Each time the Index page is loaded, the cache is checked for the cached time in `OnGetAsync`.</span></span> <span data-ttu-id="2baea-179">Si la hora almacenada en caché no ha expirado, se muestra la hora.</span><span class="sxs-lookup"><span data-stu-id="2baea-179">If the cached time hasn't expired, the time is displayed.</span></span> <span data-ttu-id="2baea-180">Si han transcurrido 20 segundos desde la última vez que se tuvo acceso a la hora almacenada en caché (la última vez que se cargó esta página), la página muestra la *fecha de expiración de la memoria caché*.</span><span class="sxs-lookup"><span data-stu-id="2baea-180">If 20 seconds have elapsed since the last time the cached time was accessed (the last time this page was loaded), the page displays *Cached Time Expired*.</span></span>

<span data-ttu-id="2baea-181">Actualice inmediatamente la hora almacenada en caché a la hora actual; para ello, seleccione el botón **restablecer hora de almacenamiento en caché** .</span><span class="sxs-lookup"><span data-stu-id="2baea-181">Immediately update the cached time to the current time by selecting the **Reset Cached Time** button.</span></span> <span data-ttu-id="2baea-182">El botón desencadena el método de control de `OnPostResetCachedTime`.</span><span class="sxs-lookup"><span data-stu-id="2baea-182">The button triggers the `OnPostResetCachedTime` handler method.</span></span>

[!code-csharp[](distributed/samples/3.x/DistCacheSample/Pages/Index.cshtml.cs?name=snippet_IndexModel&highlight=7,14-20,25-29)]

> [!NOTE]
> <span data-ttu-id="2baea-183">No es necesario usar un singleton o una duración de ámbito para las instancias de <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache> (al menos para las implementaciones integradas).</span><span class="sxs-lookup"><span data-stu-id="2baea-183">There's no need to use a Singleton or Scoped lifetime for <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache> instances (at least for the built-in implementations).</span></span>
>
> <span data-ttu-id="2baea-184">También puede crear una instancia de <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache> siempre que necesite una en lugar de usar DI, pero la creación de una instancia de en el código puede hacer que el código sea más difícil de probar e infringe el [principio de dependencias explícitas](/dotnet/standard/modern-web-apps-azure-architecture/architectural-principles#explicit-dependencies).</span><span class="sxs-lookup"><span data-stu-id="2baea-184">You can also create an <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache> instance wherever you might need one instead of using DI, but creating an instance in code can make your code harder to test and violates the [Explicit Dependencies Principle](/dotnet/standard/modern-web-apps-azure-architecture/architectural-principles#explicit-dependencies).</span></span>

## <a name="recommendations"></a><span data-ttu-id="2baea-185">Recomendaciones</span><span class="sxs-lookup"><span data-stu-id="2baea-185">Recommendations</span></span>

<span data-ttu-id="2baea-186">A la hora de decidir qué implementación de <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache> es la más adecuada para su aplicación, tenga en cuenta lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="2baea-186">When deciding which implementation of <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache> is best for your app, consider the following:</span></span>

* <span data-ttu-id="2baea-187">Infraestructura existente</span><span class="sxs-lookup"><span data-stu-id="2baea-187">Existing infrastructure</span></span>
* <span data-ttu-id="2baea-188">Requisitos de rendimiento</span><span class="sxs-lookup"><span data-stu-id="2baea-188">Performance requirements</span></span>
* <span data-ttu-id="2baea-189">Coste</span><span class="sxs-lookup"><span data-stu-id="2baea-189">Cost</span></span>
* <span data-ttu-id="2baea-190">Experiencia del equipo</span><span class="sxs-lookup"><span data-stu-id="2baea-190">Team experience</span></span>

<span data-ttu-id="2baea-191">Las soluciones de almacenamiento en caché suelen basarse en el almacenamiento en memoria para proporcionar una recuperación rápida de los datos almacenados en memoria caché, pero la memoria es un recurso limitado y se amplía de forma costosa.</span><span class="sxs-lookup"><span data-stu-id="2baea-191">Caching solutions usually rely on in-memory storage to provide fast retrieval of cached data, but memory is a limited resource and costly to expand.</span></span> <span data-ttu-id="2baea-192">Almacene solo los datos usados habitualmente en una memoria caché.</span><span class="sxs-lookup"><span data-stu-id="2baea-192">Only store commonly used data in a cache.</span></span>

<span data-ttu-id="2baea-193">Por lo general, una caché en Redis proporciona un mayor rendimiento y una menor latencia que una memoria caché de SQL Server.</span><span class="sxs-lookup"><span data-stu-id="2baea-193">Generally, a Redis cache provides higher throughput and lower latency than a SQL Server cache.</span></span> <span data-ttu-id="2baea-194">Sin embargo, normalmente es necesario realizar pruebas comparativas para determinar las características de rendimiento de las estrategias de almacenamiento en caché.</span><span class="sxs-lookup"><span data-stu-id="2baea-194">However, benchmarking is usually required to determine the performance characteristics of caching strategies.</span></span>

<span data-ttu-id="2baea-195">Cuando SQL Server se usa como un almacén de respaldo de caché distribuida, el uso de la misma base de datos para la memoria caché y el almacenamiento y la recuperación de datos normales de la aplicación puede afectar negativamente al rendimiento de ambos.</span><span class="sxs-lookup"><span data-stu-id="2baea-195">When SQL Server is used as a distributed cache backing store, use of the same database for the cache and the app's ordinary data storage and retrieval can negatively impact the performance of both.</span></span> <span data-ttu-id="2baea-196">Se recomienda usar una instancia de SQL Server dedicada para el almacén de respaldo de caché distribuida.</span><span class="sxs-lookup"><span data-stu-id="2baea-196">We recommend using a dedicated SQL Server instance for the distributed cache backing store.</span></span>

## <a name="additional-resources"></a><span data-ttu-id="2baea-197">Recursos adicionales</span><span class="sxs-lookup"><span data-stu-id="2baea-197">Additional resources</span></span>

* [<span data-ttu-id="2baea-198">Redis Cache en Azure</span><span class="sxs-lookup"><span data-stu-id="2baea-198">Redis Cache on Azure</span></span>](/azure/azure-cache-for-redis/)
* [<span data-ttu-id="2baea-199">SQL Database en Azure</span><span class="sxs-lookup"><span data-stu-id="2baea-199">SQL Database on Azure</span></span>](/azure/sql-database/)
* <span data-ttu-id="2baea-200">[ASP.net Core del proveedor de IDistributedCache para NCache en granjas de servidores web](http://www.alachisoft.com/ncache/aspnet-core-idistributedcache-ncache.html) ([NCache en github](https://github.com/Alachisoft/NCache))</span><span class="sxs-lookup"><span data-stu-id="2baea-200">[ASP.NET Core IDistributedCache Provider for NCache in Web Farms](http://www.alachisoft.com/ncache/aspnet-core-idistributedcache-ncache.html) ([NCache on GitHub](https://github.com/Alachisoft/NCache))</span></span>
* <xref:performance/caching/memory>
* <xref:fundamentals/change-tokens>
* <xref:performance/caching/response>
* <xref:performance/caching/middleware>
* <xref:mvc/views/tag-helpers/builtin-th/cache-tag-helper>
* <xref:mvc/views/tag-helpers/builtin-th/distributed-cache-tag-helper>
* <xref:host-and-deploy/web-farm>

::: moniker-end

::: moniker range="= aspnetcore-2.2"

<span data-ttu-id="2baea-201">Una caché distribuida es una memoria caché compartida por varios servidores de aplicaciones, que normalmente se mantiene como un servicio externo a los servidores de aplicaciones que tienen acceso a ella.</span><span class="sxs-lookup"><span data-stu-id="2baea-201">A distributed cache is a cache shared by multiple app servers, typically maintained as an external service to the app servers that access it.</span></span> <span data-ttu-id="2baea-202">Una caché distribuida puede mejorar el rendimiento y la escalabilidad de una aplicación ASP.NET Core, especialmente cuando la aplicación está hospedada en un servicio en la nube o en una granja de servidores.</span><span class="sxs-lookup"><span data-stu-id="2baea-202">A distributed cache can improve the performance and scalability of an ASP.NET Core app, especially when the app is hosted by a cloud service or a server farm.</span></span>

<span data-ttu-id="2baea-203">Una caché distribuida tiene varias ventajas con respecto a otros escenarios de almacenamiento en caché en los que los datos almacenados en caché se almacenan en servidores de aplicaciones individuales.</span><span class="sxs-lookup"><span data-stu-id="2baea-203">A distributed cache has several advantages over other caching scenarios where cached data is stored on individual app servers.</span></span>

<span data-ttu-id="2baea-204">Cuando se distribuyen los datos almacenados en caché, los datos:</span><span class="sxs-lookup"><span data-stu-id="2baea-204">When cached data is distributed, the data:</span></span>

* <span data-ttu-id="2baea-205">Es *coherente (coherente)* entre las solicitudes a varios servidores.</span><span class="sxs-lookup"><span data-stu-id="2baea-205">Is *coherent* (consistent) across requests to multiple servers.</span></span>
* <span data-ttu-id="2baea-206">Sobrevive los reinicios del servidor y las implementaciones de aplicaciones.</span><span class="sxs-lookup"><span data-stu-id="2baea-206">Survives server restarts and app deployments.</span></span>
* <span data-ttu-id="2baea-207">No usa la memoria local.</span><span class="sxs-lookup"><span data-stu-id="2baea-207">Doesn't use local memory.</span></span>

<span data-ttu-id="2baea-208">La configuración de caché distribuida es específica de la implementación.</span><span class="sxs-lookup"><span data-stu-id="2baea-208">Distributed cache configuration is implementation specific.</span></span> <span data-ttu-id="2baea-209">En este artículo se describe cómo configurar SQL Server y las cachés distribuidas de Redis.</span><span class="sxs-lookup"><span data-stu-id="2baea-209">This article describes how to configure SQL Server and Redis distributed caches.</span></span> <span data-ttu-id="2baea-210">También hay implementaciones de terceros disponibles, como [NCache](http://www.alachisoft.com/ncache/aspnet-core-idistributedcache-ncache.html) ([NCache en github](https://github.com/Alachisoft/NCache)).</span><span class="sxs-lookup"><span data-stu-id="2baea-210">Third party implementations are also available, such as [NCache](http://www.alachisoft.com/ncache/aspnet-core-idistributedcache-ncache.html) ([NCache on GitHub](https://github.com/Alachisoft/NCache)).</span></span> <span data-ttu-id="2baea-211">Independientemente de la implementación que se seleccione, la aplicación interactúa con la memoria caché mediante la interfaz <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache>.</span><span class="sxs-lookup"><span data-stu-id="2baea-211">Regardless of which implementation is selected, the app interacts with the cache using the <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache> interface.</span></span>

<span data-ttu-id="2baea-212">[Vea o descargue el código de ejemplo](https://github.com/dotnet/AspNetCore.Docs/tree/master/aspnetcore/performance/caching/distributed/samples/) ([cómo descargarlo](xref:index#how-to-download-a-sample))</span><span class="sxs-lookup"><span data-stu-id="2baea-212">[View or download sample code](https://github.com/dotnet/AspNetCore.Docs/tree/master/aspnetcore/performance/caching/distributed/samples/) ([how to download](xref:index#how-to-download-a-sample))</span></span>

## <a name="prerequisites"></a><span data-ttu-id="2baea-213">Prerequisites</span><span class="sxs-lookup"><span data-stu-id="2baea-213">Prerequisites</span></span>

<span data-ttu-id="2baea-214">Para usar una SQL Server caché distribuida, haga referencia al [metapaquete Microsoft. AspNetCore. app](xref:fundamentals/metapackage-app) o agregue una referencia de paquete al paquete [Microsoft. Extensions. Caching. SqlServer](https://www.nuget.org/packages/Microsoft.Extensions.Caching.SqlServer) .</span><span class="sxs-lookup"><span data-stu-id="2baea-214">To use a SQL Server distributed cache, reference the [Microsoft.AspNetCore.App metapackage](xref:fundamentals/metapackage-app) or add a package reference to the [Microsoft.Extensions.Caching.SqlServer](https://www.nuget.org/packages/Microsoft.Extensions.Caching.SqlServer) package.</span></span>

<span data-ttu-id="2baea-215">Para usar una caché distribuida de Redis, haga referencia al [metapaquete Microsoft. AspNetCore. app](xref:fundamentals/metapackage-app) y agregue una referencia de paquete al paquete [Microsoft. Extensions. Caching. StackExchangeRedis](https://www.nuget.org/packages/Microsoft.Extensions.Caching.StackExchangeRedis) .</span><span class="sxs-lookup"><span data-stu-id="2baea-215">To use a Redis distributed cache, reference the [Microsoft.AspNetCore.App metapackage](xref:fundamentals/metapackage-app) and add a package reference to the [Microsoft.Extensions.Caching.StackExchangeRedis](https://www.nuget.org/packages/Microsoft.Extensions.Caching.StackExchangeRedis) package.</span></span> <span data-ttu-id="2baea-216">El paquete de Redis no está incluido en el paquete de `Microsoft.AspNetCore.App`, por lo que debe hacer referencia al paquete de Redis por separado en el archivo de proyecto.</span><span class="sxs-lookup"><span data-stu-id="2baea-216">The Redis package isn't included in the `Microsoft.AspNetCore.App` package, so you must reference the Redis package separately in your project file.</span></span>

<span data-ttu-id="2baea-217">Para usar caché distribuida de NCache, haga referencia al [metapaquete Microsoft. AspNetCore. app](xref:fundamentals/metapackage-app) y agregue una referencia de paquete al paquete [NCache. Microsoft. Extensions. Caching. código abierto](https://www.nuget.org/packages/NCache.Microsoft.Extensions.Caching.OpenSource) .</span><span class="sxs-lookup"><span data-stu-id="2baea-217">To use NCache distributed cache, reference the [Microsoft.AspNetCore.App metapackage](xref:fundamentals/metapackage-app) and add a package reference to the [NCache.Microsoft.Extensions.Caching.OpenSource](https://www.nuget.org/packages/NCache.Microsoft.Extensions.Caching.OpenSource) package.</span></span> <span data-ttu-id="2baea-218">El paquete de NCache no está incluido en el paquete de `Microsoft.AspNetCore.App`, por lo que debe hacer referencia al paquete de NCache por separado en el archivo de proyecto.</span><span class="sxs-lookup"><span data-stu-id="2baea-218">The NCache package isn't included in the `Microsoft.AspNetCore.App` package, so you must reference the NCache package separately in your project file.</span></span>

## <a name="idistributedcache-interface"></a><span data-ttu-id="2baea-219">Interfaz IDistributedCache</span><span class="sxs-lookup"><span data-stu-id="2baea-219">IDistributedCache interface</span></span>

<span data-ttu-id="2baea-220">La interfaz de <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache> proporciona los métodos siguientes para manipular los elementos de la implementación de caché distribuida:</span><span class="sxs-lookup"><span data-stu-id="2baea-220">The <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache> interface provides the following methods to manipulate items in the distributed cache implementation:</span></span>

* <span data-ttu-id="2baea-221"><xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache.Get*>, <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache.GetAsync*> &ndash; acepta una clave de cadena y recupera un elemento almacenado en caché como una matriz de `byte[]` si se encuentra en la memoria caché.</span><span class="sxs-lookup"><span data-stu-id="2baea-221"><xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache.Get*>, <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache.GetAsync*> &ndash; Accepts a string key and retrieves a cached item as a `byte[]` array if found in the cache.</span></span>
* <span data-ttu-id="2baea-222"><xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache.Set*>, <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache.SetAsync*> &ndash; agrega un elemento (como `byte[]` matriz) a la memoria caché utilizando una clave de cadena.</span><span class="sxs-lookup"><span data-stu-id="2baea-222"><xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache.Set*>, <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache.SetAsync*> &ndash; Adds an item (as `byte[]` array) to the cache using a string key.</span></span>
* <span data-ttu-id="2baea-223"><xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache.Refresh*>, <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache.RefreshAsync*> &ndash; actualiza un elemento en la memoria caché en función de su clave, restableciendo el tiempo de espera de expiración variable (si existe).</span><span class="sxs-lookup"><span data-stu-id="2baea-223"><xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache.Refresh*>, <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache.RefreshAsync*> &ndash; Refreshes an item in the cache based on its key, resetting its sliding expiration timeout (if any).</span></span>
* <span data-ttu-id="2baea-224"><xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache.Remove*>, <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache.RemoveAsync*> &ndash; quita un elemento de la memoria caché en función de su clave de cadena.</span><span class="sxs-lookup"><span data-stu-id="2baea-224"><xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache.Remove*>, <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache.RemoveAsync*> &ndash; Removes a cache item based on its string key.</span></span>

## <a name="establish-distributed-caching-services"></a><span data-ttu-id="2baea-225">Establecer servicios de almacenamiento en caché distribuidos</span><span class="sxs-lookup"><span data-stu-id="2baea-225">Establish distributed caching services</span></span>

<span data-ttu-id="2baea-226">Registre una implementación de <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache> en `Startup.ConfigureServices`.</span><span class="sxs-lookup"><span data-stu-id="2baea-226">Register an implementation of <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache> in `Startup.ConfigureServices`.</span></span> <span data-ttu-id="2baea-227">Las implementaciones proporcionadas por el marco de trabajo que se describen en este tema incluyen:</span><span class="sxs-lookup"><span data-stu-id="2baea-227">Framework-provided implementations described in this topic include:</span></span>

* [<span data-ttu-id="2baea-228">Caché de memoria distribuida</span><span class="sxs-lookup"><span data-stu-id="2baea-228">Distributed Memory Cache</span></span>](#distributed-memory-cache)
* [<span data-ttu-id="2baea-229">Caché de SQL Server distribuida</span><span class="sxs-lookup"><span data-stu-id="2baea-229">Distributed SQL Server cache</span></span>](#distributed-sql-server-cache)
* [<span data-ttu-id="2baea-230">Caché en Redis distribuida</span><span class="sxs-lookup"><span data-stu-id="2baea-230">Distributed Redis cache</span></span>](#distributed-redis-cache)
* [<span data-ttu-id="2baea-231">Caché de NCache distribuida</span><span class="sxs-lookup"><span data-stu-id="2baea-231">Distributed NCache cache</span></span>](#distributed-ncache-cache)

### <a name="distributed-memory-cache"></a><span data-ttu-id="2baea-232">Caché de memoria distribuida</span><span class="sxs-lookup"><span data-stu-id="2baea-232">Distributed Memory Cache</span></span>

<span data-ttu-id="2baea-233">La memoria caché de memoria distribuida (<xref:Microsoft.Extensions.DependencyInjection.MemoryCacheServiceCollectionExtensions.AddDistributedMemoryCache*>) es una implementación proporcionada por el marco de <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache> que almacena elementos en la memoria.</span><span class="sxs-lookup"><span data-stu-id="2baea-233">The Distributed Memory Cache (<xref:Microsoft.Extensions.DependencyInjection.MemoryCacheServiceCollectionExtensions.AddDistributedMemoryCache*>) is a framework-provided implementation of <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache> that stores items in memory.</span></span> <span data-ttu-id="2baea-234">La caché de memoria distribuida no es una caché distribuida real.</span><span class="sxs-lookup"><span data-stu-id="2baea-234">The Distributed Memory Cache isn't an actual distributed cache.</span></span> <span data-ttu-id="2baea-235">Los elementos almacenados en caché se almacenan en la instancia de la aplicación en el servidor donde se ejecuta la aplicación.</span><span class="sxs-lookup"><span data-stu-id="2baea-235">Cached items are stored by the app instance on the server where the app is running.</span></span>

<span data-ttu-id="2baea-236">La caché de memoria distribuida es una implementación útil:</span><span class="sxs-lookup"><span data-stu-id="2baea-236">The Distributed Memory Cache is a useful implementation:</span></span>

* <span data-ttu-id="2baea-237">En escenarios de desarrollo y pruebas.</span><span class="sxs-lookup"><span data-stu-id="2baea-237">In development and testing scenarios.</span></span>
* <span data-ttu-id="2baea-238">Cuando se usa un solo servidor en producción y el consumo de memoria no es un problema.</span><span class="sxs-lookup"><span data-stu-id="2baea-238">When a single server is used in production and memory consumption isn't an issue.</span></span> <span data-ttu-id="2baea-239">La implementación de la caché de memoria distribuida abstrae el almacenamiento de datos en caché.</span><span class="sxs-lookup"><span data-stu-id="2baea-239">Implementing the Distributed Memory Cache abstracts cached data storage.</span></span> <span data-ttu-id="2baea-240">Permite implementar una solución de almacenamiento en caché distribuida verdadera en el futuro si se necesitan varios nodos o tolerancia a errores.</span><span class="sxs-lookup"><span data-stu-id="2baea-240">It allows for implementing a true distributed caching solution in the future if multiple nodes or fault tolerance become necessary.</span></span>

<span data-ttu-id="2baea-241">La aplicación de ejemplo hace uso de la caché de memoria distribuida cuando la aplicación se ejecuta en el entorno de desarrollo en `Startup.ConfigureServices`:</span><span class="sxs-lookup"><span data-stu-id="2baea-241">The sample app makes use of the Distributed Memory Cache when the app is run in the Development environment in `Startup.ConfigureServices`:</span></span>

[!code-csharp[](distributed/samples/2.x/DistCacheSample/Startup.cs?name=snippet_AddDistributedMemoryCache)]

### <a name="distributed-sql-server-cache"></a><span data-ttu-id="2baea-242">Caché de SQL Server distribuida</span><span class="sxs-lookup"><span data-stu-id="2baea-242">Distributed SQL Server Cache</span></span>

<span data-ttu-id="2baea-243">La implementación de la memoria caché de SQL Server distribuida (<xref:Microsoft.Extensions.DependencyInjection.SqlServerCachingServicesExtensions.AddDistributedSqlServerCache*>) permite que la memoria caché distribuida use una base de datos de SQL Server como su memoria auxiliar.</span><span class="sxs-lookup"><span data-stu-id="2baea-243">The Distributed SQL Server Cache implementation (<xref:Microsoft.Extensions.DependencyInjection.SqlServerCachingServicesExtensions.AddDistributedSqlServerCache*>) allows the distributed cache to use a SQL Server database as its backing store.</span></span> <span data-ttu-id="2baea-244">Para crear una SQL Server tabla de elementos almacenados en caché en una instancia de SQL Server, puede usar la herramienta `sql-cache`.</span><span class="sxs-lookup"><span data-stu-id="2baea-244">To create a SQL Server cached item table in a SQL Server instance, you can use the `sql-cache` tool.</span></span> <span data-ttu-id="2baea-245">La herramienta crea una tabla con el nombre y el esquema que especifique.</span><span class="sxs-lookup"><span data-stu-id="2baea-245">The tool creates a table with the name and schema that you specify.</span></span>

<span data-ttu-id="2baea-246">Cree una tabla en SQL Server ejecutando el comando `sql-cache create`.</span><span class="sxs-lookup"><span data-stu-id="2baea-246">Create a table in SQL Server by running the `sql-cache create` command.</span></span> <span data-ttu-id="2baea-247">Proporcione la instancia de SQL Server (`Data Source`), la base de datos (`Initial Catalog`), el esquema (por ejemplo, `dbo`) y el nombre de la tabla (por ejemplo, `TestCache`):</span><span class="sxs-lookup"><span data-stu-id="2baea-247">Provide the SQL Server instance (`Data Source`), database (`Initial Catalog`), schema (for example, `dbo`), and table name (for example, `TestCache`):</span></span>

```dotnetcli
dotnet sql-cache create "Data Source=(localdb)\MSSQLLocalDB;Initial Catalog=DistCache;Integrated Security=True;" dbo TestCache
```

<span data-ttu-id="2baea-248">Se registra un mensaje para indicar que la herramienta se ha realizado correctamente:</span><span class="sxs-lookup"><span data-stu-id="2baea-248">A message is logged to indicate that the tool was successful:</span></span>

```console
Table and index were created successfully.
```

<span data-ttu-id="2baea-249">La tabla creada por la herramienta `sql-cache` tiene el siguiente esquema:</span><span class="sxs-lookup"><span data-stu-id="2baea-249">The table created by the `sql-cache` tool has the following schema:</span></span>

![Tabla de caché SqlServer](distributed/_static/SqlServerCacheTable.png)

> [!NOTE]
> <span data-ttu-id="2baea-251">Una aplicación debe manipular los valores de la memoria caché mediante una instancia de <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache>, no una <xref:Microsoft.Extensions.Caching.SqlServer.SqlServerCache>.</span><span class="sxs-lookup"><span data-stu-id="2baea-251">An app should manipulate cache values using an instance of <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache>, not a <xref:Microsoft.Extensions.Caching.SqlServer.SqlServerCache>.</span></span>

<span data-ttu-id="2baea-252">La aplicación de ejemplo implementa <xref:Microsoft.Extensions.Caching.SqlServer.SqlServerCache> en un entorno que no es de desarrollo en `Startup.ConfigureServices`:</span><span class="sxs-lookup"><span data-stu-id="2baea-252">The sample app implements <xref:Microsoft.Extensions.Caching.SqlServer.SqlServerCache> in a non-Development environment in `Startup.ConfigureServices`:</span></span>

[!code-csharp[](distributed/samples/2.x/DistCacheSample/Startup.cs?name=snippet_AddDistributedSqlServerCache)]

> [!NOTE]
> <span data-ttu-id="2baea-253">Un <xref:Microsoft.Extensions.Caching.SqlServer.SqlServerCacheOptions.ConnectionString*> (y, opcionalmente, <xref:Microsoft.Extensions.Caching.SqlServer.SqlServerCacheOptions.SchemaName*> y <xref:Microsoft.Extensions.Caching.SqlServer.SqlServerCacheOptions.TableName*>) se almacena normalmente fuera del control de código fuente (por ejemplo, lo almacena el [Administrador secreto](xref:security/app-secrets) o en *appsettings. JSON*/*appSettings. { ENVIRONMENT}. JSON* files).</span><span class="sxs-lookup"><span data-stu-id="2baea-253">A <xref:Microsoft.Extensions.Caching.SqlServer.SqlServerCacheOptions.ConnectionString*> (and optionally, <xref:Microsoft.Extensions.Caching.SqlServer.SqlServerCacheOptions.SchemaName*> and <xref:Microsoft.Extensions.Caching.SqlServer.SqlServerCacheOptions.TableName*>) are typically stored outside of source control (for example, stored by the [Secret Manager](xref:security/app-secrets) or in *appsettings.json*/*appsettings.{ENVIRONMENT}.json* files).</span></span> <span data-ttu-id="2baea-254">La cadena de conexión puede contener credenciales que deben mantenerse fuera de los sistemas de control de código fuente.</span><span class="sxs-lookup"><span data-stu-id="2baea-254">The connection string may contain credentials that should be kept out of source control systems.</span></span>

### <a name="distributed-redis-cache"></a><span data-ttu-id="2baea-255">Redis Cache distribuido</span><span class="sxs-lookup"><span data-stu-id="2baea-255">Distributed Redis Cache</span></span>

<span data-ttu-id="2baea-256">[Redis](https://redis.io/) es un almacén de datos en memoria de código abierto, que a menudo se usa como caché distribuida.</span><span class="sxs-lookup"><span data-stu-id="2baea-256">[Redis](https://redis.io/) is an open source in-memory data store, which is often used as a distributed cache.</span></span> <span data-ttu-id="2baea-257">Puede usar Redis localmente, y puede configurar un [Azure Redis cache](https://azure.microsoft.com/services/cache/) para una aplicación de ASP.net Core hospedada en Azure.</span><span class="sxs-lookup"><span data-stu-id="2baea-257">You can use Redis locally, and you can configure an [Azure Redis Cache](https://azure.microsoft.com/services/cache/) for an Azure-hosted ASP.NET Core app.</span></span>

<span data-ttu-id="2baea-258">Una aplicación configura la implementación de la memoria caché con una instancia de <xref:Microsoft.Extensions.Caching.StackExchangeRedis.RedisCache> (<xref:Microsoft.Extensions.DependencyInjection.StackExchangeRedisCacheServiceCollectionExtensions.AddStackExchangeRedisCache*>) en un entorno que no es de desarrollo en `Startup.ConfigureServices`:</span><span class="sxs-lookup"><span data-stu-id="2baea-258">An app configures the cache implementation using a <xref:Microsoft.Extensions.Caching.StackExchangeRedis.RedisCache> instance (<xref:Microsoft.Extensions.DependencyInjection.StackExchangeRedisCacheServiceCollectionExtensions.AddStackExchangeRedisCache*>) in a non-Development environment in `Startup.ConfigureServices`:</span></span>

[!code-csharp[](distributed/samples/2.x/DistCacheSample/Startup.cs?name=snippet_AddStackExchangeRedisCache)]

<span data-ttu-id="2baea-259">Para instalar Redis en el equipo local:</span><span class="sxs-lookup"><span data-stu-id="2baea-259">To install Redis on your local machine:</span></span>

1. <span data-ttu-id="2baea-260">Instale el [paquete chocolatey Redis](https://chocolatey.org/packages/redis-64/).</span><span class="sxs-lookup"><span data-stu-id="2baea-260">Install the [Chocolatey Redis package](https://chocolatey.org/packages/redis-64/).</span></span>
1. <span data-ttu-id="2baea-261">Ejecute `redis-server` desde un símbolo del sistema.</span><span class="sxs-lookup"><span data-stu-id="2baea-261">Run `redis-server` from a command prompt.</span></span>

### <a name="distributed-ncache-cache"></a><span data-ttu-id="2baea-262">Caché de NCache distribuida</span><span class="sxs-lookup"><span data-stu-id="2baea-262">Distributed NCache Cache</span></span>

<span data-ttu-id="2baea-263">[NCache](https://github.com/Alachisoft/NCache) es una caché distribuida en memoria de código abierto desarrollada de forma nativa en .NET y .net Core.</span><span class="sxs-lookup"><span data-stu-id="2baea-263">[NCache](https://github.com/Alachisoft/NCache) is an open source in-memory distributed cache developed natively in .NET and .NET Core.</span></span> <span data-ttu-id="2baea-264">NCache funciona localmente y se configura como un clúster de caché distribuida para una aplicación ASP.NET Core que se ejecuta en Azure o en otras plataformas de hospedaje.</span><span class="sxs-lookup"><span data-stu-id="2baea-264">NCache works both locally and configured as a distributed cache cluster for an ASP.NET Core app running in Azure or on other hosting platforms.</span></span>

<span data-ttu-id="2baea-265">Para instalar y configurar NCache en el equipo local, consulte [Guía de introducción de NCache para Windows](https://www.alachisoft.com/resources/docs/ncache-oss/getting-started-guide-windows/).</span><span class="sxs-lookup"><span data-stu-id="2baea-265">To install and configure NCache on your local machine, see [NCache Getting Started Guide for Windows](https://www.alachisoft.com/resources/docs/ncache-oss/getting-started-guide-windows/).</span></span>

<span data-ttu-id="2baea-266">Para configurar NCache:</span><span class="sxs-lookup"><span data-stu-id="2baea-266">To configure NCache:</span></span>

1. <span data-ttu-id="2baea-267">Instalación de [NuGet de código abierto de NCache](https://www.nuget.org/packages/Alachisoft.NCache.OpenSource.SDK/).</span><span class="sxs-lookup"><span data-stu-id="2baea-267">Install [NCache open source NuGet](https://www.nuget.org/packages/Alachisoft.NCache.OpenSource.SDK/).</span></span>
1. <span data-ttu-id="2baea-268">Configure el clúster de caché en [Client. ncconf](https://www.alachisoft.com/resources/docs/ncache-oss/admin-guide/client-config.html).</span><span class="sxs-lookup"><span data-stu-id="2baea-268">Configure the cache cluster in [client.ncconf](https://www.alachisoft.com/resources/docs/ncache-oss/admin-guide/client-config.html).</span></span>
1. <span data-ttu-id="2baea-269">Agregue el siguiente código a `Startup.ConfigureServices`:</span><span class="sxs-lookup"><span data-stu-id="2baea-269">Add the following code to `Startup.ConfigureServices`:</span></span>

   ```csharp
   services.AddNCacheDistributedCache(configuration =>    
   {        
       configuration.CacheName = "demoClusteredCache";
       configuration.EnableLogs = true;
       configuration.ExceptionsEnabled = true;
   });
   ```

## <a name="use-the-distributed-cache"></a><span data-ttu-id="2baea-270">Usar la memoria caché distribuida</span><span class="sxs-lookup"><span data-stu-id="2baea-270">Use the distributed cache</span></span>

<span data-ttu-id="2baea-271">Para usar la interfaz <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache>, solicite una instancia de <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache> de cualquier constructor de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="2baea-271">To use the <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache> interface, request an instance of <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache> from any constructor in the app.</span></span> <span data-ttu-id="2baea-272">La instancia se proporciona mediante la [inserción de dependencias (di)](xref:fundamentals/dependency-injection).</span><span class="sxs-lookup"><span data-stu-id="2baea-272">The instance is provided by [dependency injection (DI)](xref:fundamentals/dependency-injection).</span></span>

<span data-ttu-id="2baea-273">Cuando se inicia la aplicación de ejemplo, <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache> se inserta en `Startup.Configure`.</span><span class="sxs-lookup"><span data-stu-id="2baea-273">When the sample app starts, <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache> is injected into `Startup.Configure`.</span></span> <span data-ttu-id="2baea-274">La hora actual se almacena en la memoria caché mediante <xref:Microsoft.AspNetCore.Hosting.IApplicationLifetime> (para obtener más información, vea [host de Web: interfaz IApplicationLifetime](xref:fundamentals/host/web-host#iapplicationlifetime-interface)):</span><span class="sxs-lookup"><span data-stu-id="2baea-274">The current time is cached using <xref:Microsoft.AspNetCore.Hosting.IApplicationLifetime> (for more information, see [Web Host: IApplicationLifetime interface](xref:fundamentals/host/web-host#iapplicationlifetime-interface)):</span></span>

[!code-csharp[](distributed/samples/2.x/DistCacheSample/Startup.cs?name=snippet_Configure&highlight=10)]

<span data-ttu-id="2baea-275">La aplicación de ejemplo inserta <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache> en el `IndexModel` para que lo use la página de índice.</span><span class="sxs-lookup"><span data-stu-id="2baea-275">The sample app injects <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache> into the `IndexModel` for use by the Index page.</span></span>

<span data-ttu-id="2baea-276">Cada vez que se carga la página de índice, se comprueba la hora almacenada en la memoria caché en `OnGetAsync`.</span><span class="sxs-lookup"><span data-stu-id="2baea-276">Each time the Index page is loaded, the cache is checked for the cached time in `OnGetAsync`.</span></span> <span data-ttu-id="2baea-277">Si la hora almacenada en caché no ha expirado, se muestra la hora.</span><span class="sxs-lookup"><span data-stu-id="2baea-277">If the cached time hasn't expired, the time is displayed.</span></span> <span data-ttu-id="2baea-278">Si han transcurrido 20 segundos desde la última vez que se tuvo acceso a la hora almacenada en caché (la última vez que se cargó esta página), la página muestra la *fecha de expiración de la memoria caché*.</span><span class="sxs-lookup"><span data-stu-id="2baea-278">If 20 seconds have elapsed since the last time the cached time was accessed (the last time this page was loaded), the page displays *Cached Time Expired*.</span></span>

<span data-ttu-id="2baea-279">Actualice inmediatamente la hora almacenada en caché a la hora actual; para ello, seleccione el botón **restablecer hora de almacenamiento en caché** .</span><span class="sxs-lookup"><span data-stu-id="2baea-279">Immediately update the cached time to the current time by selecting the **Reset Cached Time** button.</span></span> <span data-ttu-id="2baea-280">El botón desencadena el método de control de `OnPostResetCachedTime`.</span><span class="sxs-lookup"><span data-stu-id="2baea-280">The button triggers the `OnPostResetCachedTime` handler method.</span></span>

[!code-csharp[](distributed/samples/2.x/DistCacheSample/Pages/Index.cshtml.cs?name=snippet_IndexModel&highlight=7,14-20,25-29)]

> [!NOTE]
> <span data-ttu-id="2baea-281">No es necesario usar un singleton o una duración de ámbito para las instancias de <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache> (al menos para las implementaciones integradas).</span><span class="sxs-lookup"><span data-stu-id="2baea-281">There's no need to use a Singleton or Scoped lifetime for <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache> instances (at least for the built-in implementations).</span></span>
>
> <span data-ttu-id="2baea-282">También puede crear una instancia de <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache> siempre que necesite una en lugar de usar DI, pero la creación de una instancia de en el código puede hacer que el código sea más difícil de probar e infringe el [principio de dependencias explícitas](/dotnet/standard/modern-web-apps-azure-architecture/architectural-principles#explicit-dependencies).</span><span class="sxs-lookup"><span data-stu-id="2baea-282">You can also create an <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache> instance wherever you might need one instead of using DI, but creating an instance in code can make your code harder to test and violates the [Explicit Dependencies Principle](/dotnet/standard/modern-web-apps-azure-architecture/architectural-principles#explicit-dependencies).</span></span>

## <a name="recommendations"></a><span data-ttu-id="2baea-283">Recomendaciones</span><span class="sxs-lookup"><span data-stu-id="2baea-283">Recommendations</span></span>

<span data-ttu-id="2baea-284">A la hora de decidir qué implementación de <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache> es la más adecuada para su aplicación, tenga en cuenta lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="2baea-284">When deciding which implementation of <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache> is best for your app, consider the following:</span></span>

* <span data-ttu-id="2baea-285">Infraestructura existente</span><span class="sxs-lookup"><span data-stu-id="2baea-285">Existing infrastructure</span></span>
* <span data-ttu-id="2baea-286">Requisitos de rendimiento</span><span class="sxs-lookup"><span data-stu-id="2baea-286">Performance requirements</span></span>
* <span data-ttu-id="2baea-287">Coste</span><span class="sxs-lookup"><span data-stu-id="2baea-287">Cost</span></span>
* <span data-ttu-id="2baea-288">Experiencia del equipo</span><span class="sxs-lookup"><span data-stu-id="2baea-288">Team experience</span></span>

<span data-ttu-id="2baea-289">Las soluciones de almacenamiento en caché suelen basarse en el almacenamiento en memoria para proporcionar una recuperación rápida de los datos almacenados en memoria caché, pero la memoria es un recurso limitado y se amplía de forma costosa.</span><span class="sxs-lookup"><span data-stu-id="2baea-289">Caching solutions usually rely on in-memory storage to provide fast retrieval of cached data, but memory is a limited resource and costly to expand.</span></span> <span data-ttu-id="2baea-290">Almacene solo los datos usados habitualmente en una memoria caché.</span><span class="sxs-lookup"><span data-stu-id="2baea-290">Only store commonly used data in a cache.</span></span>

<span data-ttu-id="2baea-291">Por lo general, una caché en Redis proporciona un mayor rendimiento y una menor latencia que una memoria caché de SQL Server.</span><span class="sxs-lookup"><span data-stu-id="2baea-291">Generally, a Redis cache provides higher throughput and lower latency than a SQL Server cache.</span></span> <span data-ttu-id="2baea-292">Sin embargo, normalmente es necesario realizar pruebas comparativas para determinar las características de rendimiento de las estrategias de almacenamiento en caché.</span><span class="sxs-lookup"><span data-stu-id="2baea-292">However, benchmarking is usually required to determine the performance characteristics of caching strategies.</span></span>

<span data-ttu-id="2baea-293">Cuando SQL Server se usa como un almacén de respaldo de caché distribuida, el uso de la misma base de datos para la memoria caché y el almacenamiento y la recuperación de datos normales de la aplicación puede afectar negativamente al rendimiento de ambos.</span><span class="sxs-lookup"><span data-stu-id="2baea-293">When SQL Server is used as a distributed cache backing store, use of the same database for the cache and the app's ordinary data storage and retrieval can negatively impact the performance of both.</span></span> <span data-ttu-id="2baea-294">Se recomienda usar una instancia de SQL Server dedicada para el almacén de respaldo de caché distribuida.</span><span class="sxs-lookup"><span data-stu-id="2baea-294">We recommend using a dedicated SQL Server instance for the distributed cache backing store.</span></span>

## <a name="additional-resources"></a><span data-ttu-id="2baea-295">Recursos adicionales</span><span class="sxs-lookup"><span data-stu-id="2baea-295">Additional resources</span></span>

* [<span data-ttu-id="2baea-296">Redis Cache en Azure</span><span class="sxs-lookup"><span data-stu-id="2baea-296">Redis Cache on Azure</span></span>](/azure/azure-cache-for-redis/)
* [<span data-ttu-id="2baea-297">SQL Database en Azure</span><span class="sxs-lookup"><span data-stu-id="2baea-297">SQL Database on Azure</span></span>](/azure/sql-database/)
* <span data-ttu-id="2baea-298">[ASP.net Core del proveedor de IDistributedCache para NCache en granjas de servidores web](http://www.alachisoft.com/ncache/aspnet-core-idistributedcache-ncache.html) ([NCache en github](https://github.com/Alachisoft/NCache))</span><span class="sxs-lookup"><span data-stu-id="2baea-298">[ASP.NET Core IDistributedCache Provider for NCache in Web Farms](http://www.alachisoft.com/ncache/aspnet-core-idistributedcache-ncache.html) ([NCache on GitHub](https://github.com/Alachisoft/NCache))</span></span>
* <xref:performance/caching/memory>
* <xref:fundamentals/change-tokens>
* <xref:performance/caching/response>
* <xref:performance/caching/middleware>
* <xref:mvc/views/tag-helpers/builtin-th/cache-tag-helper>
* <xref:mvc/views/tag-helpers/builtin-th/distributed-cache-tag-helper>
* <xref:host-and-deploy/web-farm>

::: moniker-end

::: moniker range="< aspnetcore-2.2"

<span data-ttu-id="2baea-299">Una caché distribuida es una memoria caché compartida por varios servidores de aplicaciones, que normalmente se mantiene como un servicio externo a los servidores de aplicaciones que tienen acceso a ella.</span><span class="sxs-lookup"><span data-stu-id="2baea-299">A distributed cache is a cache shared by multiple app servers, typically maintained as an external service to the app servers that access it.</span></span> <span data-ttu-id="2baea-300">Una caché distribuida puede mejorar el rendimiento y la escalabilidad de una aplicación ASP.NET Core, especialmente cuando la aplicación está hospedada en un servicio en la nube o en una granja de servidores.</span><span class="sxs-lookup"><span data-stu-id="2baea-300">A distributed cache can improve the performance and scalability of an ASP.NET Core app, especially when the app is hosted by a cloud service or a server farm.</span></span>

<span data-ttu-id="2baea-301">Una caché distribuida tiene varias ventajas con respecto a otros escenarios de almacenamiento en caché en los que los datos almacenados en caché se almacenan en servidores de aplicaciones individuales.</span><span class="sxs-lookup"><span data-stu-id="2baea-301">A distributed cache has several advantages over other caching scenarios where cached data is stored on individual app servers.</span></span>

<span data-ttu-id="2baea-302">Cuando se distribuyen los datos almacenados en caché, los datos:</span><span class="sxs-lookup"><span data-stu-id="2baea-302">When cached data is distributed, the data:</span></span>

* <span data-ttu-id="2baea-303">Es *coherente (coherente)* entre las solicitudes a varios servidores.</span><span class="sxs-lookup"><span data-stu-id="2baea-303">Is *coherent* (consistent) across requests to multiple servers.</span></span>
* <span data-ttu-id="2baea-304">Sobrevive los reinicios del servidor y las implementaciones de aplicaciones.</span><span class="sxs-lookup"><span data-stu-id="2baea-304">Survives server restarts and app deployments.</span></span>
* <span data-ttu-id="2baea-305">No usa la memoria local.</span><span class="sxs-lookup"><span data-stu-id="2baea-305">Doesn't use local memory.</span></span>

<span data-ttu-id="2baea-306">La configuración de caché distribuida es específica de la implementación.</span><span class="sxs-lookup"><span data-stu-id="2baea-306">Distributed cache configuration is implementation specific.</span></span> <span data-ttu-id="2baea-307">En este artículo se describe cómo configurar SQL Server y las cachés distribuidas de Redis.</span><span class="sxs-lookup"><span data-stu-id="2baea-307">This article describes how to configure SQL Server and Redis distributed caches.</span></span> <span data-ttu-id="2baea-308">También hay implementaciones de terceros disponibles, como [NCache](http://www.alachisoft.com/ncache/aspnet-core-idistributedcache-ncache.html) ([NCache en github](https://github.com/Alachisoft/NCache)).</span><span class="sxs-lookup"><span data-stu-id="2baea-308">Third party implementations are also available, such as [NCache](http://www.alachisoft.com/ncache/aspnet-core-idistributedcache-ncache.html) ([NCache on GitHub](https://github.com/Alachisoft/NCache)).</span></span> <span data-ttu-id="2baea-309">Independientemente de la implementación que se seleccione, la aplicación interactúa con la memoria caché mediante la interfaz <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache>.</span><span class="sxs-lookup"><span data-stu-id="2baea-309">Regardless of which implementation is selected, the app interacts with the cache using the <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache> interface.</span></span>

<span data-ttu-id="2baea-310">[Vea o descargue el código de ejemplo](https://github.com/dotnet/AspNetCore.Docs/tree/master/aspnetcore/performance/caching/distributed/samples/) ([cómo descargarlo](xref:index#how-to-download-a-sample))</span><span class="sxs-lookup"><span data-stu-id="2baea-310">[View or download sample code](https://github.com/dotnet/AspNetCore.Docs/tree/master/aspnetcore/performance/caching/distributed/samples/) ([how to download](xref:index#how-to-download-a-sample))</span></span>

## <a name="prerequisites"></a><span data-ttu-id="2baea-311">Prerequisites</span><span class="sxs-lookup"><span data-stu-id="2baea-311">Prerequisites</span></span>

<span data-ttu-id="2baea-312">Para usar una SQL Server caché distribuida, haga referencia al [metapaquete Microsoft. AspNetCore. app](xref:fundamentals/metapackage-app) o agregue una referencia de paquete al paquete [Microsoft. Extensions. Caching. SqlServer](https://www.nuget.org/packages/Microsoft.Extensions.Caching.SqlServer) .</span><span class="sxs-lookup"><span data-stu-id="2baea-312">To use a SQL Server distributed cache, reference the [Microsoft.AspNetCore.App metapackage](xref:fundamentals/metapackage-app) or add a package reference to the [Microsoft.Extensions.Caching.SqlServer](https://www.nuget.org/packages/Microsoft.Extensions.Caching.SqlServer) package.</span></span>

<span data-ttu-id="2baea-313">Para usar una caché distribuida de Redis, haga referencia al [metapaquete Microsoft. AspNetCore. app](xref:fundamentals/metapackage-app) y agregue una referencia de paquete al paquete [Microsoft. Extensions. Caching. Redis](https://www.nuget.org/packages/Microsoft.Extensions.Caching.Redis) .</span><span class="sxs-lookup"><span data-stu-id="2baea-313">To use a Redis distributed cache, reference the [Microsoft.AspNetCore.App metapackage](xref:fundamentals/metapackage-app) and add a package reference to the [Microsoft.Extensions.Caching.Redis](https://www.nuget.org/packages/Microsoft.Extensions.Caching.Redis) package.</span></span> <span data-ttu-id="2baea-314">El paquete de Redis no está incluido en el paquete de `Microsoft.AspNetCore.App`, por lo que debe hacer referencia al paquete de Redis por separado en el archivo de proyecto.</span><span class="sxs-lookup"><span data-stu-id="2baea-314">The Redis package isn't included in the `Microsoft.AspNetCore.App` package, so you must reference the Redis package separately in your project file.</span></span>

<span data-ttu-id="2baea-315">Para usar caché distribuida de NCache, haga referencia al [metapaquete Microsoft. AspNetCore. app](xref:fundamentals/metapackage-app) y agregue una referencia de paquete al paquete [NCache. Microsoft. Extensions. Caching. código abierto](https://www.nuget.org/packages/NCache.Microsoft.Extensions.Caching.OpenSource) .</span><span class="sxs-lookup"><span data-stu-id="2baea-315">To use NCache distributed cache, reference the [Microsoft.AspNetCore.App metapackage](xref:fundamentals/metapackage-app) and add a package reference to the [NCache.Microsoft.Extensions.Caching.OpenSource](https://www.nuget.org/packages/NCache.Microsoft.Extensions.Caching.OpenSource) package.</span></span> <span data-ttu-id="2baea-316">El paquete de NCache no está incluido en el paquete de `Microsoft.AspNetCore.App`, por lo que debe hacer referencia al paquete de NCache por separado en el archivo de proyecto.</span><span class="sxs-lookup"><span data-stu-id="2baea-316">The NCache package isn't included in the `Microsoft.AspNetCore.App` package, so you must reference the NCache package separately in your project file.</span></span>

## <a name="idistributedcache-interface"></a><span data-ttu-id="2baea-317">Interfaz IDistributedCache</span><span class="sxs-lookup"><span data-stu-id="2baea-317">IDistributedCache interface</span></span>

<span data-ttu-id="2baea-318">La interfaz de <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache> proporciona los métodos siguientes para manipular los elementos de la implementación de caché distribuida:</span><span class="sxs-lookup"><span data-stu-id="2baea-318">The <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache> interface provides the following methods to manipulate items in the distributed cache implementation:</span></span>

* <span data-ttu-id="2baea-319"><xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache.Get*>, <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache.GetAsync*> &ndash; acepta una clave de cadena y recupera un elemento almacenado en caché como una matriz de `byte[]` si se encuentra en la memoria caché.</span><span class="sxs-lookup"><span data-stu-id="2baea-319"><xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache.Get*>, <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache.GetAsync*> &ndash; Accepts a string key and retrieves a cached item as a `byte[]` array if found in the cache.</span></span>
* <span data-ttu-id="2baea-320"><xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache.Set*>, <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache.SetAsync*> &ndash; agrega un elemento (como `byte[]` matriz) a la memoria caché utilizando una clave de cadena.</span><span class="sxs-lookup"><span data-stu-id="2baea-320"><xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache.Set*>, <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache.SetAsync*> &ndash; Adds an item (as `byte[]` array) to the cache using a string key.</span></span>
* <span data-ttu-id="2baea-321"><xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache.Refresh*>, <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache.RefreshAsync*> &ndash; actualiza un elemento en la memoria caché en función de su clave, restableciendo el tiempo de espera de expiración variable (si existe).</span><span class="sxs-lookup"><span data-stu-id="2baea-321"><xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache.Refresh*>, <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache.RefreshAsync*> &ndash; Refreshes an item in the cache based on its key, resetting its sliding expiration timeout (if any).</span></span>
* <span data-ttu-id="2baea-322"><xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache.Remove*>, <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache.RemoveAsync*> &ndash; quita un elemento de la memoria caché en función de su clave de cadena.</span><span class="sxs-lookup"><span data-stu-id="2baea-322"><xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache.Remove*>, <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache.RemoveAsync*> &ndash; Removes a cache item based on its string key.</span></span>

## <a name="establish-distributed-caching-services"></a><span data-ttu-id="2baea-323">Establecer servicios de almacenamiento en caché distribuidos</span><span class="sxs-lookup"><span data-stu-id="2baea-323">Establish distributed caching services</span></span>

<span data-ttu-id="2baea-324">Registre una implementación de <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache> en `Startup.ConfigureServices`.</span><span class="sxs-lookup"><span data-stu-id="2baea-324">Register an implementation of <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache> in `Startup.ConfigureServices`.</span></span> <span data-ttu-id="2baea-325">Las implementaciones proporcionadas por el marco de trabajo que se describen en este tema incluyen:</span><span class="sxs-lookup"><span data-stu-id="2baea-325">Framework-provided implementations described in this topic include:</span></span>

* [<span data-ttu-id="2baea-326">Caché de memoria distribuida</span><span class="sxs-lookup"><span data-stu-id="2baea-326">Distributed Memory Cache</span></span>](#distributed-memory-cache)
* [<span data-ttu-id="2baea-327">Caché de SQL Server distribuida</span><span class="sxs-lookup"><span data-stu-id="2baea-327">Distributed SQL Server cache</span></span>](#distributed-sql-server-cache)
* [<span data-ttu-id="2baea-328">Caché en Redis distribuida</span><span class="sxs-lookup"><span data-stu-id="2baea-328">Distributed Redis cache</span></span>](#distributed-redis-cache)
* [<span data-ttu-id="2baea-329">Caché de NCache distribuida</span><span class="sxs-lookup"><span data-stu-id="2baea-329">Distributed NCache cache</span></span>](#distributed-ncache-cache)

### <a name="distributed-memory-cache"></a><span data-ttu-id="2baea-330">Caché de memoria distribuida</span><span class="sxs-lookup"><span data-stu-id="2baea-330">Distributed Memory Cache</span></span>

<span data-ttu-id="2baea-331">La memoria caché de memoria distribuida (<xref:Microsoft.Extensions.DependencyInjection.MemoryCacheServiceCollectionExtensions.AddDistributedMemoryCache*>) es una implementación proporcionada por el marco de <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache> que almacena elementos en la memoria.</span><span class="sxs-lookup"><span data-stu-id="2baea-331">The Distributed Memory Cache (<xref:Microsoft.Extensions.DependencyInjection.MemoryCacheServiceCollectionExtensions.AddDistributedMemoryCache*>) is a framework-provided implementation of <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache> that stores items in memory.</span></span> <span data-ttu-id="2baea-332">La caché de memoria distribuida no es una caché distribuida real.</span><span class="sxs-lookup"><span data-stu-id="2baea-332">The Distributed Memory Cache isn't an actual distributed cache.</span></span> <span data-ttu-id="2baea-333">Los elementos almacenados en caché se almacenan en la instancia de la aplicación en el servidor donde se ejecuta la aplicación.</span><span class="sxs-lookup"><span data-stu-id="2baea-333">Cached items are stored by the app instance on the server where the app is running.</span></span>

<span data-ttu-id="2baea-334">La caché de memoria distribuida es una implementación útil:</span><span class="sxs-lookup"><span data-stu-id="2baea-334">The Distributed Memory Cache is a useful implementation:</span></span>

* <span data-ttu-id="2baea-335">En escenarios de desarrollo y pruebas.</span><span class="sxs-lookup"><span data-stu-id="2baea-335">In development and testing scenarios.</span></span>
* <span data-ttu-id="2baea-336">Cuando se usa un solo servidor en producción y el consumo de memoria no es un problema.</span><span class="sxs-lookup"><span data-stu-id="2baea-336">When a single server is used in production and memory consumption isn't an issue.</span></span> <span data-ttu-id="2baea-337">La implementación de la caché de memoria distribuida abstrae el almacenamiento de datos en caché.</span><span class="sxs-lookup"><span data-stu-id="2baea-337">Implementing the Distributed Memory Cache abstracts cached data storage.</span></span> <span data-ttu-id="2baea-338">Permite implementar una solución de almacenamiento en caché distribuida verdadera en el futuro si se necesitan varios nodos o tolerancia a errores.</span><span class="sxs-lookup"><span data-stu-id="2baea-338">It allows for implementing a true distributed caching solution in the future if multiple nodes or fault tolerance become necessary.</span></span>

<span data-ttu-id="2baea-339">La aplicación de ejemplo hace uso de la caché de memoria distribuida cuando la aplicación se ejecuta en el entorno de desarrollo en `Startup.ConfigureServices`:</span><span class="sxs-lookup"><span data-stu-id="2baea-339">The sample app makes use of the Distributed Memory Cache when the app is run in the Development environment in `Startup.ConfigureServices`:</span></span>

[!code-csharp[](distributed/samples/2.x/DistCacheSample/Startup.cs?name=snippet_AddDistributedMemoryCache)]

### <a name="distributed-sql-server-cache"></a><span data-ttu-id="2baea-340">Caché de SQL Server distribuida</span><span class="sxs-lookup"><span data-stu-id="2baea-340">Distributed SQL Server Cache</span></span>

<span data-ttu-id="2baea-341">La implementación de la memoria caché de SQL Server distribuida (<xref:Microsoft.Extensions.DependencyInjection.SqlServerCachingServicesExtensions.AddDistributedSqlServerCache*>) permite que la memoria caché distribuida use una base de datos de SQL Server como su memoria auxiliar.</span><span class="sxs-lookup"><span data-stu-id="2baea-341">The Distributed SQL Server Cache implementation (<xref:Microsoft.Extensions.DependencyInjection.SqlServerCachingServicesExtensions.AddDistributedSqlServerCache*>) allows the distributed cache to use a SQL Server database as its backing store.</span></span> <span data-ttu-id="2baea-342">Para crear una SQL Server tabla de elementos almacenados en caché en una instancia de SQL Server, puede usar la herramienta `sql-cache`.</span><span class="sxs-lookup"><span data-stu-id="2baea-342">To create a SQL Server cached item table in a SQL Server instance, you can use the `sql-cache` tool.</span></span> <span data-ttu-id="2baea-343">La herramienta crea una tabla con el nombre y el esquema que especifique.</span><span class="sxs-lookup"><span data-stu-id="2baea-343">The tool creates a table with the name and schema that you specify.</span></span>

<span data-ttu-id="2baea-344">Cree una tabla en SQL Server ejecutando el comando `sql-cache create`.</span><span class="sxs-lookup"><span data-stu-id="2baea-344">Create a table in SQL Server by running the `sql-cache create` command.</span></span> <span data-ttu-id="2baea-345">Proporcione la instancia de SQL Server (`Data Source`), la base de datos (`Initial Catalog`), el esquema (por ejemplo, `dbo`) y el nombre de la tabla (por ejemplo, `TestCache`):</span><span class="sxs-lookup"><span data-stu-id="2baea-345">Provide the SQL Server instance (`Data Source`), database (`Initial Catalog`), schema (for example, `dbo`), and table name (for example, `TestCache`):</span></span>

```dotnetcli
dotnet sql-cache create "Data Source=(localdb)\MSSQLLocalDB;Initial Catalog=DistCache;Integrated Security=True;" dbo TestCache
```

<span data-ttu-id="2baea-346">Se registra un mensaje para indicar que la herramienta se ha realizado correctamente:</span><span class="sxs-lookup"><span data-stu-id="2baea-346">A message is logged to indicate that the tool was successful:</span></span>

```console
Table and index were created successfully.
```

<span data-ttu-id="2baea-347">La tabla creada por la herramienta `sql-cache` tiene el siguiente esquema:</span><span class="sxs-lookup"><span data-stu-id="2baea-347">The table created by the `sql-cache` tool has the following schema:</span></span>

![Tabla de caché SqlServer](distributed/_static/SqlServerCacheTable.png)

> [!NOTE]
> <span data-ttu-id="2baea-349">Una aplicación debe manipular los valores de la memoria caché mediante una instancia de <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache>, no una <xref:Microsoft.Extensions.Caching.SqlServer.SqlServerCache>.</span><span class="sxs-lookup"><span data-stu-id="2baea-349">An app should manipulate cache values using an instance of <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache>, not a <xref:Microsoft.Extensions.Caching.SqlServer.SqlServerCache>.</span></span>

<span data-ttu-id="2baea-350">La aplicación de ejemplo implementa <xref:Microsoft.Extensions.Caching.SqlServer.SqlServerCache> en un entorno que no es de desarrollo en `Startup.ConfigureServices`:</span><span class="sxs-lookup"><span data-stu-id="2baea-350">The sample app implements <xref:Microsoft.Extensions.Caching.SqlServer.SqlServerCache> in a non-Development environment in `Startup.ConfigureServices`:</span></span>

[!code-csharp[](distributed/samples/2.x/DistCacheSample/Startup.cs?name=snippet_AddDistributedSqlServerCache)]

> [!NOTE]
> <span data-ttu-id="2baea-351">Un <xref:Microsoft.Extensions.Caching.SqlServer.SqlServerCacheOptions.ConnectionString*> (y, opcionalmente, <xref:Microsoft.Extensions.Caching.SqlServer.SqlServerCacheOptions.SchemaName*> y <xref:Microsoft.Extensions.Caching.SqlServer.SqlServerCacheOptions.TableName*>) se almacena normalmente fuera del control de código fuente (por ejemplo, lo almacena el [Administrador secreto](xref:security/app-secrets) o en *appsettings. JSON*/*appSettings. { ENVIRONMENT}. JSON* files).</span><span class="sxs-lookup"><span data-stu-id="2baea-351">A <xref:Microsoft.Extensions.Caching.SqlServer.SqlServerCacheOptions.ConnectionString*> (and optionally, <xref:Microsoft.Extensions.Caching.SqlServer.SqlServerCacheOptions.SchemaName*> and <xref:Microsoft.Extensions.Caching.SqlServer.SqlServerCacheOptions.TableName*>) are typically stored outside of source control (for example, stored by the [Secret Manager](xref:security/app-secrets) or in *appsettings.json*/*appsettings.{ENVIRONMENT}.json* files).</span></span> <span data-ttu-id="2baea-352">La cadena de conexión puede contener credenciales que deben mantenerse fuera de los sistemas de control de código fuente.</span><span class="sxs-lookup"><span data-stu-id="2baea-352">The connection string may contain credentials that should be kept out of source control systems.</span></span>

### <a name="distributed-redis-cache"></a><span data-ttu-id="2baea-353">Redis Cache distribuido</span><span class="sxs-lookup"><span data-stu-id="2baea-353">Distributed Redis Cache</span></span>

<span data-ttu-id="2baea-354">[Redis](https://redis.io/) es un almacén de datos en memoria de código abierto, que a menudo se usa como caché distribuida.</span><span class="sxs-lookup"><span data-stu-id="2baea-354">[Redis](https://redis.io/) is an open source in-memory data store, which is often used as a distributed cache.</span></span> <span data-ttu-id="2baea-355">Puede usar Redis localmente, y puede configurar un [Azure Redis cache](https://azure.microsoft.com/services/cache/) para una aplicación de ASP.net Core hospedada en Azure.</span><span class="sxs-lookup"><span data-stu-id="2baea-355">You can use Redis locally, and you can configure an [Azure Redis Cache](https://azure.microsoft.com/services/cache/) for an Azure-hosted ASP.NET Core app.</span></span>

<span data-ttu-id="2baea-356">Una aplicación configura la implementación de la memoria caché mediante una instancia de <xref:Microsoft.Extensions.Caching.Redis.RedisCache> (<xref:Microsoft.Extensions.DependencyInjection.RedisCacheServiceCollectionExtensions.AddDistributedRedisCache*>):</span><span class="sxs-lookup"><span data-stu-id="2baea-356">An app configures the cache implementation using a <xref:Microsoft.Extensions.Caching.Redis.RedisCache> instance (<xref:Microsoft.Extensions.DependencyInjection.RedisCacheServiceCollectionExtensions.AddDistributedRedisCache*>):</span></span>

```csharp
services.AddDistributedRedisCache(options =>
{
    options.Configuration = "localhost";
    options.InstanceName = "SampleInstance";
});
```

<span data-ttu-id="2baea-357">Para instalar Redis en el equipo local:</span><span class="sxs-lookup"><span data-stu-id="2baea-357">To install Redis on your local machine:</span></span>

1. <span data-ttu-id="2baea-358">Instale el [paquete chocolatey Redis](https://chocolatey.org/packages/redis-64/).</span><span class="sxs-lookup"><span data-stu-id="2baea-358">Install the [Chocolatey Redis package](https://chocolatey.org/packages/redis-64/).</span></span>
1. <span data-ttu-id="2baea-359">Ejecute `redis-server` desde un símbolo del sistema.</span><span class="sxs-lookup"><span data-stu-id="2baea-359">Run `redis-server` from a command prompt.</span></span>

### <a name="distributed-ncache-cache"></a><span data-ttu-id="2baea-360">Caché de NCache distribuida</span><span class="sxs-lookup"><span data-stu-id="2baea-360">Distributed NCache Cache</span></span>

<span data-ttu-id="2baea-361">[NCache](https://github.com/Alachisoft/NCache) es una caché distribuida en memoria de código abierto desarrollada de forma nativa en .NET y .net Core.</span><span class="sxs-lookup"><span data-stu-id="2baea-361">[NCache](https://github.com/Alachisoft/NCache) is an open source in-memory distributed cache developed natively in .NET and .NET Core.</span></span> <span data-ttu-id="2baea-362">NCache funciona localmente y se configura como un clúster de caché distribuida para una aplicación ASP.NET Core que se ejecuta en Azure o en otras plataformas de hospedaje.</span><span class="sxs-lookup"><span data-stu-id="2baea-362">NCache works both locally and configured as a distributed cache cluster for an ASP.NET Core app running in Azure or on other hosting platforms.</span></span>

<span data-ttu-id="2baea-363">Para instalar y configurar NCache en el equipo local, consulte [Guía de introducción de NCache para Windows](https://www.alachisoft.com/resources/docs/ncache-oss/getting-started-guide-windows/).</span><span class="sxs-lookup"><span data-stu-id="2baea-363">To install and configure NCache on your local machine, see [NCache Getting Started Guide for Windows](https://www.alachisoft.com/resources/docs/ncache-oss/getting-started-guide-windows/).</span></span>

<span data-ttu-id="2baea-364">Para configurar NCache:</span><span class="sxs-lookup"><span data-stu-id="2baea-364">To configure NCache:</span></span>

1. <span data-ttu-id="2baea-365">Instalación de [NuGet de código abierto de NCache](https://www.nuget.org/packages/Alachisoft.NCache.OpenSource.SDK/).</span><span class="sxs-lookup"><span data-stu-id="2baea-365">Install [NCache open source NuGet](https://www.nuget.org/packages/Alachisoft.NCache.OpenSource.SDK/).</span></span>
1. <span data-ttu-id="2baea-366">Configure el clúster de caché en [Client. ncconf](https://www.alachisoft.com/resources/docs/ncache-oss/admin-guide/client-config.html).</span><span class="sxs-lookup"><span data-stu-id="2baea-366">Configure the cache cluster in [client.ncconf](https://www.alachisoft.com/resources/docs/ncache-oss/admin-guide/client-config.html).</span></span>
1. <span data-ttu-id="2baea-367">Agregue el siguiente código a `Startup.ConfigureServices`:</span><span class="sxs-lookup"><span data-stu-id="2baea-367">Add the following code to `Startup.ConfigureServices`:</span></span>

   ```csharp
   services.AddNCacheDistributedCache(configuration =>    
   {        
       configuration.CacheName = "demoClusteredCache";
       configuration.EnableLogs = true;
       configuration.ExceptionsEnabled = true;
   });
   ```

## <a name="use-the-distributed-cache"></a><span data-ttu-id="2baea-368">Usar la memoria caché distribuida</span><span class="sxs-lookup"><span data-stu-id="2baea-368">Use the distributed cache</span></span>

<span data-ttu-id="2baea-369">Para usar la interfaz <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache>, solicite una instancia de <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache> de cualquier constructor de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="2baea-369">To use the <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache> interface, request an instance of <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache> from any constructor in the app.</span></span> <span data-ttu-id="2baea-370">La instancia se proporciona mediante la [inserción de dependencias (di)](xref:fundamentals/dependency-injection).</span><span class="sxs-lookup"><span data-stu-id="2baea-370">The instance is provided by [dependency injection (DI)](xref:fundamentals/dependency-injection).</span></span>

<span data-ttu-id="2baea-371">Cuando se inicia la aplicación de ejemplo, <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache> se inserta en `Startup.Configure`.</span><span class="sxs-lookup"><span data-stu-id="2baea-371">When the sample app starts, <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache> is injected into `Startup.Configure`.</span></span> <span data-ttu-id="2baea-372">La hora actual se almacena en la memoria caché mediante <xref:Microsoft.AspNetCore.Hosting.IApplicationLifetime> (para obtener más información, vea [host de Web: interfaz IApplicationLifetime](xref:fundamentals/host/web-host#iapplicationlifetime-interface)):</span><span class="sxs-lookup"><span data-stu-id="2baea-372">The current time is cached using <xref:Microsoft.AspNetCore.Hosting.IApplicationLifetime> (for more information, see [Web Host: IApplicationLifetime interface](xref:fundamentals/host/web-host#iapplicationlifetime-interface)):</span></span>

[!code-csharp[](distributed/samples/2.x/DistCacheSample/Startup.cs?name=snippet_Configure&highlight=10)]

<span data-ttu-id="2baea-373">La aplicación de ejemplo inserta <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache> en el `IndexModel` para que lo use la página de índice.</span><span class="sxs-lookup"><span data-stu-id="2baea-373">The sample app injects <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache> into the `IndexModel` for use by the Index page.</span></span>

<span data-ttu-id="2baea-374">Cada vez que se carga la página de índice, se comprueba la hora almacenada en la memoria caché en `OnGetAsync`.</span><span class="sxs-lookup"><span data-stu-id="2baea-374">Each time the Index page is loaded, the cache is checked for the cached time in `OnGetAsync`.</span></span> <span data-ttu-id="2baea-375">Si la hora almacenada en caché no ha expirado, se muestra la hora.</span><span class="sxs-lookup"><span data-stu-id="2baea-375">If the cached time hasn't expired, the time is displayed.</span></span> <span data-ttu-id="2baea-376">Si han transcurrido 20 segundos desde la última vez que se tuvo acceso a la hora almacenada en caché (la última vez que se cargó esta página), la página muestra la *fecha de expiración de la memoria caché*.</span><span class="sxs-lookup"><span data-stu-id="2baea-376">If 20 seconds have elapsed since the last time the cached time was accessed (the last time this page was loaded), the page displays *Cached Time Expired*.</span></span>

<span data-ttu-id="2baea-377">Actualice inmediatamente la hora almacenada en caché a la hora actual; para ello, seleccione el botón **restablecer hora de almacenamiento en caché** .</span><span class="sxs-lookup"><span data-stu-id="2baea-377">Immediately update the cached time to the current time by selecting the **Reset Cached Time** button.</span></span> <span data-ttu-id="2baea-378">El botón desencadena el método de control de `OnPostResetCachedTime`.</span><span class="sxs-lookup"><span data-stu-id="2baea-378">The button triggers the `OnPostResetCachedTime` handler method.</span></span>

[!code-csharp[](distributed/samples/2.x/DistCacheSample/Pages/Index.cshtml.cs?name=snippet_IndexModel&highlight=7,14-20,25-29)]

> [!NOTE]
> <span data-ttu-id="2baea-379">No es necesario usar un singleton o una duración de ámbito para las instancias de <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache> (al menos para las implementaciones integradas).</span><span class="sxs-lookup"><span data-stu-id="2baea-379">There's no need to use a Singleton or Scoped lifetime for <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache> instances (at least for the built-in implementations).</span></span>
>
> <span data-ttu-id="2baea-380">También puede crear una instancia de <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache> siempre que necesite una en lugar de usar DI, pero la creación de una instancia de en el código puede hacer que el código sea más difícil de probar e infringe el [principio de dependencias explícitas](/dotnet/standard/modern-web-apps-azure-architecture/architectural-principles#explicit-dependencies).</span><span class="sxs-lookup"><span data-stu-id="2baea-380">You can also create an <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache> instance wherever you might need one instead of using DI, but creating an instance in code can make your code harder to test and violates the [Explicit Dependencies Principle](/dotnet/standard/modern-web-apps-azure-architecture/architectural-principles#explicit-dependencies).</span></span>

## <a name="recommendations"></a><span data-ttu-id="2baea-381">Recomendaciones</span><span class="sxs-lookup"><span data-stu-id="2baea-381">Recommendations</span></span>

<span data-ttu-id="2baea-382">A la hora de decidir qué implementación de <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache> es la más adecuada para su aplicación, tenga en cuenta lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="2baea-382">When deciding which implementation of <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache> is best for your app, consider the following:</span></span>

* <span data-ttu-id="2baea-383">Infraestructura existente</span><span class="sxs-lookup"><span data-stu-id="2baea-383">Existing infrastructure</span></span>
* <span data-ttu-id="2baea-384">Requisitos de rendimiento</span><span class="sxs-lookup"><span data-stu-id="2baea-384">Performance requirements</span></span>
* <span data-ttu-id="2baea-385">Coste</span><span class="sxs-lookup"><span data-stu-id="2baea-385">Cost</span></span>
* <span data-ttu-id="2baea-386">Experiencia del equipo</span><span class="sxs-lookup"><span data-stu-id="2baea-386">Team experience</span></span>

<span data-ttu-id="2baea-387">Las soluciones de almacenamiento en caché suelen basarse en el almacenamiento en memoria para proporcionar una recuperación rápida de los datos almacenados en memoria caché, pero la memoria es un recurso limitado y se amplía de forma costosa.</span><span class="sxs-lookup"><span data-stu-id="2baea-387">Caching solutions usually rely on in-memory storage to provide fast retrieval of cached data, but memory is a limited resource and costly to expand.</span></span> <span data-ttu-id="2baea-388">Almacene solo los datos usados habitualmente en una memoria caché.</span><span class="sxs-lookup"><span data-stu-id="2baea-388">Only store commonly used data in a cache.</span></span>

<span data-ttu-id="2baea-389">Por lo general, una caché en Redis proporciona un mayor rendimiento y una menor latencia que una memoria caché de SQL Server.</span><span class="sxs-lookup"><span data-stu-id="2baea-389">Generally, a Redis cache provides higher throughput and lower latency than a SQL Server cache.</span></span> <span data-ttu-id="2baea-390">Sin embargo, normalmente es necesario realizar pruebas comparativas para determinar las características de rendimiento de las estrategias de almacenamiento en caché.</span><span class="sxs-lookup"><span data-stu-id="2baea-390">However, benchmarking is usually required to determine the performance characteristics of caching strategies.</span></span>

<span data-ttu-id="2baea-391">Cuando SQL Server se usa como un almacén de respaldo de caché distribuida, el uso de la misma base de datos para la memoria caché y el almacenamiento y la recuperación de datos normales de la aplicación puede afectar negativamente al rendimiento de ambos.</span><span class="sxs-lookup"><span data-stu-id="2baea-391">When SQL Server is used as a distributed cache backing store, use of the same database for the cache and the app's ordinary data storage and retrieval can negatively impact the performance of both.</span></span> <span data-ttu-id="2baea-392">Se recomienda usar una instancia de SQL Server dedicada para el almacén de respaldo de caché distribuida.</span><span class="sxs-lookup"><span data-stu-id="2baea-392">We recommend using a dedicated SQL Server instance for the distributed cache backing store.</span></span>

## <a name="additional-resources"></a><span data-ttu-id="2baea-393">Recursos adicionales</span><span class="sxs-lookup"><span data-stu-id="2baea-393">Additional resources</span></span>

* [<span data-ttu-id="2baea-394">Redis Cache en Azure</span><span class="sxs-lookup"><span data-stu-id="2baea-394">Redis Cache on Azure</span></span>](/azure/azure-cache-for-redis/)
* [<span data-ttu-id="2baea-395">SQL Database en Azure</span><span class="sxs-lookup"><span data-stu-id="2baea-395">SQL Database on Azure</span></span>](/azure/sql-database/)
* <span data-ttu-id="2baea-396">[ASP.net Core del proveedor de IDistributedCache para NCache en granjas de servidores web](http://www.alachisoft.com/ncache/aspnet-core-idistributedcache-ncache.html) ([NCache en github](https://github.com/Alachisoft/NCache))</span><span class="sxs-lookup"><span data-stu-id="2baea-396">[ASP.NET Core IDistributedCache Provider for NCache in Web Farms](http://www.alachisoft.com/ncache/aspnet-core-idistributedcache-ncache.html) ([NCache on GitHub](https://github.com/Alachisoft/NCache))</span></span>
* <xref:performance/caching/memory>
* <xref:fundamentals/change-tokens>
* <xref:performance/caching/response>
* <xref:performance/caching/middleware>
* <xref:mvc/views/tag-helpers/builtin-th/cache-tag-helper>
* <xref:mvc/views/tag-helpers/builtin-th/distributed-cache-tag-helper>
* <xref:host-and-deploy/web-farm>

::: moniker-end
 