---
title: Middleware de reescritura de URL en ASP.NET Core
author: guardrex
description: Aprenda a reescribir y redireccionar URL con el middleware de reescritura de URL en aplicaciones ASP.NET Core.
monikerRange: '>= aspnetcore-2.1'
ms.author: riande
ms.custom: mvc
ms.date: 08/16/2019
uid: fundamentals/url-rewriting
ms.openlocfilehash: e284d2172af723bb80a7be9f6e6f1a87ebe5208e
ms.sourcegitcommit: 41f2c1a6b316e6e368a4fd27a8b18d157cef91e1
ms.translationtype: HT
ms.contentlocale: es-ES
ms.lasthandoff: 08/21/2019
ms.locfileid: "69886508"
---
# <a name="url-rewriting-middleware-in-aspnet-core"></a><span data-ttu-id="7a2f0-103">Middleware de reescritura de URL en ASP.NET Core</span><span class="sxs-lookup"><span data-stu-id="7a2f0-103">URL Rewriting Middleware in ASP.NET Core</span></span>

<span data-ttu-id="7a2f0-104">Por [Luke Latham](https://github.com/guardrex) y [Mikael Mengistu](https://github.com/mikaelm12)</span><span class="sxs-lookup"><span data-stu-id="7a2f0-104">By [Luke Latham](https://github.com/guardrex) and [Mikael Mengistu](https://github.com/mikaelm12)</span></span>

::: moniker range=">= aspnetcore-3.0"

<span data-ttu-id="7a2f0-105">En este documento se ofrece una introducción a la reescritura de URL e instrucciones sobre cómo usar el middleware de reescritura de URL en aplicaciones ASP.NET Core.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-105">This document introduces URL rewriting with instructions on how to use URL Rewriting Middleware in ASP.NET Core apps.</span></span>

<span data-ttu-id="7a2f0-106">La reescritura de URL consiste en modificar varias URL de solicitud basadas en una o varias reglas predefinidas.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-106">URL rewriting is the act of modifying request URLs based on one or more predefined rules.</span></span> <span data-ttu-id="7a2f0-107">La reescritura de URL crea una abstracción entre las ubicaciones de recursos y sus direcciones para que las ubicaciones y las direcciones no estén estrechamente vinculadas.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-107">URL rewriting creates an abstraction between resource locations and their addresses so that the locations and addresses aren't tightly linked.</span></span> <span data-ttu-id="7a2f0-108">La reescritura de URL es útil en varios escenarios para:</span><span class="sxs-lookup"><span data-stu-id="7a2f0-108">URL rewriting is valuable in several scenarios to:</span></span>

* <span data-ttu-id="7a2f0-109">Mover o reemplazar recursos del servidor de forma temporal o permanente a la vez que se mantienen localizadores estables para esos recursos.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-109">Move or replace server resources temporarily or permanently and maintain stable locators for those resources.</span></span>
* <span data-ttu-id="7a2f0-110">Dividir el procesamiento de solicitudes entre otras aplicaciones o entre áreas de una aplicación.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-110">Split request processing across different apps or across areas of one app.</span></span>
* <span data-ttu-id="7a2f0-111">Quitar, agregar o reorganizar segmentos de dirección URL en solicitudes entrantes.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-111">Remove, add, or reorganize URL segments on incoming requests.</span></span>
* <span data-ttu-id="7a2f0-112">Optimizar direcciones URL públicas para la optimización del motor de búsqueda (SEO).</span><span class="sxs-lookup"><span data-stu-id="7a2f0-112">Optimize public URLs for Search Engine Optimization (SEO).</span></span>
* <span data-ttu-id="7a2f0-113">Permitir el uso de direcciones URL públicas descriptivas para ayudar a los visitantes a predecir el contenido devuelto mediante la solicitud de un recurso.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-113">Permit the use of friendly public URLs to help visitors predict the content returned by requesting a resource.</span></span>
* <span data-ttu-id="7a2f0-114">Redirigir solicitudes no seguras a puntos de conexión seguros.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-114">Redirect insecure requests to secure endpoints.</span></span>
* <span data-ttu-id="7a2f0-115">Evitar la vinculación activa, en la que un sitio externo usa un recurso estático hospedado en otro sitio mediante la vinculación del recurso a su propio contenido.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-115">Prevent hotlinking, where an external site uses a hosted static asset on another site by linking the asset into its own content.</span></span>

> [!NOTE]
> <span data-ttu-id="7a2f0-116">La reescritura de URL puede reducir el rendimiento de una aplicación.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-116">URL rewriting can reduce the performance of an app.</span></span> <span data-ttu-id="7a2f0-117">Cuando sea factible, limite el número y la complejidad de las reglas.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-117">Where feasible, limit the number and complexity of rules.</span></span>

<span data-ttu-id="7a2f0-118">[Vea o descargue el código de ejemplo](https://github.com/aspnet/AspNetCore.Docs/tree/master/aspnetcore/fundamentals/url-rewriting/samples/) ([cómo descargarlo](xref:index#how-to-download-a-sample))</span><span class="sxs-lookup"><span data-stu-id="7a2f0-118">[View or download sample code](https://github.com/aspnet/AspNetCore.Docs/tree/master/aspnetcore/fundamentals/url-rewriting/samples/) ([how to download](xref:index#how-to-download-a-sample))</span></span>

## <a name="url-redirect-and-url-rewrite"></a><span data-ttu-id="7a2f0-119">Redireccionamiento y reescritura de URL</span><span class="sxs-lookup"><span data-stu-id="7a2f0-119">URL redirect and URL rewrite</span></span>

<span data-ttu-id="7a2f0-120">La diferencia entre los términos *redirección de URL* y *reescritura de URL* es sutil, pero tiene importantes implicaciones para proporcionar recursos a los clientes.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-120">The difference in wording between *URL redirect* and *URL rewrite* is subtle but has important implications for providing resources to clients.</span></span> <span data-ttu-id="7a2f0-121">El middleware de reescritura de URL de ASP.NET Core es capaz de satisfacer las necesidades de ambos.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-121">ASP.NET Core's URL Rewriting Middleware is capable of meeting the need for both.</span></span>

<span data-ttu-id="7a2f0-122">Una *redirección de URL* implica una operación del lado cliente, donde al cliente se le indica que acceda a un recurso en una dirección distinta a la que ha solicitado originalmente.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-122">A *URL redirect* involves a client-side operation, where the client is instructed to access a resource at a different address than the client originally requested.</span></span> <span data-ttu-id="7a2f0-123">Esto requiere un recorrido de ida y vuelta al servidor.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-123">This requires a round trip to the server.</span></span> <span data-ttu-id="7a2f0-124">La URL de redireccionamiento que se devuelve al cliente aparece en la barra de direcciones del explorador cuando el cliente realiza una nueva solicitud para el recurso.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-124">The redirect URL returned to the client appears in the browser's address bar when the client makes a new request for the resource.</span></span>

<span data-ttu-id="7a2f0-125">Si `/resource` se *redirige* a `/different-resource`, el servidor responde que el cliente debe obtener el recurso en `/different-resource` con un código de estado que indica que la redirección es temporal o permanente.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-125">If `/resource` is *redirected* to `/different-resource`, the server responds that the client should obtain the resource at `/different-resource` with a status code indicating that the redirect is either temporary or permanent.</span></span>

![Se cambió temporalmente un punto de conexión del servicio WebAPI de la versión 1 (v1) a la versión 2 (v2) en el servidor.](url-rewriting/_static/url_redirect.png)

<span data-ttu-id="7a2f0-131">Al redirigir las solicitudes a otra dirección URL, se indica si la redirección es permanente o temporal mediante la especificación del código de estado con la respuesta:</span><span class="sxs-lookup"><span data-stu-id="7a2f0-131">When redirecting requests to a different URL, indicate whether the redirect is permanent or temporary by specifying the status code with the response:</span></span>

* <span data-ttu-id="7a2f0-132">El código de estado *301 - Movido definitivamente* se usa cuando el recurso tiene una nueva dirección URL permanente y se quiere indicar al cliente que todas las solicitudes futuras para el recurso deben usar la nueva dirección URL.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-132">The *301 - Moved Permanently* status code is used where the resource has a new, permanent URL and you wish to instruct the client that all future requests for the resource should use the new URL.</span></span> <span data-ttu-id="7a2f0-133">*El cliente puede almacenar en caché la respuesta cuando se recibe un código de estado 301.*</span><span class="sxs-lookup"><span data-stu-id="7a2f0-133">*The client may cache and reuse the response when a 301 status code is received.*</span></span>

* <span data-ttu-id="7a2f0-134">El código de estado *302: encontrado* se usa cuando el redireccionamiento es temporal o en general está sujeto a cambios.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-134">The *302 - Found* status code is used where the redirection is temporary or generally subject to change.</span></span> <span data-ttu-id="7a2f0-135">El código de estado 302 indica al cliente que no almacene la dirección URL y la use en el futuro.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-135">The 302 status code indicates to the client not to store the URL and use it in the future.</span></span>

<span data-ttu-id="7a2f0-136">Para obtener más información sobre los códigos de estado, consulte [RFC 2616: Status Code Definitions](https://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html) (RFC 2616: definiciones de los códigos de estado).</span><span class="sxs-lookup"><span data-stu-id="7a2f0-136">For more information on status codes, see [RFC 2616: Status Code Definitions](https://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html).</span></span>

<span data-ttu-id="7a2f0-137">La *reescritura de URL* es una operación del lado servidor que proporciona un recurso desde una dirección de recursos distinta a la que el cliente ha solicitado.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-137">A *URL rewrite* is a server-side operation that provides a resource from a different resource address than the client requested.</span></span> <span data-ttu-id="7a2f0-138">La reescritura de una dirección URL no requiere un recorrido de ida y vuelta al servidor.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-138">Rewriting a URL doesn't require a round trip to the server.</span></span> <span data-ttu-id="7a2f0-139">La dirección URL reescrita no se devuelve al cliente y no aparece en la barra de direcciones del explorador.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-139">The rewritten URL isn't returned to the client and doesn't appear in the browser's address bar.</span></span>

<span data-ttu-id="7a2f0-140">Si `/resource` se *reescribe* como `/different-resource`, el servidor la obtiene *internamente* y devuelve el recurso en `/different-resource`.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-140">If `/resource` is *rewritten* to `/different-resource`, the server *internally* fetches and returns the resource at `/different-resource`.</span></span>

<span data-ttu-id="7a2f0-141">Aunque es posible que el cliente pueda recuperar el recurso en la dirección URL reescrita, no se le informa de que el recurso existe en la dirección URL reescrita cuando realiza su solicitud y recibe la respuesta.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-141">Although the client might be able to retrieve the resource at the rewritten URL, the client isn't informed that the resource exists at the rewritten URL when it makes its request and receives the response.</span></span>

![Se cambió un punto de conexión del servicio WebAPI de la versión 1 (v1) a la versión 2 (v2) en el servidor.](url-rewriting/_static/url_rewrite.png)

## <a name="url-rewriting-sample-app"></a><span data-ttu-id="7a2f0-146">Aplicación de ejemplo de reescritura de URL</span><span class="sxs-lookup"><span data-stu-id="7a2f0-146">URL rewriting sample app</span></span>

<span data-ttu-id="7a2f0-147">Puede explorar las características del middleware de reescritura de URL con la [aplicación de ejemplo](https://github.com/aspnet/AspNetCore.Docs/tree/master/aspnetcore/fundamentals/url-rewriting/samples/).</span><span class="sxs-lookup"><span data-stu-id="7a2f0-147">You can explore the features of the URL Rewriting Middleware with the [sample app](https://github.com/aspnet/AspNetCore.Docs/tree/master/aspnetcore/fundamentals/url-rewriting/samples/).</span></span> <span data-ttu-id="7a2f0-148">La aplicación emplea las reglas de redireccionamiento y reescritura, y muestra la URL redirigida o reescrita para varios escenarios.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-148">The app applies redirect and rewrite rules and shows the redirected or rewritten URL for several scenarios.</span></span>

## <a name="when-to-use-url-rewriting-middleware"></a><span data-ttu-id="7a2f0-149">Cuándo usar el middleware de reescritura de URL</span><span class="sxs-lookup"><span data-stu-id="7a2f0-149">When to use URL Rewriting Middleware</span></span>

<span data-ttu-id="7a2f0-150">Use el middleware de reescritura de URL cuando no pueda usar los enfoques siguientes:</span><span class="sxs-lookup"><span data-stu-id="7a2f0-150">Use URL Rewriting Middleware when you're unable to use the following approaches:</span></span>

* [<span data-ttu-id="7a2f0-151">Módulo de reescritura de URL con IIS en Windows Server</span><span class="sxs-lookup"><span data-stu-id="7a2f0-151">URL Rewrite module with IIS on Windows Server</span></span>](https://www.iis.net/downloads/microsoft/url-rewrite)
* [<span data-ttu-id="7a2f0-152">Módulo mod_rewrite de Apache en el servidor Apache</span><span class="sxs-lookup"><span data-stu-id="7a2f0-152">Apache mod_rewrite module on Apache Server</span></span>](https://httpd.apache.org/docs/2.4/rewrite/)
* [<span data-ttu-id="7a2f0-153">Reescritura de URL en Nginx</span><span class="sxs-lookup"><span data-stu-id="7a2f0-153">URL rewriting on Nginx</span></span>](https://www.nginx.com/blog/creating-nginx-rewrite-rules/)

<span data-ttu-id="7a2f0-154">Además, use el middleware cuando la aplicación se hospede en el [servidor HTTP.sys](xref:fundamentals/servers/httpsys) (anteriormente denominado WebListener).</span><span class="sxs-lookup"><span data-stu-id="7a2f0-154">Also, use the middleware when the app is hosted on [HTTP.sys server](xref:fundamentals/servers/httpsys) (formerly called WebListener).</span></span>

<span data-ttu-id="7a2f0-155">Las principales razones para usar la tecnologías de reescritura de URL basadas en servidor en IIS, Apache y Nginx son las siguientes:</span><span class="sxs-lookup"><span data-stu-id="7a2f0-155">The main reasons to use the server-based URL rewriting technologies in IIS, Apache, and Nginx are:</span></span>

* <span data-ttu-id="7a2f0-156">El middleware no es compatible con todas las características de estos módulos.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-156">The middleware doesn't support the full features of these modules.</span></span>

  <span data-ttu-id="7a2f0-157">Algunas de las características de los módulos de servidor no funcionan con proyectos de ASP.NET Core, como las restricciones `IsFile` y `IsDirectory` del módulo de reescritura de IIS.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-157">Some of the features of the server modules don't work with ASP.NET Core projects, such as the `IsFile` and `IsDirectory` constraints of the IIS Rewrite module.</span></span> <span data-ttu-id="7a2f0-158">En estos casos, es mejor usar el middleware.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-158">In these scenarios, use the middleware instead.</span></span>
* <span data-ttu-id="7a2f0-159">El rendimiento del middleware probablemente no coincida con el de los módulos.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-159">The performance of the middleware probably doesn't match that of the modules.</span></span>

  <span data-ttu-id="7a2f0-160">La única manera de saber con certeza con qué enfoque el rendimiento disminuye más, o si la disminución de este es insignificante, es mediante una comparación.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-160">Benchmarking is the only way to know for sure which approach degrades performance the most or if degraded performance is negligible.</span></span>

## <a name="package"></a><span data-ttu-id="7a2f0-161">Package</span><span class="sxs-lookup"><span data-stu-id="7a2f0-161">Package</span></span>

<span data-ttu-id="7a2f0-162">El middleware de reescritura de URL está disponible en el paquete [Microsoft.AspNetCore.Rewrite](https://www.nuget.org/packages/Microsoft.AspNetCore.Rewrite), incluido implícitamente en las aplicaciones ASP.NET Core.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-162">URL Rewriting Middleware is provided by the [Microsoft.AspNetCore.Rewrite](https://www.nuget.org/packages/Microsoft.AspNetCore.Rewrite) package, which is implicitly included in ASP.NET Core apps.</span></span>

## <a name="extension-and-options"></a><span data-ttu-id="7a2f0-163">Extensión y opciones</span><span class="sxs-lookup"><span data-stu-id="7a2f0-163">Extension and options</span></span>

<span data-ttu-id="7a2f0-164">Establezca las reglas de reescritura y redirección de URL mediante la creación de una instancia de la clase [RewriteOptions](xref:Microsoft.AspNetCore.Rewrite.RewriteOptions) con métodos de extensión para cada una de las reglas de reescritura.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-164">Establish URL rewrite and redirect rules by creating an instance of the [RewriteOptions](xref:Microsoft.AspNetCore.Rewrite.RewriteOptions) class with extension methods for each of your rewrite rules.</span></span> <span data-ttu-id="7a2f0-165">Encadene varias reglas en el orden que quiera procesarlas.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-165">Chain multiple rules in the order that you would like them processed.</span></span> <span data-ttu-id="7a2f0-166">Las `RewriteOptions` se pasan al middleware de reescritura de URL cuando se agrega a la canalización de solicitudes con <xref:Microsoft.AspNetCore.Builder.RewriteBuilderExtensions.UseRewriter*>:</span><span class="sxs-lookup"><span data-stu-id="7a2f0-166">The `RewriteOptions` are passed into the URL Rewriting Middleware as it's added to the request pipeline with <xref:Microsoft.AspNetCore.Builder.RewriteBuilderExtensions.UseRewriter*>:</span></span>

[!code-csharp[](url-rewriting/samples/3.x/SampleApp/Startup.cs?name=snippet1)]

### <a name="redirect-non-www-to-www"></a><span data-ttu-id="7a2f0-167">Redirigir solicitudes que distintas de www a www</span><span class="sxs-lookup"><span data-stu-id="7a2f0-167">Redirect non-www to www</span></span>

<span data-ttu-id="7a2f0-168">Hay tres opciones que permiten a la aplicación redirigir solicitudes distintas de `www` a `www`:</span><span class="sxs-lookup"><span data-stu-id="7a2f0-168">Three options permit the app to redirect non-`www` requests to `www`:</span></span>

* <span data-ttu-id="7a2f0-169"><xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.AddRedirectToWwwPermanent*> &ndash; Redirige permanentemente la solicitud al subdominio `www` si la solicitud es distinta de `www`.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-169"><xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.AddRedirectToWwwPermanent*> &ndash; Permanently redirect the request to the `www` subdomain if the request is non-`www`.</span></span> <span data-ttu-id="7a2f0-170">Se redirige con un código de estado [Status308PermanentRedirect](xref:Microsoft.AspNetCore.Http.StatusCodes.Status308PermanentRedirect).</span><span class="sxs-lookup"><span data-stu-id="7a2f0-170">Redirects with a [Status308PermanentRedirect](xref:Microsoft.AspNetCore.Http.StatusCodes.Status308PermanentRedirect) status code.</span></span>

* <span data-ttu-id="7a2f0-171"><xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.AddRedirectToWww*> &ndash; Redirige la solicitud al subdominio `www` si la solicitud de entrada es distinta de `www`.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-171"><xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.AddRedirectToWww*> &ndash; Redirect the request to the `www` subdomain if the incoming request is non-`www`.</span></span> <span data-ttu-id="7a2f0-172">Se redirige con un código de estado [Status307TemporaryRedirect](xref:Microsoft.AspNetCore.Http.StatusCodes.Status307TemporaryRedirect).</span><span class="sxs-lookup"><span data-stu-id="7a2f0-172">Redirects with a [Status307TemporaryRedirect](xref:Microsoft.AspNetCore.Http.StatusCodes.Status307TemporaryRedirect) status code.</span></span> <span data-ttu-id="7a2f0-173">Una sobrecarga permite proporcionar el código de estado para la respuesta.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-173">An overload permits you to provide the status code for the response.</span></span> <span data-ttu-id="7a2f0-174">Use un campo de la clase <xref:Microsoft.AspNetCore.Http.StatusCodes> para una asignación de código de estado.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-174">Use a field of the <xref:Microsoft.AspNetCore.Http.StatusCodes> class for a status code assignment.</span></span>

### <a name="url-redirect"></a><span data-ttu-id="7a2f0-175">Redirección de URL</span><span class="sxs-lookup"><span data-stu-id="7a2f0-175">URL redirect</span></span>

<span data-ttu-id="7a2f0-176">Use <xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.AddRedirect*> para redirigir las solicitudes.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-176">Use <xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.AddRedirect*> to redirect requests.</span></span> <span data-ttu-id="7a2f0-177">El primer parámetro contiene la expresión regular para hacer coincidir la ruta de acceso de la URL entrante.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-177">The first parameter contains your regex for matching on the path of the incoming URL.</span></span> <span data-ttu-id="7a2f0-178">El segundo parámetro es la cadena de reemplazo.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-178">The second parameter is the replacement string.</span></span> <span data-ttu-id="7a2f0-179">El tercer parámetro, si está presente, especifica el código de estado.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-179">The third parameter, if present, specifies the status code.</span></span> <span data-ttu-id="7a2f0-180">Si no se especifica el código de estado, el valor predeterminado es *302 - Encontrado*, lo que indica que el recurso se ha movido o reemplazado temporalmente.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-180">If you don't specify the status code, the status code defaults to *302 - Found*, which indicates that the resource is temporarily moved or replaced.</span></span>

[!code-csharp[](url-rewriting/samples/3.x/SampleApp/Startup.cs?name=snippet1&highlight=9)]

<span data-ttu-id="7a2f0-181">En un explorador con herramientas de desarrollo habilitadas, realice una solicitud a la aplicación de ejemplo con la ruta de acceso `/redirect-rule/1234/5678`.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-181">In a browser with developer tools enabled, make a request to the sample app with the path `/redirect-rule/1234/5678`.</span></span> <span data-ttu-id="7a2f0-182">La expresión regular coincide con la ruta de acceso de la solicitud en `redirect-rule/(.*)` y la ruta de acceso se reemplaza con `/redirected/1234/5678`.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-182">The regex matches the request path on `redirect-rule/(.*)`, and the path is replaced with `/redirected/1234/5678`.</span></span> <span data-ttu-id="7a2f0-183">La dirección URL de redireccionamiento se devuelve al cliente con un código de estado *302 - Encontrado*.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-183">The redirect URL is sent back to the client with a *302 - Found* status code.</span></span> <span data-ttu-id="7a2f0-184">El explorador realiza una solicitud nueva en la URL de redireccionamiento, que aparece en la barra de direcciones del explorador.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-184">The browser makes a new request at the redirect URL, which appears in the browser's address bar.</span></span> <span data-ttu-id="7a2f0-185">Como ninguna de las reglas de la aplicación de ejemplo coincide con la dirección URL de redireccionamiento:</span><span class="sxs-lookup"><span data-stu-id="7a2f0-185">Since no rules in the sample app match on the redirect URL:</span></span>

* <span data-ttu-id="7a2f0-186">La segunda solicitud recibe una respuesta *200: correcto* de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-186">The second request receives a *200 - OK* response from the app.</span></span>
* <span data-ttu-id="7a2f0-187">En el cuerpo de la respuesta se muestra la dirección URL de redireccionamiento.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-187">The body of the response shows the redirect URL.</span></span>

<span data-ttu-id="7a2f0-188">Se realiza un recorrido de ida y vuelta al servidor cuando se *redirige* una dirección URL.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-188">A round trip is made to the server when a URL is *redirected*.</span></span>

> [!WARNING]
> <span data-ttu-id="7a2f0-189">Tenga cuidado al establecer las reglas de redirección.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-189">Be cautious when establishing redirect rules.</span></span> <span data-ttu-id="7a2f0-190">Las reglas de redirección se evalúan en cada solicitud enviada a la aplicación, incluso después de una redirección.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-190">Redirect rules are evaluated on every request to the app, including after a redirect.</span></span> <span data-ttu-id="7a2f0-191">Es fácil crear por error un *bucle de redirecciones infinitas*.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-191">It's easy to accidentally create a *loop of infinite redirects*.</span></span>

<span data-ttu-id="7a2f0-192">Solicitud original: `/redirect-rule/1234/5678`</span><span class="sxs-lookup"><span data-stu-id="7a2f0-192">Original Request: `/redirect-rule/1234/5678`</span></span>

![Ventana del explorador con herramientas de desarrollo realizando un seguimiento de las solicitudes y las respuestas](url-rewriting/_static/add_redirect.png)

<span data-ttu-id="7a2f0-194">La parte de la expresión incluida entre paréntesis se denomina *grupo de capturas*.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-194">The part of the expression contained within parentheses is called a *capture group*.</span></span> <span data-ttu-id="7a2f0-195">El punto (`.`) de la expresión significa *buscar cualquier carácter*.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-195">The dot (`.`) of the expression means *match any character*.</span></span> <span data-ttu-id="7a2f0-196">El asterisco (`*`) indica *buscar el carácter precedente cero o más veces*.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-196">The asterisk (`*`) indicates *match the preceding character zero or more times*.</span></span> <span data-ttu-id="7a2f0-197">Por tanto, el grupo de capturas `(.*)` busca los dos últimos segmentos de la ruta de acceso de la URL, `1234/5678`.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-197">Therefore, the last two path segments of the URL, `1234/5678`, are captured by capture group `(.*)`.</span></span> <span data-ttu-id="7a2f0-198">Cualquier valor que se proporcione en la URL de la solicitud después de `redirect-rule/` es capturado por este grupo de capturas único.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-198">Any value you provide in the request URL after `redirect-rule/` is captured by this single capture group.</span></span>

<span data-ttu-id="7a2f0-199">En la cadena de reemplazo, se insertan los grupos capturados en la cadena con el signo de dólar (`$`) seguido del número de secuencia de la captura.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-199">In the replacement string, captured groups are injected into the string with the dollar sign (`$`) followed by the sequence number of the capture.</span></span> <span data-ttu-id="7a2f0-200">Se obtiene el valor del primer grupo de capturas con `$1`, el segundo con `$2`, y así siguen en secuencia para los grupos de capturas de la expresión regular.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-200">The first capture group value is obtained with `$1`, the second with `$2`, and they continue in sequence for the capture groups in your regex.</span></span> <span data-ttu-id="7a2f0-201">Solo hay un grupo capturado en la expresión regular de la regla de redirección de la aplicación de ejemplo, por lo que solo hay un grupo insertado en la cadena de reemplazo, que es `$1`.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-201">There's only one captured group in the redirect rule regex in the sample app, so there's only one injected group in the replacement string, which is `$1`.</span></span> <span data-ttu-id="7a2f0-202">Cuando se aplica la regla, la URL se convierte en `/redirected/1234/5678`.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-202">When the rule is applied, the URL becomes `/redirected/1234/5678`.</span></span>

### <a name="url-redirect-to-a-secure-endpoint"></a><span data-ttu-id="7a2f0-203">Redirección de URL a un punto de conexión segura</span><span class="sxs-lookup"><span data-stu-id="7a2f0-203">URL redirect to a secure endpoint</span></span>

<span data-ttu-id="7a2f0-204">Use <xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.AddRedirectToHttps*> para redirigir las solicitudes HTTP al mismo host y ruta de acceso mediante el protocolo HTTPS.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-204">Use <xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.AddRedirectToHttps*> to redirect HTTP requests to the same host and path using the HTTPS protocol.</span></span> <span data-ttu-id="7a2f0-205">Si no se proporciona el código de estado, el middleware muestra de forma predeterminada *302 - Encontrado*.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-205">If the status code isn't supplied, the middleware defaults to *302 - Found*.</span></span> <span data-ttu-id="7a2f0-206">Si no se proporciona el puerto:</span><span class="sxs-lookup"><span data-stu-id="7a2f0-206">If the port isn't supplied:</span></span>

* <span data-ttu-id="7a2f0-207">El middleware tiene como valor predeterminado `null`.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-207">The middleware defaults to `null`.</span></span>
* <span data-ttu-id="7a2f0-208">El esquema cambia a `https` (protocolo HTTPS), y el cliente accede al recurso en el puerto 443.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-208">The scheme changes to `https` (HTTPS protocol), and the client accesses the resource on port 443.</span></span>

<span data-ttu-id="7a2f0-209">En el ejemplo siguiente se muestra cómo establecer el código de estado en *301 - Movido definitivamente* y cambiar el puerto a 5001.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-209">The following example shows how to set the status code to *301 - Moved Permanently* and change the port to 5001.</span></span>

```csharp
public void Configure(IApplicationBuilder app)
{
    var options = new RewriteOptions()
        .AddRedirectToHttps(301, 5001);

    app.UseRewriter(options);
}
```

<span data-ttu-id="7a2f0-210">Use <xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.AddRedirectToHttpsPermanent*> para redirigir las solicitudes no seguras al mismo host y ruta de acceso mediante el protocolo HTTPS seguro en el puerto 443.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-210">Use <xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.AddRedirectToHttpsPermanent*> to redirect insecure requests to the same host and path with secure HTTPS protocol on port 443.</span></span> <span data-ttu-id="7a2f0-211">El middleware establece el código de estado en *301 - Movido definitivamente*.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-211">The middleware sets the status code to *301 - Moved Permanently*.</span></span>

```csharp
public void Configure(IApplicationBuilder app)
{
    var options = new RewriteOptions()
        .AddRedirectToHttpsPermanent();

    app.UseRewriter(options);
}
```

> [!NOTE]
> <span data-ttu-id="7a2f0-212">Al redirigir a un punto de conexión seguro sin la necesidad de reglas de redirección adicionales, se recomienda usar el Middleware de redirección de HTTPS.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-212">When redirecting to a secure endpoint without the requirement for additional redirect rules, we recommend using HTTPS Redirection Middleware.</span></span> <span data-ttu-id="7a2f0-213">Para más información, vea el tema [Aplicación de HTTPS](xref:security/enforcing-ssl#require-https).</span><span class="sxs-lookup"><span data-stu-id="7a2f0-213">For more information, see the [Enforce HTTPS](xref:security/enforcing-ssl#require-https) topic.</span></span>

<span data-ttu-id="7a2f0-214">La aplicación de ejemplo es capaz de mostrar cómo usar `AddRedirectToHttps` o `AddRedirectToHttpsPermanent`.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-214">The sample app is capable of demonstrating how to use `AddRedirectToHttps` or `AddRedirectToHttpsPermanent`.</span></span> <span data-ttu-id="7a2f0-215">Agregue el método de extensión a `RewriteOptions`.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-215">Add the extension method to the `RewriteOptions`.</span></span> <span data-ttu-id="7a2f0-216">Realice una solicitud poco segura a la aplicación en cualquier URL.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-216">Make an insecure request to the app at any URL.</span></span> <span data-ttu-id="7a2f0-217">Descarte la advertencia de seguridad del explorador que indica que el certificado autofirmado no es de confianza o cree una excepción para confiar en el certificado en cuestión.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-217">Dismiss the browser security warning that the self-signed certificate is untrusted or create an exception to trust the certificate.</span></span>

<span data-ttu-id="7a2f0-218">Solicitud original mediante `AddRedirectToHttps(301, 5001)`: `http://localhost:5000/secure`</span><span class="sxs-lookup"><span data-stu-id="7a2f0-218">Original Request using `AddRedirectToHttps(301, 5001)`: `http://localhost:5000/secure`</span></span>

![Ventana del explorador con herramientas de desarrollo realizando un seguimiento de las solicitudes y las respuestas](url-rewriting/_static/add_redirect_to_https.png)

<span data-ttu-id="7a2f0-220">Solicitud original mediante `AddRedirectToHttpsPermanent`: `http://localhost:5000/secure`</span><span class="sxs-lookup"><span data-stu-id="7a2f0-220">Original Request using `AddRedirectToHttpsPermanent`: `http://localhost:5000/secure`</span></span>

![Ventana del explorador con herramientas de desarrollo realizando un seguimiento de las solicitudes y las respuestas](url-rewriting/_static/add_redirect_to_https_permanent.png)

### <a name="url-rewrite"></a><span data-ttu-id="7a2f0-222">Reescritura de URL</span><span class="sxs-lookup"><span data-stu-id="7a2f0-222">URL rewrite</span></span>

<span data-ttu-id="7a2f0-223">Use <xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.AddRewrite*> para crear una regla para reescribir URL.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-223">Use <xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.AddRewrite*> to create a rule for rewriting URLs.</span></span> <span data-ttu-id="7a2f0-224">El primer parámetro contiene la expresión regular para buscar coincidencias en la ruta de dirección de URL entrante.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-224">The first parameter contains the regex for matching on the incoming URL path.</span></span> <span data-ttu-id="7a2f0-225">El segundo parámetro es la cadena de reemplazo.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-225">The second parameter is the replacement string.</span></span> <span data-ttu-id="7a2f0-226">El tercer parámetro, `skipRemainingRules: {true|false}`, indica al middleware si al aplicar la regla actual tiene que omitir o no alguna regla de redirección adicional.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-226">The third parameter, `skipRemainingRules: {true|false}`, indicates to the middleware whether or not to skip additional rewrite rules if the current rule is applied.</span></span>

[!code-csharp[](url-rewriting/samples/3.x/SampleApp/Startup.cs?name=snippet1&highlight=10-11)]

<span data-ttu-id="7a2f0-227">Solicitud original: `/rewrite-rule/1234/5678`</span><span class="sxs-lookup"><span data-stu-id="7a2f0-227">Original Request: `/rewrite-rule/1234/5678`</span></span>

![Ventana del explorador con herramientas de desarrollo realizando un seguimiento de las solicitudes y las respuestas](url-rewriting/_static/add_rewrite.png)

<span data-ttu-id="7a2f0-229">El acento circunflejo (`^`) al principio de la expresión significa que la búsqueda de coincidencias empieza al principio de la ruta de dirección URL.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-229">The carat (`^`) at the beginning of the expression means that matching starts at the beginning of the URL path.</span></span>

<span data-ttu-id="7a2f0-230">En el ejemplo anterior de la regla de redireccionamiento (`redirect-rule/(.*)`), no hay ningún acento circunflejo (`^`) al principio de la expresión regular.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-230">In the earlier example with the redirect rule, `redirect-rule/(.*)`, there's no carat (`^`) at the start of the regex.</span></span> <span data-ttu-id="7a2f0-231">Por tanto, cualquier carácter puede preceder a `redirect-rule/` en la ruta de acceso para que la coincidencia sea correcta.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-231">Therefore, any characters may precede `redirect-rule/` in the path for a successful match.</span></span>

| <span data-ttu-id="7a2f0-232">Ruta de acceso</span><span class="sxs-lookup"><span data-stu-id="7a2f0-232">Path</span></span>                               | <span data-ttu-id="7a2f0-233">Coincidir con</span><span class="sxs-lookup"><span data-stu-id="7a2f0-233">Match</span></span> |
| ---------------------------------- | :---: |
| `/redirect-rule/1234/5678`         | <span data-ttu-id="7a2f0-234">Sí</span><span class="sxs-lookup"><span data-stu-id="7a2f0-234">Yes</span></span>   |
| `/my-cool-redirect-rule/1234/5678` | <span data-ttu-id="7a2f0-235">Sí</span><span class="sxs-lookup"><span data-stu-id="7a2f0-235">Yes</span></span>   |
| `/anotherredirect-rule/1234/5678`  | <span data-ttu-id="7a2f0-236">Sí</span><span class="sxs-lookup"><span data-stu-id="7a2f0-236">Yes</span></span>   |

<span data-ttu-id="7a2f0-237">La regla de reescritura, `^rewrite-rule/(\d+)/(\d+)`, solo encuentra rutas de acceso que empiezan con `rewrite-rule/`.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-237">The rewrite rule, `^rewrite-rule/(\d+)/(\d+)`, only matches paths if they start with `rewrite-rule/`.</span></span> <span data-ttu-id="7a2f0-238">En la tabla siguiente, observe la diferencia de coincidencia.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-238">In the following table, note the difference in matching.</span></span>

| <span data-ttu-id="7a2f0-239">Ruta de acceso</span><span class="sxs-lookup"><span data-stu-id="7a2f0-239">Path</span></span>                              | <span data-ttu-id="7a2f0-240">Coincidir con</span><span class="sxs-lookup"><span data-stu-id="7a2f0-240">Match</span></span> |
| --------------------------------- | :---: |
| `/rewrite-rule/1234/5678`         | <span data-ttu-id="7a2f0-241">Sí</span><span class="sxs-lookup"><span data-stu-id="7a2f0-241">Yes</span></span>   |
| `/my-cool-rewrite-rule/1234/5678` | <span data-ttu-id="7a2f0-242">No</span><span class="sxs-lookup"><span data-stu-id="7a2f0-242">No</span></span>    |
| `/anotherrewrite-rule/1234/5678`  | <span data-ttu-id="7a2f0-243">No</span><span class="sxs-lookup"><span data-stu-id="7a2f0-243">No</span></span>    |

<span data-ttu-id="7a2f0-244">Después de la parte `^rewrite-rule/` de la expresión, hay dos grupos de captura, `(\d+)/(\d+)`.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-244">Following the `^rewrite-rule/` portion of the expression, there are two capture groups, `(\d+)/(\d+)`.</span></span> <span data-ttu-id="7a2f0-245">`\d` significa *buscar un dígito (número)* .</span><span class="sxs-lookup"><span data-stu-id="7a2f0-245">The `\d` signifies *match a digit (number)*.</span></span> <span data-ttu-id="7a2f0-246">El signo más (`+`) significa *buscar uno o más de los caracteres anteriores*.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-246">The plus sign (`+`) means *match one or more of the preceding character*.</span></span> <span data-ttu-id="7a2f0-247">Por tanto, la URL debe contener un número seguido de una barra diagonal, seguida de otro número.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-247">Therefore, the URL must contain a number followed by a forward-slash followed by another number.</span></span> <span data-ttu-id="7a2f0-248">Estos grupos de capturas se insertan en la URL de reescritura como `$1` y `$2`.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-248">These capture groups are injected into the rewritten URL as `$1` and `$2`.</span></span> <span data-ttu-id="7a2f0-249">La cadena de reemplazo de la regla de reescritura coloca los grupos capturados en la cadena de consulta.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-249">The rewrite rule replacement string places the captured groups into the query string.</span></span> <span data-ttu-id="7a2f0-250">La ruta de acceso solicitada de `/rewrite-rule/1234/5678` se reescribe para obtener el recurso en `/rewritten?var1=1234&var2=5678`.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-250">The requested path of `/rewrite-rule/1234/5678` is rewritten to obtain the resource at `/rewritten?var1=1234&var2=5678`.</span></span> <span data-ttu-id="7a2f0-251">Si una cadena de consulta está presente en la solicitud original, se conserva cuando se reescribe la dirección URL.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-251">If a query string is present on the original request, it's preserved when the URL is rewritten.</span></span>

<span data-ttu-id="7a2f0-252">No hay ningún recorrido de ida y vuelta al servidor para obtener el recurso.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-252">There's no round trip to the server to obtain the resource.</span></span> <span data-ttu-id="7a2f0-253">Si el recurso existe, se captura y se devuelve al cliente con un código de estado *200 - Correcto*.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-253">If the resource exists, it's fetched and returned to the client with a *200 - OK* status code.</span></span> <span data-ttu-id="7a2f0-254">Como el cliente no se redirige, la dirección URL no cambia en la barra de direcciones del explorador.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-254">Because the client isn't redirected, the URL in the browser's address bar doesn't change.</span></span> <span data-ttu-id="7a2f0-255">Los clientes no pueden detectar que se ha producido una operación de reescritura de URL en el servidor.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-255">Clients can't detect that a URL rewrite operation occurred on the server.</span></span>

> [!NOTE]
> <span data-ttu-id="7a2f0-256">Use `skipRemainingRules: true` siempre que sea posible, ya que las reglas de coincidencia consumen muchos recursos y aumentan el tiempo de respuesta de aplicación.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-256">Use `skipRemainingRules: true` whenever possible because matching rules is computationally expensive and increases app response time.</span></span> <span data-ttu-id="7a2f0-257">Para obtener la respuesta más rápida de la aplicación:</span><span class="sxs-lookup"><span data-stu-id="7a2f0-257">For the fastest app response:</span></span>
>
> * <span data-ttu-id="7a2f0-258">Ordene las reglas de reescritura desde la que coincida con más frecuencia a la que coincida con menos frecuencia.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-258">Order rewrite rules from the most frequently matched rule to the least frequently matched rule.</span></span>
> * <span data-ttu-id="7a2f0-259">Omita el procesamiento de las reglas restantes cuando se produzca una coincidencia; no es necesario ningún procesamiento de reglas adicional.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-259">Skip the processing of the remaining rules when a match occurs and no additional rule processing is required.</span></span>

### <a name="apache-mod_rewrite"></a><span data-ttu-id="7a2f0-260">mod_rewrite de Apache</span><span class="sxs-lookup"><span data-stu-id="7a2f0-260">Apache mod_rewrite</span></span>

<span data-ttu-id="7a2f0-261">Aplique reglas mod_rewrite de Apache con <xref:Microsoft.AspNetCore.Rewrite.ApacheModRewriteOptionsExtensions.AddApacheModRewrite*>.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-261">Apply Apache mod_rewrite rules with <xref:Microsoft.AspNetCore.Rewrite.ApacheModRewriteOptionsExtensions.AddApacheModRewrite*>.</span></span> <span data-ttu-id="7a2f0-262">Asegúrese de que el archivo de reglas se implementa con la aplicación.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-262">Make sure that the rules file is deployed with the app.</span></span> <span data-ttu-id="7a2f0-263">Para obtener más información y ejemplos de reglas mod_rewrite, vea [Apache mod_rewrite](https://httpd.apache.org/docs/2.4/rewrite/) (mod_rewrite de Apache).</span><span class="sxs-lookup"><span data-stu-id="7a2f0-263">For more information and examples of mod_rewrite rules, see [Apache mod_rewrite](https://httpd.apache.org/docs/2.4/rewrite/).</span></span>

<span data-ttu-id="7a2f0-264">Se usa <xref:System.IO.StreamReader> para leer las reglas del archivo de reglas *ApacheModRewrite.txt*:</span><span class="sxs-lookup"><span data-stu-id="7a2f0-264">A <xref:System.IO.StreamReader> is used to read the rules from the *ApacheModRewrite.txt* rules file:</span></span>

[!code-csharp[](url-rewriting/samples/3.x/SampleApp/Startup.cs?name=snippet1&highlight=3-4,12)]

<span data-ttu-id="7a2f0-265">La aplicación de ejemplo redirige las solicitudes de `/apache-mod-rules-redirect/(.\*)` a `/redirected?id=$1`.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-265">The sample app redirects requests from `/apache-mod-rules-redirect/(.\*)` to `/redirected?id=$1`.</span></span> <span data-ttu-id="7a2f0-266">El código de estado de la respuesta es *302: Encontrado*.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-266">The response status code is *302 - Found*.</span></span>

[!code[](url-rewriting/samples/3.x/SampleApp/ApacheModRewrite.txt)]

<span data-ttu-id="7a2f0-267">Solicitud original: `/apache-mod-rules-redirect/1234`</span><span class="sxs-lookup"><span data-stu-id="7a2f0-267">Original Request: `/apache-mod-rules-redirect/1234`</span></span>

![Ventana del explorador con herramientas de desarrollo realizando un seguimiento de las solicitudes y las respuestas](url-rewriting/_static/add_apache_mod_redirect.png)

<span data-ttu-id="7a2f0-269">El middleware admite las siguientes variables de servidor mod_rewrite de Apache:</span><span class="sxs-lookup"><span data-stu-id="7a2f0-269">The middleware supports the following Apache mod_rewrite server variables:</span></span>

* <span data-ttu-id="7a2f0-270">CONN_REMOTE_ADDR</span><span class="sxs-lookup"><span data-stu-id="7a2f0-270">CONN_REMOTE_ADDR</span></span>
* <span data-ttu-id="7a2f0-271">HTTP_ACCEPT</span><span class="sxs-lookup"><span data-stu-id="7a2f0-271">HTTP_ACCEPT</span></span>
* <span data-ttu-id="7a2f0-272">HTTP_CONNECTION</span><span class="sxs-lookup"><span data-stu-id="7a2f0-272">HTTP_CONNECTION</span></span>
* <span data-ttu-id="7a2f0-273">HTTP_COOKIE</span><span class="sxs-lookup"><span data-stu-id="7a2f0-273">HTTP_COOKIE</span></span>
* <span data-ttu-id="7a2f0-274">HTTP_FORWARDED</span><span class="sxs-lookup"><span data-stu-id="7a2f0-274">HTTP_FORWARDED</span></span>
* <span data-ttu-id="7a2f0-275">HTTP_HOST</span><span class="sxs-lookup"><span data-stu-id="7a2f0-275">HTTP_HOST</span></span>
* <span data-ttu-id="7a2f0-276">HTTP_REFERER</span><span class="sxs-lookup"><span data-stu-id="7a2f0-276">HTTP_REFERER</span></span>
* <span data-ttu-id="7a2f0-277">HTTP_USER_AGENT</span><span class="sxs-lookup"><span data-stu-id="7a2f0-277">HTTP_USER_AGENT</span></span>
* <span data-ttu-id="7a2f0-278">HTTPS</span><span class="sxs-lookup"><span data-stu-id="7a2f0-278">HTTPS</span></span>
* <span data-ttu-id="7a2f0-279">IPV6</span><span class="sxs-lookup"><span data-stu-id="7a2f0-279">IPV6</span></span>
* <span data-ttu-id="7a2f0-280">QUERY_STRING</span><span class="sxs-lookup"><span data-stu-id="7a2f0-280">QUERY_STRING</span></span>
* <span data-ttu-id="7a2f0-281">REMOTE_ADDR</span><span class="sxs-lookup"><span data-stu-id="7a2f0-281">REMOTE_ADDR</span></span>
* <span data-ttu-id="7a2f0-282">REMOTE_PORT</span><span class="sxs-lookup"><span data-stu-id="7a2f0-282">REMOTE_PORT</span></span>
* <span data-ttu-id="7a2f0-283">REQUEST_FILENAME</span><span class="sxs-lookup"><span data-stu-id="7a2f0-283">REQUEST_FILENAME</span></span>
* <span data-ttu-id="7a2f0-284">REQUEST_METHOD</span><span class="sxs-lookup"><span data-stu-id="7a2f0-284">REQUEST_METHOD</span></span>
* <span data-ttu-id="7a2f0-285">REQUEST_SCHEME</span><span class="sxs-lookup"><span data-stu-id="7a2f0-285">REQUEST_SCHEME</span></span>
* <span data-ttu-id="7a2f0-286">REQUEST_URI</span><span class="sxs-lookup"><span data-stu-id="7a2f0-286">REQUEST_URI</span></span>
* <span data-ttu-id="7a2f0-287">SCRIPT_FILENAME</span><span class="sxs-lookup"><span data-stu-id="7a2f0-287">SCRIPT_FILENAME</span></span>
* <span data-ttu-id="7a2f0-288">SERVER_ADDR</span><span class="sxs-lookup"><span data-stu-id="7a2f0-288">SERVER_ADDR</span></span>
* <span data-ttu-id="7a2f0-289">SERVER_PORT</span><span class="sxs-lookup"><span data-stu-id="7a2f0-289">SERVER_PORT</span></span>
* <span data-ttu-id="7a2f0-290">SERVER_PROTOCOL</span><span class="sxs-lookup"><span data-stu-id="7a2f0-290">SERVER_PROTOCOL</span></span>
* <span data-ttu-id="7a2f0-291">TIME</span><span class="sxs-lookup"><span data-stu-id="7a2f0-291">TIME</span></span>
* <span data-ttu-id="7a2f0-292">TIME_DAY</span><span class="sxs-lookup"><span data-stu-id="7a2f0-292">TIME_DAY</span></span>
* <span data-ttu-id="7a2f0-293">TIME_HOUR</span><span class="sxs-lookup"><span data-stu-id="7a2f0-293">TIME_HOUR</span></span>
* <span data-ttu-id="7a2f0-294">TIME_MIN</span><span class="sxs-lookup"><span data-stu-id="7a2f0-294">TIME_MIN</span></span>
* <span data-ttu-id="7a2f0-295">TIME_MON</span><span class="sxs-lookup"><span data-stu-id="7a2f0-295">TIME_MON</span></span>
* <span data-ttu-id="7a2f0-296">TIME_SEC</span><span class="sxs-lookup"><span data-stu-id="7a2f0-296">TIME_SEC</span></span>
* <span data-ttu-id="7a2f0-297">TIME_WDAY</span><span class="sxs-lookup"><span data-stu-id="7a2f0-297">TIME_WDAY</span></span>
* <span data-ttu-id="7a2f0-298">TIME_YEAR</span><span class="sxs-lookup"><span data-stu-id="7a2f0-298">TIME_YEAR</span></span>

### <a name="iis-url-rewrite-module-rules"></a><span data-ttu-id="7a2f0-299">Reglas del Módulo URL Rewrite para IIS</span><span class="sxs-lookup"><span data-stu-id="7a2f0-299">IIS URL Rewrite Module rules</span></span>

<span data-ttu-id="7a2f0-300">Para usar el mismo conjunto de reglas que se aplica al módulo URL Rewrite para IIS, use <xref:Microsoft.AspNetCore.Rewrite.IISUrlRewriteOptionsExtensions.AddIISUrlRewrite*>.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-300">To use the same rule set that applies to the IIS URL Rewrite Module, use <xref:Microsoft.AspNetCore.Rewrite.IISUrlRewriteOptionsExtensions.AddIISUrlRewrite*>.</span></span> <span data-ttu-id="7a2f0-301">Asegúrese de que el archivo de reglas se implementa con la aplicación.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-301">Make sure that the rules file is deployed with the app.</span></span> <span data-ttu-id="7a2f0-302">No dirija el middleware para que use el archivo *web.config* de la aplicación cuando se ejecute en Windows Server IIS.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-302">Don't direct the middleware to use the app's *web.config* file when running on Windows Server IIS.</span></span> <span data-ttu-id="7a2f0-303">Con IIS, estas reglas se deben almacenar fuera del archivo *web.config* de la aplicación para evitar conflictos con el Módulo URL Rewrite para IIS.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-303">With IIS, these rules should be stored outside of the app's *web.config* file in order to avoid conflicts with the IIS Rewrite module.</span></span> <span data-ttu-id="7a2f0-304">Para obtener más información y ejemplos de reglas del Módulo URL Rewrite para IIS, vea [Using Url Rewrite Module 2.0](/iis/extensions/url-rewrite-module/using-url-rewrite-module-20) (Uso del Módulo URL Rewrite 2.0) y [URL Rewrite Module Configuration Reference](/iis/extensions/url-rewrite-module/url-rewrite-module-configuration-reference) (Referencia de configuración del Módulo URL Rewrite).</span><span class="sxs-lookup"><span data-stu-id="7a2f0-304">For more information and examples of IIS URL Rewrite Module rules, see [Using Url Rewrite Module 2.0](/iis/extensions/url-rewrite-module/using-url-rewrite-module-20) and [URL Rewrite Module Configuration Reference](/iis/extensions/url-rewrite-module/url-rewrite-module-configuration-reference).</span></span>

<span data-ttu-id="7a2f0-305">Se usa <xref:System.IO.StreamReader> para leer las reglas del archivo de reglas *IISUrlRewrite.xml*:</span><span class="sxs-lookup"><span data-stu-id="7a2f0-305">A <xref:System.IO.StreamReader> is used to read the rules from the *IISUrlRewrite.xml* rules file:</span></span>

[!code-csharp[](url-rewriting/samples/3.x/SampleApp/Startup.cs?name=snippet1&highlight=5-6,13)]

<span data-ttu-id="7a2f0-306">La aplicación de ejemplo reescribe las solicitudes de `/iis-rules-rewrite/(.*)` a `/rewritten?id=$1`.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-306">The sample app rewrites requests from `/iis-rules-rewrite/(.*)` to `/rewritten?id=$1`.</span></span> <span data-ttu-id="7a2f0-307">La respuesta se envía al cliente con un código de estado *200 - Correcto*.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-307">The response is sent to the client with a *200 - OK* status code.</span></span>

[!code-xml[](url-rewriting/samples/3.x/SampleApp/IISUrlRewrite.xml)]

<span data-ttu-id="7a2f0-308">Solicitud original: `/iis-rules-rewrite/1234`</span><span class="sxs-lookup"><span data-stu-id="7a2f0-308">Original Request: `/iis-rules-rewrite/1234`</span></span>

![Ventana del explorador con herramientas de desarrollo realizando un seguimiento de las solicitudes y las respuestas](url-rewriting/_static/add_iis_url_rewrite.png)

<span data-ttu-id="7a2f0-310">Si tiene un Módulo URL Rewrite para IIS activo con reglas configuradas en el nivel de servidor que podrían afectar a la aplicación de manera no deseada, puede deshabilitar el Módulo URL Rewrite para IIS para una aplicación.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-310">If you have an active IIS Rewrite Module with server-level rules configured that would impact your app in undesirable ways, you can disable the IIS Rewrite Module for an app.</span></span> <span data-ttu-id="7a2f0-311">Para más información, vea [Disabling IIS modules](xref:host-and-deploy/iis/modules#disabling-iis-modules) (Deshabilitación de módulos de IIS).</span><span class="sxs-lookup"><span data-stu-id="7a2f0-311">For more information, see [Disabling IIS modules](xref:host-and-deploy/iis/modules#disabling-iis-modules).</span></span>

#### <a name="unsupported-features"></a><span data-ttu-id="7a2f0-312">Características no admitidas</span><span class="sxs-lookup"><span data-stu-id="7a2f0-312">Unsupported features</span></span>

<span data-ttu-id="7a2f0-313">El middleware publicado con ASP.NET Core 2.x no admite las siguientes características de Módulo URL Rewrite para IIS:</span><span class="sxs-lookup"><span data-stu-id="7a2f0-313">The middleware released with ASP.NET Core 2.x doesn't support the following IIS URL Rewrite Module features:</span></span>

* <span data-ttu-id="7a2f0-314">Reglas de salida</span><span class="sxs-lookup"><span data-stu-id="7a2f0-314">Outbound Rules</span></span>
* <span data-ttu-id="7a2f0-315">Variables de servidor personalizadas</span><span class="sxs-lookup"><span data-stu-id="7a2f0-315">Custom Server Variables</span></span>
* <span data-ttu-id="7a2f0-316">Caracteres comodín</span><span class="sxs-lookup"><span data-stu-id="7a2f0-316">Wildcards</span></span>
* <span data-ttu-id="7a2f0-317">LogRewrittenUrl</span><span class="sxs-lookup"><span data-stu-id="7a2f0-317">LogRewrittenUrl</span></span>

#### <a name="supported-server-variables"></a><span data-ttu-id="7a2f0-318">Variables de servidor compatibles</span><span class="sxs-lookup"><span data-stu-id="7a2f0-318">Supported server variables</span></span>

<span data-ttu-id="7a2f0-319">El middleware admite las siguientes variables de servidor del Módulo URL Rewrite para IIS:</span><span class="sxs-lookup"><span data-stu-id="7a2f0-319">The middleware supports the following IIS URL Rewrite Module server variables:</span></span>

* <span data-ttu-id="7a2f0-320">CONTENT_LENGTH</span><span class="sxs-lookup"><span data-stu-id="7a2f0-320">CONTENT_LENGTH</span></span>
* <span data-ttu-id="7a2f0-321">CONTENT_TYPE</span><span class="sxs-lookup"><span data-stu-id="7a2f0-321">CONTENT_TYPE</span></span>
* <span data-ttu-id="7a2f0-322">HTTP_ACCEPT</span><span class="sxs-lookup"><span data-stu-id="7a2f0-322">HTTP_ACCEPT</span></span>
* <span data-ttu-id="7a2f0-323">HTTP_CONNECTION</span><span class="sxs-lookup"><span data-stu-id="7a2f0-323">HTTP_CONNECTION</span></span>
* <span data-ttu-id="7a2f0-324">HTTP_COOKIE</span><span class="sxs-lookup"><span data-stu-id="7a2f0-324">HTTP_COOKIE</span></span>
* <span data-ttu-id="7a2f0-325">HTTP_HOST</span><span class="sxs-lookup"><span data-stu-id="7a2f0-325">HTTP_HOST</span></span>
* <span data-ttu-id="7a2f0-326">HTTP_REFERER</span><span class="sxs-lookup"><span data-stu-id="7a2f0-326">HTTP_REFERER</span></span>
* <span data-ttu-id="7a2f0-327">HTTP_URL</span><span class="sxs-lookup"><span data-stu-id="7a2f0-327">HTTP_URL</span></span>
* <span data-ttu-id="7a2f0-328">HTTP_USER_AGENT</span><span class="sxs-lookup"><span data-stu-id="7a2f0-328">HTTP_USER_AGENT</span></span>
* <span data-ttu-id="7a2f0-329">HTTPS</span><span class="sxs-lookup"><span data-stu-id="7a2f0-329">HTTPS</span></span>
* <span data-ttu-id="7a2f0-330">LOCAL_ADDR</span><span class="sxs-lookup"><span data-stu-id="7a2f0-330">LOCAL_ADDR</span></span>
* <span data-ttu-id="7a2f0-331">QUERY_STRING</span><span class="sxs-lookup"><span data-stu-id="7a2f0-331">QUERY_STRING</span></span>
* <span data-ttu-id="7a2f0-332">REMOTE_ADDR</span><span class="sxs-lookup"><span data-stu-id="7a2f0-332">REMOTE_ADDR</span></span>
* <span data-ttu-id="7a2f0-333">REMOTE_PORT</span><span class="sxs-lookup"><span data-stu-id="7a2f0-333">REMOTE_PORT</span></span>
* <span data-ttu-id="7a2f0-334">REQUEST_FILENAME</span><span class="sxs-lookup"><span data-stu-id="7a2f0-334">REQUEST_FILENAME</span></span>
* <span data-ttu-id="7a2f0-335">REQUEST_URI</span><span class="sxs-lookup"><span data-stu-id="7a2f0-335">REQUEST_URI</span></span>

> [!NOTE]
> <span data-ttu-id="7a2f0-336">También puede obtener <xref:Microsoft.Extensions.FileProviders.IFileProvider> a través de <xref:Microsoft.Extensions.FileProviders.PhysicalFileProvider>.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-336">You can also obtain an <xref:Microsoft.Extensions.FileProviders.IFileProvider> via a <xref:Microsoft.Extensions.FileProviders.PhysicalFileProvider>.</span></span> <span data-ttu-id="7a2f0-337">Con este enfoque logrará mayor flexibilidad para la ubicación de los archivos de reglas de reescritura.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-337">This approach may provide greater flexibility for the location of your rewrite rules files.</span></span> <span data-ttu-id="7a2f0-338">Asegúrese de que los archivos de reglas de reescritura se implementan en el servidor en la ruta de acceso que proporcione.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-338">Make sure that your rewrite rules files are deployed to the server at the path you provide.</span></span>
>
> ```csharp
> PhysicalFileProvider fileProvider = new PhysicalFileProvider(Directory.GetCurrentDirectory());
> ```

### <a name="method-based-rule"></a><span data-ttu-id="7a2f0-339">Regla basada en métodos</span><span class="sxs-lookup"><span data-stu-id="7a2f0-339">Method-based rule</span></span>

<span data-ttu-id="7a2f0-340">Use <xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.Add*> para implementar su propia lógica de la regla en un método.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-340">Use <xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.Add*> to implement your own rule logic in a method.</span></span> <span data-ttu-id="7a2f0-341">`Add` expone el elemento <xref:Microsoft.AspNetCore.Rewrite.RewriteContext>, lo que hace que <xref:Microsoft.AspNetCore.Http.HttpContext> esté disponible para usarlo en el método.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-341">`Add` exposes the <xref:Microsoft.AspNetCore.Rewrite.RewriteContext>, which makes available the <xref:Microsoft.AspNetCore.Http.HttpContext> for use in your method.</span></span> <span data-ttu-id="7a2f0-342">[RewriteContext.Result](xref:Microsoft.AspNetCore.Rewrite.RewriteContext.Result*) determina cómo se administra el procesamiento adicional en la canalización.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-342">The [RewriteContext.Result](xref:Microsoft.AspNetCore.Rewrite.RewriteContext.Result*) determines how additional pipeline processing is handled.</span></span> <span data-ttu-id="7a2f0-343">Establezca el valor en uno de los campos <xref:Microsoft.AspNetCore.Rewrite.RuleResult> que se describen en la tabla siguiente.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-343">Set the value to one of the <xref:Microsoft.AspNetCore.Rewrite.RuleResult> fields described in the following table.</span></span>

| `RewriteContext.Result`              | <span data-ttu-id="7a2f0-344">Acción</span><span class="sxs-lookup"><span data-stu-id="7a2f0-344">Action</span></span>                                                           |
| ------------------------------------ | ---------------------------------------------------------------- |
| <span data-ttu-id="7a2f0-345">`RuleResult.ContinueRules` (valor predeterminado)</span><span class="sxs-lookup"><span data-stu-id="7a2f0-345">`RuleResult.ContinueRules` (default)</span></span> | <span data-ttu-id="7a2f0-346">Continuar aplicando las reglas.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-346">Continue applying rules.</span></span>                                         |
| `RuleResult.EndResponse`             | <span data-ttu-id="7a2f0-347">Dejar de aplicar las reglas y enviar la respuesta.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-347">Stop applying rules and send the response.</span></span>                       |
| `RuleResult.SkipRemainingRules`      | <span data-ttu-id="7a2f0-348">Dejar de aplicar las reglas y enviar el contexto al middleware siguiente.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-348">Stop applying rules and send the context to the next middleware.</span></span> |

[!code-csharp[](url-rewriting/samples/3.x/SampleApp/Startup.cs?name=snippet1&highlight=14)]

<span data-ttu-id="7a2f0-349">La aplicación de ejemplo muestra un método que redirige las solicitudes para las rutas de acceso que terminen con *.xml*.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-349">The sample app demonstrates a method that redirects requests for paths that end with *.xml*.</span></span> <span data-ttu-id="7a2f0-350">Si se realiza una solicitud de `/file.xml`, la solicitud se redirige a `/xmlfiles/file.xml`.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-350">If a request is made for `/file.xml`, the request is redirected to `/xmlfiles/file.xml`.</span></span> <span data-ttu-id="7a2f0-351">El código de estado se establece en *301 - Movido definitivamente*.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-351">The status code is set to *301 - Moved Permanently*.</span></span> <span data-ttu-id="7a2f0-352">Cuando el explorador realiza una solicitud nueva a */xmlfiles/file.xml*, el middleware de archivos estáticos sirve el archivo al cliente desde la carpeta *wwwroot/xmlfiles*.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-352">When the browser makes a new request for */xmlfiles/file.xml*, Static File Middleware serves the file to the client from the *wwwroot/xmlfiles* folder.</span></span> <span data-ttu-id="7a2f0-353">Para un redireccionamiento, debe establecer de forma explícita el código de estado de la respuesta.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-353">For a redirect, explicitly set the status code of the response.</span></span> <span data-ttu-id="7a2f0-354">En caso contrario, se devuelve un código de estado *200: correcto* y no se produce el redireccionamiento en el cliente.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-354">Otherwise, a *200 - OK* status code is returned, and the redirect doesn't occur on the client.</span></span>

<span data-ttu-id="7a2f0-355">*RewriteRules.cs*:</span><span class="sxs-lookup"><span data-stu-id="7a2f0-355">*RewriteRules.cs*:</span></span>

[!code-csharp[](url-rewriting/samples/3.x/SampleApp/RewriteRules.cs?name=snippet_RedirectXmlFileRequests&highlight=14-18)]

<span data-ttu-id="7a2f0-356">Este enfoque también permite volver a escribir las solicitudes.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-356">This approach can also rewrite requests.</span></span> <span data-ttu-id="7a2f0-357">En la aplicación de ejemplo se muestra cómo volver a escribir la ruta de acceso para cualquier solicitud de archivo de texto para proporcionar el archivo de texto *file.txt* desde la carpeta *wwwroot*.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-357">The sample app demonstrates rewriting the path for any text file request to serve the *file.txt* text file from the *wwwroot* folder.</span></span> <span data-ttu-id="7a2f0-358">El middleware de archivos estáticos proporciona el archivo en función de la ruta de acceso de la solicitud actualizada:</span><span class="sxs-lookup"><span data-stu-id="7a2f0-358">Static File Middleware serves the file based on the updated request path:</span></span>

[!code-csharp[](url-rewriting/samples/3.x/SampleApp/Startup.cs?name=snippet1&highlight=15,22)]

<span data-ttu-id="7a2f0-359">*RewriteRules.cs*:</span><span class="sxs-lookup"><span data-stu-id="7a2f0-359">*RewriteRules.cs*:</span></span>

[!code-csharp[](url-rewriting/samples/3.x/SampleApp/RewriteRules.cs?name=snippet_RewriteTextFileRequests&highlight=7-8)]

### <a name="irule-based-rule"></a><span data-ttu-id="7a2f0-360">Regla basada en IRule</span><span class="sxs-lookup"><span data-stu-id="7a2f0-360">IRule-based rule</span></span>

<span data-ttu-id="7a2f0-361">Utilice <xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.Add*> para usar la lógica de reglas en una clase que implemente la interfaz <xref:Microsoft.AspNetCore.Rewrite.IRule>.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-361">Use <xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.Add*> to use rule logic in a class that implements the <xref:Microsoft.AspNetCore.Rewrite.IRule> interface.</span></span> <span data-ttu-id="7a2f0-362">`IRule` proporciona mayor flexibilidad que si se usa el enfoque de reglas basadas en métodos.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-362">`IRule` provides greater flexibility over using the method-based rule approach.</span></span> <span data-ttu-id="7a2f0-363">La clase de implementación puede incluir un constructor que permita pasar parámetros para el método <xref:Microsoft.AspNetCore.Rewrite.IRule.ApplyRule*>.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-363">Your implementation class may include a constructor that allows you can pass in parameters for the <xref:Microsoft.AspNetCore.Rewrite.IRule.ApplyRule*> method.</span></span>

[!code-csharp[](url-rewriting/samples/3.x/SampleApp/Startup.cs?name=snippet1&highlight=16-17)]

<span data-ttu-id="7a2f0-364">Se comprueba que los valores de los parámetros en la aplicación de ejemplo para `extension` y `newPath` cumplen ciertas condiciones.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-364">The values of the parameters in the sample app for the `extension` and the `newPath` are checked to meet several conditions.</span></span> <span data-ttu-id="7a2f0-365">`extension` debe contener un valor, que debe ser *.png*, *.jpg* o *.gif*.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-365">The `extension` must contain a value, and the value must be *.png*, *.jpg*, or *.gif*.</span></span> <span data-ttu-id="7a2f0-366">Si `newPath` no es válido, se genera <xref:System.ArgumentException> .</span><span class="sxs-lookup"><span data-stu-id="7a2f0-366">If the `newPath` isn't valid, an <xref:System.ArgumentException> is thrown.</span></span> <span data-ttu-id="7a2f0-367">Si se realiza una solicitud de *image.png*, la solicitud se redirige a `/png-images/image.png`.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-367">If a request is made for *image.png*, the request is redirected to `/png-images/image.png`.</span></span> <span data-ttu-id="7a2f0-368">Si se realiza una solicitud de *image.jpg*, la solicitud se redirige a `/jpg-images/image.jpg`.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-368">If a request is made for *image.jpg*, the request is redirected to `/jpg-images/image.jpg`.</span></span> <span data-ttu-id="7a2f0-369">El código de estado se establece en *301 - Movido definitivamente* y se establece `context.Result` para detener el procesamiento de las reglas y enviar la respuesta.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-369">The status code is set to *301 - Moved Permanently*, and the `context.Result` is set to stop processing rules and send the response.</span></span>

[!code-csharp[](url-rewriting/samples/3.x/SampleApp/RewriteRules.cs?name=snippet_RedirectImageRequests)]

<span data-ttu-id="7a2f0-370">Solicitud original: `/image.png`</span><span class="sxs-lookup"><span data-stu-id="7a2f0-370">Original Request: `/image.png`</span></span>

![Ventana del explorador con herramientas de desarrollo realizando un seguimiento de las solicitudes y las respuestas para image.png](url-rewriting/_static/add_redirect_png_requests.png)

<span data-ttu-id="7a2f0-372">Solicitud original: `/image.jpg`</span><span class="sxs-lookup"><span data-stu-id="7a2f0-372">Original Request: `/image.jpg`</span></span>

![Ventana del explorador con herramientas de desarrollo realizando un seguimiento de las solicitudes y las respuestas para image.jpg](url-rewriting/_static/add_redirect_jpg_requests.png)

## <a name="regex-examples"></a><span data-ttu-id="7a2f0-374">Ejemplos de expresiones regulares</span><span class="sxs-lookup"><span data-stu-id="7a2f0-374">Regex examples</span></span>

| <span data-ttu-id="7a2f0-375">Objetivo</span><span class="sxs-lookup"><span data-stu-id="7a2f0-375">Goal</span></span> | <span data-ttu-id="7a2f0-376">Cadena de expresión regular &</span><span class="sxs-lookup"><span data-stu-id="7a2f0-376">Regex String &</span></span><br><span data-ttu-id="7a2f0-377">Ejemplo de coincidencia</span><span class="sxs-lookup"><span data-stu-id="7a2f0-377">Match Example</span></span> | <span data-ttu-id="7a2f0-378">Cadena de reemplazo &</span><span class="sxs-lookup"><span data-stu-id="7a2f0-378">Replacement String &</span></span><br><span data-ttu-id="7a2f0-379">Ejemplo de resultado</span><span class="sxs-lookup"><span data-stu-id="7a2f0-379">Output Example</span></span> |
| ---- | ------------------------------- | -------------------------------------- |
| <span data-ttu-id="7a2f0-380">Ruta de acceso de reescritura en la cadena de consulta</span><span class="sxs-lookup"><span data-stu-id="7a2f0-380">Rewrite path into querystring</span></span> | `^path/(.*)/(.*)`<br>`/path/abc/123` | `path?var1=$1&var2=$2`<br>`/path?var1=abc&var2=123` |
| <span data-ttu-id="7a2f0-381">Quitar barra diagonal final</span><span class="sxs-lookup"><span data-stu-id="7a2f0-381">Strip trailing slash</span></span> | `(.*)/$`<br>`/path/` | `$1`<br>`/path` |
| <span data-ttu-id="7a2f0-382">Exigir barra diagonal final</span><span class="sxs-lookup"><span data-stu-id="7a2f0-382">Enforce trailing slash</span></span> | `(.*[^/])$`<br>`/path` | `$1/`<br>`/path/` |
| <span data-ttu-id="7a2f0-383">Evitar reescritura de solicitudes específicas</span><span class="sxs-lookup"><span data-stu-id="7a2f0-383">Avoid rewriting specific requests</span></span> | <span data-ttu-id="7a2f0-384">`^(.*)(?<!\.axd)$` o `^(?!.*\.axd$)(.*)$`</span><span class="sxs-lookup"><span data-stu-id="7a2f0-384">`^(.*)(?<!\.axd)$` or `^(?!.*\.axd$)(.*)$`</span></span><br><span data-ttu-id="7a2f0-385">Sí: `/resource.htm`</span><span class="sxs-lookup"><span data-stu-id="7a2f0-385">Yes: `/resource.htm`</span></span><br><span data-ttu-id="7a2f0-386">No: `/resource.axd`</span><span class="sxs-lookup"><span data-stu-id="7a2f0-386">No: `/resource.axd`</span></span> | `rewritten/$1`<br>`/rewritten/resource.htm`<br>`/resource.axd` |
| <span data-ttu-id="7a2f0-387">Reorganizar los segmentos de URL</span><span class="sxs-lookup"><span data-stu-id="7a2f0-387">Rearrange URL segments</span></span> | `path/(.*)/(.*)/(.*)`<br>`path/1/2/3` | `path/$3/$2/$1`<br>`path/3/2/1` |
| <span data-ttu-id="7a2f0-388">Reemplazar un segmento de URL</span><span class="sxs-lookup"><span data-stu-id="7a2f0-388">Replace a URL segment</span></span> | `^(.*)/segment2/(.*)`<br>`/segment1/segment2/segment3` | `$1/replaced/$2`<br>`/segment1/replaced/segment3` |

::: moniker-end

::: moniker range="< aspnetcore-3.0"

<span data-ttu-id="7a2f0-389">En este documento se ofrece una introducción a la reescritura de URL e instrucciones sobre cómo usar el middleware de reescritura de URL en aplicaciones ASP.NET Core.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-389">This document introduces URL rewriting with instructions on how to use URL Rewriting Middleware in ASP.NET Core apps.</span></span>

<span data-ttu-id="7a2f0-390">La reescritura de URL consiste en modificar varias URL de solicitud basadas en una o varias reglas predefinidas.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-390">URL rewriting is the act of modifying request URLs based on one or more predefined rules.</span></span> <span data-ttu-id="7a2f0-391">La reescritura de URL crea una abstracción entre las ubicaciones de recursos y sus direcciones para que las ubicaciones y las direcciones no estén estrechamente vinculadas.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-391">URL rewriting creates an abstraction between resource locations and their addresses so that the locations and addresses aren't tightly linked.</span></span> <span data-ttu-id="7a2f0-392">La reescritura de URL es útil en varios escenarios para:</span><span class="sxs-lookup"><span data-stu-id="7a2f0-392">URL rewriting is valuable in several scenarios to:</span></span>

* <span data-ttu-id="7a2f0-393">Mover o reemplazar recursos del servidor de forma temporal o permanente a la vez que se mantienen localizadores estables para esos recursos.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-393">Move or replace server resources temporarily or permanently and maintain stable locators for those resources.</span></span>
* <span data-ttu-id="7a2f0-394">Dividir el procesamiento de solicitudes entre otras aplicaciones o entre áreas de una aplicación.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-394">Split request processing across different apps or across areas of one app.</span></span>
* <span data-ttu-id="7a2f0-395">Quitar, agregar o reorganizar segmentos de dirección URL en solicitudes entrantes.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-395">Remove, add, or reorganize URL segments on incoming requests.</span></span>
* <span data-ttu-id="7a2f0-396">Optimizar direcciones URL públicas para la optimización del motor de búsqueda (SEO).</span><span class="sxs-lookup"><span data-stu-id="7a2f0-396">Optimize public URLs for Search Engine Optimization (SEO).</span></span>
* <span data-ttu-id="7a2f0-397">Permitir el uso de direcciones URL públicas descriptivas para ayudar a los visitantes a predecir el contenido devuelto mediante la solicitud de un recurso.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-397">Permit the use of friendly public URLs to help visitors predict the content returned by requesting a resource.</span></span>
* <span data-ttu-id="7a2f0-398">Redirigir solicitudes no seguras a puntos de conexión seguros.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-398">Redirect insecure requests to secure endpoints.</span></span>
* <span data-ttu-id="7a2f0-399">Evitar la vinculación activa, en la que un sitio externo usa un recurso estático hospedado en otro sitio mediante la vinculación del recurso a su propio contenido.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-399">Prevent hotlinking, where an external site uses a hosted static asset on another site by linking the asset into its own content.</span></span>

> [!NOTE]
> <span data-ttu-id="7a2f0-400">La reescritura de URL puede reducir el rendimiento de una aplicación.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-400">URL rewriting can reduce the performance of an app.</span></span> <span data-ttu-id="7a2f0-401">Cuando sea factible, limite el número y la complejidad de las reglas.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-401">Where feasible, limit the number and complexity of rules.</span></span>

<span data-ttu-id="7a2f0-402">[Vea o descargue el código de ejemplo](https://github.com/aspnet/AspNetCore.Docs/tree/master/aspnetcore/fundamentals/url-rewriting/samples/) ([cómo descargarlo](xref:index#how-to-download-a-sample))</span><span class="sxs-lookup"><span data-stu-id="7a2f0-402">[View or download sample code](https://github.com/aspnet/AspNetCore.Docs/tree/master/aspnetcore/fundamentals/url-rewriting/samples/) ([how to download](xref:index#how-to-download-a-sample))</span></span>

## <a name="url-redirect-and-url-rewrite"></a><span data-ttu-id="7a2f0-403">Redireccionamiento y reescritura de URL</span><span class="sxs-lookup"><span data-stu-id="7a2f0-403">URL redirect and URL rewrite</span></span>

<span data-ttu-id="7a2f0-404">La diferencia entre los términos *redirección de URL* y *reescritura de URL* es sutil, pero tiene importantes implicaciones para proporcionar recursos a los clientes.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-404">The difference in wording between *URL redirect* and *URL rewrite* is subtle but has important implications for providing resources to clients.</span></span> <span data-ttu-id="7a2f0-405">El middleware de reescritura de URL de ASP.NET Core es capaz de satisfacer las necesidades de ambos.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-405">ASP.NET Core's URL Rewriting Middleware is capable of meeting the need for both.</span></span>

<span data-ttu-id="7a2f0-406">Una *redirección de URL* implica una operación del lado cliente, donde al cliente se le indica que acceda a un recurso en una dirección distinta a la que ha solicitado originalmente.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-406">A *URL redirect* involves a client-side operation, where the client is instructed to access a resource at a different address than the client originally requested.</span></span> <span data-ttu-id="7a2f0-407">Esto requiere un recorrido de ida y vuelta al servidor.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-407">This requires a round trip to the server.</span></span> <span data-ttu-id="7a2f0-408">La URL de redireccionamiento que se devuelve al cliente aparece en la barra de direcciones del explorador cuando el cliente realiza una nueva solicitud para el recurso.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-408">The redirect URL returned to the client appears in the browser's address bar when the client makes a new request for the resource.</span></span>

<span data-ttu-id="7a2f0-409">Si `/resource` se *redirige* a `/different-resource`, el servidor responde que el cliente debe obtener el recurso en `/different-resource` con un código de estado que indica que la redirección es temporal o permanente.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-409">If `/resource` is *redirected* to `/different-resource`, the server responds that the client should obtain the resource at `/different-resource` with a status code indicating that the redirect is either temporary or permanent.</span></span>

![Se cambió temporalmente un punto de conexión del servicio WebAPI de la versión 1 (v1) a la versión 2 (v2) en el servidor.](url-rewriting/_static/url_redirect.png)

<span data-ttu-id="7a2f0-415">Al redirigir las solicitudes a otra dirección URL, se indica si la redirección es permanente o temporal mediante la especificación del código de estado con la respuesta:</span><span class="sxs-lookup"><span data-stu-id="7a2f0-415">When redirecting requests to a different URL, indicate whether the redirect is permanent or temporary by specifying the status code with the response:</span></span>

* <span data-ttu-id="7a2f0-416">El código de estado *301 - Movido definitivamente* se usa cuando el recurso tiene una nueva dirección URL permanente y se quiere indicar al cliente que todas las solicitudes futuras para el recurso deben usar la nueva dirección URL.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-416">The *301 - Moved Permanently* status code is used where the resource has a new, permanent URL and you wish to instruct the client that all future requests for the resource should use the new URL.</span></span> <span data-ttu-id="7a2f0-417">*El cliente puede almacenar en caché la respuesta cuando se recibe un código de estado 301.*</span><span class="sxs-lookup"><span data-stu-id="7a2f0-417">*The client may cache and reuse the response when a 301 status code is received.*</span></span>

* <span data-ttu-id="7a2f0-418">El código de estado *302: encontrado* se usa cuando el redireccionamiento es temporal o en general está sujeto a cambios.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-418">The *302 - Found* status code is used where the redirection is temporary or generally subject to change.</span></span> <span data-ttu-id="7a2f0-419">El código de estado 302 indica al cliente que no almacene la dirección URL y la use en el futuro.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-419">The 302 status code indicates to the client not to store the URL and use it in the future.</span></span>

<span data-ttu-id="7a2f0-420">Para obtener más información sobre los códigos de estado, consulte [RFC 2616: Status Code Definitions](https://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html) (RFC 2616: definiciones de los códigos de estado).</span><span class="sxs-lookup"><span data-stu-id="7a2f0-420">For more information on status codes, see [RFC 2616: Status Code Definitions](https://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html).</span></span>

<span data-ttu-id="7a2f0-421">La *reescritura de URL* es una operación del lado servidor que proporciona un recurso desde una dirección de recursos distinta a la que el cliente ha solicitado.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-421">A *URL rewrite* is a server-side operation that provides a resource from a different resource address than the client requested.</span></span> <span data-ttu-id="7a2f0-422">La reescritura de una dirección URL no requiere un recorrido de ida y vuelta al servidor.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-422">Rewriting a URL doesn't require a round trip to the server.</span></span> <span data-ttu-id="7a2f0-423">La dirección URL reescrita no se devuelve al cliente y no aparece en la barra de direcciones del explorador.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-423">The rewritten URL isn't returned to the client and doesn't appear in the browser's address bar.</span></span>

<span data-ttu-id="7a2f0-424">Si `/resource` se *reescribe* como `/different-resource`, el servidor la obtiene *internamente* y devuelve el recurso en `/different-resource`.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-424">If `/resource` is *rewritten* to `/different-resource`, the server *internally* fetches and returns the resource at `/different-resource`.</span></span>

<span data-ttu-id="7a2f0-425">Aunque es posible que el cliente pueda recuperar el recurso en la dirección URL reescrita, no se le informa de que el recurso existe en la dirección URL reescrita cuando realiza su solicitud y recibe la respuesta.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-425">Although the client might be able to retrieve the resource at the rewritten URL, the client isn't informed that the resource exists at the rewritten URL when it makes its request and receives the response.</span></span>

![Se cambió un punto de conexión del servicio WebAPI de la versión 1 (v1) a la versión 2 (v2) en el servidor.](url-rewriting/_static/url_rewrite.png)

## <a name="url-rewriting-sample-app"></a><span data-ttu-id="7a2f0-430">Aplicación de ejemplo de reescritura de URL</span><span class="sxs-lookup"><span data-stu-id="7a2f0-430">URL rewriting sample app</span></span>

<span data-ttu-id="7a2f0-431">Puede explorar las características del middleware de reescritura de URL con la [aplicación de ejemplo](https://github.com/aspnet/AspNetCore.Docs/tree/master/aspnetcore/fundamentals/url-rewriting/samples/).</span><span class="sxs-lookup"><span data-stu-id="7a2f0-431">You can explore the features of the URL Rewriting Middleware with the [sample app](https://github.com/aspnet/AspNetCore.Docs/tree/master/aspnetcore/fundamentals/url-rewriting/samples/).</span></span> <span data-ttu-id="7a2f0-432">La aplicación emplea las reglas de redireccionamiento y reescritura, y muestra la URL redirigida o reescrita para varios escenarios.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-432">The app applies redirect and rewrite rules and shows the redirected or rewritten URL for several scenarios.</span></span>

## <a name="when-to-use-url-rewriting-middleware"></a><span data-ttu-id="7a2f0-433">Cuándo usar el middleware de reescritura de URL</span><span class="sxs-lookup"><span data-stu-id="7a2f0-433">When to use URL Rewriting Middleware</span></span>

<span data-ttu-id="7a2f0-434">Use el middleware de reescritura de URL cuando no pueda usar los enfoques siguientes:</span><span class="sxs-lookup"><span data-stu-id="7a2f0-434">Use URL Rewriting Middleware when you're unable to use the following approaches:</span></span>

* [<span data-ttu-id="7a2f0-435">Módulo de reescritura de URL con IIS en Windows Server</span><span class="sxs-lookup"><span data-stu-id="7a2f0-435">URL Rewrite module with IIS on Windows Server</span></span>](https://www.iis.net/downloads/microsoft/url-rewrite)
* [<span data-ttu-id="7a2f0-436">Módulo mod_rewrite de Apache en el servidor Apache</span><span class="sxs-lookup"><span data-stu-id="7a2f0-436">Apache mod_rewrite module on Apache Server</span></span>](https://httpd.apache.org/docs/2.4/rewrite/)
* [<span data-ttu-id="7a2f0-437">Reescritura de URL en Nginx</span><span class="sxs-lookup"><span data-stu-id="7a2f0-437">URL rewriting on Nginx</span></span>](https://www.nginx.com/blog/creating-nginx-rewrite-rules/)

<span data-ttu-id="7a2f0-438">Además, use el middleware cuando la aplicación se hospede en el [servidor HTTP.sys](xref:fundamentals/servers/httpsys) (anteriormente denominado WebListener).</span><span class="sxs-lookup"><span data-stu-id="7a2f0-438">Also, use the middleware when the app is hosted on [HTTP.sys server](xref:fundamentals/servers/httpsys) (formerly called WebListener).</span></span>

<span data-ttu-id="7a2f0-439">Las principales razones para usar la tecnologías de reescritura de URL basadas en servidor en IIS, Apache y Nginx son las siguientes:</span><span class="sxs-lookup"><span data-stu-id="7a2f0-439">The main reasons to use the server-based URL rewriting technologies in IIS, Apache, and Nginx are:</span></span>

* <span data-ttu-id="7a2f0-440">El middleware no es compatible con todas las características de estos módulos.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-440">The middleware doesn't support the full features of these modules.</span></span>

  <span data-ttu-id="7a2f0-441">Algunas de las características de los módulos de servidor no funcionan con proyectos de ASP.NET Core, como las restricciones `IsFile` y `IsDirectory` del módulo de reescritura de IIS.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-441">Some of the features of the server modules don't work with ASP.NET Core projects, such as the `IsFile` and `IsDirectory` constraints of the IIS Rewrite module.</span></span> <span data-ttu-id="7a2f0-442">En estos casos, es mejor usar el middleware.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-442">In these scenarios, use the middleware instead.</span></span>
* <span data-ttu-id="7a2f0-443">El rendimiento del middleware probablemente no coincida con el de los módulos.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-443">The performance of the middleware probably doesn't match that of the modules.</span></span>

  <span data-ttu-id="7a2f0-444">La única manera de saber con certeza con qué enfoque el rendimiento disminuye más, o si la disminución de este es insignificante, es mediante una comparación.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-444">Benchmarking is the only way to know for sure which approach degrades performance the most or if degraded performance is negligible.</span></span>

## <a name="package"></a><span data-ttu-id="7a2f0-445">Package</span><span class="sxs-lookup"><span data-stu-id="7a2f0-445">Package</span></span>

<span data-ttu-id="7a2f0-446">Para incluir el middleware en el proyecto, agregue una referencia de paquete al [metapaquete Microsoft.AspNetCore.App](xref:fundamentals/metapackage-app) del archivo de proyecto, que contiene el paquete [Microsoft.AspNetCore.Rewrite](https://www.nuget.org/packages/Microsoft.AspNetCore.Rewrite).</span><span class="sxs-lookup"><span data-stu-id="7a2f0-446">To include the middleware in your project, add a package reference to the [Microsoft.AspNetCore.App metapackage](xref:fundamentals/metapackage-app) in the project file, which contains the [Microsoft.AspNetCore.Rewrite](https://www.nuget.org/packages/Microsoft.AspNetCore.Rewrite) package.</span></span>

<span data-ttu-id="7a2f0-447">Si no se usa el metapaquete `Microsoft.AspNetCore.App`, agregue una referencia de proyecto al paquete `Microsoft.AspNetCore.Rewrite`.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-447">When not using the `Microsoft.AspNetCore.App` metapackage, add a project reference to the `Microsoft.AspNetCore.Rewrite` package.</span></span>

## <a name="extension-and-options"></a><span data-ttu-id="7a2f0-448">Extensión y opciones</span><span class="sxs-lookup"><span data-stu-id="7a2f0-448">Extension and options</span></span>

<span data-ttu-id="7a2f0-449">Establezca las reglas de reescritura y redirección de URL mediante la creación de una instancia de la clase [RewriteOptions](xref:Microsoft.AspNetCore.Rewrite.RewriteOptions) con métodos de extensión para cada una de las reglas de reescritura.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-449">Establish URL rewrite and redirect rules by creating an instance of the [RewriteOptions](xref:Microsoft.AspNetCore.Rewrite.RewriteOptions) class with extension methods for each of your rewrite rules.</span></span> <span data-ttu-id="7a2f0-450">Encadene varias reglas en el orden que quiera procesarlas.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-450">Chain multiple rules in the order that you would like them processed.</span></span> <span data-ttu-id="7a2f0-451">Las `RewriteOptions` se pasan al middleware de reescritura de URL cuando se agrega a la canalización de solicitudes con <xref:Microsoft.AspNetCore.Builder.RewriteBuilderExtensions.UseRewriter*>:</span><span class="sxs-lookup"><span data-stu-id="7a2f0-451">The `RewriteOptions` are passed into the URL Rewriting Middleware as it's added to the request pipeline with <xref:Microsoft.AspNetCore.Builder.RewriteBuilderExtensions.UseRewriter*>:</span></span>

[!code-csharp[](url-rewriting/samples/2.x/SampleApp/Startup.cs?name=snippet1)]

### <a name="redirect-non-www-to-www"></a><span data-ttu-id="7a2f0-452">Redirigir solicitudes que distintas de www a www</span><span class="sxs-lookup"><span data-stu-id="7a2f0-452">Redirect non-www to www</span></span>

<span data-ttu-id="7a2f0-453">Hay tres opciones que permiten a la aplicación redirigir solicitudes distintas de `www` a `www`:</span><span class="sxs-lookup"><span data-stu-id="7a2f0-453">Three options permit the app to redirect non-`www` requests to `www`:</span></span>

* <span data-ttu-id="7a2f0-454"><xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.AddRedirectToWwwPermanent*> &ndash; Redirige permanentemente la solicitud al subdominio `www` si la solicitud es distinta de `www`.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-454"><xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.AddRedirectToWwwPermanent*> &ndash; Permanently redirect the request to the `www` subdomain if the request is non-`www`.</span></span> <span data-ttu-id="7a2f0-455">Se redirige con un código de estado [Status308PermanentRedirect](xref:Microsoft.AspNetCore.Http.StatusCodes.Status308PermanentRedirect).</span><span class="sxs-lookup"><span data-stu-id="7a2f0-455">Redirects with a [Status308PermanentRedirect](xref:Microsoft.AspNetCore.Http.StatusCodes.Status308PermanentRedirect) status code.</span></span>

* <span data-ttu-id="7a2f0-456"><xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.AddRedirectToWww*> &ndash; Redirige la solicitud al subdominio `www` si la solicitud de entrada es distinta de `www`.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-456"><xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.AddRedirectToWww*> &ndash; Redirect the request to the `www` subdomain if the incoming request is non-`www`.</span></span> <span data-ttu-id="7a2f0-457">Se redirige con un código de estado [Status307TemporaryRedirect](xref:Microsoft.AspNetCore.Http.StatusCodes.Status307TemporaryRedirect).</span><span class="sxs-lookup"><span data-stu-id="7a2f0-457">Redirects with a [Status307TemporaryRedirect](xref:Microsoft.AspNetCore.Http.StatusCodes.Status307TemporaryRedirect) status code.</span></span> <span data-ttu-id="7a2f0-458">Una sobrecarga permite proporcionar el código de estado para la respuesta.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-458">An overload permits you to provide the status code for the response.</span></span> <span data-ttu-id="7a2f0-459">Use un campo de la clase <xref:Microsoft.AspNetCore.Http.StatusCodes> para una asignación de código de estado.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-459">Use a field of the <xref:Microsoft.AspNetCore.Http.StatusCodes> class for a status code assignment.</span></span>

### <a name="url-redirect"></a><span data-ttu-id="7a2f0-460">Redirección de URL</span><span class="sxs-lookup"><span data-stu-id="7a2f0-460">URL redirect</span></span>

<span data-ttu-id="7a2f0-461">Use <xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.AddRedirect*> para redirigir las solicitudes.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-461">Use <xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.AddRedirect*> to redirect requests.</span></span> <span data-ttu-id="7a2f0-462">El primer parámetro contiene la expresión regular para hacer coincidir la ruta de acceso de la URL entrante.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-462">The first parameter contains your regex for matching on the path of the incoming URL.</span></span> <span data-ttu-id="7a2f0-463">El segundo parámetro es la cadena de reemplazo.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-463">The second parameter is the replacement string.</span></span> <span data-ttu-id="7a2f0-464">El tercer parámetro, si está presente, especifica el código de estado.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-464">The third parameter, if present, specifies the status code.</span></span> <span data-ttu-id="7a2f0-465">Si no se especifica el código de estado, el valor predeterminado es *302 - Encontrado*, lo que indica que el recurso se ha movido o reemplazado temporalmente.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-465">If you don't specify the status code, the status code defaults to *302 - Found*, which indicates that the resource is temporarily moved or replaced.</span></span>

[!code-csharp[](url-rewriting/samples/2.x/SampleApp/Startup.cs?name=snippet1&highlight=9)]

<span data-ttu-id="7a2f0-466">En un explorador con herramientas de desarrollo habilitadas, realice una solicitud a la aplicación de ejemplo con la ruta de acceso `/redirect-rule/1234/5678`.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-466">In a browser with developer tools enabled, make a request to the sample app with the path `/redirect-rule/1234/5678`.</span></span> <span data-ttu-id="7a2f0-467">La expresión regular coincide con la ruta de acceso de la solicitud en `redirect-rule/(.*)` y la ruta de acceso se reemplaza con `/redirected/1234/5678`.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-467">The regex matches the request path on `redirect-rule/(.*)`, and the path is replaced with `/redirected/1234/5678`.</span></span> <span data-ttu-id="7a2f0-468">La dirección URL de redireccionamiento se devuelve al cliente con un código de estado *302 - Encontrado*.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-468">The redirect URL is sent back to the client with a *302 - Found* status code.</span></span> <span data-ttu-id="7a2f0-469">El explorador realiza una solicitud nueva en la URL de redireccionamiento, que aparece en la barra de direcciones del explorador.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-469">The browser makes a new request at the redirect URL, which appears in the browser's address bar.</span></span> <span data-ttu-id="7a2f0-470">Como ninguna de las reglas de la aplicación de ejemplo coincide con la dirección URL de redireccionamiento:</span><span class="sxs-lookup"><span data-stu-id="7a2f0-470">Since no rules in the sample app match on the redirect URL:</span></span>

* <span data-ttu-id="7a2f0-471">La segunda solicitud recibe una respuesta *200: correcto* de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-471">The second request receives a *200 - OK* response from the app.</span></span>
* <span data-ttu-id="7a2f0-472">En el cuerpo de la respuesta se muestra la dirección URL de redireccionamiento.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-472">The body of the response shows the redirect URL.</span></span>

<span data-ttu-id="7a2f0-473">Se realiza un recorrido de ida y vuelta al servidor cuando se *redirige* una dirección URL.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-473">A round trip is made to the server when a URL is *redirected*.</span></span>

> [!WARNING]
> <span data-ttu-id="7a2f0-474">Tenga cuidado al establecer las reglas de redirección.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-474">Be cautious when establishing redirect rules.</span></span> <span data-ttu-id="7a2f0-475">Las reglas de redirección se evalúan en cada solicitud enviada a la aplicación, incluso después de una redirección.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-475">Redirect rules are evaluated on every request to the app, including after a redirect.</span></span> <span data-ttu-id="7a2f0-476">Es fácil crear por error un *bucle de redirecciones infinitas*.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-476">It's easy to accidentally create a *loop of infinite redirects*.</span></span>

<span data-ttu-id="7a2f0-477">Solicitud original: `/redirect-rule/1234/5678`</span><span class="sxs-lookup"><span data-stu-id="7a2f0-477">Original Request: `/redirect-rule/1234/5678`</span></span>

![Ventana del explorador con herramientas de desarrollo realizando un seguimiento de las solicitudes y las respuestas](url-rewriting/_static/add_redirect.png)

<span data-ttu-id="7a2f0-479">La parte de la expresión incluida entre paréntesis se denomina *grupo de capturas*.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-479">The part of the expression contained within parentheses is called a *capture group*.</span></span> <span data-ttu-id="7a2f0-480">El punto (`.`) de la expresión significa *buscar cualquier carácter*.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-480">The dot (`.`) of the expression means *match any character*.</span></span> <span data-ttu-id="7a2f0-481">El asterisco (`*`) indica *buscar el carácter precedente cero o más veces*.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-481">The asterisk (`*`) indicates *match the preceding character zero or more times*.</span></span> <span data-ttu-id="7a2f0-482">Por tanto, el grupo de capturas `(.*)` busca los dos últimos segmentos de la ruta de acceso de la URL, `1234/5678`.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-482">Therefore, the last two path segments of the URL, `1234/5678`, are captured by capture group `(.*)`.</span></span> <span data-ttu-id="7a2f0-483">Cualquier valor que se proporcione en la URL de la solicitud después de `redirect-rule/` es capturado por este grupo de capturas único.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-483">Any value you provide in the request URL after `redirect-rule/` is captured by this single capture group.</span></span>

<span data-ttu-id="7a2f0-484">En la cadena de reemplazo, se insertan los grupos capturados en la cadena con el signo de dólar (`$`) seguido del número de secuencia de la captura.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-484">In the replacement string, captured groups are injected into the string with the dollar sign (`$`) followed by the sequence number of the capture.</span></span> <span data-ttu-id="7a2f0-485">Se obtiene el valor del primer grupo de capturas con `$1`, el segundo con `$2`, y así siguen en secuencia para los grupos de capturas de la expresión regular.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-485">The first capture group value is obtained with `$1`, the second with `$2`, and they continue in sequence for the capture groups in your regex.</span></span> <span data-ttu-id="7a2f0-486">Solo hay un grupo capturado en la expresión regular de la regla de redirección de la aplicación de ejemplo, por lo que solo hay un grupo insertado en la cadena de reemplazo, que es `$1`.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-486">There's only one captured group in the redirect rule regex in the sample app, so there's only one injected group in the replacement string, which is `$1`.</span></span> <span data-ttu-id="7a2f0-487">Cuando se aplica la regla, la URL se convierte en `/redirected/1234/5678`.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-487">When the rule is applied, the URL becomes `/redirected/1234/5678`.</span></span>

### <a name="url-redirect-to-a-secure-endpoint"></a><span data-ttu-id="7a2f0-488">Redirección de URL a un punto de conexión segura</span><span class="sxs-lookup"><span data-stu-id="7a2f0-488">URL redirect to a secure endpoint</span></span>

<span data-ttu-id="7a2f0-489">Use <xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.AddRedirectToHttps*> para redirigir las solicitudes HTTP al mismo host y ruta de acceso mediante el protocolo HTTPS.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-489">Use <xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.AddRedirectToHttps*> to redirect HTTP requests to the same host and path using the HTTPS protocol.</span></span> <span data-ttu-id="7a2f0-490">Si no se proporciona el código de estado, el middleware muestra de forma predeterminada *302 - Encontrado*.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-490">If the status code isn't supplied, the middleware defaults to *302 - Found*.</span></span> <span data-ttu-id="7a2f0-491">Si no se proporciona el puerto:</span><span class="sxs-lookup"><span data-stu-id="7a2f0-491">If the port isn't supplied:</span></span>

* <span data-ttu-id="7a2f0-492">El middleware tiene como valor predeterminado `null`.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-492">The middleware defaults to `null`.</span></span>
* <span data-ttu-id="7a2f0-493">El esquema cambia a `https` (protocolo HTTPS), y el cliente accede al recurso en el puerto 443.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-493">The scheme changes to `https` (HTTPS protocol), and the client accesses the resource on port 443.</span></span>

<span data-ttu-id="7a2f0-494">En el ejemplo siguiente se muestra cómo establecer el código de estado en *301 - Movido definitivamente* y cambiar el puerto a 5001.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-494">The following example shows how to set the status code to *301 - Moved Permanently* and change the port to 5001.</span></span>

```csharp
public void Configure(IApplicationBuilder app)
{
    var options = new RewriteOptions()
        .AddRedirectToHttps(301, 5001);

    app.UseRewriter(options);
}
```

<span data-ttu-id="7a2f0-495">Use <xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.AddRedirectToHttpsPermanent*> para redirigir las solicitudes no seguras al mismo host y ruta de acceso mediante el protocolo HTTPS seguro en el puerto 443.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-495">Use <xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.AddRedirectToHttpsPermanent*> to redirect insecure requests to the same host and path with secure HTTPS protocol on port 443.</span></span> <span data-ttu-id="7a2f0-496">El middleware establece el código de estado en *301 - Movido definitivamente*.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-496">The middleware sets the status code to *301 - Moved Permanently*.</span></span>

```csharp
public void Configure(IApplicationBuilder app)
{
    var options = new RewriteOptions()
        .AddRedirectToHttpsPermanent();

    app.UseRewriter(options);
}
```

> [!NOTE]
> <span data-ttu-id="7a2f0-497">Al redirigir a un punto de conexión seguro sin la necesidad de reglas de redirección adicionales, se recomienda usar el Middleware de redirección de HTTPS.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-497">When redirecting to a secure endpoint without the requirement for additional redirect rules, we recommend using HTTPS Redirection Middleware.</span></span> <span data-ttu-id="7a2f0-498">Para más información, vea el tema [Aplicación de HTTPS](xref:security/enforcing-ssl#require-https).</span><span class="sxs-lookup"><span data-stu-id="7a2f0-498">For more information, see the [Enforce HTTPS](xref:security/enforcing-ssl#require-https) topic.</span></span>

<span data-ttu-id="7a2f0-499">La aplicación de ejemplo es capaz de mostrar cómo usar `AddRedirectToHttps` o `AddRedirectToHttpsPermanent`.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-499">The sample app is capable of demonstrating how to use `AddRedirectToHttps` or `AddRedirectToHttpsPermanent`.</span></span> <span data-ttu-id="7a2f0-500">Agregue el método de extensión a `RewriteOptions`.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-500">Add the extension method to the `RewriteOptions`.</span></span> <span data-ttu-id="7a2f0-501">Realice una solicitud poco segura a la aplicación en cualquier URL.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-501">Make an insecure request to the app at any URL.</span></span> <span data-ttu-id="7a2f0-502">Descarte la advertencia de seguridad del explorador que indica que el certificado autofirmado no es de confianza o cree una excepción para confiar en el certificado en cuestión.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-502">Dismiss the browser security warning that the self-signed certificate is untrusted or create an exception to trust the certificate.</span></span>

<span data-ttu-id="7a2f0-503">Solicitud original mediante `AddRedirectToHttps(301, 5001)`: `http://localhost:5000/secure`</span><span class="sxs-lookup"><span data-stu-id="7a2f0-503">Original Request using `AddRedirectToHttps(301, 5001)`: `http://localhost:5000/secure`</span></span>

![Ventana del explorador con herramientas de desarrollo realizando un seguimiento de las solicitudes y las respuestas](url-rewriting/_static/add_redirect_to_https.png)

<span data-ttu-id="7a2f0-505">Solicitud original mediante `AddRedirectToHttpsPermanent`: `http://localhost:5000/secure`</span><span class="sxs-lookup"><span data-stu-id="7a2f0-505">Original Request using `AddRedirectToHttpsPermanent`: `http://localhost:5000/secure`</span></span>

![Ventana del explorador con herramientas de desarrollo realizando un seguimiento de las solicitudes y las respuestas](url-rewriting/_static/add_redirect_to_https_permanent.png)

### <a name="url-rewrite"></a><span data-ttu-id="7a2f0-507">Reescritura de URL</span><span class="sxs-lookup"><span data-stu-id="7a2f0-507">URL rewrite</span></span>

<span data-ttu-id="7a2f0-508">Use <xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.AddRewrite*> para crear una regla para reescribir URL.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-508">Use <xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.AddRewrite*> to create a rule for rewriting URLs.</span></span> <span data-ttu-id="7a2f0-509">El primer parámetro contiene la expresión regular para buscar coincidencias en la ruta de dirección de URL entrante.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-509">The first parameter contains the regex for matching on the incoming URL path.</span></span> <span data-ttu-id="7a2f0-510">El segundo parámetro es la cadena de reemplazo.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-510">The second parameter is the replacement string.</span></span> <span data-ttu-id="7a2f0-511">El tercer parámetro, `skipRemainingRules: {true|false}`, indica al middleware si al aplicar la regla actual tiene que omitir o no alguna regla de redirección adicional.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-511">The third parameter, `skipRemainingRules: {true|false}`, indicates to the middleware whether or not to skip additional rewrite rules if the current rule is applied.</span></span>

[!code-csharp[](url-rewriting/samples/2.x/SampleApp/Startup.cs?name=snippet1&highlight=10-11)]

<span data-ttu-id="7a2f0-512">Solicitud original: `/rewrite-rule/1234/5678`</span><span class="sxs-lookup"><span data-stu-id="7a2f0-512">Original Request: `/rewrite-rule/1234/5678`</span></span>

![Ventana del explorador con herramientas de desarrollo realizando un seguimiento de las solicitudes y las respuestas](url-rewriting/_static/add_rewrite.png)

<span data-ttu-id="7a2f0-514">El acento circunflejo (`^`) al principio de la expresión significa que la búsqueda de coincidencias empieza al principio de la ruta de dirección URL.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-514">The carat (`^`) at the beginning of the expression means that matching starts at the beginning of the URL path.</span></span>

<span data-ttu-id="7a2f0-515">En el ejemplo anterior de la regla de redireccionamiento (`redirect-rule/(.*)`), no hay ningún acento circunflejo (`^`) al principio de la expresión regular.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-515">In the earlier example with the redirect rule, `redirect-rule/(.*)`, there's no carat (`^`) at the start of the regex.</span></span> <span data-ttu-id="7a2f0-516">Por tanto, cualquier carácter puede preceder a `redirect-rule/` en la ruta de acceso para que la coincidencia sea correcta.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-516">Therefore, any characters may precede `redirect-rule/` in the path for a successful match.</span></span>

| <span data-ttu-id="7a2f0-517">Ruta de acceso</span><span class="sxs-lookup"><span data-stu-id="7a2f0-517">Path</span></span>                               | <span data-ttu-id="7a2f0-518">Coincidir con</span><span class="sxs-lookup"><span data-stu-id="7a2f0-518">Match</span></span> |
| ---------------------------------- | :---: |
| `/redirect-rule/1234/5678`         | <span data-ttu-id="7a2f0-519">Sí</span><span class="sxs-lookup"><span data-stu-id="7a2f0-519">Yes</span></span>   |
| `/my-cool-redirect-rule/1234/5678` | <span data-ttu-id="7a2f0-520">Sí</span><span class="sxs-lookup"><span data-stu-id="7a2f0-520">Yes</span></span>   |
| `/anotherredirect-rule/1234/5678`  | <span data-ttu-id="7a2f0-521">Sí</span><span class="sxs-lookup"><span data-stu-id="7a2f0-521">Yes</span></span>   |

<span data-ttu-id="7a2f0-522">La regla de reescritura, `^rewrite-rule/(\d+)/(\d+)`, solo encuentra rutas de acceso que empiezan con `rewrite-rule/`.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-522">The rewrite rule, `^rewrite-rule/(\d+)/(\d+)`, only matches paths if they start with `rewrite-rule/`.</span></span> <span data-ttu-id="7a2f0-523">En la tabla siguiente, observe la diferencia de coincidencia.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-523">In the following table, note the difference in matching.</span></span>

| <span data-ttu-id="7a2f0-524">Ruta de acceso</span><span class="sxs-lookup"><span data-stu-id="7a2f0-524">Path</span></span>                              | <span data-ttu-id="7a2f0-525">Coincidir con</span><span class="sxs-lookup"><span data-stu-id="7a2f0-525">Match</span></span> |
| --------------------------------- | :---: |
| `/rewrite-rule/1234/5678`         | <span data-ttu-id="7a2f0-526">Sí</span><span class="sxs-lookup"><span data-stu-id="7a2f0-526">Yes</span></span>   |
| `/my-cool-rewrite-rule/1234/5678` | <span data-ttu-id="7a2f0-527">No</span><span class="sxs-lookup"><span data-stu-id="7a2f0-527">No</span></span>    |
| `/anotherrewrite-rule/1234/5678`  | <span data-ttu-id="7a2f0-528">No</span><span class="sxs-lookup"><span data-stu-id="7a2f0-528">No</span></span>    |

<span data-ttu-id="7a2f0-529">Después de la parte `^rewrite-rule/` de la expresión, hay dos grupos de captura, `(\d+)/(\d+)`.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-529">Following the `^rewrite-rule/` portion of the expression, there are two capture groups, `(\d+)/(\d+)`.</span></span> <span data-ttu-id="7a2f0-530">`\d` significa *buscar un dígito (número)* .</span><span class="sxs-lookup"><span data-stu-id="7a2f0-530">The `\d` signifies *match a digit (number)*.</span></span> <span data-ttu-id="7a2f0-531">El signo más (`+`) significa *buscar uno o más de los caracteres anteriores*.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-531">The plus sign (`+`) means *match one or more of the preceding character*.</span></span> <span data-ttu-id="7a2f0-532">Por tanto, la URL debe contener un número seguido de una barra diagonal, seguida de otro número.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-532">Therefore, the URL must contain a number followed by a forward-slash followed by another number.</span></span> <span data-ttu-id="7a2f0-533">Estos grupos de capturas se insertan en la URL de reescritura como `$1` y `$2`.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-533">These capture groups are injected into the rewritten URL as `$1` and `$2`.</span></span> <span data-ttu-id="7a2f0-534">La cadena de reemplazo de la regla de reescritura coloca los grupos capturados en la cadena de consulta.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-534">The rewrite rule replacement string places the captured groups into the query string.</span></span> <span data-ttu-id="7a2f0-535">La ruta de acceso solicitada de `/rewrite-rule/1234/5678` se reescribe para obtener el recurso en `/rewritten?var1=1234&var2=5678`.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-535">The requested path of `/rewrite-rule/1234/5678` is rewritten to obtain the resource at `/rewritten?var1=1234&var2=5678`.</span></span> <span data-ttu-id="7a2f0-536">Si una cadena de consulta está presente en la solicitud original, se conserva cuando se reescribe la dirección URL.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-536">If a query string is present on the original request, it's preserved when the URL is rewritten.</span></span>

<span data-ttu-id="7a2f0-537">No hay ningún recorrido de ida y vuelta al servidor para obtener el recurso.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-537">There's no round trip to the server to obtain the resource.</span></span> <span data-ttu-id="7a2f0-538">Si el recurso existe, se captura y se devuelve al cliente con un código de estado *200 - Correcto*.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-538">If the resource exists, it's fetched and returned to the client with a *200 - OK* status code.</span></span> <span data-ttu-id="7a2f0-539">Como el cliente no se redirige, la dirección URL no cambia en la barra de direcciones del explorador.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-539">Because the client isn't redirected, the URL in the browser's address bar doesn't change.</span></span> <span data-ttu-id="7a2f0-540">Los clientes no pueden detectar que se ha producido una operación de reescritura de URL en el servidor.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-540">Clients can't detect that a URL rewrite operation occurred on the server.</span></span>

> [!NOTE]
> <span data-ttu-id="7a2f0-541">Use `skipRemainingRules: true` siempre que sea posible, ya que las reglas de coincidencia consumen muchos recursos y aumentan el tiempo de respuesta de aplicación.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-541">Use `skipRemainingRules: true` whenever possible because matching rules is computationally expensive and increases app response time.</span></span> <span data-ttu-id="7a2f0-542">Para obtener la respuesta más rápida de la aplicación:</span><span class="sxs-lookup"><span data-stu-id="7a2f0-542">For the fastest app response:</span></span>
>
> * <span data-ttu-id="7a2f0-543">Ordene las reglas de reescritura desde la que coincida con más frecuencia a la que coincida con menos frecuencia.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-543">Order rewrite rules from the most frequently matched rule to the least frequently matched rule.</span></span>
> * <span data-ttu-id="7a2f0-544">Omita el procesamiento de las reglas restantes cuando se produzca una coincidencia; no es necesario ningún procesamiento de reglas adicional.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-544">Skip the processing of the remaining rules when a match occurs and no additional rule processing is required.</span></span>

### <a name="apache-mod_rewrite"></a><span data-ttu-id="7a2f0-545">mod_rewrite de Apache</span><span class="sxs-lookup"><span data-stu-id="7a2f0-545">Apache mod_rewrite</span></span>

<span data-ttu-id="7a2f0-546">Aplique reglas mod_rewrite de Apache con <xref:Microsoft.AspNetCore.Rewrite.ApacheModRewriteOptionsExtensions.AddApacheModRewrite*>.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-546">Apply Apache mod_rewrite rules with <xref:Microsoft.AspNetCore.Rewrite.ApacheModRewriteOptionsExtensions.AddApacheModRewrite*>.</span></span> <span data-ttu-id="7a2f0-547">Asegúrese de que el archivo de reglas se implementa con la aplicación.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-547">Make sure that the rules file is deployed with the app.</span></span> <span data-ttu-id="7a2f0-548">Para obtener más información y ejemplos de reglas mod_rewrite, vea [Apache mod_rewrite](https://httpd.apache.org/docs/2.4/rewrite/) (mod_rewrite de Apache).</span><span class="sxs-lookup"><span data-stu-id="7a2f0-548">For more information and examples of mod_rewrite rules, see [Apache mod_rewrite](https://httpd.apache.org/docs/2.4/rewrite/).</span></span>

<span data-ttu-id="7a2f0-549">Se usa <xref:System.IO.StreamReader> para leer las reglas del archivo de reglas *ApacheModRewrite.txt*:</span><span class="sxs-lookup"><span data-stu-id="7a2f0-549">A <xref:System.IO.StreamReader> is used to read the rules from the *ApacheModRewrite.txt* rules file:</span></span>

[!code-csharp[](url-rewriting/samples/2.x/SampleApp/Startup.cs?name=snippet1&highlight=3-4,12)]

<span data-ttu-id="7a2f0-550">La aplicación de ejemplo redirige las solicitudes de `/apache-mod-rules-redirect/(.\*)` a `/redirected?id=$1`.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-550">The sample app redirects requests from `/apache-mod-rules-redirect/(.\*)` to `/redirected?id=$1`.</span></span> <span data-ttu-id="7a2f0-551">El código de estado de la respuesta es *302: Encontrado*.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-551">The response status code is *302 - Found*.</span></span>

[!code[](url-rewriting/samples/2.x/SampleApp/ApacheModRewrite.txt)]

<span data-ttu-id="7a2f0-552">Solicitud original: `/apache-mod-rules-redirect/1234`</span><span class="sxs-lookup"><span data-stu-id="7a2f0-552">Original Request: `/apache-mod-rules-redirect/1234`</span></span>

![Ventana del explorador con herramientas de desarrollo realizando un seguimiento de las solicitudes y las respuestas](url-rewriting/_static/add_apache_mod_redirect.png)

<span data-ttu-id="7a2f0-554">El middleware admite las siguientes variables de servidor mod_rewrite de Apache:</span><span class="sxs-lookup"><span data-stu-id="7a2f0-554">The middleware supports the following Apache mod_rewrite server variables:</span></span>

* <span data-ttu-id="7a2f0-555">CONN_REMOTE_ADDR</span><span class="sxs-lookup"><span data-stu-id="7a2f0-555">CONN_REMOTE_ADDR</span></span>
* <span data-ttu-id="7a2f0-556">HTTP_ACCEPT</span><span class="sxs-lookup"><span data-stu-id="7a2f0-556">HTTP_ACCEPT</span></span>
* <span data-ttu-id="7a2f0-557">HTTP_CONNECTION</span><span class="sxs-lookup"><span data-stu-id="7a2f0-557">HTTP_CONNECTION</span></span>
* <span data-ttu-id="7a2f0-558">HTTP_COOKIE</span><span class="sxs-lookup"><span data-stu-id="7a2f0-558">HTTP_COOKIE</span></span>
* <span data-ttu-id="7a2f0-559">HTTP_FORWARDED</span><span class="sxs-lookup"><span data-stu-id="7a2f0-559">HTTP_FORWARDED</span></span>
* <span data-ttu-id="7a2f0-560">HTTP_HOST</span><span class="sxs-lookup"><span data-stu-id="7a2f0-560">HTTP_HOST</span></span>
* <span data-ttu-id="7a2f0-561">HTTP_REFERER</span><span class="sxs-lookup"><span data-stu-id="7a2f0-561">HTTP_REFERER</span></span>
* <span data-ttu-id="7a2f0-562">HTTP_USER_AGENT</span><span class="sxs-lookup"><span data-stu-id="7a2f0-562">HTTP_USER_AGENT</span></span>
* <span data-ttu-id="7a2f0-563">HTTPS</span><span class="sxs-lookup"><span data-stu-id="7a2f0-563">HTTPS</span></span>
* <span data-ttu-id="7a2f0-564">IPV6</span><span class="sxs-lookup"><span data-stu-id="7a2f0-564">IPV6</span></span>
* <span data-ttu-id="7a2f0-565">QUERY_STRING</span><span class="sxs-lookup"><span data-stu-id="7a2f0-565">QUERY_STRING</span></span>
* <span data-ttu-id="7a2f0-566">REMOTE_ADDR</span><span class="sxs-lookup"><span data-stu-id="7a2f0-566">REMOTE_ADDR</span></span>
* <span data-ttu-id="7a2f0-567">REMOTE_PORT</span><span class="sxs-lookup"><span data-stu-id="7a2f0-567">REMOTE_PORT</span></span>
* <span data-ttu-id="7a2f0-568">REQUEST_FILENAME</span><span class="sxs-lookup"><span data-stu-id="7a2f0-568">REQUEST_FILENAME</span></span>
* <span data-ttu-id="7a2f0-569">REQUEST_METHOD</span><span class="sxs-lookup"><span data-stu-id="7a2f0-569">REQUEST_METHOD</span></span>
* <span data-ttu-id="7a2f0-570">REQUEST_SCHEME</span><span class="sxs-lookup"><span data-stu-id="7a2f0-570">REQUEST_SCHEME</span></span>
* <span data-ttu-id="7a2f0-571">REQUEST_URI</span><span class="sxs-lookup"><span data-stu-id="7a2f0-571">REQUEST_URI</span></span>
* <span data-ttu-id="7a2f0-572">SCRIPT_FILENAME</span><span class="sxs-lookup"><span data-stu-id="7a2f0-572">SCRIPT_FILENAME</span></span>
* <span data-ttu-id="7a2f0-573">SERVER_ADDR</span><span class="sxs-lookup"><span data-stu-id="7a2f0-573">SERVER_ADDR</span></span>
* <span data-ttu-id="7a2f0-574">SERVER_PORT</span><span class="sxs-lookup"><span data-stu-id="7a2f0-574">SERVER_PORT</span></span>
* <span data-ttu-id="7a2f0-575">SERVER_PROTOCOL</span><span class="sxs-lookup"><span data-stu-id="7a2f0-575">SERVER_PROTOCOL</span></span>
* <span data-ttu-id="7a2f0-576">TIME</span><span class="sxs-lookup"><span data-stu-id="7a2f0-576">TIME</span></span>
* <span data-ttu-id="7a2f0-577">TIME_DAY</span><span class="sxs-lookup"><span data-stu-id="7a2f0-577">TIME_DAY</span></span>
* <span data-ttu-id="7a2f0-578">TIME_HOUR</span><span class="sxs-lookup"><span data-stu-id="7a2f0-578">TIME_HOUR</span></span>
* <span data-ttu-id="7a2f0-579">TIME_MIN</span><span class="sxs-lookup"><span data-stu-id="7a2f0-579">TIME_MIN</span></span>
* <span data-ttu-id="7a2f0-580">TIME_MON</span><span class="sxs-lookup"><span data-stu-id="7a2f0-580">TIME_MON</span></span>
* <span data-ttu-id="7a2f0-581">TIME_SEC</span><span class="sxs-lookup"><span data-stu-id="7a2f0-581">TIME_SEC</span></span>
* <span data-ttu-id="7a2f0-582">TIME_WDAY</span><span class="sxs-lookup"><span data-stu-id="7a2f0-582">TIME_WDAY</span></span>
* <span data-ttu-id="7a2f0-583">TIME_YEAR</span><span class="sxs-lookup"><span data-stu-id="7a2f0-583">TIME_YEAR</span></span>

### <a name="iis-url-rewrite-module-rules"></a><span data-ttu-id="7a2f0-584">Reglas del Módulo URL Rewrite para IIS</span><span class="sxs-lookup"><span data-stu-id="7a2f0-584">IIS URL Rewrite Module rules</span></span>

<span data-ttu-id="7a2f0-585">Para usar el mismo conjunto de reglas que se aplica al módulo URL Rewrite para IIS, use <xref:Microsoft.AspNetCore.Rewrite.IISUrlRewriteOptionsExtensions.AddIISUrlRewrite*>.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-585">To use the same rule set that applies to the IIS URL Rewrite Module, use <xref:Microsoft.AspNetCore.Rewrite.IISUrlRewriteOptionsExtensions.AddIISUrlRewrite*>.</span></span> <span data-ttu-id="7a2f0-586">Asegúrese de que el archivo de reglas se implementa con la aplicación.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-586">Make sure that the rules file is deployed with the app.</span></span> <span data-ttu-id="7a2f0-587">No dirija el middleware para que use el archivo *web.config* de la aplicación cuando se ejecute en Windows Server IIS.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-587">Don't direct the middleware to use the app's *web.config* file when running on Windows Server IIS.</span></span> <span data-ttu-id="7a2f0-588">Con IIS, estas reglas se deben almacenar fuera del archivo *web.config* de la aplicación para evitar conflictos con el Módulo URL Rewrite para IIS.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-588">With IIS, these rules should be stored outside of the app's *web.config* file in order to avoid conflicts with the IIS Rewrite module.</span></span> <span data-ttu-id="7a2f0-589">Para obtener más información y ejemplos de reglas del Módulo URL Rewrite para IIS, vea [Using Url Rewrite Module 2.0](/iis/extensions/url-rewrite-module/using-url-rewrite-module-20) (Uso del Módulo URL Rewrite 2.0) y [URL Rewrite Module Configuration Reference](/iis/extensions/url-rewrite-module/url-rewrite-module-configuration-reference) (Referencia de configuración del Módulo URL Rewrite).</span><span class="sxs-lookup"><span data-stu-id="7a2f0-589">For more information and examples of IIS URL Rewrite Module rules, see [Using Url Rewrite Module 2.0](/iis/extensions/url-rewrite-module/using-url-rewrite-module-20) and [URL Rewrite Module Configuration Reference](/iis/extensions/url-rewrite-module/url-rewrite-module-configuration-reference).</span></span>

<span data-ttu-id="7a2f0-590">Se usa <xref:System.IO.StreamReader> para leer las reglas del archivo de reglas *IISUrlRewrite.xml*:</span><span class="sxs-lookup"><span data-stu-id="7a2f0-590">A <xref:System.IO.StreamReader> is used to read the rules from the *IISUrlRewrite.xml* rules file:</span></span>

[!code-csharp[](url-rewriting/samples/2.x/SampleApp/Startup.cs?name=snippet1&highlight=5-6,13)]

<span data-ttu-id="7a2f0-591">La aplicación de ejemplo reescribe las solicitudes de `/iis-rules-rewrite/(.*)` a `/rewritten?id=$1`.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-591">The sample app rewrites requests from `/iis-rules-rewrite/(.*)` to `/rewritten?id=$1`.</span></span> <span data-ttu-id="7a2f0-592">La respuesta se envía al cliente con un código de estado *200 - Correcto*.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-592">The response is sent to the client with a *200 - OK* status code.</span></span>

[!code-xml[](url-rewriting/samples/2.x/SampleApp/IISUrlRewrite.xml)]

<span data-ttu-id="7a2f0-593">Solicitud original: `/iis-rules-rewrite/1234`</span><span class="sxs-lookup"><span data-stu-id="7a2f0-593">Original Request: `/iis-rules-rewrite/1234`</span></span>

![Ventana del explorador con herramientas de desarrollo realizando un seguimiento de las solicitudes y las respuestas](url-rewriting/_static/add_iis_url_rewrite.png)

<span data-ttu-id="7a2f0-595">Si tiene un Módulo URL Rewrite para IIS activo con reglas configuradas en el nivel de servidor que podrían afectar a la aplicación de manera no deseada, puede deshabilitar el Módulo URL Rewrite para IIS para una aplicación.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-595">If you have an active IIS Rewrite Module with server-level rules configured that would impact your app in undesirable ways, you can disable the IIS Rewrite Module for an app.</span></span> <span data-ttu-id="7a2f0-596">Para más información, vea [Disabling IIS modules](xref:host-and-deploy/iis/modules#disabling-iis-modules) (Deshabilitación de módulos de IIS).</span><span class="sxs-lookup"><span data-stu-id="7a2f0-596">For more information, see [Disabling IIS modules](xref:host-and-deploy/iis/modules#disabling-iis-modules).</span></span>

#### <a name="unsupported-features"></a><span data-ttu-id="7a2f0-597">Características no admitidas</span><span class="sxs-lookup"><span data-stu-id="7a2f0-597">Unsupported features</span></span>

<span data-ttu-id="7a2f0-598">El middleware publicado con ASP.NET Core 2.x no admite las siguientes características de Módulo URL Rewrite para IIS:</span><span class="sxs-lookup"><span data-stu-id="7a2f0-598">The middleware released with ASP.NET Core 2.x doesn't support the following IIS URL Rewrite Module features:</span></span>

* <span data-ttu-id="7a2f0-599">Reglas de salida</span><span class="sxs-lookup"><span data-stu-id="7a2f0-599">Outbound Rules</span></span>
* <span data-ttu-id="7a2f0-600">Variables de servidor personalizadas</span><span class="sxs-lookup"><span data-stu-id="7a2f0-600">Custom Server Variables</span></span>
* <span data-ttu-id="7a2f0-601">Caracteres comodín</span><span class="sxs-lookup"><span data-stu-id="7a2f0-601">Wildcards</span></span>
* <span data-ttu-id="7a2f0-602">LogRewrittenUrl</span><span class="sxs-lookup"><span data-stu-id="7a2f0-602">LogRewrittenUrl</span></span>

#### <a name="supported-server-variables"></a><span data-ttu-id="7a2f0-603">Variables de servidor compatibles</span><span class="sxs-lookup"><span data-stu-id="7a2f0-603">Supported server variables</span></span>

<span data-ttu-id="7a2f0-604">El middleware admite las siguientes variables de servidor del Módulo URL Rewrite para IIS:</span><span class="sxs-lookup"><span data-stu-id="7a2f0-604">The middleware supports the following IIS URL Rewrite Module server variables:</span></span>

* <span data-ttu-id="7a2f0-605">CONTENT_LENGTH</span><span class="sxs-lookup"><span data-stu-id="7a2f0-605">CONTENT_LENGTH</span></span>
* <span data-ttu-id="7a2f0-606">CONTENT_TYPE</span><span class="sxs-lookup"><span data-stu-id="7a2f0-606">CONTENT_TYPE</span></span>
* <span data-ttu-id="7a2f0-607">HTTP_ACCEPT</span><span class="sxs-lookup"><span data-stu-id="7a2f0-607">HTTP_ACCEPT</span></span>
* <span data-ttu-id="7a2f0-608">HTTP_CONNECTION</span><span class="sxs-lookup"><span data-stu-id="7a2f0-608">HTTP_CONNECTION</span></span>
* <span data-ttu-id="7a2f0-609">HTTP_COOKIE</span><span class="sxs-lookup"><span data-stu-id="7a2f0-609">HTTP_COOKIE</span></span>
* <span data-ttu-id="7a2f0-610">HTTP_HOST</span><span class="sxs-lookup"><span data-stu-id="7a2f0-610">HTTP_HOST</span></span>
* <span data-ttu-id="7a2f0-611">HTTP_REFERER</span><span class="sxs-lookup"><span data-stu-id="7a2f0-611">HTTP_REFERER</span></span>
* <span data-ttu-id="7a2f0-612">HTTP_URL</span><span class="sxs-lookup"><span data-stu-id="7a2f0-612">HTTP_URL</span></span>
* <span data-ttu-id="7a2f0-613">HTTP_USER_AGENT</span><span class="sxs-lookup"><span data-stu-id="7a2f0-613">HTTP_USER_AGENT</span></span>
* <span data-ttu-id="7a2f0-614">HTTPS</span><span class="sxs-lookup"><span data-stu-id="7a2f0-614">HTTPS</span></span>
* <span data-ttu-id="7a2f0-615">LOCAL_ADDR</span><span class="sxs-lookup"><span data-stu-id="7a2f0-615">LOCAL_ADDR</span></span>
* <span data-ttu-id="7a2f0-616">QUERY_STRING</span><span class="sxs-lookup"><span data-stu-id="7a2f0-616">QUERY_STRING</span></span>
* <span data-ttu-id="7a2f0-617">REMOTE_ADDR</span><span class="sxs-lookup"><span data-stu-id="7a2f0-617">REMOTE_ADDR</span></span>
* <span data-ttu-id="7a2f0-618">REMOTE_PORT</span><span class="sxs-lookup"><span data-stu-id="7a2f0-618">REMOTE_PORT</span></span>
* <span data-ttu-id="7a2f0-619">REQUEST_FILENAME</span><span class="sxs-lookup"><span data-stu-id="7a2f0-619">REQUEST_FILENAME</span></span>
* <span data-ttu-id="7a2f0-620">REQUEST_URI</span><span class="sxs-lookup"><span data-stu-id="7a2f0-620">REQUEST_URI</span></span>

> [!NOTE]
> <span data-ttu-id="7a2f0-621">También puede obtener <xref:Microsoft.Extensions.FileProviders.IFileProvider> a través de <xref:Microsoft.Extensions.FileProviders.PhysicalFileProvider>.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-621">You can also obtain an <xref:Microsoft.Extensions.FileProviders.IFileProvider> via a <xref:Microsoft.Extensions.FileProviders.PhysicalFileProvider>.</span></span> <span data-ttu-id="7a2f0-622">Con este enfoque logrará mayor flexibilidad para la ubicación de los archivos de reglas de reescritura.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-622">This approach may provide greater flexibility for the location of your rewrite rules files.</span></span> <span data-ttu-id="7a2f0-623">Asegúrese de que los archivos de reglas de reescritura se implementan en el servidor en la ruta de acceso que proporcione.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-623">Make sure that your rewrite rules files are deployed to the server at the path you provide.</span></span>
>
> ```csharp
> PhysicalFileProvider fileProvider = new PhysicalFileProvider(Directory.GetCurrentDirectory());
> ```

### <a name="method-based-rule"></a><span data-ttu-id="7a2f0-624">Regla basada en métodos</span><span class="sxs-lookup"><span data-stu-id="7a2f0-624">Method-based rule</span></span>

<span data-ttu-id="7a2f0-625">Use <xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.Add*> para implementar su propia lógica de la regla en un método.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-625">Use <xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.Add*> to implement your own rule logic in a method.</span></span> <span data-ttu-id="7a2f0-626">`Add` expone el elemento <xref:Microsoft.AspNetCore.Rewrite.RewriteContext>, lo que hace que <xref:Microsoft.AspNetCore.Http.HttpContext> esté disponible para usarlo en el método.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-626">`Add` exposes the <xref:Microsoft.AspNetCore.Rewrite.RewriteContext>, which makes available the <xref:Microsoft.AspNetCore.Http.HttpContext> for use in your method.</span></span> <span data-ttu-id="7a2f0-627">[RewriteContext.Result](xref:Microsoft.AspNetCore.Rewrite.RewriteContext.Result*) determina cómo se administra el procesamiento adicional en la canalización.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-627">The [RewriteContext.Result](xref:Microsoft.AspNetCore.Rewrite.RewriteContext.Result*) determines how additional pipeline processing is handled.</span></span> <span data-ttu-id="7a2f0-628">Establezca el valor en uno de los campos <xref:Microsoft.AspNetCore.Rewrite.RuleResult> que se describen en la tabla siguiente.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-628">Set the value to one of the <xref:Microsoft.AspNetCore.Rewrite.RuleResult> fields described in the following table.</span></span>

| `RewriteContext.Result`              | <span data-ttu-id="7a2f0-629">Acción</span><span class="sxs-lookup"><span data-stu-id="7a2f0-629">Action</span></span>                                                           |
| ------------------------------------ | ---------------------------------------------------------------- |
| <span data-ttu-id="7a2f0-630">`RuleResult.ContinueRules` (valor predeterminado)</span><span class="sxs-lookup"><span data-stu-id="7a2f0-630">`RuleResult.ContinueRules` (default)</span></span> | <span data-ttu-id="7a2f0-631">Continuar aplicando las reglas.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-631">Continue applying rules.</span></span>                                         |
| `RuleResult.EndResponse`             | <span data-ttu-id="7a2f0-632">Dejar de aplicar las reglas y enviar la respuesta.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-632">Stop applying rules and send the response.</span></span>                       |
| `RuleResult.SkipRemainingRules`      | <span data-ttu-id="7a2f0-633">Dejar de aplicar las reglas y enviar el contexto al middleware siguiente.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-633">Stop applying rules and send the context to the next middleware.</span></span> |

[!code-csharp[](url-rewriting/samples/2.x/SampleApp/Startup.cs?name=snippet1&highlight=14)]

<span data-ttu-id="7a2f0-634">La aplicación de ejemplo muestra un método que redirige las solicitudes para las rutas de acceso que terminen con *.xml*.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-634">The sample app demonstrates a method that redirects requests for paths that end with *.xml*.</span></span> <span data-ttu-id="7a2f0-635">Si se realiza una solicitud de `/file.xml`, la solicitud se redirige a `/xmlfiles/file.xml`.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-635">If a request is made for `/file.xml`, the request is redirected to `/xmlfiles/file.xml`.</span></span> <span data-ttu-id="7a2f0-636">El código de estado se establece en *301 - Movido definitivamente*.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-636">The status code is set to *301 - Moved Permanently*.</span></span> <span data-ttu-id="7a2f0-637">Cuando el explorador realiza una solicitud nueva a */xmlfiles/file.xml*, el middleware de archivos estáticos sirve el archivo al cliente desde la carpeta *wwwroot/xmlfiles*.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-637">When the browser makes a new request for */xmlfiles/file.xml*, Static File Middleware serves the file to the client from the *wwwroot/xmlfiles* folder.</span></span> <span data-ttu-id="7a2f0-638">Para un redireccionamiento, debe establecer de forma explícita el código de estado de la respuesta.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-638">For a redirect, explicitly set the status code of the response.</span></span> <span data-ttu-id="7a2f0-639">En caso contrario, se devuelve un código de estado *200: correcto* y no se produce el redireccionamiento en el cliente.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-639">Otherwise, a *200 - OK* status code is returned, and the redirect doesn't occur on the client.</span></span>

<span data-ttu-id="7a2f0-640">*RewriteRules.cs*:</span><span class="sxs-lookup"><span data-stu-id="7a2f0-640">*RewriteRules.cs*:</span></span>

[!code-csharp[](url-rewriting/samples/2.x/SampleApp/RewriteRules.cs?name=snippet_RedirectXmlFileRequests&highlight=14-18)]

<span data-ttu-id="7a2f0-641">Este enfoque también permite volver a escribir las solicitudes.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-641">This approach can also rewrite requests.</span></span> <span data-ttu-id="7a2f0-642">En la aplicación de ejemplo se muestra cómo volver a escribir la ruta de acceso para cualquier solicitud de archivo de texto para proporcionar el archivo de texto *file.txt* desde la carpeta *wwwroot*.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-642">The sample app demonstrates rewriting the path for any text file request to serve the *file.txt* text file from the *wwwroot* folder.</span></span> <span data-ttu-id="7a2f0-643">El middleware de archivos estáticos proporciona el archivo en función de la ruta de acceso de la solicitud actualizada:</span><span class="sxs-lookup"><span data-stu-id="7a2f0-643">Static File Middleware serves the file based on the updated request path:</span></span>

[!code-csharp[](url-rewriting/samples/2.x/SampleApp/Startup.cs?name=snippet1&highlight=15,22)]

<span data-ttu-id="7a2f0-644">*RewriteRules.cs*:</span><span class="sxs-lookup"><span data-stu-id="7a2f0-644">*RewriteRules.cs*:</span></span>

[!code-csharp[](url-rewriting/samples/2.x/SampleApp/RewriteRules.cs?name=snippet_RewriteTextFileRequests&highlight=7-8)]

### <a name="irule-based-rule"></a><span data-ttu-id="7a2f0-645">Regla basada en IRule</span><span class="sxs-lookup"><span data-stu-id="7a2f0-645">IRule-based rule</span></span>

<span data-ttu-id="7a2f0-646">Utilice <xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.Add*> para usar la lógica de reglas en una clase que implemente la interfaz <xref:Microsoft.AspNetCore.Rewrite.IRule>.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-646">Use <xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.Add*> to use rule logic in a class that implements the <xref:Microsoft.AspNetCore.Rewrite.IRule> interface.</span></span> <span data-ttu-id="7a2f0-647">`IRule` proporciona mayor flexibilidad que si se usa el enfoque de reglas basadas en métodos.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-647">`IRule` provides greater flexibility over using the method-based rule approach.</span></span> <span data-ttu-id="7a2f0-648">La clase de implementación puede incluir un constructor que permita pasar parámetros para el método <xref:Microsoft.AspNetCore.Rewrite.IRule.ApplyRule*>.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-648">Your implementation class may include a constructor that allows you can pass in parameters for the <xref:Microsoft.AspNetCore.Rewrite.IRule.ApplyRule*> method.</span></span>

[!code-csharp[](url-rewriting/samples/2.x/SampleApp/Startup.cs?name=snippet1&highlight=16-17)]

<span data-ttu-id="7a2f0-649">Se comprueba que los valores de los parámetros en la aplicación de ejemplo para `extension` y `newPath` cumplen ciertas condiciones.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-649">The values of the parameters in the sample app for the `extension` and the `newPath` are checked to meet several conditions.</span></span> <span data-ttu-id="7a2f0-650">`extension` debe contener un valor, que debe ser *.png*, *.jpg* o *.gif*.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-650">The `extension` must contain a value, and the value must be *.png*, *.jpg*, or *.gif*.</span></span> <span data-ttu-id="7a2f0-651">Si `newPath` no es válido, se genera <xref:System.ArgumentException> .</span><span class="sxs-lookup"><span data-stu-id="7a2f0-651">If the `newPath` isn't valid, an <xref:System.ArgumentException> is thrown.</span></span> <span data-ttu-id="7a2f0-652">Si se realiza una solicitud de *image.png*, la solicitud se redirige a `/png-images/image.png`.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-652">If a request is made for *image.png*, the request is redirected to `/png-images/image.png`.</span></span> <span data-ttu-id="7a2f0-653">Si se realiza una solicitud de *image.jpg*, la solicitud se redirige a `/jpg-images/image.jpg`.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-653">If a request is made for *image.jpg*, the request is redirected to `/jpg-images/image.jpg`.</span></span> <span data-ttu-id="7a2f0-654">El código de estado se establece en *301 - Movido definitivamente* y se establece `context.Result` para detener el procesamiento de las reglas y enviar la respuesta.</span><span class="sxs-lookup"><span data-stu-id="7a2f0-654">The status code is set to *301 - Moved Permanently*, and the `context.Result` is set to stop processing rules and send the response.</span></span>

[!code-csharp[](url-rewriting/samples/2.x/SampleApp/RewriteRules.cs?name=snippet_RedirectImageRequests)]

<span data-ttu-id="7a2f0-655">Solicitud original: `/image.png`</span><span class="sxs-lookup"><span data-stu-id="7a2f0-655">Original Request: `/image.png`</span></span>

![Ventana del explorador con herramientas de desarrollo realizando un seguimiento de las solicitudes y las respuestas para image.png](url-rewriting/_static/add_redirect_png_requests.png)

<span data-ttu-id="7a2f0-657">Solicitud original: `/image.jpg`</span><span class="sxs-lookup"><span data-stu-id="7a2f0-657">Original Request: `/image.jpg`</span></span>

![Ventana del explorador con herramientas de desarrollo realizando un seguimiento de las solicitudes y las respuestas para image.jpg](url-rewriting/_static/add_redirect_jpg_requests.png)

## <a name="regex-examples"></a><span data-ttu-id="7a2f0-659">Ejemplos de expresiones regulares</span><span class="sxs-lookup"><span data-stu-id="7a2f0-659">Regex examples</span></span>

| <span data-ttu-id="7a2f0-660">Objetivo</span><span class="sxs-lookup"><span data-stu-id="7a2f0-660">Goal</span></span> | <span data-ttu-id="7a2f0-661">Cadena de expresión regular &</span><span class="sxs-lookup"><span data-stu-id="7a2f0-661">Regex String &</span></span><br><span data-ttu-id="7a2f0-662">Ejemplo de coincidencia</span><span class="sxs-lookup"><span data-stu-id="7a2f0-662">Match Example</span></span> | <span data-ttu-id="7a2f0-663">Cadena de reemplazo &</span><span class="sxs-lookup"><span data-stu-id="7a2f0-663">Replacement String &</span></span><br><span data-ttu-id="7a2f0-664">Ejemplo de resultado</span><span class="sxs-lookup"><span data-stu-id="7a2f0-664">Output Example</span></span> |
| ---- | ------------------------------- | -------------------------------------- |
| <span data-ttu-id="7a2f0-665">Ruta de acceso de reescritura en la cadena de consulta</span><span class="sxs-lookup"><span data-stu-id="7a2f0-665">Rewrite path into querystring</span></span> | `^path/(.*)/(.*)`<br>`/path/abc/123` | `path?var1=$1&var2=$2`<br>`/path?var1=abc&var2=123` |
| <span data-ttu-id="7a2f0-666">Quitar barra diagonal final</span><span class="sxs-lookup"><span data-stu-id="7a2f0-666">Strip trailing slash</span></span> | `(.*)/$`<br>`/path/` | `$1`<br>`/path` |
| <span data-ttu-id="7a2f0-667">Exigir barra diagonal final</span><span class="sxs-lookup"><span data-stu-id="7a2f0-667">Enforce trailing slash</span></span> | `(.*[^/])$`<br>`/path` | `$1/`<br>`/path/` |
| <span data-ttu-id="7a2f0-668">Evitar reescritura de solicitudes específicas</span><span class="sxs-lookup"><span data-stu-id="7a2f0-668">Avoid rewriting specific requests</span></span> | <span data-ttu-id="7a2f0-669">`^(.*)(?<!\.axd)$` o `^(?!.*\.axd$)(.*)$`</span><span class="sxs-lookup"><span data-stu-id="7a2f0-669">`^(.*)(?<!\.axd)$` or `^(?!.*\.axd$)(.*)$`</span></span><br><span data-ttu-id="7a2f0-670">Sí: `/resource.htm`</span><span class="sxs-lookup"><span data-stu-id="7a2f0-670">Yes: `/resource.htm`</span></span><br><span data-ttu-id="7a2f0-671">No: `/resource.axd`</span><span class="sxs-lookup"><span data-stu-id="7a2f0-671">No: `/resource.axd`</span></span> | `rewritten/$1`<br>`/rewritten/resource.htm`<br>`/resource.axd` |
| <span data-ttu-id="7a2f0-672">Reorganizar los segmentos de URL</span><span class="sxs-lookup"><span data-stu-id="7a2f0-672">Rearrange URL segments</span></span> | `path/(.*)/(.*)/(.*)`<br>`path/1/2/3` | `path/$3/$2/$1`<br>`path/3/2/1` |
| <span data-ttu-id="7a2f0-673">Reemplazar un segmento de URL</span><span class="sxs-lookup"><span data-stu-id="7a2f0-673">Replace a URL segment</span></span> | `^(.*)/segment2/(.*)`<br>`/segment1/segment2/segment3` | `$1/replaced/$2`<br>`/segment1/replaced/segment3` |

::: moniker-end

## <a name="additional-resources"></a><span data-ttu-id="7a2f0-674">Recursos adicionales</span><span class="sxs-lookup"><span data-stu-id="7a2f0-674">Additional resources</span></span>

* <xref:fundamentals/startup>
* <xref:fundamentals/middleware/index>
* [<span data-ttu-id="7a2f0-675">Expresiones regulares en .NET</span><span class="sxs-lookup"><span data-stu-id="7a2f0-675">Regular expressions in .NET</span></span>](/dotnet/articles/standard/base-types/regular-expressions)
* [<span data-ttu-id="7a2f0-676">Lenguaje de expresiones regulares: referencia rápida</span><span class="sxs-lookup"><span data-stu-id="7a2f0-676">Regular expression language - quick reference</span></span>](/dotnet/articles/standard/base-types/quick-ref)
* <span data-ttu-id="7a2f0-677">[Apache mod_rewrite](https://httpd.apache.org/docs/2.4/rewrite/) (mod_rewrite de Apache)</span><span class="sxs-lookup"><span data-stu-id="7a2f0-677">[Apache mod_rewrite](https://httpd.apache.org/docs/2.4/rewrite/)</span></span>
* <span data-ttu-id="7a2f0-678">[Using Url Rewrite Module 2.0 (for IIS)](/iis/extensions/url-rewrite-module/using-url-rewrite-module-20) (Uso del Módulo URL Rewrite 2.0 para IIS)</span><span class="sxs-lookup"><span data-stu-id="7a2f0-678">[Using Url Rewrite Module 2.0 (for IIS)](/iis/extensions/url-rewrite-module/using-url-rewrite-module-20)</span></span>
* <span data-ttu-id="7a2f0-679">[URL Rewrite Module Configuration Reference](/iis/extensions/url-rewrite-module/url-rewrite-module-configuration-reference) (Referencia de configuración del Módulo URL Rewrite)</span><span class="sxs-lookup"><span data-stu-id="7a2f0-679">[URL Rewrite Module Configuration Reference](/iis/extensions/url-rewrite-module/url-rewrite-module-configuration-reference)</span></span>
* <span data-ttu-id="7a2f0-680">[IIS URL Rewrite Module Forum](https://forums.iis.net/1152.aspx) (Foro del Módulo URL Rewrite para IIS)</span><span class="sxs-lookup"><span data-stu-id="7a2f0-680">[IIS URL Rewrite Module Forum](https://forums.iis.net/1152.aspx)</span></span>
* [<span data-ttu-id="7a2f0-681">Cómo simplificar la estructura de direcciones URL</span><span class="sxs-lookup"><span data-stu-id="7a2f0-681">Keep a simple URL structure</span></span>](https://support.google.com/webmasters/answer/76329?hl=en)
* <span data-ttu-id="7a2f0-682">[10 URL Rewriting Tips and Tricks](https://ruslany.net/2009/04/10-url-rewriting-tips-and-tricks/) (10 trucos y consejos para reescritura de URL)</span><span class="sxs-lookup"><span data-stu-id="7a2f0-682">[10 URL Rewriting Tips and Tricks](https://ruslany.net/2009/04/10-url-rewriting-tips-and-tricks/)</span></span>
* <span data-ttu-id="7a2f0-683">[To slash or not to slash](https://webmasters.googleblog.com/2010/04/to-slash-or-not-to-slash.html) (Usar la barra diagonal o no)</span><span class="sxs-lookup"><span data-stu-id="7a2f0-683">[To slash or not to slash](https://webmasters.googleblog.com/2010/04/to-slash-or-not-to-slash.html)</span></span>
