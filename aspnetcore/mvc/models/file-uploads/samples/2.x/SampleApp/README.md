# <a name="upload-files-sample-app"></a><span data-ttu-id="4069f-101">Aplicación de ejemplo de carga de archivos</span><span class="sxs-lookup"><span data-stu-id="4069f-101">Upload Files Sample App</span></span>

<span data-ttu-id="4069f-102">En esta aplicación de ejemplo se muestran los conceptos descritos en el tema [Carga de archivos en ASP.NET Core](https://docs.microsoft.com/aspnet/core/mvc/models/file-uploads).</span><span class="sxs-lookup"><span data-stu-id="4069f-102">This sample app demonstrates concepts described in the [Upload files in ASP.NET Core](https://docs.microsoft.com/aspnet/core/mvc/models/file-uploads) topic.</span></span>

## <a name="security-considerations"></a><span data-ttu-id="4069f-103">Consideraciones sobre la seguridad</span><span class="sxs-lookup"><span data-stu-id="4069f-103">Security considerations</span></span>

<span data-ttu-id="4069f-104">Tenga precaución al proporcionar a los usuarios la capacidad de cargar archivos en un servidor.</span><span class="sxs-lookup"><span data-stu-id="4069f-104">Use caution when providing users with the ability to upload files to a server.</span></span> <span data-ttu-id="4069f-105">Los atacantes pueden ejecutar ataques por [denegación de servicio](/windows-hardware/drivers/ifs/denial-of-service), intentar cargar virus o malware o intentar poner en riesgo redes y servidores de otras maneras.</span><span class="sxs-lookup"><span data-stu-id="4069f-105">Attackers may execute [denial of service](/windows-hardware/drivers/ifs/denial-of-service) attacks, attempt to upload viruses or malware, or attempt to compromise networks and servers in other ways.</span></span>

<span data-ttu-id="4069f-106">Estos son algunos de los pasos de seguridad con los que se reduce la probabilidad de sufrir ataques:</span><span class="sxs-lookup"><span data-stu-id="4069f-106">Security steps that reduce the likelihood of a successful attack are:</span></span>

* <span data-ttu-id="4069f-107">Cargue los archivos a un área de carga de archivos dedicada del sistema, de preferencia una unidad que no sea de sistema.</span><span class="sxs-lookup"><span data-stu-id="4069f-107">Upload files to a dedicated file upload area on the system, preferably to a non-system drive.</span></span> <span data-ttu-id="4069f-108">El uso de una ubicación dedicada permite imponer de manera más sencilla medidas de seguridad en los archivos cargados.</span><span class="sxs-lookup"><span data-stu-id="4069f-108">Use of a dedicated location makes it easier to impose security measures on uploaded files.</span></span> <span data-ttu-id="4069f-109">Deshabilite la ejecución de los permisos en la ubicación de carga de archivos.&dagger;</span><span class="sxs-lookup"><span data-stu-id="4069f-109">Disable execute permissions on the file upload location.&dagger;</span></span>
* <span data-ttu-id="4069f-110">Los archivos cargados nunca deben persistir en el mismo árbol de directorio que la aplicación.&dagger;</span><span class="sxs-lookup"><span data-stu-id="4069f-110">Never persist uploaded files in the same directory tree as the app.&dagger;</span></span>
* <span data-ttu-id="4069f-111">Use un nombre de archivo seguro determinado por la aplicación.</span><span class="sxs-lookup"><span data-stu-id="4069f-111">Use a safe file name determined by the app.</span></span> <span data-ttu-id="4069f-112">No use un nombre de archivo proporcionado por una entrada del usuario ni el nombre de archivo que no es de confianza del archivo cargado.&dagger;</span><span class="sxs-lookup"><span data-stu-id="4069f-112">Don't use a file name provided by user input or the untrusted file name of the uploaded file.&dagger;</span></span>
* <span data-ttu-id="4069f-113">Permita únicamente un conjunto específico de extensiones de archivo aprobadas.&dagger;</span><span class="sxs-lookup"><span data-stu-id="4069f-113">Only allow a specific set of approved file extensions.&dagger;</span></span>
* <span data-ttu-id="4069f-114">Compruebe la firma de formato de archivo para evitar que un usuario cargue un archivo enmascarado (por ejemplo, la carga de un archivo *.exe* con una extensión *.txt*).&dagger;</span><span class="sxs-lookup"><span data-stu-id="4069f-114">Check the file format signature to prevent a user from uploading a masqueraded file (for example, uploading an *.exe* file with a *.txt* extension).&dagger;</span></span>
* <span data-ttu-id="4069f-115">Compruebe que también se llevan a cabo comprobaciones de cliente en el servidor.</span><span class="sxs-lookup"><span data-stu-id="4069f-115">Verify that client-side checks are also performed on the server.</span></span> <span data-ttu-id="4069f-116">Las comprobaciones de cliente son fáciles de sortear.&dagger;</span><span class="sxs-lookup"><span data-stu-id="4069f-116">Client-side checks are easy to circumvent.&dagger;</span></span>
* <span data-ttu-id="4069f-117">Compruebe el tamaño de la carga y evite las cargas de mayor tamaño de lo esperado.&dagger;</span><span class="sxs-lookup"><span data-stu-id="4069f-117">Check the size of the upload and prevent uploads that are larger than expected.&dagger;</span></span>
* <span data-ttu-id="4069f-118">Cuando un archivo cargado con el mismo nombre no deba sobrescribir los archivos, vuelva a comprobar el nombre de archivo en la base de datos o en el almacenamiento físico antes de cargarlo.</span><span class="sxs-lookup"><span data-stu-id="4069f-118">When files shouldn't be overwritten by an uploaded file with the same name, check the file name against the database or physical storage before uploading the file.</span></span>
* <span data-ttu-id="4069f-119">**Ejecute un detector de virus o malware en el contenido cargado antes de que se almacene el archivo.**</span><span class="sxs-lookup"><span data-stu-id="4069f-119">**Run a virus/malware scanner on uploaded content before the file is stored.**</span></span>

<span data-ttu-id="4069f-120">&dagger;La aplicación de ejemplo muestra un enfoque que cumple los criterios.</span><span class="sxs-lookup"><span data-stu-id="4069f-120">&dagger;The sample app demonstrates an approach that meets the criteria.</span></span>

> [!WARNING]
> <span data-ttu-id="4069f-121">La carga de código malintencionado en un sistema suele ser el primer paso para ejecutar código que puede:</span><span class="sxs-lookup"><span data-stu-id="4069f-121">Uploading malicious code to a system is frequently the first step to executing code that can:</span></span>
>
> * <span data-ttu-id="4069f-122">Tomar todo el poder en un sistema.</span><span class="sxs-lookup"><span data-stu-id="4069f-122">Completely takeover a system.</span></span>
> * <span data-ttu-id="4069f-123">Sobrecargar un sistema de manera que el sistema se bloquea.</span><span class="sxs-lookup"><span data-stu-id="4069f-123">Overload a system with the result that the system crashes.</span></span>
> * <span data-ttu-id="4069f-124">Poner en peligro los datos del usuario o del sistema.</span><span class="sxs-lookup"><span data-stu-id="4069f-124">Compromise user or system data.</span></span>
> * <span data-ttu-id="4069f-125">Aplicar grafitis a una interfaz de usuario pública.</span><span class="sxs-lookup"><span data-stu-id="4069f-125">Apply graffiti to a public UI.</span></span>
>
> <span data-ttu-id="4069f-126">Vea los siguientes recursos para más información sobre cómo reducir el área expuesta de ataques al aceptar archivos de los usuarios:</span><span class="sxs-lookup"><span data-stu-id="4069f-126">For information on reducing the attack surface area when accepting files from users, see the following resources:</span></span>
>
> * <span data-ttu-id="4069f-127">[Unrestricted File Upload](https://www.owasp.org/index.php/Unrestricted_File_Upload) (Carga de archivos sin restricciones)</span><span class="sxs-lookup"><span data-stu-id="4069f-127">[Unrestricted File Upload](https://www.owasp.org/index.php/Unrestricted_File_Upload)</span></span>
> * [<span data-ttu-id="4069f-128">Azure Security: asegúrese de que los controles adecuados estén en vigor al aceptar archivos de usuarios</span><span class="sxs-lookup"><span data-stu-id="4069f-128">Azure Security: Ensure appropriate controls are in place when accepting files from users</span></span>](/azure/security/azure-security-threat-modeling-tool-input-validation#controls-users)

<span data-ttu-id="4069f-129">Para información adicional, consulte [Carga de archivos en ASP.NET Core](https://docs.microsoft.com/aspnet/core/mvc/models/file-uploads).</span><span class="sxs-lookup"><span data-stu-id="4069f-129">For additional information, see [Upload files in ASP.NET Core](https://docs.microsoft.com/aspnet/core/mvc/models/file-uploads).</span></span>

## <a name="how-to-use-the-sample"></a><span data-ttu-id="4069f-130">Uso del ejemplo</span><span class="sxs-lookup"><span data-stu-id="4069f-130">How to use the sample</span></span>

<span data-ttu-id="4069f-131">En el archivo *appsettings.json*:</span><span class="sxs-lookup"><span data-stu-id="4069f-131">In the *appsettings.json* file:</span></span>

1. <span data-ttu-id="4069f-132">Establezca la ruta de acceso de los archivos almacenados (`StoredFilesPath`).</span><span class="sxs-lookup"><span data-stu-id="4069f-132">Set the path for stored files (`StoredFilesPath`).</span></span>

   * <span data-ttu-id="4069f-133">La aplicación de ejemplo establece el valor en `c:\\files`, que presupone que una carpeta denominada *files* existe en la raíz de la unidad C: del sistema.</span><span class="sxs-lookup"><span data-stu-id="4069f-133">The sample app sets the value to `c:\\files`, which assumes that a folder named *files* exists at the system's C: drive root.</span></span>
   * <span data-ttu-id="4069f-134">Debe existir la ruta de acceso.</span><span class="sxs-lookup"><span data-stu-id="4069f-134">The path must exist.</span></span> <span data-ttu-id="4069f-135">Cree una carpeta *files* en la unidad C: del sistema o establezca la ruta de acceso en una ubicación adecuada.</span><span class="sxs-lookup"><span data-stu-id="4069f-135">Create a *files* folder on the system's C: drive or set the path to a suitable location.</span></span>
   * <span data-ttu-id="4069f-136">El proceso de la aplicación requiere permisos de lectura y escritura sobre la ruta de acceso.</span><span class="sxs-lookup"><span data-stu-id="4069f-136">The app's process requires read/write permissions to the path.</span></span>
   * <span data-ttu-id="4069f-137">**IMPORTANTE:**</span><span class="sxs-lookup"><span data-stu-id="4069f-137">**IMPORTANT!**</span></span> <span data-ttu-id="4069f-138">Deshabilite los permisos de ejecución para todos los usuarios en la ruta de acceso.</span><span class="sxs-lookup"><span data-stu-id="4069f-138">Disable execute permissions for all users at the path.</span></span>

1. <span data-ttu-id="4069f-139">Establezca el límite de tamaño de archivo (`FileSizeLimit`) en bytes.</span><span class="sxs-lookup"><span data-stu-id="4069f-139">Set the file size limit (`FileSizeLimit`) in bytes.</span></span> <span data-ttu-id="4069f-140">El valor predeterminado de la aplicación de ejemplo de `2097152` (2 097 152 bytes) permite cargas de archivo de hasta 2 MB.</span><span class="sxs-lookup"><span data-stu-id="4069f-140">The sample app's default value of `2097152` (2,097,152 bytes) permits file uploads up to 2 MB.</span></span>
