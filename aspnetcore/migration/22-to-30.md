---
title: Migrar de ASP.NET Core 2,2 a 3,0
author: rick-anderson
description: Obtenga información sobre cómo migrar un proyecto ASP.NET Core 2,2 a ASP.NET Core 3,0.
ms.author: riande
ms.custom: mvc
ms.date: 10/08/2019
uid: migration/22-to-30
ms.openlocfilehash: e9a4fed88a7ed2d0347704987b3f1c2fede31ec3
ms.sourcegitcommit: 73a451e9a58ac7102f90b608d661d8c23dd9bbaf
ms.translationtype: HT
ms.contentlocale: es-ES
ms.lasthandoff: 10/08/2019
ms.locfileid: "72037501"
---
# <a name="migrate-from-aspnet-core-22-to-30"></a><span data-ttu-id="e4d1e-103">Migrar de ASP.NET Core 2,2 a 3,0</span><span class="sxs-lookup"><span data-stu-id="e4d1e-103">Migrate from ASP.NET Core 2.2 to 3.0</span></span>

<span data-ttu-id="e4d1e-104">Por [Scott Addie](https://github.com/scottaddie) y [Rick Anderson](https://twitter.com/RickAndMSFT)</span><span class="sxs-lookup"><span data-stu-id="e4d1e-104">By [Scott Addie](https://github.com/scottaddie) and [Rick Anderson](https://twitter.com/RickAndMSFT)</span></span>

<span data-ttu-id="e4d1e-105">En este artículo se explica cómo actualizar un proyecto ASP.NET Core 2,2 existente a ASP.NET Core 3,0.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-105">This article explains how to update an existing ASP.NET Core 2.2 project to ASP.NET Core 3.0.</span></span>

## <a name="prerequisites"></a><span data-ttu-id="e4d1e-106">Requisitos previos</span><span class="sxs-lookup"><span data-stu-id="e4d1e-106">Prerequisites</span></span>

# <a name="visual-studiotabvisual-studio"></a>[<span data-ttu-id="e4d1e-107">Visual Studio</span><span class="sxs-lookup"><span data-stu-id="e4d1e-107">Visual Studio</span></span>](#tab/visual-studio)

[!INCLUDE[](~/includes/net-core-prereqs-vs-3.0.md)]

# <a name="visual-studio-codetabvisual-studio-code"></a>[<span data-ttu-id="e4d1e-108">Visual Studio Code</span><span class="sxs-lookup"><span data-stu-id="e4d1e-108">Visual Studio Code</span></span>](#tab/visual-studio-code)

[!INCLUDE[](~/includes/net-core-prereqs-vsc-3.0.md)]

# <a name="visual-studio-for-mactabvisual-studio-mac"></a>[<span data-ttu-id="e4d1e-109">Visual Studio para Mac</span><span class="sxs-lookup"><span data-stu-id="e4d1e-109">Visual Studio for Mac</span></span>](#tab/visual-studio-mac)

[!INCLUDE[](~/includes/net-core-prereqs-mac-3.0.md)]

---

## <a name="update-net-core-sdk-version-in-globaljson"></a><span data-ttu-id="e4d1e-110">Actualización de la versión del SDK de .NET Core en global.json</span><span class="sxs-lookup"><span data-stu-id="e4d1e-110">Update .NET Core SDK version in global.json</span></span>

<span data-ttu-id="e4d1e-111">Si la solución se basa en un archivo [global. JSON](/dotnet/core/tools/global-json) para tener como destino una versión de SDK de .net Core específica, actualice su propiedad `version` a la versión 3,0 instalada en el equipo:</span><span class="sxs-lookup"><span data-stu-id="e4d1e-111">If your solution relies upon a [global.json](/dotnet/core/tools/global-json) file to target a specific .NET Core SDK version, update its `version` property to the 3.0 version installed on your machine:</span></span>

```json
{
  "sdk": {
    "version": "3.0.100"
  }
}
```

## <a name="update-the-project-file"></a><span data-ttu-id="e4d1e-112">Actualizar el archivo de proyecto</span><span class="sxs-lookup"><span data-stu-id="e4d1e-112">Update the project file</span></span>

### <a name="update-the-target-framework"></a><span data-ttu-id="e4d1e-113">Actualización de la plataforma de destino</span><span class="sxs-lookup"><span data-stu-id="e4d1e-113">Update the Target Framework</span></span>

<span data-ttu-id="e4d1e-114">ASP.NET Core 3,0 y versiones posteriores solo se ejecutan en .NET Core.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-114">ASP.NET Core 3.0 and later only run on .NET Core.</span></span> <span data-ttu-id="e4d1e-115">Establezca el [moniker de la plataforma de destino (TFM)](/dotnet/standard/frameworks) en `netcoreapp3.0`:</span><span class="sxs-lookup"><span data-stu-id="e4d1e-115">Set the [Target Framework Moniker (TFM)](/dotnet/standard/frameworks) to `netcoreapp3.0`:</span></span>

```xml
<TargetFramework>netcoreapp3.0</TargetFramework>
```

### <a name="remove-obsolete-package-references"></a><span data-ttu-id="e4d1e-116">Quitar referencias de paquetes obsoletas</span><span class="sxs-lookup"><span data-stu-id="e4d1e-116">Remove obsolete package references</span></span>

<span data-ttu-id="e4d1e-117">ASP.NET Core ya no genera un gran número de características de paquetes NuGet.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-117">ASP.NET Core no longer produces a large number of NuGet packages features.</span></span> <span data-ttu-id="e4d1e-118">Estas referencias de paquete deben quitarse del archivo de proyecto.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-118">These package references should be removed from your project file.</span></span> <span data-ttu-id="e4d1e-119">Para ver la lista completa de los paquetes que ya no se producen, vea a continuación:</span><span class="sxs-lookup"><span data-stu-id="e4d1e-119">To see the full list of packages that are no longer produced, see below:</span></span>

<details>
    <summary><span data-ttu-id="e4d1e-120">Haga clic aquí para expandir la lista de paquetes que ya no se generan</span><span class="sxs-lookup"><span data-stu-id="e4d1e-120">Click here to expand the list of packages no longer being produced</span></span></summary>
    <ul>
        <li><span data-ttu-id="e4d1e-121">Microsoft.AspNetCore</span><span class="sxs-lookup"><span data-stu-id="e4d1e-121">Microsoft.AspNetCore</span></span></li>
        <li><span data-ttu-id="e4d1e-122">Microsoft.AspNetCore.All</span><span class="sxs-lookup"><span data-stu-id="e4d1e-122">Microsoft.AspNetCore.All</span></span></li>
        <li><span data-ttu-id="e4d1e-123">Microsoft.AspNetCore.App</span><span class="sxs-lookup"><span data-stu-id="e4d1e-123">Microsoft.AspNetCore.App</span></span></li>
        <li><span data-ttu-id="e4d1e-124">Microsoft.AspNetCore.Antiforgery</span><span class="sxs-lookup"><span data-stu-id="e4d1e-124">Microsoft.AspNetCore.Antiforgery</span></span></li>
        <li><span data-ttu-id="e4d1e-125">Microsoft.AspNetCore.Authentication</span><span class="sxs-lookup"><span data-stu-id="e4d1e-125">Microsoft.AspNetCore.Authentication</span></span></li>
        <li><span data-ttu-id="e4d1e-126">Microsoft.AspNetCore.Authentication.Abstractions</span><span class="sxs-lookup"><span data-stu-id="e4d1e-126">Microsoft.AspNetCore.Authentication.Abstractions</span></span></li>
        <li><span data-ttu-id="e4d1e-127">Microsoft.AspNetCore.Authentication.Cookies</span><span class="sxs-lookup"><span data-stu-id="e4d1e-127">Microsoft.AspNetCore.Authentication.Cookies</span></span></li>
        <li><span data-ttu-id="e4d1e-128">Microsoft.AspNetCore.Authentication.Core</span><span class="sxs-lookup"><span data-stu-id="e4d1e-128">Microsoft.AspNetCore.Authentication.Core</span></span></li>
        <li><span data-ttu-id="e4d1e-129">Microsoft.AspNetCore.Authentication.JwtBearer</span><span class="sxs-lookup"><span data-stu-id="e4d1e-129">Microsoft.AspNetCore.Authentication.JwtBearer</span></span></li>
        <li><span data-ttu-id="e4d1e-130">Microsoft.AspNetCore.Authentication.OAuth</span><span class="sxs-lookup"><span data-stu-id="e4d1e-130">Microsoft.AspNetCore.Authentication.OAuth</span></span></li>
        <li><span data-ttu-id="e4d1e-131">Microsoft.AspNetCore.Authentication.OpenIdConnect</span><span class="sxs-lookup"><span data-stu-id="e4d1e-131">Microsoft.AspNetCore.Authentication.OpenIdConnect</span></span></li>
        <li><span data-ttu-id="e4d1e-132">Microsoft.AspNetCore.Authorization</span><span class="sxs-lookup"><span data-stu-id="e4d1e-132">Microsoft.AspNetCore.Authorization</span></span></li>
        <li><span data-ttu-id="e4d1e-133">Microsoft.AspNetCore.Authorization.Policy</span><span class="sxs-lookup"><span data-stu-id="e4d1e-133">Microsoft.AspNetCore.Authorization.Policy</span></span></li>
        <li><span data-ttu-id="e4d1e-134">Microsoft.AspNetCore.CookiePolicy</span><span class="sxs-lookup"><span data-stu-id="e4d1e-134">Microsoft.AspNetCore.CookiePolicy</span></span></li>
        <li><span data-ttu-id="e4d1e-135">Microsoft.AspNetCore.Cors</span><span class="sxs-lookup"><span data-stu-id="e4d1e-135">Microsoft.AspNetCore.Cors</span></span></li>
        <li><span data-ttu-id="e4d1e-136">Microsoft.AspNetCore.Cryptography.Internal</span><span class="sxs-lookup"><span data-stu-id="e4d1e-136">Microsoft.AspNetCore.Cryptography.Internal</span></span></li>
        <li><span data-ttu-id="e4d1e-137">Microsoft.AspNetCore.Cryptography.KeyDerivation</span><span class="sxs-lookup"><span data-stu-id="e4d1e-137">Microsoft.AspNetCore.Cryptography.KeyDerivation</span></span></li>
        <li><span data-ttu-id="e4d1e-138">Microsoft.AspNetCore.DataProtection</span><span class="sxs-lookup"><span data-stu-id="e4d1e-138">Microsoft.AspNetCore.DataProtection</span></span></li>
        <li><span data-ttu-id="e4d1e-139">Microsoft.AspNetCore.DataProtection.Abstractions</span><span class="sxs-lookup"><span data-stu-id="e4d1e-139">Microsoft.AspNetCore.DataProtection.Abstractions</span></span></li>
        <li><span data-ttu-id="e4d1e-140">Microsoft.AspNetCore.DataProtection.Extensions</span><span class="sxs-lookup"><span data-stu-id="e4d1e-140">Microsoft.AspNetCore.DataProtection.Extensions</span></span></li>
        <li><span data-ttu-id="e4d1e-141">Microsoft.AspNetCore.Diagnostics</span><span class="sxs-lookup"><span data-stu-id="e4d1e-141">Microsoft.AspNetCore.Diagnostics</span></span></li>
        <li><span data-ttu-id="e4d1e-142">Microsoft.AspNetCore.Diagnostics.HealthChecks</span><span class="sxs-lookup"><span data-stu-id="e4d1e-142">Microsoft.AspNetCore.Diagnostics.HealthChecks</span></span></li>
        <li><span data-ttu-id="e4d1e-143">Microsoft.AspNetCore.HostFiltering</span><span class="sxs-lookup"><span data-stu-id="e4d1e-143">Microsoft.AspNetCore.HostFiltering</span></span></li>
        <li><span data-ttu-id="e4d1e-144">Microsoft.AspNetCore.Hosting</span><span class="sxs-lookup"><span data-stu-id="e4d1e-144">Microsoft.AspNetCore.Hosting</span></span></li>
        <li><span data-ttu-id="e4d1e-145">Microsoft.AspNetCore.Hosting.Abstractions</span><span class="sxs-lookup"><span data-stu-id="e4d1e-145">Microsoft.AspNetCore.Hosting.Abstractions</span></span></li>
        <li><span data-ttu-id="e4d1e-146">Microsoft.AspNetCore.Hosting.Server.Abstractions</span><span class="sxs-lookup"><span data-stu-id="e4d1e-146">Microsoft.AspNetCore.Hosting.Server.Abstractions</span></span></li>
        <li><span data-ttu-id="e4d1e-147">Microsoft.AspNetCore.Http</span><span class="sxs-lookup"><span data-stu-id="e4d1e-147">Microsoft.AspNetCore.Http</span></span></li>
        <li><span data-ttu-id="e4d1e-148">Microsoft.AspNetCore.Http.Abstractions</span><span class="sxs-lookup"><span data-stu-id="e4d1e-148">Microsoft.AspNetCore.Http.Abstractions</span></span></li>
        <li><span data-ttu-id="e4d1e-149">Microsoft.AspNetCore.Http.Connections</span><span class="sxs-lookup"><span data-stu-id="e4d1e-149">Microsoft.AspNetCore.Http.Connections</span></span></li>
        <li><span data-ttu-id="e4d1e-150">Microsoft.AspNetCore.Http.Extensions</span><span class="sxs-lookup"><span data-stu-id="e4d1e-150">Microsoft.AspNetCore.Http.Extensions</span></span></li>
        <li><span data-ttu-id="e4d1e-151">Microsoft.AspNetCore.Http.Features</span><span class="sxs-lookup"><span data-stu-id="e4d1e-151">Microsoft.AspNetCore.Http.Features</span></span></li>
        <li><span data-ttu-id="e4d1e-152">Microsoft.AspNetCore.HttpOverrides</span><span class="sxs-lookup"><span data-stu-id="e4d1e-152">Microsoft.AspNetCore.HttpOverrides</span></span></li>
        <li><span data-ttu-id="e4d1e-153">Microsoft.AspNetCore.HttpsPolicy</span><span class="sxs-lookup"><span data-stu-id="e4d1e-153">Microsoft.AspNetCore.HttpsPolicy</span></span></li>
        <li><span data-ttu-id="e4d1e-154">Microsoft.AspNetCore.Identity</span><span class="sxs-lookup"><span data-stu-id="e4d1e-154">Microsoft.AspNetCore.Identity</span></span></li>
        <li><span data-ttu-id="e4d1e-155">Microsoft.AspNetCore.Localization</span><span class="sxs-lookup"><span data-stu-id="e4d1e-155">Microsoft.AspNetCore.Localization</span></span></li>
        <li><span data-ttu-id="e4d1e-156">Microsoft.AspNetCore.Localization.Routing</span><span class="sxs-lookup"><span data-stu-id="e4d1e-156">Microsoft.AspNetCore.Localization.Routing</span></span></li>
        <li><span data-ttu-id="e4d1e-157">Microsoft.AspNetCore.MiddlewareAnalysis</span><span class="sxs-lookup"><span data-stu-id="e4d1e-157">Microsoft.AspNetCore.MiddlewareAnalysis</span></span></li>
        <li><span data-ttu-id="e4d1e-158">Microsoft.AspNetCore.Mvc</span><span class="sxs-lookup"><span data-stu-id="e4d1e-158">Microsoft.AspNetCore.Mvc</span></span></li>
        <li><span data-ttu-id="e4d1e-159">Microsoft.AspNetCore.Mvc.Abstractions</span><span class="sxs-lookup"><span data-stu-id="e4d1e-159">Microsoft.AspNetCore.Mvc.Abstractions</span></span></li>
        <li><span data-ttu-id="e4d1e-160">Microsoft.AspNetCore.Mvc.Analyzers</span><span class="sxs-lookup"><span data-stu-id="e4d1e-160">Microsoft.AspNetCore.Mvc.Analyzers</span></span></li>
        <li><span data-ttu-id="e4d1e-161">Microsoft.AspNetCore.Mvc.ApiExplorer</span><span class="sxs-lookup"><span data-stu-id="e4d1e-161">Microsoft.AspNetCore.Mvc.ApiExplorer</span></span></li>
        <li><span data-ttu-id="e4d1e-162">Microsoft.AspNetCore.Mvc.Api.Analyzers</span><span class="sxs-lookup"><span data-stu-id="e4d1e-162">Microsoft.AspNetCore.Mvc.Api.Analyzers</span></span></li>
        <li><span data-ttu-id="e4d1e-163">Microsoft.AspNetCore.Mvc.Core</span><span class="sxs-lookup"><span data-stu-id="e4d1e-163">Microsoft.AspNetCore.Mvc.Core</span></span></li>
        <li><span data-ttu-id="e4d1e-164">Microsoft.AspNetCore.Mvc.Cors</span><span class="sxs-lookup"><span data-stu-id="e4d1e-164">Microsoft.AspNetCore.Mvc.Cors</span></span></li>
        <li><span data-ttu-id="e4d1e-165">Microsoft.AspNetCore.Mvc.DataAnnotations</span><span class="sxs-lookup"><span data-stu-id="e4d1e-165">Microsoft.AspNetCore.Mvc.DataAnnotations</span></span></li>
        <li><span data-ttu-id="e4d1e-166">Microsoft.AspNetCore.Mvc.Formatters.Json</span><span class="sxs-lookup"><span data-stu-id="e4d1e-166">Microsoft.AspNetCore.Mvc.Formatters.Json</span></span></li>
        <li><span data-ttu-id="e4d1e-167">Microsoft.AspNetCore.Mvc.Formatters.Xml</span><span class="sxs-lookup"><span data-stu-id="e4d1e-167">Microsoft.AspNetCore.Mvc.Formatters.Xml</span></span></li>
        <li><span data-ttu-id="e4d1e-168">Microsoft.AspNetCore.Mvc.Localization</span><span class="sxs-lookup"><span data-stu-id="e4d1e-168">Microsoft.AspNetCore.Mvc.Localization</span></span></li>
        <li><span data-ttu-id="e4d1e-169">Microsoft.AspNetCore.Mvc.Razor</span><span class="sxs-lookup"><span data-stu-id="e4d1e-169">Microsoft.AspNetCore.Mvc.Razor</span></span></li>
        <li><span data-ttu-id="e4d1e-170">Microsoft.AspNetCore.Mvc.Razor.Extensions</span><span class="sxs-lookup"><span data-stu-id="e4d1e-170">Microsoft.AspNetCore.Mvc.Razor.Extensions</span></span></li>
        <li><span data-ttu-id="e4d1e-171">Microsoft.AspNetCore.Mvc.Razor.ViewCompilation</span><span class="sxs-lookup"><span data-stu-id="e4d1e-171">Microsoft.AspNetCore.Mvc.Razor.ViewCompilation</span></span></li>
        <li><span data-ttu-id="e4d1e-172">Microsoft.AspNetCore.Mvc.RazorPages</span><span class="sxs-lookup"><span data-stu-id="e4d1e-172">Microsoft.AspNetCore.Mvc.RazorPages</span></span></li>
        <li><span data-ttu-id="e4d1e-173">Microsoft.AspNetCore.Mvc.TagHelpers</span><span class="sxs-lookup"><span data-stu-id="e4d1e-173">Microsoft.AspNetCore.Mvc.TagHelpers</span></span></li>
        <li><span data-ttu-id="e4d1e-174">Microsoft.AspNetCore.Mvc.ViewFeatures</span><span class="sxs-lookup"><span data-stu-id="e4d1e-174">Microsoft.AspNetCore.Mvc.ViewFeatures</span></span></li>
        <li><span data-ttu-id="e4d1e-175">Microsoft.AspNetCore.Razor</span><span class="sxs-lookup"><span data-stu-id="e4d1e-175">Microsoft.AspNetCore.Razor</span></span></li>
        <li><span data-ttu-id="e4d1e-176">Microsoft.AspNetCore.Razor.Runtime</span><span class="sxs-lookup"><span data-stu-id="e4d1e-176">Microsoft.AspNetCore.Razor.Runtime</span></span></li>
        <li><span data-ttu-id="e4d1e-177">Microsoft.AspNetCore.Razor.Design</span><span class="sxs-lookup"><span data-stu-id="e4d1e-177">Microsoft.AspNetCore.Razor.Design</span></span></li>
        <li><span data-ttu-id="e4d1e-178">Microsoft.AspNetCore.ResponseCaching</span><span class="sxs-lookup"><span data-stu-id="e4d1e-178">Microsoft.AspNetCore.ResponseCaching</span></span></li>
        <li><span data-ttu-id="e4d1e-179">Microsoft.AspNetCore.ResponseCaching.Abstractions</span><span class="sxs-lookup"><span data-stu-id="e4d1e-179">Microsoft.AspNetCore.ResponseCaching.Abstractions</span></span></li>
        <li><span data-ttu-id="e4d1e-180">Microsoft.AspNetCore.ResponseCompression</span><span class="sxs-lookup"><span data-stu-id="e4d1e-180">Microsoft.AspNetCore.ResponseCompression</span></span></li>
        <li><span data-ttu-id="e4d1e-181">Microsoft.AspNetCore.Rewrite</span><span class="sxs-lookup"><span data-stu-id="e4d1e-181">Microsoft.AspNetCore.Rewrite</span></span></li>
        <li><span data-ttu-id="e4d1e-182">Microsoft.AspNetCore.Routing</span><span class="sxs-lookup"><span data-stu-id="e4d1e-182">Microsoft.AspNetCore.Routing</span></span></li>
        <li><span data-ttu-id="e4d1e-183">Microsoft.AspNetCore.Routing.Abstractions</span><span class="sxs-lookup"><span data-stu-id="e4d1e-183">Microsoft.AspNetCore.Routing.Abstractions</span></span></li>
        <li><span data-ttu-id="e4d1e-184">Microsoft.AspNetCore.Server.HttpSys</span><span class="sxs-lookup"><span data-stu-id="e4d1e-184">Microsoft.AspNetCore.Server.HttpSys</span></span></li>
        <li><span data-ttu-id="e4d1e-185">Microsoft.AspNetCore.Server.IIS</span><span class="sxs-lookup"><span data-stu-id="e4d1e-185">Microsoft.AspNetCore.Server.IIS</span></span></li>
        <li><span data-ttu-id="e4d1e-186">Microsoft.AspNetCore.Server.IISIntegration</span><span class="sxs-lookup"><span data-stu-id="e4d1e-186">Microsoft.AspNetCore.Server.IISIntegration</span></span></li>
        <li><span data-ttu-id="e4d1e-187">Microsoft.AspNetCore.Server.Kestrel</span><span class="sxs-lookup"><span data-stu-id="e4d1e-187">Microsoft.AspNetCore.Server.Kestrel</span></span></li>
        <li><span data-ttu-id="e4d1e-188">Microsoft.AspNetCore.Server.Kestrel.Core</span><span class="sxs-lookup"><span data-stu-id="e4d1e-188">Microsoft.AspNetCore.Server.Kestrel.Core</span></span></li>
        <li><span data-ttu-id="e4d1e-189">Microsoft.AspNetCore.Server.Kestrel.Https</span><span class="sxs-lookup"><span data-stu-id="e4d1e-189">Microsoft.AspNetCore.Server.Kestrel.Https</span></span></li>
        <li><span data-ttu-id="e4d1e-190">Microsoft.AspNetCore.Server.Kestrel.Transport.Abstractions</span><span class="sxs-lookup"><span data-stu-id="e4d1e-190">Microsoft.AspNetCore.Server.Kestrel.Transport.Abstractions</span></span></li>
        <li><span data-ttu-id="e4d1e-191">Microsoft.AspNetCore.Server.Kestrel.Transport.Sockets</span><span class="sxs-lookup"><span data-stu-id="e4d1e-191">Microsoft.AspNetCore.Server.Kestrel.Transport.Sockets</span></span></li>
        <li><span data-ttu-id="e4d1e-192">Microsoft.AspNetCore.Session</span><span class="sxs-lookup"><span data-stu-id="e4d1e-192">Microsoft.AspNetCore.Session</span></span></li>
        <li><span data-ttu-id="e4d1e-193">Microsoft.AspNetCore.SignalR</span><span class="sxs-lookup"><span data-stu-id="e4d1e-193">Microsoft.AspNetCore.SignalR</span></span></li>
        <li><span data-ttu-id="e4d1e-194">Microsoft.AspNetCore.SignalR.Core</span><span class="sxs-lookup"><span data-stu-id="e4d1e-194">Microsoft.AspNetCore.SignalR.Core</span></span></li>
        <li><span data-ttu-id="e4d1e-195">Microsoft.AspNetCore.StaticFiles</span><span class="sxs-lookup"><span data-stu-id="e4d1e-195">Microsoft.AspNetCore.StaticFiles</span></span></li>
        <li><span data-ttu-id="e4d1e-196">Microsoft.AspNetCore.WebSockets</span><span class="sxs-lookup"><span data-stu-id="e4d1e-196">Microsoft.AspNetCore.WebSockets</span></span></li>
        <li><span data-ttu-id="e4d1e-197">Microsoft.AspNetCore.WebUtilities</span><span class="sxs-lookup"><span data-stu-id="e4d1e-197">Microsoft.AspNetCore.WebUtilities</span></span></li>
        <li><span data-ttu-id="e4d1e-198">Microsoft.Net. http. Headers</span><span class="sxs-lookup"><span data-stu-id="e4d1e-198">Microsoft.Net.Http.Headers</span></span></li>
    </ul>
</details>

### <a name="review-breaking-changes"></a><span data-ttu-id="e4d1e-199">Revisar cambios importantes</span><span class="sxs-lookup"><span data-stu-id="e4d1e-199">Review breaking changes</span></span>

[<span data-ttu-id="e4d1e-200">Revisar cambios importantes</span><span class="sxs-lookup"><span data-stu-id="e4d1e-200">Review breaking changes</span></span>](#break)

### <a name="framework-reference"></a><span data-ttu-id="e4d1e-201">Referencia de Framework</span><span class="sxs-lookup"><span data-stu-id="e4d1e-201">Framework reference</span></span>

<span data-ttu-id="e4d1e-202">Las características de ASP.NET Core que estaban disponibles a través de uno de los paquetes enumerados anteriormente están disponibles como parte del marco de trabajo compartido `Microsoft.AspNetCore.App`.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-202">Features of ASP.NET Core that were available through one of the packages listed above are available as part of the `Microsoft.AspNetCore.App` shared framework.</span></span> <span data-ttu-id="e4d1e-203">El *marco de trabajo compartido* es el conjunto de ensamblados (archivos *. dll* ) que se instalan en el equipo e incluye un componente de tiempo de ejecución y un paquete de destino.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-203">The *shared framework* is the set of assemblies (*.dll* files) that are installed on the machine and includes a runtime component, and a targeting pack.</span></span> <span data-ttu-id="e4d1e-204">Para más información, consulte este artículo sobre el [marco de trabajo compartido](https://natemcmaster.com/blog/2018/08/29/netcore-primitives-2/).</span><span class="sxs-lookup"><span data-stu-id="e4d1e-204">For more information, see [The shared framework](https://natemcmaster.com/blog/2018/08/29/netcore-primitives-2/).</span></span>

* <span data-ttu-id="e4d1e-205">Los proyectos que tienen como destino el SDK de `Microsoft.NET.Sdk.Web` hacen referencia implícitamente al marco `Microsoft.AspNetCore.App`.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-205">Projects that target the `Microsoft.NET.Sdk.Web` SDK implicitly reference the `Microsoft.AspNetCore.App` framework.</span></span>

<span data-ttu-id="e4d1e-206">No se requieren referencias adicionales para estos proyectos:</span><span class="sxs-lookup"><span data-stu-id="e4d1e-206">No additional references are required for these projects:</span></span>

```xml
<Project Sdk="Microsoft.NET.Sdk.Web">
  <PropertyGroup>
    <TargetFramework>netcoreapp3.0</TargetFramework>
  </PropertyGroup>
    ...
</Project>
```

* <span data-ttu-id="e4d1e-207">Los proyectos que tienen como destino `Microsoft.NET.Sdk` o `Microsoft.NET.Sdk.Razor` SDK deben agregar un `FrameworkReference` explícito a `Microsoft.AspNetCore.App`:</span><span class="sxs-lookup"><span data-stu-id="e4d1e-207">Projects that target `Microsoft.NET.Sdk` or `Microsoft.NET.Sdk.Razor` SDK, should add an explicit `FrameworkReference` to `Microsoft.AspNetCore.App`:</span></span>

```xml
<Project Sdk="Microsoft.NET.Sdk.Razor">
  <PropertyGroup>
    <TargetFramework>netcoreapp3.0</TargetFramework>
  </PropertyGroup>

  <ItemGroup>
    <FrameworkReference Include="Microsoft.AspNetCore.App" />
  </ItemGroup>
    ...
</Project>
```

#### <a name="framework-dependent-builds-using-docker"></a><span data-ttu-id="e4d1e-208">Compilaciones dependientes de Framework mediante Docker</span><span class="sxs-lookup"><span data-stu-id="e4d1e-208">Framework-dependent builds using Docker</span></span>

<span data-ttu-id="e4d1e-209">Las compilaciones dependientes del marco de trabajo de aplicaciones de consola que usan un paquete que depende de la ASP.NET Core [marco compartido](https://natemcmaster.com/blog/2018/08/29/netcore-primitives-2/) pueden dar el siguiente error de tiempo de ejecución:</span><span class="sxs-lookup"><span data-stu-id="e4d1e-209">Framework-dependent builds of console apps that use a package that depends on the ASP.NET Core [shared framework](https://natemcmaster.com/blog/2018/08/29/netcore-primitives-2/) may give the following runtime error:</span></span>

```console
It was not possible to find any compatible framework version
The specified framework 'Microsoft.AspNetCore.App', version '3.0.0' was not found.
  - No frameworks were found.
```

<span data-ttu-id="e4d1e-210">`Microsoft.AspNetCore.App` es el marco de trabajo compartido que contiene el tiempo de ejecución de ASP.NET Core y solo está presente en la imagen de Docker [dotnet/Core/ASPNET](https://hub.docker.com/_/microsoft-dotnet-core-aspnet/) .</span><span class="sxs-lookup"><span data-stu-id="e4d1e-210">`Microsoft.AspNetCore.App` is the shared framework containing the ASP.NET Core runtime and is only present on the [dotnet/core/aspnet](https://hub.docker.com/_/microsoft-dotnet-core-aspnet/) docker image.</span></span>  <span data-ttu-id="e4d1e-211">El SDK de 3,0 reduce el tamaño de las compilaciones dependientes del marco de trabajo mediante asp.net Core, sin incluir copias duplicadas de las bibliotecas que están disponibles en el marco de trabajo compartido.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-211">The 3.0 SDK reduces the size of framework dependent builds using asp.net core by not including duplicate copies of libraries that are available in the shared framework.</span></span>  <span data-ttu-id="e4d1e-212">Se trata de un ahorro potencial de hasta 18 MB, pero requiere que el tiempo de ejecución de ASP.NET Core deba estar presente o instalado para ejecutar la aplicación.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-212">This is a potential savings of up to 18 MB but it requires that the ASP.NET Core runtime must be present / installed to run the app.</span></span>

<span data-ttu-id="e4d1e-213">Para determinar si la aplicación tiene una dependencia (directa o indirecta) en el ASP.NET Core marco compartido, examine el archivo *runtimeConfig. JSON* generado durante una compilación o publicación de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-213">To determine if the app has a dependency (either direct or indirect) on the ASP.NET Core shared framework, examine the *runtimeconfig.json* file generated during a build/publish of your app.</span></span> <span data-ttu-id="e4d1e-214">El siguiente archivo JSON muestra una dependencia en el ASP.NET Core marco compartido:</span><span class="sxs-lookup"><span data-stu-id="e4d1e-214">The following JSON file shows a dependency on the ASP.NET Core shared framework:</span></span>

```json
{
  "runtimeOptions": {
    "tfm": "netcoreapp3.0",
    "framework": {
      "name": "Microsoft.AspNetCore.App",
      "version": "3.0.0"
    },
    "configProperties": {
      "System.GC.Server": true
    }
  }
}
```

<span data-ttu-id="e4d1e-215">Si la aplicación usa Docker, use una imagen base que incluya ASP.NET Core 3,0.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-215">If your app is using docker, use a base image that includes ASP.NET Core 3.0.</span></span> <span data-ttu-id="e4d1e-216">Por ejemplo: `docker pull mcr.microsoft.com/dotnet/core/aspnet:3.0`.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-216">For example, `docker pull mcr.microsoft.com/dotnet/core/aspnet:3.0`.</span></span>

### <a name="add-package-references-for-removed-assemblies"></a><span data-ttu-id="e4d1e-217">Agregar referencias de paquete para los ensamblados quitados</span><span class="sxs-lookup"><span data-stu-id="e4d1e-217">Add package references for removed assemblies</span></span>

<span data-ttu-id="e4d1e-218">ASP.NET Core 3,0 quita algunos ensamblados que anteriormente formaban parte de la referencia de paquete `Microsoft.AspNetCore.App`.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-218">ASP.NET Core 3.0 removes some assemblies that were previously part of the `Microsoft.AspNetCore.App` package reference.</span></span> <span data-ttu-id="e4d1e-219">Para seguir usando las características proporcionadas por estos ensamblados, haga referencia a las versiones 3,0 de los paquetes correspondientes:</span><span class="sxs-lookup"><span data-stu-id="e4d1e-219">To continue using features provided by these assemblies, reference the 3.0 versions of the corresponding packages:</span></span>

* [<span data-ttu-id="e4d1e-220">Microsoft. EntityFrameworkCore</span><span class="sxs-lookup"><span data-stu-id="e4d1e-220">Microsoft.EntityFrameworkCore</span></span>](https://www.nuget.org/packages/Microsoft.EntityFrameworkCore)

  <span data-ttu-id="e4d1e-221">Para obtener más información sobre cómo hacer referencia al paquete específico del proveedor de bases de datos, vea [proveedores de bases de datos](/ef/core/providers/index).</span><span class="sxs-lookup"><span data-stu-id="e4d1e-221">For more information on referencing the database provider-specific package, see [Database Providers](/ef/core/providers/index).</span></span>

* <span data-ttu-id="e4d1e-222">Interfaz de usuario de identidad</span><span class="sxs-lookup"><span data-stu-id="e4d1e-222">Identity UI</span></span>

  <span data-ttu-id="e4d1e-223">Se puede Agregar compatibilidad con la [interfaz de usuario de identidad](xref:security/authentication/identity) haciendo referencia al paquete [Microsoft. AspNetCore. Identity. UI](https://www.nuget.org/packages/Microsoft.AspNetCore.Identity.UI) .</span><span class="sxs-lookup"><span data-stu-id="e4d1e-223">Support for [Identity UI](xref:security/authentication/identity) can be added by referencing the [Microsoft.AspNetCore.Identity.UI](https://www.nuget.org/packages/Microsoft.AspNetCore.Identity.UI) package.</span></span>

* <span data-ttu-id="e4d1e-224">Servicios de SPA</span><span class="sxs-lookup"><span data-stu-id="e4d1e-224">SPA Services</span></span>

  * [<span data-ttu-id="e4d1e-225">Microsoft. AspNetCore. SpaServices</span><span class="sxs-lookup"><span data-stu-id="e4d1e-225">Microsoft.AspNetCore.SpaServices</span></span>](https://www.nuget.org/packages/Microsoft.AspNetCore.SpaServices)
  * [<span data-ttu-id="e4d1e-226">Microsoft. AspNetCore. SpaServices. Extensions</span><span class="sxs-lookup"><span data-stu-id="e4d1e-226">Microsoft.AspNetCore.SpaServices.Extensions</span></span>](https://www.nuget.org/packages/Microsoft.AspNetCore.SpaServices.Extensions)

* <span data-ttu-id="e4d1e-227">Autenticación &ndash; la compatibilidad con los flujos de autenticación de terceros están disponibles como paquetes NuGet:</span><span class="sxs-lookup"><span data-stu-id="e4d1e-227">Authentication &ndash; Support for third-party authentication flows are available as NuGet packages:</span></span>

  * <span data-ttu-id="e4d1e-228">OAuth de Facebook ([Microsoft. AspNetCore. Authentication. Facebook](https://www.nuget.org/packages/Microsoft.AspNetCore.Authentication.Facebook))</span><span class="sxs-lookup"><span data-stu-id="e4d1e-228">Facebook OAuth ([Microsoft.AspNetCore.Authentication.Facebook](https://www.nuget.org/packages/Microsoft.AspNetCore.Authentication.Facebook))</span></span>
  * <span data-ttu-id="e4d1e-229">Google OAuth ([Microsoft. AspNetCore. Authentication. Google](https://www.nuget.org/packages/Microsoft.AspNetCore.Authentication.Google))</span><span class="sxs-lookup"><span data-stu-id="e4d1e-229">Google OAuth ([Microsoft.AspNetCore.Authentication.Google](https://www.nuget.org/packages/Microsoft.AspNetCore.Authentication.Google))</span></span>
  * <span data-ttu-id="e4d1e-230">Token de portador de OpenID Connect ([Microsoft. AspNetCore. Authentication. JwtBearer](https://www.nuget.org/packages/Microsoft.AspNetCore.Authentication.JwtBearer))</span><span class="sxs-lookup"><span data-stu-id="e4d1e-230">OpenID Connect bearer token ([Microsoft.AspNetCore.Authentication.JwtBearer](https://www.nuget.org/packages/Microsoft.AspNetCore.Authentication.JwtBearer))</span></span>
  * <span data-ttu-id="e4d1e-231">Autenticación de la cuenta Microsoft ([Microsoft. AspNetCore. Authentication. MicrosoftAccount](https://www.nuget.org/packages/Microsoft.AspNetCore.Authentication.MicrosoftAccount))</span><span class="sxs-lookup"><span data-stu-id="e4d1e-231">Microsoft Account authentication ([Microsoft.AspNetCore.Authentication.MicrosoftAccount](https://www.nuget.org/packages/Microsoft.AspNetCore.Authentication.MicrosoftAccount))</span></span>
  * <span data-ttu-id="e4d1e-232">Autenticación de OpenID Connect ([Microsoft. AspNetCore. Authentication. OpenIdConnect](https://www.nuget.org/packages/Microsoft.AspNetCore.Authentication.OpenIdConnect))</span><span class="sxs-lookup"><span data-stu-id="e4d1e-232">OpenID Connect authentication ([Microsoft.AspNetCore.Authentication.OpenIdConnect](https://www.nuget.org/packages/Microsoft.AspNetCore.Authentication.OpenIdConnect))</span></span>
  * <span data-ttu-id="e4d1e-233">Twitter OAuth ([Microsoft. AspNetCore. Authentication. Twitter](https://www.nuget.org/packages/Microsoft.AspNetCore.Authentication.Twitter))</span><span class="sxs-lookup"><span data-stu-id="e4d1e-233">Twitter OAuth ([Microsoft.AspNetCore.Authentication.Twitter](https://www.nuget.org/packages/Microsoft.AspNetCore.Authentication.Twitter))</span></span>
  * <span data-ttu-id="e4d1e-234">Autenticación WsFederation ([Microsoft. AspNetCore. Authentication. WsFederation](https://www.nuget.org/packages/Microsoft.AspNetCore.Authentication.WsFederation))</span><span class="sxs-lookup"><span data-stu-id="e4d1e-234">WsFederation authentication ([Microsoft.AspNetCore.Authentication.WsFederation](https://www.nuget.org/packages/Microsoft.AspNetCore.Authentication.WsFederation))</span></span>

* <span data-ttu-id="e4d1e-235">Compatibilidad con la negociación de contenido y el formato de `System.Net.HttpClient` &ndash; el paquete NuGet [Microsoft. Aspnet. WebApi. Client](https://www.nuget.org/packages/Microsoft.AspNet.WebApi.Client/) proporciona una extensibilidad útil a `System.Net.HttpClient` con las api como `ReadAsAsync`, `PostJsonAsync`, etc.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-235">Formatting and content negotiation support for `System.Net.HttpClient` &ndash; The [Microsoft.AspNet.WebApi.Client](https://www.nuget.org/packages/Microsoft.AspNet.WebApi.Client/) NuGet package provides useful extensibility to `System.Net.HttpClient` with APIs such as `ReadAsAsync`, `PostJsonAsync` etc.</span></span>

* <span data-ttu-id="e4d1e-236">Compilación en tiempo de ejecución de Razor &ndash; la compatibilidad con la compilación en tiempo de ejecución de las vistas y páginas de Razor ahora forma parte de [Microsoft. AspNetCore. Mvc. Razor. RuntimeCompilation](https://www.nuget.org/packages/Microsoft.AspNetCore.Mvc.Razor.RuntimeCompilation).</span><span class="sxs-lookup"><span data-stu-id="e4d1e-236">Razor runtime compilation &ndash; Support for runtime compilation of Razor views and pages is now part of [Microsoft.AspNetCore.Mvc.Razor.RuntimeCompilation](https://www.nuget.org/packages/Microsoft.AspNetCore.Mvc.Razor.RuntimeCompilation).</span></span>

* <span data-ttu-id="e4d1e-237">MVC `Newtonsoft.Json` admiten la compatibilidad de &ndash; para el uso de MVC con @no__t 2 es ahora parte de [Microsoft. AspNetCore. Mvc. NewtonsoftJson](https://www.nuget.org/packages/Microsoft.AspNetCore.Mvc.NewtonsoftJson).</span><span class="sxs-lookup"><span data-stu-id="e4d1e-237">MVC `Newtonsoft.Json` support &ndash; Support for using MVC with `Newtonsoft.Json` is now part of [Microsoft.AspNetCore.Mvc.NewtonsoftJson](https://www.nuget.org/packages/Microsoft.AspNetCore.Mvc.NewtonsoftJson).</span></span>

### <a name="analyzer-support"></a><span data-ttu-id="e4d1e-238">Compatibilidad con analizador</span><span class="sxs-lookup"><span data-stu-id="e4d1e-238">Analyzer support</span></span>

<span data-ttu-id="e4d1e-239">Los proyectos que tienen como destino `Microsoft.NET.Sdk.Web`, implícitamente, hacen referencia a analizadores distribuidos previamente como parte del paquete [Microsoft. AspNetCore. Mvc. analizadores](https://www.nuget.org/packages/Microsoft.AspNetCore.Mvc.Analyzers/) .</span><span class="sxs-lookup"><span data-stu-id="e4d1e-239">Projects that target `Microsoft.NET.Sdk.Web` implicitly reference analyzers previously shipped as part of the [Microsoft.AspNetCore.Mvc.Analyzers](https://www.nuget.org/packages/Microsoft.AspNetCore.Mvc.Analyzers/) package.</span></span> <span data-ttu-id="e4d1e-240">No se requieren referencias adicionales para habilitarlas.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-240">No additional references are required to enable these.</span></span>

<span data-ttu-id="e4d1e-241">Si su aplicación usa [analizadores de API](xref:web-api/advanced/analyzers) previamente enviados mediante el paquete [Microsoft. AspNetCore. Mvc. API. analizadores](https://www.nuget.org/packages/Microsoft.AspNetCore.Mvc.Api.Analyzers/) , edite el archivo de proyecto para que haga referencia a los analizadores que se incluyen como parte del SDK Web de .net Core:</span><span class="sxs-lookup"><span data-stu-id="e4d1e-241">If your app uses [API analyzers](xref:web-api/advanced/analyzers) previously shipped using the [Microsoft.AspNetCore.Mvc.Api.Analyzers](https://www.nuget.org/packages/Microsoft.AspNetCore.Mvc.Api.Analyzers/) package, edit your project file to reference the analyzers shipped as part of the .NET Core Web SDK:</span></span>

```xml
<Project Sdk="Microsoft.NET.Sdk.Web">
    <PropertyGroup>
        <TargetFramework>netcoreapp3.0</TargetFramework>
        <IncludeOpenAPIAnalyzers>true</IncludeOpenAPIAnalyzers>
    </PropertyGroup>

    ...
</Project>
```

### <a name="razor-class-library"></a><span data-ttu-id="e4d1e-242">Biblioteca de clases de Razor</span><span class="sxs-lookup"><span data-stu-id="e4d1e-242">Razor Class Library</span></span>

<span data-ttu-id="e4d1e-243">Los proyectos de biblioteca de clases de Razor que proporcionan los componentes de interfaz de usuario para MVC deben establecer la propiedad `AddRazorSupportForMvc` en el archivo de proyecto:</span><span class="sxs-lookup"><span data-stu-id="e4d1e-243">Razor Class Library projects that provide UI components for MVC must set the `AddRazorSupportForMvc` property in the project file:</span></span>

```xml
<PropertyGroup>
  <AddRazorSupportForMvc>true</AddRazorSupportForMvc>
</PropertyGroup>
```

### <a name="in-process-hosting-model"></a><span data-ttu-id="e4d1e-244">Modelo de hospedaje en proceso</span><span class="sxs-lookup"><span data-stu-id="e4d1e-244">In-process hosting model</span></span>

<span data-ttu-id="e4d1e-245">Los proyectos tienen como valor predeterminado el [modelo de hospedaje en proceso](xref:host-and-deploy/aspnet-core-module#in-process-hosting-model) en ASP.net Core 3,0 o posterior.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-245">Projects default to the [in-process hosting model](xref:host-and-deploy/aspnet-core-module#in-process-hosting-model) in ASP.NET Core 3.0 or later.</span></span> <span data-ttu-id="e4d1e-246">Opcionalmente, puede quitar la propiedad `<AspNetCoreHostingModel>` en el archivo de proyecto si su valor es `InProcess`.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-246">You may optionally remove the `<AspNetCoreHostingModel>` property in the project file if its value is `InProcess`.</span></span>

## <a name="kestrel"></a><span data-ttu-id="e4d1e-247">Kestrel</span><span class="sxs-lookup"><span data-stu-id="e4d1e-247">Kestrel</span></span>

### <a name="configuration"></a><span data-ttu-id="e4d1e-248">Configuración</span><span class="sxs-lookup"><span data-stu-id="e4d1e-248">Configuration</span></span>

<span data-ttu-id="e4d1e-249">Migre la configuración de Kestrel al generador de hosts web proporcionado por `ConfigureWebHostDefaults` (*Program.CS*):</span><span class="sxs-lookup"><span data-stu-id="e4d1e-249">Migrate Kestrel configuration to the web host builder provided by `ConfigureWebHostDefaults` (*Program.cs*):</span></span>

```csharp
public static IHostBuilder CreateHostBuilder(string[] args) =>
    Host.CreateDefaultBuilder(args)
        .ConfigureWebHostDefaults(webBuilder =>
        {
            webBuilder.ConfigureKestrel(serverOptions =>
            {
                // Set properties and call methods on options
            })
            .UseStartup<Startup>();
        });
```

<span data-ttu-id="e4d1e-250">Si la aplicación crea el host manualmente con `HostBuilder`, llame a `UseKestrel` en el generador de hosts Web de `ConfigureWebHostDefaults`:</span><span class="sxs-lookup"><span data-stu-id="e4d1e-250">If the app creates the host manually with `HostBuilder`, call `UseKestrel` on the web host builder in `ConfigureWebHostDefaults`:</span></span>

```csharp
public static void Main(string[] args)
{
    var host = new HostBuilder()
        .UseContentRoot(Directory.GetCurrentDirectory())
        .ConfigureWebHostDefaults(webBuilder =>
        {
            webBuilder.UseKestrel(serverOptions =>
            {
                // Set properties and call methods on options
            })
            .UseIISIntegration()
            .UseStartup<Startup>();
        })
        .Build();

    host.Run();
}
```

### <a name="connection-middleware-replaces-connection-adapters"></a><span data-ttu-id="e4d1e-251">El middleware de conexión reemplaza los adaptadores de conexión</span><span class="sxs-lookup"><span data-stu-id="e4d1e-251">Connection Middleware replaces Connection Adapters</span></span>

<span data-ttu-id="e4d1e-252">Los adaptadores de conexión (<xref:Microsoft.AspNetCore.Server.Kestrel.Core.Adapter.Internal.IConnectionAdapter>) se han quitado de Kestrel.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-252">Connection Adapters (<xref:Microsoft.AspNetCore.Server.Kestrel.Core.Adapter.Internal.IConnectionAdapter>) have been removed from Kestrel.</span></span> <span data-ttu-id="e4d1e-253">Reemplace los adaptadores de conexión por el middleware de conexión.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-253">Replace Connection Adapters with Connection Middleware.</span></span> <span data-ttu-id="e4d1e-254">El middleware de conexión es similar al middleware HTTP en la canalización de ASP.NET Core, pero para las conexiones de nivel inferior.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-254">Connection Middleware is similar to HTTP Middleware in the ASP.NET Core pipeline but for lower-level connections.</span></span> <span data-ttu-id="e4d1e-255">HTTPS y registro de conexiones:</span><span class="sxs-lookup"><span data-stu-id="e4d1e-255">HTTPS and connection logging:</span></span>

* <span data-ttu-id="e4d1e-256">Se han pasado de los adaptadores de conexión al middleware de conexión.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-256">Have been moved from Connection Adapters to Connection Middleware.</span></span>
* <span data-ttu-id="e4d1e-257">Estos métodos de extensión funcionan como en versiones anteriores de ASP.NET Core.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-257">These extension methods work as in previous versions of ASP.NET Core.</span></span> 

<span data-ttu-id="e4d1e-258">Para obtener más información, consulte [el ejemplo de TlsFilterConnectionHandler en la sección ListenOptions. Protocols del artículo Kestrel](/aspnet/core/fundamentals/servers/kestrel?view=aspnetcore-3.0#listenoptionsprotocols).</span><span class="sxs-lookup"><span data-stu-id="e4d1e-258">For more information, see [the TlsFilterConnectionHandler example in the ListenOptions.Protocols section of the Kestrel article](/aspnet/core/fundamentals/servers/kestrel?view=aspnetcore-3.0#listenoptionsprotocols).</span></span>

### <a name="transport-abstractions-moved-and-made-public"></a><span data-ttu-id="e4d1e-259">Abstracciones de transporte que se movieron y hicieron públicas</span><span class="sxs-lookup"><span data-stu-id="e4d1e-259">Transport abstractions moved and made public</span></span>

<span data-ttu-id="e4d1e-260">La capa de transporte de Kestrel se ha expuesto como una interfaz pública en `Connections.Abstractions`.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-260">The Kestrel transport layer has been exposed as a public interface in `Connections.Abstractions`.</span></span> <span data-ttu-id="e4d1e-261">Como parte de estas actualizaciones:</span><span class="sxs-lookup"><span data-stu-id="e4d1e-261">As part of these updates:</span></span>

* <span data-ttu-id="e4d1e-262">se han quitado `Microsoft.AspNetCore.Server.Kestrel.Transport.Abstractions` y los tipos asociados.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-262">`Microsoft.AspNetCore.Server.Kestrel.Transport.Abstractions` and associated types have been removed.</span></span>
* <span data-ttu-id="e4d1e-263"><xref:Microsoft.AspNetCore.Server.Kestrel.KestrelServerOptions.NoDelay> se ha pasado de <xref:Microsoft.AspNetCore.Server.Kestrel.Core.ListenOptions> a las opciones de transporte.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-263"><xref:Microsoft.AspNetCore.Server.Kestrel.KestrelServerOptions.NoDelay> was moved from <xref:Microsoft.AspNetCore.Server.Kestrel.Core.ListenOptions> to the transport options.</span></span>
* <span data-ttu-id="e4d1e-264">se quitó <xref:Microsoft.AspNetCore.Server.Kestrel.Transport.Abstractions.Internal.SchedulingMode> de <xref:Microsoft.AspNetCore.Server.Kestrel.KestrelServerOptions>.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-264"><xref:Microsoft.AspNetCore.Server.Kestrel.Transport.Abstractions.Internal.SchedulingMode> was removed from <xref:Microsoft.AspNetCore.Server.Kestrel.KestrelServerOptions>.</span></span>

<span data-ttu-id="e4d1e-265">Para obtener más información, consulte los siguientes recursos de GitHub:</span><span class="sxs-lookup"><span data-stu-id="e4d1e-265">For more information, see the following GitHub resources:</span></span>

* [<span data-ttu-id="e4d1e-266">Abstracciones de redes cliente/servidor (#10308 ASPNET/AspNetCore)</span><span class="sxs-lookup"><span data-stu-id="e4d1e-266">Client/server networking abstractions (aspnet/AspNetCore #10308)</span></span>](https://github.com/aspnet/AspNetCore/issues/10308)
* [<span data-ttu-id="e4d1e-267">Implementar una nueva abstracción de escucha de cimientos y volver a Kestrel en la parte superior (ASPNET/AspNetCore #10321)</span><span class="sxs-lookup"><span data-stu-id="e4d1e-267">Implement new bedrock listener abstraction and re-plat Kestrel on top (aspnet/AspNetCore #10321)</span></span>](https://github.com/aspnet/AspNetCore/pull/10321)

### <a name="kestrel-request-trailer-headers"></a><span data-ttu-id="e4d1e-268">Kestrel encabezados de finalizador de solicitud</span><span class="sxs-lookup"><span data-stu-id="e4d1e-268">Kestrel Request trailer headers</span></span>

<span data-ttu-id="e4d1e-269">En el caso de las aplicaciones destinadas a versiones anteriores de ASP.NET Core:</span><span class="sxs-lookup"><span data-stu-id="e4d1e-269">For apps that target earlier versions of ASP.NET Core:</span></span>

* <span data-ttu-id="e4d1e-270">Kestrel agrega encabezados de finalizador fragmentados de HTTP/1.1 a la colección de encabezados de solicitud.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-270">Kestrel adds HTTP/1.1 chunked trailer headers into the request headers collection.</span></span>
* <span data-ttu-id="e4d1e-271">Los finalizadores están disponibles después de leer el cuerpo de la solicitud hasta el final.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-271">Trailers are available after the request body is read to the end.</span></span>

<span data-ttu-id="e4d1e-272">Esto provoca algunos problemas sobre la ambigüedad entre encabezados y finalizadores, por lo que los finalizadores se han desplazado a una nueva colección (`RequestTrailerExtensions`) en 3,0.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-272">This causes some concerns about ambiguity between headers and trailers, so the trailers have been moved to a new collection (`RequestTrailerExtensions`) in 3.0.</span></span>

<span data-ttu-id="e4d1e-273">Los finalizadores de solicitudes HTTP/2 son:</span><span class="sxs-lookup"><span data-stu-id="e4d1e-273">HTTP/2 request trailers are:</span></span>

* <span data-ttu-id="e4d1e-274">No disponible en ASP.NET Core 2,2.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-274">Not available in ASP.NET Core 2.2.</span></span>
* <span data-ttu-id="e4d1e-275">Disponible en 3,0 como `RequestTrailerExtensions`.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-275">Available in 3.0 as `RequestTrailerExtensions`.</span></span>

<span data-ttu-id="e4d1e-276">Hay nuevos métodos de extensión de solicitud para tener acceso a estos finalizadores.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-276">New request extension methods are present to access these trailers.</span></span> <span data-ttu-id="e4d1e-277">Al igual que con HTTP/1.1, los finalizadores están disponibles después de leer el cuerpo de la solicitud hasta el final.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-277">As with HTTP/1.1, trailers are available after the request body is read to the end.</span></span>

<span data-ttu-id="e4d1e-278">En la versión 3,0, están disponibles los siguientes métodos `RequestTrailerExtensions`:</span><span class="sxs-lookup"><span data-stu-id="e4d1e-278">For the 3.0 release, the following `RequestTrailerExtensions` methods are available:</span></span>

* <span data-ttu-id="e4d1e-279">`GetDeclaredTrailers` &ndash; obtiene el encabezado request `Trailer` que muestra los finalizadores que se esperan después del cuerpo.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-279">`GetDeclaredTrailers` &ndash; Gets the request `Trailer` header that lists which trailers to expect after the body.</span></span>
* <span data-ttu-id="e4d1e-280">`SupportsTrailers` &ndash; indica si la solicitud admite encabezados de finalizador de recepción.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-280">`SupportsTrailers` &ndash; Indicates if the request supports receiving trailer headers.</span></span>
* <span data-ttu-id="e4d1e-281">`CheckTrailersAvailable` &ndash; comprueba si la solicitud admite finalizadores y si están disponibles para su lectura.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-281">`CheckTrailersAvailable` &ndash; Checks if the request supports trailers and if they're available to be read.</span></span> <span data-ttu-id="e4d1e-282">En esta comprobación no se da por hecho que hay finalizadores para leer.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-282">This check doesn't assume that there are trailers to read.</span></span> <span data-ttu-id="e4d1e-283">Es posible que no haya ningún finalizador para leer aunque este método devuelva `true`.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-283">There might be no trailers to read even if `true` is returned by this method.</span></span>
* <span data-ttu-id="e4d1e-284">`GetTrailer` &ndash; obtiene el encabezado final solicitado de la respuesta.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-284">`GetTrailer` &ndash; Gets the requested trailing header from the response.</span></span> <span data-ttu-id="e4d1e-285">Compruebe `SupportsTrailers` antes de llamar a `GetTrailer` o se puede producir una <xref:System.NotSupportedException> Si la solicitud no admite encabezados finales.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-285">Check `SupportsTrailers` before calling `GetTrailer`, or a <xref:System.NotSupportedException> may occur if the request doesn't support trailing headers.</span></span>

<span data-ttu-id="e4d1e-286">Para obtener más información, consulte [colocar finalizadores de solicitudes en una colección independiente (ASPNET/AspNetCore #10410)](https://github.com/aspnet/AspNetCore/pull/10410).</span><span class="sxs-lookup"><span data-stu-id="e4d1e-286">For more information, see [Put request trailers in a separate collection (aspnet/AspNetCore #10410)](https://github.com/aspnet/AspNetCore/pull/10410).</span></span>

### <a name="allowsynchronousio-disabled"></a><span data-ttu-id="e4d1e-287">AllowSynchronousIO deshabilitado</span><span class="sxs-lookup"><span data-stu-id="e4d1e-287">AllowSynchronousIO disabled</span></span>

<span data-ttu-id="e4d1e-288">`AllowSynchronousIO` habilita o deshabilita las API de e/s sincrónicas, como `HttpRequest.Body.Read`, `HttpResponse.Body.Write` y `Stream.Flush`.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-288">`AllowSynchronousIO` enables or disables synchronous IO APIs, such as `HttpRequest.Body.Read`, `HttpResponse.Body.Write`, and `Stream.Flush`.</span></span> <span data-ttu-id="e4d1e-289">Estas API son un origen de colapso de subprocesos que conduce a bloqueos de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-289">These APIs are a source of thread starvation leading to app crashes.</span></span> <span data-ttu-id="e4d1e-290">En la versión 3.0, `AllowSynchronousIO` se ha deshabilitado de manera predeterminada.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-290">In 3.0, `AllowSynchronousIO` is disabled by default.</span></span> <span data-ttu-id="e4d1e-291">Para obtener más información, consulte [la sección de e/s sincrónica en el artículo de Kestrel](/aspnet/core/fundamentals/servers/kestrel?view=aspnetcore-3.0#synchronous-io).</span><span class="sxs-lookup"><span data-stu-id="e4d1e-291">For more information, see [the Synchronous IO section in the Kestrel article](/aspnet/core/fundamentals/servers/kestrel?view=aspnetcore-3.0#synchronous-io).</span></span>

<span data-ttu-id="e4d1e-292">Además de habilitar `AllowSynchronousIO` con las opciones de `ConfigureKestrel`, la e/s sincrónica también puede invalidarse por solicitud como una mitigación temporal:</span><span class="sxs-lookup"><span data-stu-id="e4d1e-292">In addition to enabling `AllowSynchronousIO` with `ConfigureKestrel`'s options, synchronous IO can also be overridden on a per-request basis as a temporary mitigation:</span></span>

```csharp
var syncIOFeature = HttpContext.Features.Get<IHttpBodyControlFeature>();

if (syncIOFeature != null)
{
    syncIOFeature.AllowSynchronousIO = true;
}
```

<span data-ttu-id="e4d1e-293">Si tiene problemas con las implementaciones <xref:System.IO.TextWriter> u otras secuencias que llaman a las API sincrónicas en [Dispose](/dotnet/standard/garbage-collection/implementing-dispose), llame a la nueva API <xref:System.IO.Stream.DisposeAsync*> en su lugar.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-293">If you have trouble with <xref:System.IO.TextWriter> implementations or other streams that call synchronous APIs in [Dispose](/dotnet/standard/garbage-collection/implementing-dispose), call the new <xref:System.IO.Stream.DisposeAsync*> API instead.</span></span>

<span data-ttu-id="e4d1e-294">Para obtener más información, vea [[anuncio] AllowSynchronousIO deshabilitado en todos los servidores (ASPNET/AspNetCore #7644)](https://github.com/aspnet/AspNetCore/issues/7644).</span><span class="sxs-lookup"><span data-stu-id="e4d1e-294">For more information, see [[Announcement] AllowSynchronousIO disabled in all servers (aspnet/AspNetCore #7644)](https://github.com/aspnet/AspNetCore/issues/7644).</span></span>

### <a name="microsoftaspnetcoreserverkestrelhttps-assembly-removed"></a><span data-ttu-id="e4d1e-295">Se quitó el ensamblado Microsoft. AspNetCore. Server. Kestrel. https</span><span class="sxs-lookup"><span data-stu-id="e4d1e-295">Microsoft.AspNetCore.Server.Kestrel.Https assembly removed</span></span>

<span data-ttu-id="e4d1e-296">En ASP.NET Core 2,1, el contenido de *Microsoft. AspNetCore. Server. Kestrel. https. dll* se ha migrado a *Microsoft. AspNetCore. Server. Kestrel. Core. dll*.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-296">In ASP.NET Core 2.1, the contents of *Microsoft.AspNetCore.Server.Kestrel.Https.dll* were moved to *Microsoft.AspNetCore.Server.Kestrel.Core.dll*.</span></span> <span data-ttu-id="e4d1e-297">Se trata de una actualización no interrumpida mediante el uso de atributos `TypeForwardedTo`.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-297">This was a non-breaking update using `TypeForwardedTo` attributes.</span></span> <span data-ttu-id="e4d1e-298">En 3,0, se han quitado el ensamblado *Microsoft. AspNetCore. Server. Kestrel. https. dll* vacío y el paquete NuGet.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-298">For 3.0, the empty *Microsoft.AspNetCore.Server.Kestrel.Https.dll* assembly and the NuGet package have been removed.</span></span>

<span data-ttu-id="e4d1e-299">Las bibliotecas que hacen referencia a [Microsoft. AspNetCore. Server. Kestrel. https](https://www.nuget.org/packages/Microsoft.AspNetCore.Server.Kestrel.Https) deben actualizar las dependencias ASP.NET Core a 2,1 o posterior.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-299">Libraries referencing [Microsoft.AspNetCore.Server.Kestrel.Https](https://www.nuget.org/packages/Microsoft.AspNetCore.Server.Kestrel.Https) should update ASP.NET Core dependencies to 2.1 or later.</span></span>

<span data-ttu-id="e4d1e-300">Las aplicaciones y bibliotecas que tienen como destino ASP.NET Core 2,1 o posterior deben quitar las referencias directas al paquete [Microsoft. AspNetCore. Server. Kestrel. https](https://www.nuget.org/packages/Microsoft.AspNetCore.Server.Kestrel.Https) .</span><span class="sxs-lookup"><span data-stu-id="e4d1e-300">Apps and libraries targeting ASP.NET Core 2.1 or later should remove any direct references to the [Microsoft.AspNetCore.Server.Kestrel.Https](https://www.nuget.org/packages/Microsoft.AspNetCore.Server.Kestrel.Https) package.</span></span>

## <a name="jsonnet-support"></a><span data-ttu-id="e4d1e-301">Compatibilidad con Json.NET</span><span class="sxs-lookup"><span data-stu-id="e4d1e-301">Json.NET support</span></span>

<span data-ttu-id="e4d1e-302">Como parte del trabajo para [mejorar la ASP.net Core marco compartido](https://blogs.msdn.microsoft.com/webdev/2018/10/29/a-first-look-at-changes-coming-in-asp-net-core-3-0/), se ha quitado [Json.NET](https://www.newtonsoft.com/json/help/html/Introduction.htm) de la ASP.net Core marco compartido.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-302">As part of the work to [improve the ASP.NET Core shared framework](https://blogs.msdn.microsoft.com/webdev/2018/10/29/a-first-look-at-changes-coming-in-asp-net-core-3-0/), [Json.NET](https://www.newtonsoft.com/json/help/html/Introduction.htm) has been removed from the ASP.NET Core shared framework.</span></span>

<span data-ttu-id="e4d1e-303">El valor predeterminado para ASP.NET Core es ahora [System. Text. JSON](/dotnet/api/system.text.json?view=netcore-3.0), que es nuevo en .net Core 3,0.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-303">The default for ASP.NET Core is now [System.Text.Json](/dotnet/api/system.text.json?view=netcore-3.0), which is new in .NET Core 3.0.</span></span> <span data-ttu-id="e4d1e-304">Considere la posibilidad de usar `System.Text.Json` cuando sea posible.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-304">Consider using `System.Text.Json` when possible.</span></span> <span data-ttu-id="e4d1e-305">Es de alto rendimiento y no requiere una dependencia de biblioteca adicional.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-305">It's high-performance and doesn't require an additional library dependency.</span></span> <span data-ttu-id="e4d1e-306">Sin embargo, como `System.Text.Json` es nuevo, es posible que actualmente falten características que la aplicación necesita.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-306">However, since `System.Text.Json` is new, it might currently be missing features that your app needs.</span></span>

<span data-ttu-id="e4d1e-307">Es posible que la aplicación requiera la integración con `Newtonsoft.Json` si usa @no__t característica específica de -1 como JsonPatch o convertidores o si [da formato](xref:web-api/advanced/formatting) a @no__t tipos específicos de -3.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-307">Your app may require `Newtonsoft.Json` integration if it uses `Newtonsoft.Json`-specific feature such as JsonPatch or converters or if it [formats](xref:web-api/advanced/formatting) `Newtonsoft.Json`-specific types.</span></span>

<span data-ttu-id="e4d1e-308">Para usar Json.NET en un proyecto de Signalr ASP.NET Core 3,0, consulte [cambiar a Newtonsoft. JSON](#switch-to-newtonsoftjson) en este documento.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-308">To use Json.NET in an ASP.NET Core 3.0 SignalR project, see [Switch to Newtonsoft.Json](#switch-to-newtonsoftjson) in this document.</span></span>

<span data-ttu-id="e4d1e-309">Para usar Json.NET en un proyecto ASP.NET Core 3,0:</span><span class="sxs-lookup"><span data-stu-id="e4d1e-309">To use Json.NET in an ASP.NET Core 3.0 project:</span></span>

* <span data-ttu-id="e4d1e-310">Agregue una referencia de paquete a [Microsoft.AspNetCore.Mvc.NewtonsoftJson](https://nuget.org/packages/Microsoft.AspNetCore.Mvc.NewtonsoftJson).</span><span class="sxs-lookup"><span data-stu-id="e4d1e-310">Add a package reference to [Microsoft.AspNetCore.Mvc.NewtonsoftJson](https://nuget.org/packages/Microsoft.AspNetCore.Mvc.NewtonsoftJson).</span></span>
* <span data-ttu-id="e4d1e-311">Actualice `Startup.ConfigureServices` para llamar a `AddNewtonsoftJson`.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-311">Update `Startup.ConfigureServices` to call `AddNewtonsoftJson`.</span></span>

  ```csharp
  services.AddMvc()
      .AddNewtonsoftJson();
  ```

  <span data-ttu-id="e4d1e-312">`AddNewtonsoftJson` es compatible con los nuevos métodos de registro del servicio MVC:</span><span class="sxs-lookup"><span data-stu-id="e4d1e-312">`AddNewtonsoftJson` is compatible with the new MVC service registration methods:</span></span>

  * `AddRazorPages`
  * `AddControllersWithViews`
  * `AddControllers`

  ```csharp
  services.AddControllers()
      .AddNewtonsoftJson();
  ```

  <span data-ttu-id="e4d1e-313">La configuración de Json.NET se puede establecer en la llamada a `AddNewtonsoftJson`:</span><span class="sxs-lookup"><span data-stu-id="e4d1e-313">Json.NET settings can be set in the call to `AddNewtonsoftJson`:</span></span>

  ```csharp
  services.AddMvc()
      .AddNewtonsoftJson(options =>
             options.SerializerSettings.ContractResolver =
                new CamelCasePropertyNamesContractResolver());
  ```

## <a name="mvc-service-registration"></a><span data-ttu-id="e4d1e-314">Registro del servicio MVC</span><span class="sxs-lookup"><span data-stu-id="e4d1e-314">MVC service registration</span></span>

<span data-ttu-id="e4d1e-315">ASP.NET Core 3,0 agrega nuevas opciones para registrar escenarios MVC dentro de `Startup.ConfigureServices`.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-315">ASP.NET Core 3.0 adds new options for registering MVC scenarios inside `Startup.ConfigureServices`.</span></span>

<span data-ttu-id="e4d1e-316">Hay disponibles tres nuevos métodos de extensión de nivel superior relacionados con los escenarios MVC en `IServiceCollection`.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-316">Three new top-level extension methods related to MVC scenarios on `IServiceCollection` are available.</span></span> <span data-ttu-id="e4d1e-317">Las plantillas usan estos nuevos métodos en lugar de `UseMvc`.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-317">Templates use these new methods instead of `UseMvc`.</span></span> <span data-ttu-id="e4d1e-318">Sin embargo, `AddMvc` continúa comportándose como tiene en las versiones anteriores.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-318">However, `AddMvc` continues to behave as it has in previous releases.</span></span>

<span data-ttu-id="e4d1e-319">En el ejemplo siguiente se agrega compatibilidad con controladores y características relacionadas con la API, pero no vistas o páginas.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-319">The following example adds support for controllers and API-related features, but not views or pages.</span></span> <span data-ttu-id="e4d1e-320">La plantilla de API usa este código:</span><span class="sxs-lookup"><span data-stu-id="e4d1e-320">The API template uses this code:</span></span>

```csharp
public void ConfigureServices(IServiceCollection services)
{
    services.AddControllers();
}
```

<span data-ttu-id="e4d1e-321">En el ejemplo siguiente se agrega compatibilidad con controladores, características relacionadas con la API y vistas, pero no páginas.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-321">The following example adds support for controllers, API-related features, and views, but not pages.</span></span> <span data-ttu-id="e4d1e-322">La plantilla aplicación web (MVC) utiliza este código:</span><span class="sxs-lookup"><span data-stu-id="e4d1e-322">The Web Application (MVC) template uses this code:</span></span>

```csharp
public void ConfigureServices(IServiceCollection services)
{
    services.AddControllersWithViews();
}
```

<span data-ttu-id="e4d1e-323">En el ejemplo siguiente se agrega compatibilidad con Razor Pages y compatibilidad mínima con el controlador.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-323">The following example adds support for Razor Pages and minimal controller support.</span></span> <span data-ttu-id="e4d1e-324">La plantilla de aplicación Web usa este código:</span><span class="sxs-lookup"><span data-stu-id="e4d1e-324">The Web Application template uses this code:</span></span>

```csharp
public void ConfigureServices(IServiceCollection services)
{
    services.AddRazorPages();
}
```

<span data-ttu-id="e4d1e-325">También se pueden combinar los nuevos métodos.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-325">The new methods can also be combined.</span></span> <span data-ttu-id="e4d1e-326">El ejemplo siguiente es equivalente a llamar a `AddMvc` en ASP.NET Core 2,2:</span><span class="sxs-lookup"><span data-stu-id="e4d1e-326">The following example is equivalent to calling `AddMvc` in ASP.NET Core 2.2:</span></span>

```csharp
public void ConfigureServices(IServiceCollection services)
{
    services.AddControllersWithViews();
    services.AddRazorPages();
}
```

## <a name="routing-startup-code"></a><span data-ttu-id="e4d1e-327">Código de inicio de enrutamiento</span><span class="sxs-lookup"><span data-stu-id="e4d1e-327">Routing startup code</span></span>

<span data-ttu-id="e4d1e-328">Si una aplicación llama a `UseMvc` o `UseSignalR`, migre la aplicación al [enrutamiento del punto de conexión](xref:fundamentals/routing) , si es posible.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-328">If an app calls `UseMvc` or `UseSignalR`, migrate the app to [Endpoint Routing](xref:fundamentals/routing) if possible.</span></span> <span data-ttu-id="e4d1e-329">Para mejorar la compatibilidad del enrutamiento de puntos de conexión con versiones anteriores de MVC, hemos revertido algunos de los cambios en la generación de direcciones URL introducidos en ASP.NET Core 2,2.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-329">To improve Endpoint Routing compatibility with previous versions of MVC, we've reverted some of the changes in URL generation introduced in ASP.NET Core 2.2.</span></span> <span data-ttu-id="e4d1e-330">Si experimenta problemas al usar el enrutamiento de puntos de conexión en 2,2, espere mejoras en ASP.NET Core 3,0 con las siguientes excepciones:</span><span class="sxs-lookup"><span data-stu-id="e4d1e-330">If you experienced problems using Endpoint Routing in 2.2, expect improvements in ASP.NET Core 3.0 with the following exceptions:</span></span>

* <span data-ttu-id="e4d1e-331">Si la aplicación implementa `IRouter` o hereda de `Route`, use [DynamicRouteValuesTransformer](https://github.com/aspnet/AspNetCore.Docs/issues/12997) como reemplazo.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-331">If the app implements `IRouter` or inherits from `Route`, use [DynamicRouteValuesTransformer](https://github.com/aspnet/AspNetCore.Docs/issues/12997) as the replacement.</span></span>

* <span data-ttu-id="e4d1e-332">Si la aplicación accede directamente a `RouteData.Routers` dentro de MVC para analizar las direcciones URL, puede reemplazarlo por el uso de `LinkParser.ParsePathByEndpointName`.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-332">If the app directly accesses `RouteData.Routers` inside MVC to parse URLs, you can replace this with use of `LinkParser.ParsePathByEndpointName`.</span></span> 
 * <span data-ttu-id="e4d1e-333">Defina la ruta con un nombre de ruta.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-333">Define the route with a route name.</span></span>
 * <span data-ttu-id="e4d1e-334">Use `LinkParser.ParsePathByEndpointName` y pase el nombre de ruta deseado.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-334">Use `LinkParser.ParsePathByEndpointName` and pass in the desired route name.</span></span>

<span data-ttu-id="e4d1e-335">El enrutamiento de puntos de conexión admite la misma sintaxis de patrón de ruta y características de creación de patrones de ruta que `IRouter`.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-335">Endpoint Routing supports the same route pattern syntax and route pattern authoring features as `IRouter`.</span></span> <span data-ttu-id="e4d1e-336">El enrutamiento del punto de conexión admite `IRouteConstraint`.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-336">Endpoint Routing supports `IRouteConstraint`.</span></span> <span data-ttu-id="e4d1e-337">El enrutamiento de puntos de conexión admite `[Route]`, `[HttpGet]` y los demás atributos de enrutamiento de MVC.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-337">Endpoint routing supports `[Route]`, `[HttpGet]`, and the other MVC routing attributes.</span></span>

<span data-ttu-id="e4d1e-338">Para la mayoría de las aplicaciones, solo `Startup` requiere cambios.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-338">For most applications, only `Startup` requires changes.</span></span>

### <a name="migrate-startupconfigure"></a><span data-ttu-id="e4d1e-339">Migrar startup. Configure</span><span class="sxs-lookup"><span data-stu-id="e4d1e-339">Migrate Startup.Configure</span></span>

<span data-ttu-id="e4d1e-340">Consejos generales:</span><span class="sxs-lookup"><span data-stu-id="e4d1e-340">General advice:</span></span>

* <span data-ttu-id="e4d1e-341">Agregue `UseRouting`.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-341">Add `UseRouting`.</span></span>
* <span data-ttu-id="e4d1e-342">Si la aplicación llama a `UseStaticFiles`, coloque `UseStaticFiles` **antes** de `UseRouting`.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-342">If the app calls `UseStaticFiles`, place `UseStaticFiles` **before** `UseRouting`.</span></span>
* <span data-ttu-id="e4d1e-343">Si la aplicación usa características de autenticación y autorización como `AuthorizePage` o `[Authorize]`, realice la llamada a `UseAuthentication` y `UseAuthorization`: **After**, `UseRouting` y `UseCors`, pero antes de `UseEndpoints`:</span><span class="sxs-lookup"><span data-stu-id="e4d1e-343">If the app uses authentication/authorization features such as `AuthorizePage` or `[Authorize]`, place the call to `UseAuthentication` and `UseAuthorization`: **after**, `UseRouting` and `UseCors`, but before `UseEndpoints`:</span></span>

  ```csharp
  public void Configure(IApplicationBuilder app)
  {
    ...

    app.UseStaticFiles();

    app.UseRouting();
    app.UseCors();

    app.UseAuthentication();
    app.UseAuthorization();

    app.UseEndpoints(endpoints => {
       endpoints.MapControllers();
    });
  ```

* <span data-ttu-id="e4d1e-344">Reemplace `UseMvc` o `UseSignalR` por `UseEndpoints`.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-344">Replace `UseMvc` or `UseSignalR` with `UseEndpoints`.</span></span>
* <span data-ttu-id="e4d1e-345">Si la aplicación usa escenarios de [CORS](xref:security/cors) , como `[EnableCors]`, realice la llamada a `UseCors` antes de cualquier otro middleware que use CORS (por ejemplo, coloque `UseCors` antes de `UseAuthentication`, `UseAuthorization` y `UseEndpoints`).</span><span class="sxs-lookup"><span data-stu-id="e4d1e-345">If the app uses [CORS](xref:security/cors) scenarios, such as `[EnableCors]`, place the call to `UseCors` before any other middleware that use CORS (for example, place `UseCors` before `UseAuthentication`, `UseAuthorization`, and `UseEndpoints`).</span></span>
* <span data-ttu-id="e4d1e-346">Reemplace `IHostingEnvironment` por `IWebHostEnvironment` y agregue una instrucción @no__t 2 para el espacio de nombres <xref:Microsoft.Extensions.Hosting?displayProperty=fullName>.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-346">Replace `IHostingEnvironment` with `IWebHostEnvironment` and add a `using` statement for the <xref:Microsoft.Extensions.Hosting?displayProperty=fullName> namespace.</span></span>
* <span data-ttu-id="e4d1e-347">Reemplace `IApplicationLifetime` por <xref:Microsoft.Extensions.Hosting.IHostApplicationLifetime> (espacio de nombres @no__t 2).</span><span class="sxs-lookup"><span data-stu-id="e4d1e-347">Replace `IApplicationLifetime` with <xref:Microsoft.Extensions.Hosting.IHostApplicationLifetime> (<xref:Microsoft.Extensions.Hosting?displayProperty=fullName> namespace).</span></span>
* <span data-ttu-id="e4d1e-348">Reemplace `EnvironmentName` por <xref:Microsoft.Extensions.Hosting.Environments> (espacio de nombres @no__t 2).</span><span class="sxs-lookup"><span data-stu-id="e4d1e-348">Replace `EnvironmentName` with <xref:Microsoft.Extensions.Hosting.Environments> (<xref:Microsoft.Extensions.Hosting?displayProperty=fullName> namespace).</span></span>

<span data-ttu-id="e4d1e-349">El código siguiente es un ejemplo de `Startup.Configure` en una aplicación típica de ASP.NET Core 2,2:</span><span class="sxs-lookup"><span data-stu-id="e4d1e-349">The following code is an example of `Startup.Configure` in a typical ASP.NET Core 2.2 app:</span></span>

```csharp
public void Configure(IApplicationBuilder app)
{
    ...

    app.UseStaticFiles();

    app.UseAuthentication();

    app.UseSignalR(hubs =>
    {
        hubs.MapHub<ChatHub>("/chat");
    });

    app.UseMvc(routes =>
    {
        routes.MapRoute("default", "{controller=Home}/{action=Index}/{id?}");
    });
}
```

<span data-ttu-id="e4d1e-350">Después de actualizar el código `Startup.Configure` anterior:</span><span class="sxs-lookup"><span data-stu-id="e4d1e-350">After updating the previous `Startup.Configure` code:</span></span>

```csharp
public void Configure(IApplicationBuilder app)
{
    ...

    app.UseStaticFiles();

    app.UseRouting();

    app.UseCors();

    app.UseAuthentication();
    app.UseAuthorization();

    app.UseEndpoints(endpoints =>
    {
        endpoints.MapHub<ChatHub>("/chat");
        endpoints.MapControllerRoute("default", "{controller=Home}/{action=Index}/{id?}");
    });
}
```

> [!WARNING]
> <span data-ttu-id="e4d1e-351">Para la mayoría de las aplicaciones, las llamadas a `UseAuthentication`, `UseAuthorization` y `UseCors` deben aparecer entre las llamadas a `UseRouting` y `UseEndpoints` para ser efectivas.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-351">For most apps, calls to `UseAuthentication`, `UseAuthorization`, and `UseCors` must appear between the calls to `UseRouting` and `UseEndpoints` to be effective.</span></span>

### <a name="health-checks"></a><span data-ttu-id="e4d1e-352">Comprobaciones de estado</span><span class="sxs-lookup"><span data-stu-id="e4d1e-352">Health Checks</span></span>

<span data-ttu-id="e4d1e-353">Las comprobaciones de estado utilizan el enrutamiento de puntos de conexión con el host genérico.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-353">Health Checks use endpoint routing with the Generic Host.</span></span> <span data-ttu-id="e4d1e-354">En `Startup.Configure`, llame a `MapHealthChecks` en el generador de puntos de conexiones con la dirección URL del punto de conexión o la ruta de acceso relativa:</span><span class="sxs-lookup"><span data-stu-id="e4d1e-354">In `Startup.Configure`, call `MapHealthChecks` on the endpoint builder with the endpoint URL or relative path:</span></span>

```csharp
app.UseEndpoints(endpoints =>
{
    endpoints.MapHealthChecks("/health");
});
```

<span data-ttu-id="e4d1e-355">Los puntos de conexión de las comprobaciones de estado pueden:</span><span class="sxs-lookup"><span data-stu-id="e4d1e-355">Health Checks endpoints can:</span></span>

* <span data-ttu-id="e4d1e-356">Especificar uno o más hosts o puertos permitidos.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-356">Specify one or more permitted hosts/ports.</span></span>
* <span data-ttu-id="e4d1e-357">Requerir autorización.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-357">Require authorization.</span></span>
* <span data-ttu-id="e4d1e-358">Requerir CORS.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-358">Require CORS.</span></span>

<span data-ttu-id="e4d1e-359">Para obtener más información, consulta <xref:host-and-deploy/health-checks>.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-359">For more information, see <xref:host-and-deploy/health-checks>.</span></span>

### <a name="security-middleware-guidance"></a><span data-ttu-id="e4d1e-360">Guía de middleware de seguridad</span><span class="sxs-lookup"><span data-stu-id="e4d1e-360">Security middleware guidance</span></span>

<span data-ttu-id="e4d1e-361">La compatibilidad con la autorización y CORS está unificada en torno al enfoque de [middleware](xref:fundamentals/middleware/index) .</span><span class="sxs-lookup"><span data-stu-id="e4d1e-361">Support for authorization and CORS is unified around the [middleware](xref:fundamentals/middleware/index) approach.</span></span> <span data-ttu-id="e4d1e-362">Esto permite el uso del mismo middleware y la misma funcionalidad en estos escenarios.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-362">This allows use of the same middleware and functionality across these scenarios.</span></span> <span data-ttu-id="e4d1e-363">En esta versión se proporciona un middleware de autorización actualizado, y el middleware CORS se ha mejorado para que pueda comprender los atributos usados por los controladores MVC.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-363">An updated authorization middleware is provided in this release, and CORS Middleware is enhanced so that it can understand the attributes used by MVC controllers.</span></span>

#### <a name="cors"></a><span data-ttu-id="e4d1e-364">CORS</span><span class="sxs-lookup"><span data-stu-id="e4d1e-364">CORS</span></span>

<span data-ttu-id="e4d1e-365">Anteriormente, CORS podía ser difícil de configurar.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-365">Previously, CORS could be difficult to configure.</span></span> <span data-ttu-id="e4d1e-366">El middleware se proporcionó para su uso en algunos casos de uso, pero los filtros de MVC debían usarse **sin** el middleware en otros casos de uso.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-366">Middleware was provided for use in some use cases, but MVC filters were intended to be used **without** the middleware in other use cases.</span></span> <span data-ttu-id="e4d1e-367">Con ASP.NET Core 3,0, se recomienda que todas las aplicaciones que requieren CORS usen el middleware de CORS en tándem con el enrutamiento de puntos de conexión.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-367">With ASP.NET Core 3.0, we recommend that all apps that require CORS use the CORS Middleware in tandem with Endpoint Routing.</span></span> <span data-ttu-id="e4d1e-368">se puede proporcionar `UseCors` con una directiva predeterminada y se pueden usar los atributos `[EnableCors]` y `[DisableCors]` para invalidar la directiva predeterminada cuando sea necesario.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-368">`UseCors` can be provided with a default policy, and `[EnableCors]` and `[DisableCors]` attributes can be used to override the default policy where required.</span></span>

<span data-ttu-id="e4d1e-369">En el ejemplo siguiente:</span><span class="sxs-lookup"><span data-stu-id="e4d1e-369">In the following example:</span></span>

* <span data-ttu-id="e4d1e-370">CORS está habilitado para todos los puntos de conexión con la Directiva con nombre `default`.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-370">CORS is enabled for all endpoints with the `default` named policy.</span></span>
* <span data-ttu-id="e4d1e-371">La clase `MyController` deshabilita CORS con el atributo `[DisableCors]`.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-371">The `MyController` class disables CORS with the `[DisableCors]` attribute.</span></span>

```csharp
public void Configure(IApplicationBuilder app)
{
    ...

    app.UseRouting();

    app.UseCors("default");

    app.UseEndpoints(endpoints =>
    {
        endpoints.MapDefaultControllerRoute();
    });
}

[DisableCors]
public class MyController : ControllerBase
{
    ...
}
```

#### <a name="authorization"></a><span data-ttu-id="e4d1e-372">Autorización</span><span class="sxs-lookup"><span data-stu-id="e4d1e-372">Authorization</span></span>

<span data-ttu-id="e4d1e-373">En versiones anteriores de ASP.NET Core, se proporcionaba compatibilidad con la autorización mediante el atributo `[Authorize]`.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-373">In earlier versions of ASP.NET Core, authorization support was provided via the `[Authorize]` attribute.</span></span> <span data-ttu-id="e4d1e-374">El middleware de autorización no estaba disponible.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-374">Authorization middleware wasn't available.</span></span> <span data-ttu-id="e4d1e-375">En ASP.NET Core 3,0, se requiere middleware de autorización.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-375">In ASP.NET Core 3.0, authorization middleware is required.</span></span> <span data-ttu-id="e4d1e-376">Se recomienda colocar el middleware de autorización de ASP.NET Core (`UseAuthorization`) inmediatamente después de `UseAuthentication`.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-376">We recommend placing the ASP.NET Core Authorization Middleware (`UseAuthorization`) immediately after `UseAuthentication`.</span></span> <span data-ttu-id="e4d1e-377">El middleware de autorización también puede configurarse con una directiva predeterminada, que se puede invalidar.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-377">The Authorization Middleware can also be configured with a default policy, which can be overridden.</span></span>

<span data-ttu-id="e4d1e-378">En ASP.NET Core 3,0 o posterior, se llama a `UseAuthorization` en `Startup.Configure` y el @no__t 2 de la siguiente requiere un usuario con sesión iniciada:</span><span class="sxs-lookup"><span data-stu-id="e4d1e-378">In ASP.NET Core 3.0 or later, `UseAuthorization` is called in `Startup.Configure`, and the following `HomeController` requires a signed in user:</span></span>

```csharp
public void Configure(IApplicationBuilder app)
{
    ...

    app.UseRouting();

    app.UseAuthentication();
    app.UseAuthorization();

    app.UseEndpoints(endpoints =>
    {
        endpoints.MapDefaultControllerRoute();
    });
}

public class HomeController : ControllerBase
{
    [Authorize]
    public IActionResult BuyWidgets()
    {
        ...
    }
}
```

<span data-ttu-id="e4d1e-379">Si la aplicación usa un `AuthorizeFilter` como filtro global en MVC, se recomienda refactorizar el código para proporcionar una directiva en la llamada a `AddAuthorization`.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-379">If the app uses an `AuthorizeFilter` as a global filter in MVC, we recommend refactoring the code to provide a policy in the call to `AddAuthorization`.</span></span>

<span data-ttu-id="e4d1e-380">El `DefaultPolicy` se configura inicialmente para requerir autenticación, por lo que no se requiere ninguna configuración adicional.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-380">The `DefaultPolicy` is initially configured to require authentication, so no additional configuration is required.</span></span> <span data-ttu-id="e4d1e-381">En el ejemplo siguiente, los puntos de conexión de MVC se marcan como `RequireAuthorization` para que todas las solicitudes se deben autorizar en función de `DefaultPolicy`.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-381">In the following example, MVC endpoints are marked as `RequireAuthorization` so that all requests must be authorized based on the `DefaultPolicy`.</span></span> <span data-ttu-id="e4d1e-382">Sin embargo, el `HomeController` permite el acceso sin que el usuario inicie sesión en la aplicación debido a `[AllowAnonymous]`:</span><span class="sxs-lookup"><span data-stu-id="e4d1e-382">However, the `HomeController` allows access without the user signing into the app due to `[AllowAnonymous]`:</span></span>

```csharp
public void Configure(IApplicationBuilder app)
{
    ...

    app.UseRouting();

    app.UseAuthentication();
    app.UseAuthorization();

    app.UseEndpoints(endpoints =>
    {
        endpoints.MapDefaultControllerRoute().RequireAuthorization();
    });
}

[AllowAnonymous]
public class HomeController : ControllerBase
{
    ...
}
```

<span data-ttu-id="e4d1e-383">También se pueden personalizar las directivas.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-383">Policies can also be customized.</span></span> <span data-ttu-id="e4d1e-384">Basándose en el ejemplo anterior, el `DefaultPolicy` está configurado para requerir autenticación y un ámbito específico:</span><span class="sxs-lookup"><span data-stu-id="e4d1e-384">Building upon the previous example, the `DefaultPolicy` is configured to require authentication and a specific scope:</span></span>

```csharp
public void ConfigureServices(IServiceCollection services)
{
    ...

    services.AddAuthorization(options =>
    {
        options.DefaultPolicy = new AuthorizationPolicyBuilder()
          .RequireAuthenticatedUser()
          .Build();
    });
}

public void Configure(IApplicationBuilder app)
{
    ...

    app.UseRouting();

    app.UseAuthentication();
    app.UseAuthorization();

    app.UseEndpoints(endpoints =>
    {
        endpoints.MapDefaultControllerRoute().RequireAuthorization();
    });
}

[AllowAnonymous]
public class HomeController : ControllerBase
{
    ...
}
```

<span data-ttu-id="e4d1e-385">Como alternativa, se pueden configurar todos los puntos de conexión para requerir la autorización sin `[Authorize]` o `RequireAuthorization` mediante la configuración de un `FallbackPolicy`.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-385">Alternatively, all endpoints can be configured to require authorization without `[Authorize]` or `RequireAuthorization` by configuring a `FallbackPolicy`.</span></span> <span data-ttu-id="e4d1e-386">El `FallbackPolicy` es diferente del `DefaultPolicy`.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-386">The `FallbackPolicy` is different from the `DefaultPolicy`.</span></span> <span data-ttu-id="e4d1e-387">El `DefaultPolicy` se desencadena con `[Authorize]` o `RequireAuthorization`, mientras que el `FallbackPolicy` se desencadena cuando no se establece ninguna otra directiva.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-387">The `DefaultPolicy` is triggered by `[Authorize]` or `RequireAuthorization`, while the `FallbackPolicy` is triggered when no other policy is set.</span></span> <span data-ttu-id="e4d1e-388">`FallbackPolicy` se configura inicialmente para permitir solicitudes sin autorización.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-388">`FallbackPolicy` is initially configured to allow requests without authorization.</span></span>

<span data-ttu-id="e4d1e-389">El ejemplo siguiente es el mismo que el anterior `DefaultPolicy`, pero usa el `FallbackPolicy` para requerir siempre la autenticación en todos los extremos excepto cuando se especifica `[AllowAnonymous]`:</span><span class="sxs-lookup"><span data-stu-id="e4d1e-389">The following example is the same as the preceding `DefaultPolicy` example but uses the `FallbackPolicy` to always require authentication on all endpoints except when `[AllowAnonymous]` is specified:</span></span>

```csharp
public void ConfigureServices(IServiceCollection services)
{
    ...

    services.AddAuthorization(options =>
    {
        options.FallbackPolicy = new AuthorizationPolicyBuilder()
          .RequireAuthenticatedUser()
          .Build();
    });
}

public void Configure(IApplicationBuilder app)
{
    ...

    app.UseRouting();

    app.UseAuthentication();
    app.UseAuthorization();

    app.UseEndpoints(endpoints =>
    {
        endpoints.MapDefaultControllerRoute();
    });
}

[AllowAnonymous]
public class HomeController : ControllerBase
{
    ...
}
```

<span data-ttu-id="e4d1e-390">La autorización por middleware funciona sin el marco de trabajo que tiene un conocimiento específico de la autorización.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-390">Authorization by middleware works without the framework having any specific knowledge of authorization.</span></span> <span data-ttu-id="e4d1e-391">Por ejemplo, las [comprobaciones de estado](xref:host-and-deploy/health-checks) no tienen ningún conocimiento específico de la autorización, pero las comprobaciones de estado pueden tener una directiva de autorización configurable aplicada por el middleware.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-391">For instance, [health checks](xref:host-and-deploy/health-checks) has no specific knowledge of authorization, but health checks can have a configurable authorization policy applied by the middleware.</span></span>

<span data-ttu-id="e4d1e-392">Además, cada punto de conexión puede personalizar sus requisitos de autorización.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-392">Additionally, each endpoint can customize its authorization requirements.</span></span> <span data-ttu-id="e4d1e-393">En el ejemplo siguiente, `UseAuthorization` procesa la autorización con el `DefaultPolicy`, pero el extremo de la comprobación de estado `/healthz` requiere un usuario `admin`:</span><span class="sxs-lookup"><span data-stu-id="e4d1e-393">In the following example, `UseAuthorization` processes authorization with the `DefaultPolicy`, but the `/healthz` health check endpoint requires an `admin` user:</span></span>

```csharp
public void Configure(IApplicationBuilder app)
{
    ...

    app.UseRouting();

    app.UseAuthentication();
    app.UseAuthorization();

    app.UseEndpoints(endpoints =>
    {
        endpoints
            .MapHealthChecks("/healthz")
            .RequireAuthorization(new AuthorizeAttribute(){ Roles = "admin", });
    });
}
```

<span data-ttu-id="e4d1e-394">La protección se implementa en algunos escenarios.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-394">Protection is implemented for some scenarios.</span></span> <span data-ttu-id="e4d1e-395">El middleware de extremos inicia una excepción si se omite una directiva de autorización o CORS debido a que falta un middleware.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-395">Endpoints Middleware throws an exception if an authorization or CORS policy is skipped due to missing middleware.</span></span> <span data-ttu-id="e4d1e-396">La compatibilidad con el analizador para proporcionar información adicional sobre la configuración inestable está en curso.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-396">Analyzer support to provide additional feedback about misconfiguration is in progress.</span></span>

### <a name="signalr"></a><span data-ttu-id="e4d1e-397">SignalR</span><span class="sxs-lookup"><span data-stu-id="e4d1e-397">SignalR</span></span>

<span data-ttu-id="e4d1e-398">La asignación de los concentradores de Signalr ahora tiene lugar dentro de `UseEndpoints`.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-398">Mapping of SignalR hubs now takes place inside `UseEndpoints`.</span></span>

<span data-ttu-id="e4d1e-399">Asigne cada concentrador con `MapHub`.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-399">Map each hub with `MapHub`.</span></span> <span data-ttu-id="e4d1e-400">Como en versiones anteriores, cada concentrador aparece explícitamente en la lista.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-400">As in previous versions, each hub is explicitly listed.</span></span>

<span data-ttu-id="e4d1e-401">En el ejemplo siguiente, se agrega compatibilidad con el concentrador de Signalr `ChatHub`:</span><span class="sxs-lookup"><span data-stu-id="e4d1e-401">In the following example, support for the `ChatHub` SignalR hub is added:</span></span>

```csharp
public void Configure(IApplicationBuilder app)
{
    ...

    app.UseRouting();

    app.UseEndpoints(endpoints =>
    {
        endpoints.MapHub<ChatHub>();
    });
}
```

<span data-ttu-id="e4d1e-402">Existe una nueva opción para controlar los límites de tamaño de los mensajes de los clientes.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-402">There is a new option for controlling message size limits from clients.</span></span> <span data-ttu-id="e4d1e-403">Por ejemplo, en `Startup.ConfigureServices`:</span><span class="sxs-lookup"><span data-stu-id="e4d1e-403">For example, in `Startup.ConfigureServices`:</span></span>

```csharp
services.AddSignalR(hubOptions =>
{
    hubOptions.MaximumReceiveMessageSize = 32768;
});
```

<span data-ttu-id="e4d1e-404">En ASP.NET Core 2,2, podría establecer el `TransportMaxBufferSize` y que controlaría de forma eficaz el tamaño máximo de los mensajes.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-404">In ASP.NET Core 2.2, you could set the `TransportMaxBufferSize` and that would effectively control the maximum message size.</span></span> <span data-ttu-id="e4d1e-405">En ASP.NET Core 3,0, esa opción ahora solo controla el tamaño máximo antes de que se observe la presión.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-405">In ASP.NET Core 3.0, that option now only controls the maximum size before backpressure is observed.</span></span>

### <a name="mvc-controllers"></a><span data-ttu-id="e4d1e-406">Controladores MVC</span><span class="sxs-lookup"><span data-stu-id="e4d1e-406">MVC controllers</span></span>

<span data-ttu-id="e4d1e-407">La asignación de controladores ahora tiene lugar dentro de `UseEndpoints`.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-407">Mapping of controllers now takes place inside `UseEndpoints`.</span></span>

<span data-ttu-id="e4d1e-408">Agregue `MapControllers` si la aplicación usa el enrutamiento de atributos.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-408">Add `MapControllers` if the app uses attribute routing.</span></span> <span data-ttu-id="e4d1e-409">Dado que el enrutamiento incluye compatibilidad con muchos marcos en ASP.NET Core 3,0 o posterior, la adición de controladores de enrutamiento de atributos es participación.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-409">Since routing includes support for many frameworks in ASP.NET Core 3.0 or later, adding attribute-routed controllers is opt-in.</span></span>

<span data-ttu-id="e4d1e-410">Reemplace lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="e4d1e-410">Replace the following:</span></span>

* <span data-ttu-id="e4d1e-411">`MapRoute` con `MapControllerRoute`</span><span class="sxs-lookup"><span data-stu-id="e4d1e-411">`MapRoute` with `MapControllerRoute`</span></span>
* <span data-ttu-id="e4d1e-412">`MapAreaRoute` con `MapAreaControllerRoute`</span><span class="sxs-lookup"><span data-stu-id="e4d1e-412">`MapAreaRoute` with `MapAreaControllerRoute`</span></span>

<span data-ttu-id="e4d1e-413">Puesto que el enrutamiento ahora incluye compatibilidad con algo más que MVC, la terminología ha cambiado para que estos métodos indiquen claramente lo que hacen.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-413">Since routing now includes support for more than just MVC, the terminology has changed to make these methods clearly state what they do.</span></span> <span data-ttu-id="e4d1e-414">Las rutas convencionales como `MapControllerRoute` @ no__t-1 @ no__t-2 @ no__t-3 @ no__t-4 se aplican en el orden en que se agregan.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-414">Conventional routes such as `MapControllerRoute`/`MapAreaControllerRoute`/`MapDefaultControllerRoute` are applied in the order that they're added.</span></span> <span data-ttu-id="e4d1e-415">Coloque primero rutas más específicas (por ejemplo, las rutas de un área).</span><span class="sxs-lookup"><span data-stu-id="e4d1e-415">Place more specific routes (such as routes for an area) first.</span></span>

<span data-ttu-id="e4d1e-416">En el ejemplo siguiente:</span><span class="sxs-lookup"><span data-stu-id="e4d1e-416">In the following example:</span></span>

* <span data-ttu-id="e4d1e-417">`MapControllers` agrega compatibilidad con los controladores de enrutamiento de atributos.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-417">`MapControllers` adds support for attribute-routed controllers.</span></span>
* <span data-ttu-id="e4d1e-418">`MapAreaControllerRoute` agrega una ruta convencional para los controladores de un área.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-418">`MapAreaControllerRoute` adds a conventional route for controllers in an area.</span></span>
* <span data-ttu-id="e4d1e-419">`MapControllerRoute` agrega una ruta convencional para los controladores.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-419">`MapControllerRoute` adds a conventional route for controllers.</span></span>

```csharp
public void Configure(IApplicationBuilder app)
{
    ...

    app.UseRouting();

    app.UseEndpoints(endpoints =>
    {
        endpoints.MapControllers();
        endpoints.MapAreaControllerRoute(
            "admin",
            "admin",
            "Admin/{controller=Home}/{action=Index}/{id?}");
        endpoints.MapControllerRoute(
            "default", "{controller=Home}/{action=Index}/{id?}");
    });
}
```

#### <a name="async-suffix-removal-from-controller-action-names"></a><span data-ttu-id="e4d1e-420">Eliminación de sufijo asincrónico de los nombres de acción del controlador</span><span class="sxs-lookup"><span data-stu-id="e4d1e-420">Async suffix removal from controller action names</span></span>

<span data-ttu-id="e4d1e-421">En ASP.NET Core 3,0, ASP.NET Core MVC quita el sufijo `Async` de los nombres de acción del controlador.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-421">In ASP.NET Core 3.0, ASP.NET Core MVC removes the `Async` suffix from controller action names.</span></span> <span data-ttu-id="e4d1e-422">El enrutamiento y la generación de vínculos se ven afectados por este nuevo valor predeterminado.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-422">Both routing and link generation are impacted by this new default.</span></span> <span data-ttu-id="e4d1e-423">Por ejemplo:</span><span class="sxs-lookup"><span data-stu-id="e4d1e-423">For example:</span></span>

```csharp
public class ProductsController : Controller
{
    public async Task<IActionResult> ListAsync()
    {
        var model = await _dbContext.Products.ToListAsync();
        return View(model);
    }
}
```

<span data-ttu-id="e4d1e-424">Antes de ASP.NET Core 3,0:</span><span class="sxs-lookup"><span data-stu-id="e4d1e-424">Prior to ASP.NET Core 3.0:</span></span>

* <span data-ttu-id="e4d1e-425">Se puede tener acceso a la acción anterior en la ruta *Products/ListAsync* .</span><span class="sxs-lookup"><span data-stu-id="e4d1e-425">The preceding action could be accessed at the *Products/ListAsync* route.</span></span>
* <span data-ttu-id="e4d1e-426">Generación de vínculos necesaria especificando el sufijo `Async`.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-426">Link generation required specifying the `Async` suffix.</span></span> <span data-ttu-id="e4d1e-427">Por ejemplo:</span><span class="sxs-lookup"><span data-stu-id="e4d1e-427">For example:</span></span>

    ```cshtml
    <a asp-controller="Products" asp-action="ListAsync">List</a>
    ```

<span data-ttu-id="e4d1e-428">En ASP.NET Core 3,0:</span><span class="sxs-lookup"><span data-stu-id="e4d1e-428">In ASP.NET Core 3.0:</span></span>

* <span data-ttu-id="e4d1e-429">Se puede tener acceso a la acción anterior en la ruta *Products/List* .</span><span class="sxs-lookup"><span data-stu-id="e4d1e-429">The preceding action can be accessed at the *Products/List* route.</span></span>
* <span data-ttu-id="e4d1e-430">La generación de vínculos no requiere especificar el sufijo `Async`.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-430">Link generation doesn't require specifying the `Async` suffix.</span></span> <span data-ttu-id="e4d1e-431">Por ejemplo:</span><span class="sxs-lookup"><span data-stu-id="e4d1e-431">For example:</span></span>

    ```cshtml
    <a asp-controller="Products" asp-action="List">List</a>
    ```

<span data-ttu-id="e4d1e-432">Este cambio no afecta a los nombres especificados mediante el atributo [[ActionName]](/dotnet/api/microsoft.aspnetcore.mvc.actionnameattribute) .</span><span class="sxs-lookup"><span data-stu-id="e4d1e-432">This change doesn't affect names specified using the [[ActionName]](/dotnet/api/microsoft.aspnetcore.mvc.actionnameattribute) attribute.</span></span> <span data-ttu-id="e4d1e-433">El comportamiento predeterminado se puede deshabilitar con el código siguiente en `Startup.ConfigureServices`:</span><span class="sxs-lookup"><span data-stu-id="e4d1e-433">The default behavior can be disabled with the following code in `Startup.ConfigureServices`:</span></span>

```csharp
services.AddMvc(options =>
    options.SuppressAsyncSuffixInActionNames = false);
```

### <a name="razor-pages"></a><span data-ttu-id="e4d1e-434">Páginas de Razor</span><span class="sxs-lookup"><span data-stu-id="e4d1e-434">Razor Pages</span></span>

<span data-ttu-id="e4d1e-435">La asignación Razor Pages ahora tiene lugar dentro de `UseEndpoints`.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-435">Mapping Razor Pages now takes place inside `UseEndpoints`.</span></span>

<span data-ttu-id="e4d1e-436">Agregue `MapRazorPages` si la aplicación usa Razor Pages.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-436">Add `MapRazorPages` if the app uses Razor Pages.</span></span> <span data-ttu-id="e4d1e-437">Dado que el enrutamiento del punto de conexión incluye compatibilidad con muchos marcos, agregar Razor Pages es ahora opcional.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-437">Since Endpoint Routing includes support for many frameworks, adding Razor Pages is now opt-in.</span></span>

<span data-ttu-id="e4d1e-438">En el siguiente método `Startup.Configure`, `MapRazorPages` agrega compatibilidad con Razor Pages:</span><span class="sxs-lookup"><span data-stu-id="e4d1e-438">In the following `Startup.Configure` method, `MapRazorPages` adds support for Razor Pages:</span></span>

```csharp
public void Configure(IApplicationBuilder app)
{
    ...

    app.UseRouting();

    app.UseEndpoints(endpoints =>
    {
        endpoints.MapRazorPages();
    });
}
```

### <a name="use-mvc-without-endpoint-routing"></a><span data-ttu-id="e4d1e-439">Uso de MVC sin enrutamiento de punto de conexión</span><span class="sxs-lookup"><span data-stu-id="e4d1e-439">Use MVC without Endpoint Routing</span></span>

<span data-ttu-id="e4d1e-440">El uso de MVC a través de `UseMvc` o `UseMvcWithDefaultRoute` en ASP.NET Core 3,0 requiere una participación explícita dentro de `Startup.ConfigureServices`.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-440">Using MVC via `UseMvc` or `UseMvcWithDefaultRoute` in ASP.NET Core 3.0 requires an explicit opt-in inside `Startup.ConfigureServices`.</span></span> <span data-ttu-id="e4d1e-441">Esto es necesario porque MVC debe saber si puede confiar en la autorización y el middleware CORS durante la inicialización.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-441">This is required because MVC must know whether it can rely on the authorization and CORS Middleware during initialization.</span></span> <span data-ttu-id="e4d1e-442">Se proporciona un analizador que advierte si la aplicación intenta usar una configuración no admitida.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-442">An analyzer is provided that warns if the app attempts to use an unsupported configuration.</span></span>

<span data-ttu-id="e4d1e-443">Si la aplicación requiere compatibilidad heredada de `IRouter`, deshabilite `EnableEndpointRouting` mediante cualquiera de los enfoques siguientes en `Startup.ConfigureServices`:</span><span class="sxs-lookup"><span data-stu-id="e4d1e-443">If the app requires legacy `IRouter` support, disable `EnableEndpointRouting` using any of the following approaches in `Startup.ConfigureServices`:</span></span>

```csharp
services.AddMvc(options => options.EnableEndpointRouting = false);
```

```csharp
services.AddControllers(options => options.EnableEndpointRouting = false);
```

```csharp
services.AddControllersWithViews(options => options.EnableEndpointRouting = false);
```

```csharp
services.AddRazorPages().AddMvcOptions(options => options.EnableEndpointRouting = false);
```

### <a name="health-checks"></a><span data-ttu-id="e4d1e-444">Comprobaciones de estado</span><span class="sxs-lookup"><span data-stu-id="e4d1e-444">Health checks</span></span>

<span data-ttu-id="e4d1e-445">Las comprobaciones de estado se pueden usar como un *enrutador* con enrutamiento de punto de conexión.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-445">Health checks can be used as a *router-ware* with Endpoint Routing.</span></span>

<span data-ttu-id="e4d1e-446">Agregue `MapHealthChecks` para usar las comprobaciones de estado con el enrutamiento del punto de conexión.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-446">Add `MapHealthChecks` to use health checks with Endpoint Routing.</span></span> <span data-ttu-id="e4d1e-447">El método `MapHealthChecks` acepta argumentos similares a `UseHealthChecks`.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-447">The `MapHealthChecks` method accepts arguments similar to `UseHealthChecks`.</span></span> <span data-ttu-id="e4d1e-448">La ventaja de usar `MapHealthChecks` sobre `UseHealthChecks` es la capacidad de aplicar la autorización y tener un control más preciso sobre la Directiva de coincidencia.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-448">The advantage of using `MapHealthChecks` over `UseHealthChecks` is the ability to apply authorization and to have greater fine-grained control over the matching policy.</span></span>

<span data-ttu-id="e4d1e-449">En el ejemplo siguiente, se llama a `MapHealthChecks` para un extremo de comprobación de estado en `/healthz`:</span><span class="sxs-lookup"><span data-stu-id="e4d1e-449">In the following example, `MapHealthChecks` is called for a health check endpoint at `/healthz`:</span></span>

```csharp
public void Configure(IApplicationBuilder app)
{
    ...

    app.UseRouting();

    app.UseEndpoints(endpoints =>
    {
        endpoints.MapHealthChecks("/healthz", new HealthCheckOptions() { });
    });
}
```

## <a name="hostbuilder-replaces-webhostbuilder"></a><span data-ttu-id="e4d1e-450">HostBuilder reemplaza a WebHostBuilder</span><span class="sxs-lookup"><span data-stu-id="e4d1e-450">HostBuilder replaces WebHostBuilder</span></span>

<span data-ttu-id="e4d1e-451">Las plantillas ASP.NET Core 3,0 usan el [host genérico](xref:fundamentals/host/generic-host).</span><span class="sxs-lookup"><span data-stu-id="e4d1e-451">The ASP.NET Core 3.0 templates use [Generic Host](xref:fundamentals/host/generic-host).</span></span> <span data-ttu-id="e4d1e-452">Las versiones anteriores usaban el [host web](xref:fundamentals/host/web-host).</span><span class="sxs-lookup"><span data-stu-id="e4d1e-452">Previous versions used [Web Host](xref:fundamentals/host/web-host).</span></span> <span data-ttu-id="e4d1e-453">En el código siguiente se muestra la plantilla ASP.NET Core 3,0 generada `Program`:</span><span class="sxs-lookup"><span data-stu-id="e4d1e-453">The following code shows the ASP.NET Core 3.0 template generated `Program` class:</span></span>

[!code-csharp[](22-to-30/samples/Program.cs?name=snippet)]

<span data-ttu-id="e4d1e-454">En el código siguiente se muestra la clase ASP.NET Core 2,2 `Program` generada por la plantilla:</span><span class="sxs-lookup"><span data-stu-id="e4d1e-454">The following code shows the ASP.NET Core 2.2 template-generated `Program` class:</span></span>

[!code-csharp[](22-to-30/samples/Program2.2.cs?name=snippet)]

<span data-ttu-id="e4d1e-455"><xref:Microsoft.AspNetCore.Hosting.IWebHostBuilder> permanece en 3,0 y es el tipo del `webBuilder` que se muestra en el ejemplo de código anterior.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-455"><xref:Microsoft.AspNetCore.Hosting.IWebHostBuilder> remains in 3.0 and is the type of the `webBuilder` seen in the preceding code sample.</span></span> <span data-ttu-id="e4d1e-456"><xref:Microsoft.AspNetCore.Hosting.WebHostBuilder> quedará en desuso en una versión futura y se reemplazará por `HostBuilder`.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-456"><xref:Microsoft.AspNetCore.Hosting.WebHostBuilder> will be deprecated in a future release and replaced by `HostBuilder`.</span></span>

<span data-ttu-id="e4d1e-457">El cambio más significativo de `WebHostBuilder` a `HostBuilder` está en la [inserción de dependencias (di)](xref:fundamentals/dependency-injection).</span><span class="sxs-lookup"><span data-stu-id="e4d1e-457">The most significant change from `WebHostBuilder` to `HostBuilder` is in [dependency injection (DI)](xref:fundamentals/dependency-injection).</span></span> <span data-ttu-id="e4d1e-458">Cuando se usa `HostBuilder`, solo se pueden insertar <xref:Microsoft.Extensions.Configuration.IConfiguration> y <xref:Microsoft.AspNetCore.Hosting.IHostingEnvironment> en el constructor de `Startup`.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-458">When using `HostBuilder`, you can only inject <xref:Microsoft.Extensions.Configuration.IConfiguration> and <xref:Microsoft.AspNetCore.Hosting.IHostingEnvironment> into `Startup`'s constructor.</span></span> <span data-ttu-id="e4d1e-459">Las restricciones `HostBuilder` DI:</span><span class="sxs-lookup"><span data-stu-id="e4d1e-459">The `HostBuilder` DI constraints:</span></span>

* <span data-ttu-id="e4d1e-460">Habilite el contenedor de DI para que se compile solo una vez.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-460">Enable the DI container to be built only one time.</span></span>
* <span data-ttu-id="e4d1e-461">Evita los problemas de duración de los objetos resultantes como resolver varias instancias de singleton.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-461">Avoids the resulting object lifetime issues like resolving multiple instances of singletons.</span></span>

## <a name="addauthorization-moved-to-a-different-assembly"></a><span data-ttu-id="e4d1e-462">AddAuthorization se ha cambiado a otro ensamblado</span><span class="sxs-lookup"><span data-stu-id="e4d1e-462">AddAuthorization moved to a different assembly</span></span>

<span data-ttu-id="e4d1e-463">Los métodos ASP.NET Core 2,2 y Lower `AddAuthorization` de *Microsoft. AspNetCore. Authorization. dll*:</span><span class="sxs-lookup"><span data-stu-id="e4d1e-463">The ASP.NET Core 2.2 and lower `AddAuthorization` methods in *Microsoft.AspNetCore.Authorization.dll*:</span></span>

* <span data-ttu-id="e4d1e-464">Se ha cambiado el nombre de `AddAuthorizationCore`.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-464">Have been renamed `AddAuthorizationCore`.</span></span>
* <span data-ttu-id="e4d1e-465">Se han migrado a *Microsoft. AspNetCore. Authorization. Policy. dll*.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-465">Have been moved to *Microsoft.AspNetCore.Authorization.Policy.dll*.</span></span>

<span data-ttu-id="e4d1e-466">Las aplicaciones que usan *Microsoft. AspNetCore. Authorization. dll* y *Microsoft. AspNetCore. Authorization. Policy. dll* no se ven afectadas.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-466">Apps that are using both *Microsoft.AspNetCore.Authorization.dll* and *Microsoft.AspNetCore.Authorization.Policy.dll* aren't impacted.</span></span>

<span data-ttu-id="e4d1e-467">Las aplicaciones que no usan *Microsoft. AspNetCore. Authorization. Policy. dll* deben realizar una de las siguientes acciones:</span><span class="sxs-lookup"><span data-stu-id="e4d1e-467">Apps that are not using *Microsoft.AspNetCore.Authorization.Policy.dll* should do one of the following:</span></span>

* <span data-ttu-id="e4d1e-468">Cambiar a mediante `AddAuthorizationCore`</span><span class="sxs-lookup"><span data-stu-id="e4d1e-468">Switch to using `AddAuthorizationCore`</span></span>
* <span data-ttu-id="e4d1e-469">Agregue una referencia a *Microsoft. AspNetCore. Authorization. Policy. dll*.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-469">Add a reference to *Microsoft.AspNetCore.Authorization.Policy.dll*.</span></span>

<span data-ttu-id="e4d1e-470">Para obtener más información, vea la [sobrecarga de cambios importantes en `AddAuthorization(o =>`) en un ensamblado diferente #386](https://github.com/aspnet/Announcements/issues/386).</span><span class="sxs-lookup"><span data-stu-id="e4d1e-470">For more information, see [Breaking change in `AddAuthorization(o =>`) overload lives in a different assembly #386](https://github.com/aspnet/Announcements/issues/386).</span></span>

## <a name="signalr"></a><span data-ttu-id="e4d1e-471">SignalR</span><span class="sxs-lookup"><span data-stu-id="e4d1e-471">SignalR</span></span>

<span data-ttu-id="e4d1e-472">El cliente de Signalr JavaScript ha cambiado de `@aspnet/signalr` a `@microsoft/signalr`.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-472">The SignalR JavaScript client has changed from `@aspnet/signalr` to `@microsoft/signalr`.</span></span> <span data-ttu-id="e4d1e-473">Para reaccionar a este cambio, cambie las referencias en los archivos *Package. JSON* , las instrucciones `require` y las instrucciones ECMAScript `import`.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-473">To react to this change, change the references in *package.json* files, `require` statements, and ECMAScript `import` statements.</span></span>

### <a name="systemtextjson-is-the-default-protocol"></a><span data-ttu-id="e4d1e-474">System. Text. JSON es el protocolo predeterminado</span><span class="sxs-lookup"><span data-stu-id="e4d1e-474">System.Text.Json is the default protocol</span></span>

<span data-ttu-id="e4d1e-475">`System.Text.Json` es ahora el protocolo de concentrador predeterminado utilizado por el cliente y el servidor.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-475">`System.Text.Json` is now the default Hub protocol used by both the client and server.</span></span>

<span data-ttu-id="e4d1e-476">En `Startup.ConfigureServices`, llame a `AddJsonProtocol` para establecer las opciones del serializador.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-476">In `Startup.ConfigureServices`, call `AddJsonProtocol` to set serializer options.</span></span>

<span data-ttu-id="e4d1e-477">**Servidor**</span><span class="sxs-lookup"><span data-stu-id="e4d1e-477">**Server:**</span></span>

```csharp
services.AddSignalR(...)
        .AddJsonProtocol(options =>
        {
            options.WriteIndented = false;
        })
```

<span data-ttu-id="e4d1e-478">**Nº**</span><span class="sxs-lookup"><span data-stu-id="e4d1e-478">**Client:**</span></span>

```csharp
new HubConnectionBuilder()
    .WithUrl("/chatHub")
    .AddJsonProtocol(options =>
    {
        options.WriteIndented = false;
    })
    .Build();
```

### <a name="switch-to-newtonsoftjson"></a><span data-ttu-id="e4d1e-479">Cambiar a Newtonsoft. JSON</span><span class="sxs-lookup"><span data-stu-id="e4d1e-479">Switch to Newtonsoft.Json</span></span>

<span data-ttu-id="e4d1e-480">Si usa las características de `Newtonsoft.Json` que no se admiten en `System.Text.Json`, puede volver a `Newtonsoft.Json`:</span><span class="sxs-lookup"><span data-stu-id="e4d1e-480">If you're using features of `Newtonsoft.Json` that aren't supported in `System.Text.Json`, you can switch back to `Newtonsoft.Json`:</span></span>

1. <span data-ttu-id="e4d1e-481">Instale el paquete NuGet [Microsoft. AspNetCore. signalr. Protocols. NewtonsoftJson](https://www.nuget.org/packages/Microsoft.AspNetCore.SignalR.Protocols.NewtonsoftJson) .</span><span class="sxs-lookup"><span data-stu-id="e4d1e-481">Install the [Microsoft.AspNetCore.SignalR.Protocols.NewtonsoftJson](https://www.nuget.org/packages/Microsoft.AspNetCore.SignalR.Protocols.NewtonsoftJson) NuGet package.</span></span>
1. <span data-ttu-id="e4d1e-482">En el cliente, encadenar una llamada al método `AddNewtonsoftJsonProtocol` a la instancia de `HubConnectionBuilder`:</span><span class="sxs-lookup"><span data-stu-id="e4d1e-482">On the client, chain an `AddNewtonsoftJsonProtocol` method call to the `HubConnectionBuilder` instance:</span></span>

    ```csharp
    new HubConnectionBuilder()
        .WithUrl("/chatHub")
        .AddNewtonsoftJsonProtocol(...)
        .Build();
    ```

1. <span data-ttu-id="e4d1e-483">En el servidor, encadenar una llamada al método `AddNewtonsoftJsonProtocol` a la llamada al método `AddSignalR` en `Startup.ConfigureServices`:</span><span class="sxs-lookup"><span data-stu-id="e4d1e-483">On the server, chain an `AddNewtonsoftJsonProtocol` method call to the `AddSignalR` method call in `Startup.ConfigureServices`:</span></span>

    ```csharp
    services.AddSignalR()
        .AddNewtonsoftJsonProtocol(...);
    ```

## <a name="opt-in-to-runtime-compilation"></a><span data-ttu-id="e4d1e-484">Participar en la compilación en tiempo de ejecución</span><span class="sxs-lookup"><span data-stu-id="e4d1e-484">Opt in to runtime compilation</span></span>

<span data-ttu-id="e4d1e-485">Antes de ASP.NET Core 3,0, la compilación de vistas en tiempo de ejecución era una característica implícita del marco.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-485">Prior to ASP.NET Core 3.0, runtime compilation of views was an implicit feature of the framework.</span></span> <span data-ttu-id="e4d1e-486">La compilación en tiempo de ejecución complementa la compilación en tiempo de compilación de las vistas.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-486">Runtime compilation supplements build-time compilation of views.</span></span> <span data-ttu-id="e4d1e-487">Permite al marco de trabajo compilar vistas y páginas de Razor (archivos *. cshtml* ) cuando se modifican los archivos, sin tener que volver a generar toda la aplicación.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-487">It allows the framework to compile Razor views and pages (*.cshtml* files) when the files are modified, without having to rebuild the entire app.</span></span> <span data-ttu-id="e4d1e-488">Esta característica admite el escenario de realizar una edición rápida en el IDE y actualizar el explorador para ver los cambios.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-488">This feature supports the scenario of making a quick edit in the IDE and refreshing the browser to view the changes.</span></span>

<span data-ttu-id="e4d1e-489">En ASP.NET Core 3,0, la compilación en tiempo de ejecución es un escenario de participación.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-489">In ASP.NET Core 3.0, runtime compilation is an opt-in scenario.</span></span> <span data-ttu-id="e4d1e-490">La compilación en tiempo de compilación es el único mecanismo para la compilación de vistas que está habilitada de forma predeterminada.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-490">Build-time compilation is the only mechanism for view compilation that's enabled by default.</span></span> <span data-ttu-id="e4d1e-491">El Runtime se basa en Visual Studio o [dotnet-Watch](xref:tutorials/dotnet-watch) en Visual Studio Code para recompilar el proyecto cuando detecta cambios en los archivos *. cshtml* .</span><span class="sxs-lookup"><span data-stu-id="e4d1e-491">The runtime relies on Visual Studio or [dotnet-watch](xref:tutorials/dotnet-watch) in Visual Studio Code to rebuild the project when it detects changes to *.cshtml* files.</span></span> <span data-ttu-id="e4d1e-492">En Visual Studio, los cambios en los archivos *. CS*, *. cshtml*o *. Razor* del proyecto que se ejecuta (<kbd>Ctrl + F5</kbd>), pero no se depuran (<kbd>F5</kbd>), desencadenan la recompilación del proyecto.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-492">In Visual Studio, changes to *.cs*, *.cshtml*, or *.razor* files in the project being run (<kbd>Ctrl+F5</kbd>), but not debugged (<kbd>F5</kbd>), trigger recompilation of the project.</span></span>

<span data-ttu-id="e4d1e-493">Para habilitar la compilación en tiempo de ejecución en el proyecto ASP.NET Core 3,0:</span><span class="sxs-lookup"><span data-stu-id="e4d1e-493">To enable runtime compilation in your ASP.NET Core 3.0 project:</span></span>

1. <span data-ttu-id="e4d1e-494">Instalar el paquete NuGet [Microsoft.AspNetCore.Mvc.Razor.RuntimeCompilation](https://www.nuget.org/packages/Microsoft.AspNetCore.Mvc.Razor.RuntimeCompilation).</span><span class="sxs-lookup"><span data-stu-id="e4d1e-494">Install the [Microsoft.AspNetCore.Mvc.Razor.RuntimeCompilation](https://www.nuget.org/packages/Microsoft.AspNetCore.Mvc.Razor.RuntimeCompilation) NuGet package.</span></span>
1. <span data-ttu-id="e4d1e-495">Actualice `Startup.ConfigureServices` para llamar a `AddRazorRuntimeCompilation`:</span><span class="sxs-lookup"><span data-stu-id="e4d1e-495">Update `Startup.ConfigureServices` to call `AddRazorRuntimeCompilation`:</span></span>

    <span data-ttu-id="e4d1e-496">Para ASP.NET Core MVC, use el código siguiente:</span><span class="sxs-lookup"><span data-stu-id="e4d1e-496">For ASP.NET Core MVC, use the following code:</span></span>

    ```csharp
    services.AddControllersWithViews()
        .AddRazorRuntimeCompilation(...);
    ```
 
    <span data-ttu-id="e4d1e-497">Para ASP.NET Core Razor Pages, use el siguiente código:</span><span class="sxs-lookup"><span data-stu-id="e4d1e-497">For ASP.NET Core Razor Pages, use the following code:</span></span>
 
    ```csharp
    services.AddRazorPages()
        .AddRazorRuntimeCompilation(...);
    ```
 
<span data-ttu-id="e4d1e-498">En el ejemplo de https://github.com/aspnet/samples/tree/master/samples/aspnetcore/mvc/runtimecompilation se muestra un ejemplo de cómo habilitar la compilación en tiempo de ejecución condicionalmente en entornos de desarrollo.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-498">The sample at https://github.com/aspnet/samples/tree/master/samples/aspnetcore/mvc/runtimecompilation shows an example of enabling runtime compilation conditionally in Development environments.</span></span>

<span data-ttu-id="e4d1e-499">Para obtener más información sobre la compilación de archivos de Razor, vea <xref:mvc/views/view-compilation>.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-499">For more information on Razor file compilation, see <xref:mvc/views/view-compilation>.</span></span>

## <a name="migrate-libraries-via-multi-targeting"></a><span data-ttu-id="e4d1e-500">Migración de bibliotecas a través de la compatibilidad con múltiples versiones</span><span class="sxs-lookup"><span data-stu-id="e4d1e-500">Migrate libraries via multi-targeting</span></span>

<span data-ttu-id="e4d1e-501">Las bibliotecas suelen necesitar admitir varias versiones de ASP.NET Core.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-501">Libraries often need to support multiple versions of ASP.NET Core.</span></span> <span data-ttu-id="e4d1e-502">La mayoría de las bibliotecas compiladas con versiones anteriores de ASP.NET Core deberían seguir funcionando sin problemas.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-502">Most libraries that were compiled against previous versions of ASP.NET Core should continue working without issues.</span></span> <span data-ttu-id="e4d1e-503">Las condiciones siguientes requieren la compilación cruzada de la aplicación:</span><span class="sxs-lookup"><span data-stu-id="e4d1e-503">The following conditions require the app to be cross-compiled:</span></span>

* <span data-ttu-id="e4d1e-504">La biblioteca se basa en una característica que tiene un [cambio de interrupción](#breaking-api-changes)binario.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-504">The library relies on a feature that has a binary [breaking change](#breaking-api-changes).</span></span>
* <span data-ttu-id="e4d1e-505">La biblioteca desea aprovechar las nuevas características de ASP.NET Core 3,0.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-505">The library wants to take advantage of new features in ASP.NET Core 3.0.</span></span> 

<span data-ttu-id="e4d1e-506">Por ejemplo:</span><span class="sxs-lookup"><span data-stu-id="e4d1e-506">For example:</span></span>

```xml
<Project Sdk="Microsoft.NET.Sdk">
  <PropertyGroup>
    <TargetFrameworks>netcoreapp3.0;netstandard2.0</TargetFrameworks>
  </PropertyGroup>

  <ItemGroup Condition="'$(TargetFramework)' == 'netcoreapp3.0'">
    <FrameworkReference Include="Microsoft.AspNetCore.App" />
  </ItemGroup>

  <ItemGroup Condition="'$(TargetFramework)' == 'netstandard2.0'">
    <PackageReference Include="Microsoft.AspNetCore" Version="2.1.0" />
  </ItemGroup>
</Project>
```

<span data-ttu-id="e4d1e-507">Use `#ifdefs` para habilitar las API específicas de ASP.NET Core 3,0:</span><span class="sxs-lookup"><span data-stu-id="e4d1e-507">Use `#ifdefs` to enable ASP.NET Core 3.0-specific APIs:</span></span>

```csharp
var webRootFileProvider =
#if NETCOREAPP3_0
    GetRequiredService<IWebHostEnvironment>().WebRootFileProvider;
#elif NETSTANDARD2_0
    GetRequiredService<IHostingEnvironment>().WebRootFileProvider;
#else
#error unknown target framework
#endif
```

<a name="break"></a>

## <a name="breaking-api-changes"></a><span data-ttu-id="e4d1e-508">Interrupción de los cambios de API</span><span class="sxs-lookup"><span data-stu-id="e4d1e-508">Breaking API changes</span></span>

<span data-ttu-id="e4d1e-509">Revisar cambios importantes:</span><span class="sxs-lookup"><span data-stu-id="e4d1e-509">Review breaking changes:</span></span>

* [<span data-ttu-id="e4d1e-510">Lista completa de cambios importantes en la versión ASP.NET Core 3,0</span><span class="sxs-lookup"><span data-stu-id="e4d1e-510">Complete list of breaking changes in the ASP.NET Core 3.0 release</span></span>](https://github.com/aspnet/Announcements/issues?page=2&q=is%3Aissue+is%3Aopen+label%3A%22Breaking+change%22+label%3A3.0.0)
* <span data-ttu-id="e4d1e-511">[Interrupción de los cambios de API en antifalsificación, CORS, diagnósticos, MVC y enrutamiento](https://github.com/aspnet/Announcements/issues/387).</span><span class="sxs-lookup"><span data-stu-id="e4d1e-511">[Breaking API changes in Antiforgery, CORS, Diagnostics, MVC, and Routing](https://github.com/aspnet/Announcements/issues/387).</span></span> <span data-ttu-id="e4d1e-512">Esta lista incluye cambios importantes para los modificadores de compatibilidad.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-512">This list includes breaking changes for compatibility switches.</span></span>
* <span data-ttu-id="e4d1e-513">Para obtener un resumen de los cambios importantes de 2,2 a 3,0 en .NET Core, ASP.NET Core y Entity Framework Core, vea [cambios importantes para la migración de la versión 2,2 a la 3,0](/dotnet/core/compatibility/2.2-3.0).</span><span class="sxs-lookup"><span data-stu-id="e4d1e-513">For a summary of 2.2-to-3.0 breaking changes across .NET Core, ASP.NET Core, and Entity Framework Core, see [Breaking changes for migration from version 2.2 to 3.0](/dotnet/core/compatibility/2.2-3.0).</span></span>

## <a name="aspnet-core-30-not-currently-available-for-azure-app-service"></a><span data-ttu-id="e4d1e-514">ASP.NET Core 3,0 no está disponible actualmente para Azure App Service</span><span class="sxs-lookup"><span data-stu-id="e4d1e-514">ASP.NET Core 3.0 not currently available for Azure App Service</span></span>

<span data-ttu-id="e4d1e-515">Esperamos que esté disponible pronto.</span><span class="sxs-lookup"><span data-stu-id="e4d1e-515">We hope to make this available soon.</span></span> <span data-ttu-id="e4d1e-516">Hasta que ASP.NET Core 3,0 esté disponible en Azure App Service, siga las instrucciones de [Deploy ASP.net Core versión preliminar para Azure App Service](xref:host-and-deploy/azure-apps/index#deploy-aspnet-core-preview-release-to-azure-app-service).</span><span class="sxs-lookup"><span data-stu-id="e4d1e-516">Until ASP.NET Core 3.0 is available on Azure App Service, follow the instructions at [Deploy ASP.NET Core preview release to Azure App Service](xref:host-and-deploy/azure-apps/index#deploy-aspnet-core-preview-release-to-azure-app-service).</span></span>

## <a name="mysqldataentityframeworkcore-not-currently-supported-on-aspnet-core-30"></a><span data-ttu-id="e4d1e-517">MySql. Data. EntityFrameworkCore no se admite actualmente en ASP.NET Core 3,0</span><span class="sxs-lookup"><span data-stu-id="e4d1e-517">MySql.Data.EntityFrameworkCore not currently supported on ASP.NET Core 3.0</span></span>

<span data-ttu-id="e4d1e-518">Para obtener más información, consulte [este problema de GitHub](https://github.com/aspnet/EntityFrameworkCore/issues/17788).</span><span class="sxs-lookup"><span data-stu-id="e4d1e-518">For more information, see [this GitHub issue](https://github.com/aspnet/EntityFrameworkCore/issues/17788).</span></span>
